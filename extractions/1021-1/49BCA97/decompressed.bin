e)}else{if(f.length>0){navigation.setFocus(f[0].id,true)}}}}},disableButtons:function(){if($("ButtonPanel")){$("ButtonPanel").addClass("disabled")}},enableButtons:function(){if($("ButtonPanel")){$("ButtonPanel").removeClass("disabled")}},show:function(){$("titledetails").show();$("titledetailscontainer").show();if(document.getElementById("ButtonPanel")){var d=$("ButtonPanel").getElements("a");navigation.buildNavigation(d)}},showAvailability:function(){var d=this.persist.title.watchStatus;if($cn.utilities.isTrue(this.persist.title.isPassUV)){d="UV_Unavailable"}var e=application.resource.unavailable_messages[d];switch(this.persist.title.watchStatus){case WatchStatus.NotAvailable_HoldBack:e={Message:e.Message.replace("{Date}",$cn.utilities.formatDate(this.persist.title.dateExpired,"short")),Content:e.Content};break;case WatchStatus.NotAvailable_Aired_Episode:e={Message:e.Message.replace("{PurchaseDate}",$cn.utilities.formatDate(this.persist.title.datePurchased,"short")),Content:e.Content};break;case WatchStatus.NotAvailable_Pre_Ordered:e={Message:e.Message.replace("{PurchaseDate}",$cn.utilities.formatDate(this.persist.title.datePurchased,"short")),Content:e.Content};break}if(e){e.Close="Close";BrowseView.showMessage("message_content",e)}},onEpisodes:function(d){BrowseView.showTvEpisodes(this.persist.title)},onWishlistError:function(d){log.write("======== wishlist error 1 ========");log.write("pa0 is: "+d.args[0]);log.write("pa0tid is: "+d.args[0].titleId);log.write("======== wishlist error 2 ========");this.onWishlistInsert(d)},onWishlistInsert:function(f){if(this.persist.title.titleID==f.args[0]){var d=$("tdbuttonWishlist");if(d){if(d==$(application.element.current)){this.setFocus()}d.hide()}if(d.getParent(".half")==null){$("tdbuttonWishlist-1").inject($("tdbuttonWishlist"),"after");log.write("fullsize move")}d=$("tdbuttonWishlist-1");if(d){d.show()}var e=$("ButtonPanel").getElements("a");e.each(function(g){g.removeProperties("up","down","left","right")});navigation.buildNavigation(e)}},onSaveState:function(e){var d=e.args[0];d[this.id]={persist:$extend({},this.persist),tv:this.tv,episode:this.episode,season:this.season,tvshow:this.tvshow}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id])}},TitleViewControl=new Class(TitleViewControlProperties);var WatchStatus={WatchNow:"WatchNow",ExpiredRental:"ExpiredRental",NotAvailable_HoldBack:"NotAvailable_HoldBack",NotAvailable_LicensorRestricted:"NotAvailable_LicensorRestricted",NotAvailable_NotArrived:"NotAvailable_NotArrived",NotAvailable_In_This_Store:"NotAvailable_In_This_Store",NotAvailable_In_This_Territory:"NotAvailable_In_This_Territory",NotAvailable_Aired_Episode:"NotAvailable_Aired_Episode",NotAvailable_Pre_Ordered:"NotAvailable_Pre_Ordered"};var ActiveGrid=null;var GridController=new Class({DEBUG:false,registeredControls:{},spinnerPos:1,spinnerTimer:null,spinnerSpinning:false,spinnerPosition:1,initialize:function(){application.events.subscribe(this,"loadgrid",this.activate.bind(this));application.events.subscribe(this,"gridloading",this.handleGridLoading.bind(this));this.spinnerTimer=new Timer();this.spinnerTimer.Interval=80},activate:function(g){if(this.DEBUG){log.write("gridcontroller.activate Debug: Enter with payload "+log.dumpObj(g))}g=g.args[0];if(BrowseView.LastGridProcess==g.gridProcess){log.write("gridcontroller.activate Debug: Loading grid...position is "+g.position);var d;if(ActiveGrid!=null&&g.grid!=ActiveGrid.id){if(this.DEBUG){log.write("gridcontroller.activate Debug: Hiding active grid.")}d=$(ActiveGrid.id);d.hide()}var e=g.className?g.className:"";ActiveGrid=this.registeredControls[g.grid];ActiveGrid.className=e;ActiveGrid.altMessage=g.altMessage;ActiveGrid.returnFocus=g.returnFocus;ActiveGrid.showFade=g.showFade;d=$(ActiveGrid.id);d.className=e;if((e!="wishlistgrid")&&g.position){if(this.DEBUG){log.write("gridcontroller.activate Debug: payload.position set, calling ActiveGrid.redraw passing data"+log.dumpObj(g.data))}ActiveGrid.redraw(g.data)}else{var f=(!g.data)?0:g.data.length;f=(f!=0&&(g.customLength&&g.customLength>g.data.length))?g.customLength:f;if(this.DEBUG){log.write("gridcontroller.activate Debug: payload.position NOT set, Calling ActiveGrid.loadData passing data of length "+f+": "+log.dumpObj(g.data))}ActiveGrid.loadData(g.data,g.columns,g.template,g.position,f,(g.customPages)?g.customPages:1,g.genreid)}d.show();application.currentView.layoutIsDirty=true}},hideAll:function(){ActiveGrid=null;for(var d in this.registeredControls){$(this.registeredControls[d].id).hide()}},initSpinner:function(){log.write("Init Spinner");BrowseView.GridController.spinnerTimer.Tick=BrowseView.GridController.spinnerTick;if(!BrowseView.GridController.spinnerSpinning){$("gridspinnercontainer").hide();BrowseView.GridController.spinnerPosition=1;BrowseView.GridController.spinnerTimer.Start();BrowseView.GridController.spinnerSpinning=true}},deinitSpinner:function(){BrowseView.GridController.spinnerTimer.Stop();BrowseView.GridController.spinnerSpinning=false;$("gridspinnercontainer").hide()},spinnerTick:function(){var h=document.getElementById("gridspinner");if(h){var g=false;var d=-413;var j=-461;if(!g){d=-1004;j=-1052}BrowseView.GridController.spinnerPosition=(BrowseView.GridController.spinnerPosition+1)%16;var e=BrowseView.GridController.spinnerPosition*80*-1;var f=d;if(BrowseView.GridController.spinnerPosition>7){e=(BrowseView.GridController.spinnerPosition-8)*80*-1;f=j}h.style.backgroundPosition=parseInt(e)+"px "+f+"px";$("gridspinnercontainer").show()}},register:function(d){this.registeredControls[d.id]=d},handleGridLoading:function(f){f=f.args[0];var d;if(ActiveGrid!=null&&f.grid!=ActiveGrid.id){d=$(ActiveGrid.id);d.hide()}var e=f.className?f.className:"";ActiveGrid=this.registeredControls[f.grid];ActiveGrid.className=e;d=$(ActiveGrid.id);d.className=e;d.show();application.currentView.layoutIsDirty=true}});var ContentGridProperties={id:"contentgrid",tplKey:null,tpl:null,_data:[],scroll:false,scrollBuffer:30,imageTimer:null,imageTimerTicking:false,initialize:function(d){this.id=d;this.tplKey=this.id;this.tpl=new ui.template(this.id,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile();this.imageTimer=new Timer();this.imageTimer.Interval=200;log.write(this.id+".init()");application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"scroll",function(e){if($(this.id).offsetWidth){if(e.args[0].isDrag){this.verticalDragScroll(e.args[0].direction,e.args[0].scrollbar,e.args[0].rows)}else{this.onScroll(e.args[0].direction,e.args[0].scrollbar)}}}.bind(this))},initImageTimer:function(){log.write("Init Image Timer");this.imageTimer.Tick=this.validateImages.bind(this);this.imageTimerTime=new Date();if(!this.imageTimerTicking){this.imageTimer.Start();this.imageTimerTicking=true}},deinitImageTimer:function(){this.imageTimer.Stop();this.imageTimerTicking=false},validateImages:function(){log.write("Images Validating...");var g=document.getElementById(this.id).getElementsByTagName("img");var f=g.length,d;if(g.length>0){for(d=0;d<g.length;d++){var e=g[d];if(e.complete){if(e.width>0){f--;log.write("Image loaded.")}else{log.write("0 Width detected. Swap img.");if(document.getElementById("griddefaultbg")){$("griddefaultbg").show();e.style.display="none"}f--}}else{if($cn.utilities.testDuration(this.imageTimerTime,3)){if(document.getElementById("griddefaultbg")){$("griddefaultbg").show();e.style.display="none"}f--}}}if(f===0){log.write("All Images Loaded.");this.onLoad();this.deinitImageTimer()}}else{log.write("image loading error");this.deinitImageTimer();this.onLoad()}},cleanUI:function(){this.tpl.empty();BrowseView.ScrollBar.setRange(0)},loadData:function(f,d,e){if(e&&e!=this.tplKey){this.tpl=new ui.template(this.id,application.ui.loadTpl(e+".tpl"));this.tpl.compile();this.tplKey=e}this._data=[];this._data=f;this.draw()},scaleDefaultImage:function(){alert(this.style.width)},onScroll:function(j,k){var h=$(this.id),e="";if(h){var d=h.childNodes[0];if(d){e=h.clientHeight-this.scrollBuffer;var f=k.getPosition()+(j=="down"?1:-1);f=Math.min(Math.max(0,f),k.range);if(f!=k.getPosition()){var g=-(f*e)+5;d.setStyle("margin-top",g);k.setPosition(f)}}}},verticalDragScroll:function(j,m,d){var f=$(this.id),k="";if(f){var l=f.childNodes[0];if(l){k=f.clientHeight-this.scrollBuffer;log.write("^^^^^^^^^^^^^^titlegrid this.pageSize  "+m.pageSize);var e=m.getPosition()+d;e=Math.min(Math.max(0,e),m.range);var h=-e*k;var g=new Fx.Morph(l,{duration:"short",transition:Fx.Transitions.Sine.easeOut});g.start({"margin-top":h})}}},imgResize:function(d){if(d){if(d.className.indexOf("resize")>-1){log.write(d);if(document.getElementById("griddefaultbg")){document.getElemetById("griddefaultbg").style.display="none"}}}},imgLoad:function(){this.imageCount--;if(this.imageCount===0){this.onLoad()}},imgError:function(d){log.write("image loading error");if(document.getElementById("griddefaultbg")){$("griddefaultbg").show();d.target.style.display="none"}this.imageCount--;if(this.imageCount===0){this.onLoad()}},draw:function(){var d=this,h;this.cleanUI();application.events.publish("gridloading",{grid:this.id});$(this.id).setStyle("visibility","hidden");var g="<div>";this._data.each(function(k){g=g+d.tpl.applyTemplate(k)});g=g+"</div>";var e=g.toElement();if(e){document.getElementById(this.id).appendChild(e)}var j=document.getElementById(this.id).getElementsByTagName("img");this.imageCount=0;for(var f=0;f<j.length;f++){h=j[f].getAttribute("src");log.write("image source "+h);if(j[f].src.indexOf("localhost")>-1||h===""){$("griddefaultbg").show();$(j[f]).hide()}j[f].onerror=function(){log.write("!!image load error");log.write(this);$("griddefaultbg").show();$(this).hide()}}this.onLoad()},navigate:function(d){if((application.element.current&&application.element.current!=="")&&document.getElementById(application.element.current)&&application.element.current==BrowseView.ScrollBar.thumb){if(d.args[0].direction=="left"&&$(this.id).getSize().y){d.preventDefault();navigation.setFocus("selectedslave",true)}}},onLoad:function(){application.events.publish("gridloaded",{grid:this.id});$(this.id).setStyle("visibility","inherit");var g=$(this.id);var d=0,f;if(g){var e=g.childNodes[0];if(e){f=e.clientHeight;if(f>g.clientHeight){d=Math.ceil(f/g.clientHeight)-1;if(((f%g.clientHeight)+(d*this.scrollBuffer))>g.clientHeight){d=d+1}this.scroll=true}}}BrowseView.ScrollBar.setPosition(0);BrowseView.ScrollBar.setRange(d)}},ContentGrid=new Class(ContentGridProperties);var GridControlProperties={DEBUG:false,id:"titlegrid",persist:{},controls:{},history:[],layoutIsDirty:true,template:"",tpl:null,tplCache:{},scroll:true,tplMeta:null,altMessage:null,itemidx:-1,isActive:false,hault:0,currentId:0,currentTopLeft:0,totalRecords:0,currentPage:0,genreid:0,totalPages:0,rowHeight:0,maskViewIndex:-1,gridLoaded:false,itemsRequested:false,metaRequest:null,spinnerPos:1,spinnerTimer:null,spinnerSpinning:false,lastMovement:new Date(),lastNavigationDirection:"",spinnerPosition:1,imgPreloader:[],prefetchSpinner:false,config:{numRows:3,numCols:3,numDisplay:9,numStartIndex:0},_data:[],initialize:function(d){if(d&&d.id){this.id=d.id}this.loadTemplate("listgrid.tpl");this.loadTemplate("refinementgrid.tpl");this.loadTemplate("librarylist.tpl");this.loadTemplate("titlelist.tpl");this.loadTemplate("similarlist.tpl");log.write("gridcontrol.init()");application.element.registerControl(this);application.events.subscribe(this,"elementfocus",this.gridFocus.bind(this));application.events.subscribe(this,"elementblur",this.gridBlur.bind(this));application.events.subscribe(this,"griditemselected",this.loadMeta.bind(this));application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"wheelvaluechanged",this.handleWheelItemChange.bind(this));application.events.subscribe(this,"viewchanged",this.onViewChange.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"error",this.onHandleError.bind(this));application.events.subscribe(this,"pointerdeactivated",this.onPointerdeactivated.bind(this));application.events.subscribe(this,"pointertrack",this.onPointerTrackMove.bind(this));application.events.subscribe(this,"scroll",function(e){this.nextIndexTitle=0;if($("titlelist").offsetWidth){if(e.args[0].rows||e.args[0].rows==0){this.movegrid(e.args[0].direction,Math.abs(e.args[0].rows))}else{this.movegrid(e.args[0].direction,this.config.numRows)}}}.bind(this))},init:function(){},cleanUI:function(){if($("titlelist").getChildren().length>0){$("titlelist").getChildren().destroy()}document.getElementById("titlelist").className="";if(this.tplMeta){this.tplMeta.empty();this.tplMeta=null}BrowseView.ScrollBar.deactivate()},handleWheelItemChangeInit:function(f){log.write("WheelItemChangedInit Called.");var e=f.args[0].wheelinstance;if(e!="SearchWheelControl"&&e!="SettingsWheelControl"&&e!="TitleCheckOutWheelControl"&&e!="TvSeasonsWheelControl"&&e!="HelpWheelControl"){var d=3;if(f.context.activeControl=="TitleMetaWheelControl"){d=2}if(f.args[0].slavevalue!=f.context.currentId){application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:d})}}},handleWheelItemChange:function(h){log.write("grid.handleWheelItemChange Debug: Enter with payload:");log.write(h);var e=this,g=h.args[0].wheelinstance,d=h.args[0].slavevalue,f;if(g!="SearchWheelControl"&&g!="SettingsWheelControl"&&g!="TitleCheckOutWheelControl"&&g!="TvSeasonsWheelControl"&&g!="HelpWheelControl"){f=3;if(h.context.activeControl=="TitleMetaWheelControl"){f=2}if(d!=h.context.currentId){h.context.currentId=d;if(this.DEBUG){log.write("grid.WheelItemChanged Debug: About to call publish with gridloading")}application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:f});setTimeout(function(){if(BrowseView.CurrentWheelValue.indexOf(String(d))>-1){if(this.DEBUG){log.write("grid.WheelItemChanged Debug: About to call getTitlesByGenreId.")}$cn.methods.getTitlesByGenreId(d,1,function(k){if(this.DEBUG){log.write("grid.WheelItemChanged Debug: Back from getTitlesByGenreId with callback "+k)}if(BrowseView.CurrentWheelValue.indexOf(String(d))>-1){var j=null;if($cn.data.RecomendedGenreIds&&$cn.data.RecomendedGenreIds.contains(k.data.result.genreID.toString())){j="recommended_empty"}BrowseView.LastGridProcess="titlelist";if(this.DEBUG){log.write("grid.WheelItemChanged Debug: About to call publish with loadGrid")}application.events.publish("loadgrid",{grid:"titlegrid",data:k.data.result.items,genreid:k.data.result.genreID.toString(),customLength:k.data.result.totalItems,customPages:k.data.result.totalPages,columns:f,altMessage:j,gridProcess:"titlelist",cssClass:""})}else{if(this.DEBUG){log.write("[CALLBACK] Current wheel value does not match payload. Ignore request.")}}})}},1000)}}},gridFocus:function(d){if(document.getElementById(d.args[0].focusedelem)){if($("titlelist").isParentOf($(d.args[0].focusedelem))){log.write("gridfocus");$("titlemeta").setStyle("visibility","visible");this.itemidx=parseInt($(application.element.current).get("titleidx"));this.isActive=true}else{$("titlemeta").setStyle("visibility","hidden");$("titlemeta").setStyle("top","");$("titlelist").setStyle("height","470px");if($("titlegrid").hasClass("episodegrid")){$("titlelist").setStyle("height",this.rowHeight*this.config.numRows+"px")}this.itemidx=-1;this.isActive=false;if(this.maskViewIndex>0){this.setPointerLoseFocus()}}}},gridBlur:function(d){if((this.maskViewIndex>0)&&(d.args[0].nextFocus==null)){this.setPointerLoseFocus()}if($("titlemeta")){$("titlemeta").setStyle("visibility","hidden")}},loadData:function(k,e,g,d,j,h,f){this.numColumns=e;this.cleanUI();this.currentPage=1;this.totalRecords=j;this.totalPages=h;this.genreid=f;this.itemsRequested=false;this.template=(g)?g:"titlelist";this.tpl=this.loadTemplate(this.template+".tpl");switch(this.template){case"refinementgrid":case"listgrid":$("titlelist").addClass("listgrid");break;case"librarylist":case"similarlist":default:$("titlelist").removeClass("listgrid");break}this.config.numStartIndex=d==null?0:d;this.config.numCols=typeof(e)!="undefined"?e:3;this.hideAltMessage();this._data=[];if(k){this._data=k}this.draw();application.events.publish("gridloaded",{grid:this.id})},loadMeta:function(f){var e=(this.lastNavigationDirection=="up"||this.lastNavigationDirection=="down")?250:1;var d=f.args[0].id;this.lastMetakey=f.args[0].id;log.write(this.lastMetakey+":"+d);setTimeout(function(){var m,l;if(d==this.lastMetakey){if(f.context.id=="titlegrid"){this.tplMeta=this.loadTemplate("titlelist."+f.args[0].type+"meta","titlemetacontainer");$("titlemetacontainer").erase("class");$("titlemetacontainer").addClass(f.args[0].type+"meta");if(f.args[0].type=="cast"){log.write("Cast Bio: loading id: "+f.args[0].id);this.tplMeta.emptyAndAppend({});$cn.methods.getCastBio(f.args[0].id,function(n){if(d==this.lastMetakey){n.bio=(n.bio)?n.bio.firstWithEllips(150):"";this.tplMeta.emptyAndAppend(n);this.tplMeta.apply();$("castmeta").setStyle("visibility","inherit")}}.bind(this))}else{if(f.args[0].type=="episode"){var g=this.totalRecords;var k=(g+1)*32;if(g<10){$("titlelist").setStyle("height",k+"px");$("titlemeta").setStyle("top",(k+34)+"px")}else{$("titlelist").setStyle("height",this.rowHeight*this.config.numRows+"px");$("titlemeta").setStyle("top","386px")}j=$cn.data.TitleSummaryCache[f.args[0].id];this.loadTitleSummary(j,f,f.args[0].passID)}else{if(f.args[0].type=="similar"&&$cn.data.TitlesBySimilar[BrowseView.RecomendationWheelControl.titleID+"-"+BrowseView.RecomendationWheelControl.slaveIdx+"-1"]){var h=$cn.data.TitlesBySimilar[BrowseView.RecomendationWheelControl.titleID+"-"+BrowseView.RecomendationWheelControl.slaveIdx+"-1"].data.result,j=$cn.data.TitleSummaryCache[f.args[0].id];this.loadTitleSummary(j,f.args[0],undefined);for(x=0;x<h.similarTitles.length;x++){if(f.args[0].id==h.similarTitles[x].keyName){j.synopsys="Similar because: "+h.similarTitles[x].keyValue;break}}}else{j=$cn.data.TitleSummaryCache[f.args[0].id];if(!j){if(f.args[0].type=="library"){$cn.methods.getPurchasedTitle(f.args[0].passID,f.args[0].id,function(n){if(n){if(n.responseCode==0){this.updateTitleSummary(d,this.lastMetakey,n,f)}else{this.updateTitleSummary(d,this.lastMetakey,null,f);n.errorHandled=true}}}.bind(this))}else{$cn.methods.getShortSummary(f.args[0].id,function(n){if(n){if(n.responseCode==0){this.updateTitleSummary(d,this.lastMetakey,n,f)}else{this.updateTitleSummary(d,this.lastMetakey,null,f);n.errorHandled=true}}}.bind(this))}}else{if(d==this.lastMetakey){log.write("grid: Else processing, about to call loadTitleSummary on title "+j);this.loadTitleSummary(j,f,f.args[0].passID);log.write("grid: Else processing, back from loadTitleSummary on title "+j)}}}}}}}}.bind(this),e)},updateTitleSummary:function(e,g,d,f){if(e==g){this.loadTitleSummary(d,f,f.args[0].passID);if(d){$cn.data.TitleSummaryCache[f.args[0].id]=d}}},loadTitleSummary:function(j,k,g){log.write("grid.loadTitleSummary: Entered with title "+j);if(!j){$("titlemetacontainer").getElement(".metapanel").setStyle("display","none");return}var e=j.name;var d="",h=$cn.utilities.highlightKeywordForSynopsis(j.synopsys,BrowseView.SearchKeyboard.getkeyword()),m;if(BrowseView.currentState==="library-view"){if($cn.data.isPassUVCache&&$cn.data.isPassUVCache[g]){m=$cn.data.isPassUVCache[g].isPassUV}else{m=false}}else{m=$cn.utilities.getMeta("HasUV",j.metaValues)}m=$cn.utilities.isTrue(m)&&$cn.config.EnableUV;log.write("hasUv is: "+m+" from "+BrowseView.currentState);if(j.titleType=="TV_Episode"&&k.args[0].type!="episode"){e=$cn.utilities.getMeta("TVSeasonHeader",j.metaValues);d=$cn.utilities.getMeta("TVEpisodeHeader",j.metaValues);h=""}else{if(j.titleType=="TV_Season"){e=$cn.utilities.getMeta("TVSeasonHeader",j.metaValues)}}if(this.tplMeta){this.tplMeta.emptyAndAppend({titleID:j.titleID,name:e,mPAARating:j.mPAARating,UVAvailable:(m?"yesUV":"noUV"),Episode:d,synopsys:h,hasClosedCaption:($cn.utilities.getMeta("HasClosedCaption",j.metaValues)=="True"?"hasCC":"noCC")});var f=$("titlemeta_title");if($("store").hasClass("search-view")){f.set("html",$cn.utilities.highlightKeywordForTitlename(e,BrowseView.SearchKeyboard.getkeyword()))}if(f){var l=f.getParent().getSize().x;if(f.getNext()){l=l-(f.getNext().offsetWidth)-11;if(f.getNext(".ratingholder").getNext(".ratingholder")){l=l-(f.getNext().getNext().offsetWidth);if(f.getNext(".ratingholder").getNext(".ratingholder").getNext(".ratingholder")){l=l-(f.getNext().getNext().getNext().offsetWidth)}}}f.setStyle("width",Math.min(f.offsetWidth,l)+2);if(f.getNext()){f.getNext().setStyle("padding-left","3px")}}this.tplMeta.apply();$("titlemetacontainer").getElement(".metapanel").setStyle("visibility","inherit");log.debug("Title: "+e+", mPAARating: "+j.mPAARating);log.debug("############################")}},loadHeader:function(e,f){application.putInnerHTML($("titlegrid_header"),"");var d=new ui.template("titlegrid_header",application.ui.loadTpl(e));d.compile();d.append(f);d.apply();$("titlegrid_container").addClass("header")},getElipsisLength:function(){if(BrowseView.DockControl.selection=="dock-search"){return 95}else{if(this.config.numCols==2){return 65}else{return 95}}},loadTemplate:function(f,d){var e=this.tplCache[f];if(e==null){if(d==null){d="titlelist"}e=new ui.template(d,application.ui.loadTpl(f));e.compile();this.tplCache[f]=e}return e},configure:function(){var d=$("titlelist"),g;if(d!=null){if(this._data&&this._data.length){d.show();var e=this.config.numStartIndex;if(this._data[e]){this._data[e].titleidx=e;this.tpl.append(this._data[e]);var f=d.getFirst();this.configure.titleWidth=f.offsetWidth;this.rowHeight=f.offsetHeight+parseInt(f.getStyle("margin-top"))+parseInt(f.getStyle("margin-bottom"))}}else{this.rowHeight=150}g=d.clientHeight>0?d.clientHeight:this.config.numRows*this.rowHeight;this.config.numRows=Math.floor(g/this.rowHeight);this.config.numDisplay=this.config.numCols*this.config.numRows}},resize:function(d){if(this.template=="listgrid"){log.write("Singlewheel display: "+$("singlewheel").getStyle("display"))}$("titlemeta").setStyle("width",$("titlelist").offsetWidth)},redraw:function(h){var d=$("titlelist").getChildren();if(d.length>0){d.destroy()}var g=Math.floor((h.length-this.config.numCols)/this.config.numCols)*this.config.numCols;var f=this.itemidx>=0?this._data[this.itemidx].titleID:0;if(this.config.numStartIndex>g){this.config.numStartIndex=g}this._data=h;this.resize();this.draw();var e=$("titlelist").getElement("a[titleid='"+f+"']");if(e){navigation.setFocusElement(e,true)}application.events.publish("gridloaded",{grid:this.id})},draw:function(){var k,h;$("titlegrid").show();this.configure();this.resize(this.config.numCols);h=Math.min(this.totalRecords,this.config.numStartIndex+this.config.numDisplay);var n=this;if(this.totalRecords>0){this.scroll=!(this.totalRecords<this.config.numDisplay);log.write("totalRecords: "+this.totalRecords+" numDisplay: "+this.config.numDisplay+" numCols: "+this.config.numCols+" this.scroll: "+this.scroll);for(k=this.config.numStartIndex+1;k<h;k++){if(this._data[k]){var q=[],j=0;this._data[k].titleidx=k;this.tpl.append(this._data[k]);if(this._data[k+9]){q[j]=new Image();q[j].src="http://cache.cinemanow.com/images/boxart/v2_107/"+this._data[k+9].boxartPrefix+"v2_107.jpg";j++}q=null;delete q;if(!$cn.data.TitleCache[this._data[k].titleID]){$cn.data.TitleCache[this._data[k].titleID]=this._data[k]}}}this.tpl.apply();$$("#titlelist .title img").each(function(r){r.onerror=function(s){log.write("IMAGE ERROR");r.hide()}});if(typeof $cn.config.CustomDefaultGridImage=="function"){$$("#titlelist .title .title-text").each(function(s){var r=$cn.config.CustomDefaultGridImage(s);s.addClass(r)})}var g=$("titlelist");var m=g.getFirst();var d=Math.min(Math.floor(($("titlemeta").getPosition().y-g.getPosition().y)/this.rowHeight),this.config.numRows);var p=Math.ceil(this.totalRecords/this.config.numCols);var e=$("store").hasClass("episode-panel");var f=$("store").hasClass("search-view");if(e&&!f){log.write("##### adjusting tv episodes scrollbar ########");$("scrollbar").setStyles({"margin-top":"33px",height:g.offsetHeight})}else{if($("titlegrid").hasClass("refinementgrid")){$("scrollbar").setStyles({"margin-top":"0px",height:g.offsetHeight});$("scrollbar").getElement(".scrollarea").addClass("refinementgridAreaHeight")}else{$("scrollbar").setStyles({"margin-top":"0px",height:g.offsetHeight})}}var l=$("scrollbar").getElement(".scrollbottom").getStyle("height");$("scrollbar").getElement(".scrollarea").setStyle("height",g.offsetHeight-parseInt(l)*2);if(Math.max(0,p-d)>0){BrowseView.ScrollBar.setPosition(Math.floor(this.config.numStartIndex/this.config.numCols));BrowseView.ScrollBar.setRange(Math.max(0,p-d));BrowseView.ScrollBar.draw()}}else{this.showAltMessage();if($("store").hasClass("browse-view")){navigation.setFocus("selectedslave",true);if(pointer.isPointerModeActive()){if($("slavewheelmaskup").getStyle("opacity")=="0.6"||$("slavewheelmaskdown").getStyle("opacity")=="0.6"){navigation.setFocus("selectedslave",true)}if($("masterwheelmaskup").getStyle("opacity")=="0.6"||$("masterwheelmaskdown").getStyle("opacity")=="0.6"){navigation.setFocus("selectedmaster",true)}}}}application.currentView.layoutIsDirty=true},itemCount:function(){return this.totalRecords},getPosition:function(){return BrowseView.ScrollBar.getPosition()*this.config.numCols},remove:function(h){if(h>=0&&h<this.totalRecords){var j=$("titlelist"),g=j.getChildren(),e;this._data.splice(h,1);if(g.length){var f=parseInt(g[0].getElement("a").get("titleidx")),d=f+g.length;if(h>=f&&h<d){this.tpl.empty();for(e=f;e<d;e++){if(this._data[e]){this._data[e].titleidx=e;this.tpl.append(this._data[e])}}this.tpl.apply();if(h==this.itemidx){var l=Math.min(this.totalRecords-2,h);navigation.setFocusElement(j.getElement("a[titleidx='"+l+"']"),true);this.nextIndexTitle=l}this.totalRecords--}}var k=BrowseView.ScrollBar.getPosition();BrowseView.ScrollBar.setRange(this.totalRecords<(this.config.numDisplay-this.config.numCols)?0:Math.ceil((this.totalRecords-(this.config.numDisplay-this.config.numCols))/this.config.numCols));if(k>0&&k>BrowseView.ScrollBar.range){this.movegrid("up",1)}application.currentView.layoutIsDirty=true}},showAltMessage:function(){var e="";if(this.altMessage){e=this.altMessage}else{if(BrowseView.DockControl.selection=="dock-search"){if(BrowseView.SearchKeyboard._currentValue.length>=1){e="search_empty"}else{return}}else{e="empty"}}var d=new ui.template("altmessage",application.ui.loadTpl(e+".tpl"));d.compile();d.empty();d.append();d.apply();$("titlelist").hide();$("altmessage").show()},hideAltMessage:function(){$("altmessage").hide();$("altmessage").set("html","")},onViewChange:function(d){this.currentView=d.args[0]},setPointerFocus:function(h){var g=$("titlelist");var n=g.getElement("a[titleidx='"+h+"']");var d=Math.min(Math.floor(($("titlemeta").getPosition().y-g.getPosition().y)/this.rowHeight),this.config.numRows);var e=g.getChildren();var l;var k=parseInt(this.totalRecords)-1;var j=(e[0])?e[0].getElements("a")[0]:null;this.currentTopLeft=(j)?(j.get("titleidx")!=null?parseInt(j.get("titleidx")):-1):(k+1);var f=h-this.currentTopLeft;if((f)>=(this.config.numCols*d)){var m=f-this.config.numCols;if(this.maskViewIndex>0){this.setPointerLoseFocus()}this.maskViewIndex=f;l=$(e[this.maskViewIndex]);if(l&&l.getElement(".titlelistmask")){l.getElement(".titlelistmask").show()}n=g.getElement("a[titleidx='"+(h-this.config.numCols)+"']");navigation.setFocusElement(n)}else{navigation.setFocusElement(n);if(this.maskViewIndex>0){this.setPointerLoseFocus()}}},setPointerLoseFocus:function(){var f=$("titlelist");var e=f.getChildren();var d;if(this.maskViewIndex>0){d=$(e[this.maskViewIndex]);if(d&&d.getElement(".titlelistmask")){d.getElement(".titlelistmask").hide();this.maskViewIndex=-1}}},clickAction:function(){this.setPointerLoseFocus();this.movegrid("down",1)},metaClickAction:function(){var h=this.maskViewIndex;if((this.maskViewIndex>0)&&(this.template!="listgrid")&&(this.template!="refinementgrid")){this.setPointerLoseFocus();this.movegrid("down",1);var g=$("titlelist");var f=g.getChildren();var d=(f[0])?f[h].getElements("a")[0]:null;var e=d.get("titleidx");this.setPointerFocus(e)}},onPointerdeactivated:function(){this.setPointerLoseFocus()},onPointerTrackMove:function(f){var j=f.args[0];var k=$("titlelist");var g=k.getChildren();var l;var n;var m;var d=Math.min(Math.floor(($("titlemeta").getPosition().y-k.getPosition().y)/this.rowHeight),this.config.numRows);if((this.template=="refinementgrid")||(this.template=="listgrid")){return}if($(g[this.config.numCols*d])==null){return}else{for(var h=(this.config.numCols*d);h<((this.config.numCols*d)+this.config.numCols);h++){l=$(g[h]).getBoundingClientRect();if((j.clientX>l.left)&&(j.clientX<l.right)&&(j.clientY>l.top)&&(j.clientY<l.bottom)){n=g[h].getElements("a")[0];m=parseInt(n.get("titleidx"));this.setPointerFocus(m);break}}}},loadPage:function(d){$cn.methods.getTitlesByGenreId(this.genreid,d,function(e){self=this.self;log.write("Got title response. itemsRequested="+self.itemsRequested+", page="+this.page+", currentPage="+self.currentPage);if(self.itemsRequested&&self.currentPage==this.page){self.itemsRequested=false;log.write("before concat: "+self._data.length+" result items. ->"+e.data.result.items.length);self._data=self._data.concat(e.data.result.items);log.write("after concat "+e.data.result.items.length+" items, yielding "+self._data.length);if(self.prefetchSpinner){self.movegrid("down",0);application.events.publish("gridloaded",{grid:self.id})}}}.bind({self:this,page:d}))},loadPageForInstant:function(g,f,e,h,d){log.write("send request:"+h);$cn.methods.getTitlesByGenreId(this.genreid,f,function(p){self=this.self;log.write("Got title response. itemsRequested="+self.itemsRequested+", page="+this.page+", currentPage="+self.currentPage);if(self.itemsRequested||h){self.itemsRequested=false;log.write("before concat: "+self._data.length+" result items. ->"+p.data.result.items.length);var n=p.data.result.items.slice(0);var l=(this.page-1)*$cn.data.PAGE_SIZE;log.write("pageStart concat: "+l);for(var k=0;k<n.length;k++){self._data[l++]=n[k]}log.write("after concat "+p.data.result.items.length+" items, yielding "+self._data.length);log.write("requestIndex "+h);if(h==1){self.loadPageForInstant(g,d+1,e,2);return}else{if(self.prefetchSpinner){var m=e.start;var j=e.end;if(g=="down"){self.dragshowDown(m,j)}else{if(g=="up"){self.dragshowUp(m,j)}}application.events.publish("gridloaded",{grid:self.id});self.prefetchSpinner=false}}}}.bind({self:this,page:f}))},dragshowUp:function(d,f){log.write("---------------draw:"+d+":"+f+" ****************");log.write("--------data length:"+this._data.length+" ****************");var j,h=$("titlelist");if(d<=f){var p=[];var g=0;var m=false;var k=this.config.numCols;var e=1;for(var l=f;l>=d;l--){if(this._data[l]){this._data[l].titleidx=l;this.tpl.prepend(this._data[l]);log.write("prepend:"+this._data[l].name+"-"+this._data[l].titleID+" ****************")}}this.tpl.apply();$$("#titlelist .title img").each(function(q){q.onerror=function(r){log.write("IMAGE ERROR");q.hide()}});if(typeof $cn.config.CustomDefaultGridImage=="function"){$$("#titlelist .title .title-text").each(function(r){var q=$cn.config.CustomDefaultGridImage(r);r.addClass(q)})}j=h.getChildren()}p=null;application.currentView.layoutIsDirty=true;this.hault=0;if(!application.element.current){application.element.current="app-gen-0"}log.write("nextIndexTitle--"+this.nextIndexTitle);if(this.nextIndexTitle){var n=h.getElement("a[titleidx='"+this.nextIndexTitle+"']");navigation.setFocus(n,true);this.nextIndexTitle=0}for(i=f-d+1;i<j.length;i++){j[i].destroy();log.write("destroy:"+i+" ****************")}this.prefetchSpinner=false},dragshowDown:function(d,g){log.write("---------------draw:"+d+":"+g+" ****************");log.write("--------data length:"+this._data.length+" ****************");var l,k=$("titlelist");var h=k.getChildren().length;if(d<=g){var r=[];var j=0;var p=false;var m=this.config.numCols;var f=1;for(var n=d;n<=g;n++){if(this._data[n]){this._data[n].titleidx=n;this.tpl.append(this._data[n]);log.write("append:"+this._data[n].name+"-"+this._data[n].titleID+" ****************")}}this.tpl.apply();$$("#titlelist .title img").each(function(s){s.onerror=function(u){log.write("IMAGE ERROR");s.hide()}});if(typeof $cn.config.CustomDefaultGridImage=="function"){$$("#titlelist .title .title-text").each(function(u){var s=$cn.config.CustomDefaultGridImage(u);u.addClass(s)})}l=k.getChildren()}r=null;var e=[];for(i=0;i<h;i++){e[i]={"margin-top":-(this.rowHeight*1)}}for(var n=0;n<e.length;++n){l[n].setStyles(e[n]);log.write("setStyles:"+n+"  "+e[n]["margin-top"]+" ****************")}application.currentView.layoutIsDirty=true;this.hault=0;if(!application.element.current){application.element.current="app-gen-0"}elem1=null;for(i=0;i<l.length;i++){if(l[i].style.marginTop&&parseInt(l[i].style.marginTop.replace("px",""))<0){l[i].destroy();log.write("destroy:"+i+" ****************")}}log.write("nextIndexTitle--"+this.nextIndexTitle);if(this.nextIndexTitle){var q=k.getElement("a[titleidx='"+this.nextIndexTitle+"']");navigation.setFocus(q,true);this.nextIndexTitle=0}this.prefetchSpinner=false},movegrid:function(N,q){log.write("hault: "+this.hault);var I=application.loadAnimation("grid"),K=I.options.duration,E,r,O,s,F=this._data.length,m,f,e,G,B,v,J,H,A,n,k,l,L=false,h,D,u,C,P,w,p,d=I.options.fps,g=I.options.transition;log.write("^^^^^^^^^^^^^^titlegrid this.pageSize  "+BrowseView.ScrollBar.pageSize);this.lastMovement=new Date();if(this.hault==0){s="";J=$("titlelist");v=J.getChildren();P=this.totalRecords;O=(v[0])?v[0].getElements("a")[0]:null;r=this.config.numCols;H=this.config.numDisplay;e=parseInt(this.totalRecords)-1;n=q;w=v.length;E=false;this.currentTopLeft=(O)?(O.get("titleidx")!=null?parseInt(O.get("titleidx")):-1):(e+1);E=(!O);l=Math.floor(this.currentTopLeft/r);log.write("original length of this._data[]:"+this._data.length);if(N=="down"){log.write("start drag  down ************");log.write("============ prefetch spinner is: "+this.prefetchSpinner);if(l<BrowseView.ScrollBar.range){if(this.showFade){$("HorizontalFadeTop").show()}this.hault=1;k=Math.min(BrowseView.ScrollBar.range,l+q);log.write("row: "+l+" range: "+BrowseView.ScrollBar.range);log.write("=====|||  rows: "+q+"  pos: "+k+"||||========");C=k*this.config.numCols;K=(n==1)?K:K*2;h=C;f=Math.min(e,C+this.config.numDisplay-1);log.write(" start-end :"+h+":"+f+" ****************");if(((1000/d)*2)>=K){K=100;d=1000/K}if(!this._data[h]||!this._data[f]){var j=Math.floor(h/$cn.data.PAGE_SIZE);var M=Math.floor(f/$cn.data.PAGE_SIZE);if(M<=this.totalPages){if(!this.itemsRequested){log.write("loading from ws request :"+h+":"+f+" ****************");this.itemsRequested=true;this.prefetchSpinner=true;application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:this.numColumns});if(j==M){log.write("loading  $cn.data.PAGE_SIZE 27 "+$cn.data.PAGE_SIZE);log.write("*********loading startpage+1:"+(j+1));this.loadPageForInstant(N,j+1,{start:h,end:f})}else{log.write("loading  $cn.data.PAGE_SIZE 27 x 2 "+$cn.data.PAGE_SIZE);log.write("*********loading startpage+1 & endpage+1:"+(j+1)+"  "+(M+1));this.loadPageForInstant(N,j+1,{start:h,end:f},1,M)}this.currentPage=j;n=0}}else{log.write("pre-fetch call not made. currentPage:"+this.currentPage+" is >= totalPages:"+this.totalPages)}}else{log.write("loading from local _data[]*********************:"+h+":"+f+" ****************");this.dragshowDown(h,f)}BrowseView.ScrollBar.setPosition(k)}else{log.write("row >= range ,it's the bottom, no movement made")}}else{if(N=="up"){log.write("start drag up ************");if(l>0){this.hault=1;k=Math.max(l-q,0);C=k*r;K=(n==1)?K:K*2;if(((1000/d)*2)>=K){K=100;d=1000/K}h=C;f=Math.min(e,C+this.config.numDisplay-1);if(!this._data[h]||!this._data[f]){var j=Math.floor(h/$cn.data.PAGE_SIZE);var M=Math.floor(f/$cn.data.PAGE_SIZE);if(M<=this.totalPages){if(!this.itemsRequested){log.write("loading from ws request :"+h+":"+f+" ****************");this.itemsRequested=true;this.prefetchSpinner=true;application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:this.numColumns});if(j==M){log.write("loading  $cn.data.PAGE_SIZE 27 "+$cn.data.PAGE_SIZE);log.write("*********loading startpage+1:"+(j+1));this.loadPageForInstant(N,j+1,{start:h,end:f})}else{log.write("loading  $cn.data.PAGE_SIZE 27 xxxxxx 2 "+$cn.data.PAGE_SIZE);log.write("*********loading startpage+1 & endpage+1:"+(j+1)+"  "+(M+1));this.loadPageForInstant(N,j+1,{start:h,end:f},1,M)}this.currentPage=j;n=0}}else{log.write("pre-fetch call not made. currentPage:"+this.currentPage+" is >= totalPages:"+this.totalPages)}}else{log.write("loading from local _data[]*********************:"+h+":"+f+" ****************");this.dragshowUp(h,f)}this.currentTopLeft=C;BrowseView.ScrollBar.setPosition(k);m=null}else{log.write("row <= 0 , it's the top, no movement made")}}}J=null;O=null}},movegridOld:function(M,q){log.write("hault: "+this.hault);var I=application.loadAnimation("grid"),K=I.options.duration,E,r,N,s,F=this._data.length,m,g,f,G,B,v,J,H,A,n,k,l,L=false,j,D,u,C,O,w,p,e=I.options.fps,h=I.options.transition;this.lastMovement=new Date();if(this.hault==0){s="";J=$("titlelist");v=J.getChildren();O=this.totalRecords;N=(v[0])?v[0].getElements("a")[0]:null;r=this.config.numCols;H=this.config.numDisplay;f=parseInt(this.totalRecords)-1;n=q;w=v.length;E=false;this.currentTopLeft=(N)?(N.get("titleidx")!=null?parseInt(N.get("titleidx")):-1):(f+1);E=(!N);l=Math.floor(this.currentTopLeft/r);log.write("============== items requested is: "+this.itemsRequested);if(M=="up"){log.write("===== moving on up ========");if(this.prefetchSpinner){application.events.publish("gridloaded",{grid:this.id});this.prefetchSpinner=false}if(l>0){this.hault=1;k=Math.max(-q,l-q);C=k*r;K=(n==1)?K:K*2;if(((1000/e)*2)>=K){K=100;e=1000/K}for(G=parseInt(this.currentTopLeft)-1;G>=C;--G){if(this._data[G]){this._data[G].titleidx=G;this.tpl.prepend(this._data[G])}}this.tpl.apply();$$("#titlelist .title img").each(function(P){P.onerror=function(Q){log.write("IMAGE ERROR");P.hide()}});if(typeof $cn.config.CustomDefaultGridImage=="function"){$$("#titlelist .title .title-text").each(function(Q){var P=$cn.config.CustomDefaultGridImage(Q);Q.addClass(P)})}v=J.getChildren();u=(k-l)*(this.rowHeight)+1;for(G=0;G<(r*n)&&(G<v.length);G++){v[G].setStyle("margin-top",u)}A={};for(G=0;G<(r*n);G++){if(G<v.length){A[G]={"margin-top":"1px"}}}if(device.getDeviceSoc()!="BCOM"){application.TempKeyBlockEnter=true;application.TempKeyBlockDuration=K*2;if(!application.element.current){application.element.current="app-gen-0"}m=new Fx.Elements(v,{duration:(L)?0:K,fps:e,transition:h,onComplete:function(P){application.TempKeyBlockEnter=false;if(this.currentTopLeft==0&&this.showFade){$("HorizontalFadeTop").hide()}if(E){if(v[v.length]&&v[v.length].id){navigation.setFocus(v[v.length].id,true)}else{navigation.setFocus("singleselectedmaster",true)}}setTimeout(function(){var Q;application.currentView.layoutIsDirty=true;for(Q=v.length-1;Q>=H;--Q){log.write("Removing title at "+Q);v[Q].destroy()}this.config.numStartIndex=C;this.hault=0}.bind(this),200)}.bind(this)});m.start(A)}else{for(var p=0;p<v.length;++p){v[p].setStyles(A[p]);if(this.currentTopLeft==0&&this.showFade){$("HorizontalFadeTop").hide()}if(E){if(v[v.length]&&v[v.length].id){navigation.setFocus(v[v.length].id,true)}else{navigation.setFocus("singleselectedmaster",true)}}setTimeout(function(){var P;application.currentView.layoutIsDirty=true;for(P=v.length-1;P>=H;--P){log.write("Removing title at "+P);v[P].destroy()}this.config.numStartIndex=C;this.hault=0}.bind(this),200)}}this.currentTopLeft=C;BrowseView.ScrollBar.setPosition(k);m=null}}else{if(M=="down"){log.write("============ prefetch spinner is: "+this.prefetchSpinner);if(l<BrowseView.ScrollBar.range){log.write("row: "+l+" range: "+BrowseView.ScrollBar.range);if(this.showFade){$("HorizontalFadeTop").show()}this.hault=1;k=Math.min(BrowseView.ScrollBar.range,l+q);C=k*this.config.numCols;K=(n==1)?K:K*2;j=parseInt(this.currentTopLeft)+v.length;g=Math.min(f,C+this.config.numDisplay);if(j>=g){n=1;k=Math.min(BrowseView.ScrollBar.range,l+n);C=k*this.config.numCols;K=(n==1)?K:K*2;j=parseInt(this.currentTopLeft)+v.length;g=Math.min(f,C+this.config.numDisplay)}if(((1000/e)*2)>=K){K=100;e=1000/K}if(g>F){n=q=0;log.write("======= user scrolled to end of page =======================");if(this.itemsRequested){this.prefetchSpinner=true;application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:this.numColumns})}}log.write("this.currentTopLeft: "+this.currentTopLeft+" finalIndex: "+f+" pos: "+k+" topLeft: "+C+" start: "+j+" end: "+g+" items.length: "+v.length);if(!this._data[g+$cn.data.PAGE_PRE_FETCH]){log.write("===== Getting ready to make pre fetch page call (itemsRequested="+this.itemsRequested+") ========");if(this.currentPage<this.totalPages){if(!this.itemsRequested){this.currentPage++;this.itemsRequested=true;log.write("before method. currentPage = "+this.currentPage+", items = "+this._data.length);this.loadPage(this.currentPage)}}else{log.write("pre-fetch call not made. currentPage:"+this.currentPage+" is >= totalPages:"+this.totalPages)}}log.write("Rendering items "+j+" to "+g);D=[];if(j<=g){B=0;for(p=j;p<=g;p++){if(this._data[p]){this._data[p].titleidx=p;this.tpl.append(this._data[p]);if(!L){if(this._data[p+(n*r)]){D[B]=new Image();D[B].src="http://cache.cinemanow.com/images/boxart/v2_107/"+this._data[p+(n*r)].boxartPrefix+"v2_107.jpg";B++}}}}this.tpl.apply();$$("#titlelist .title img").each(function(P){P.onerror=function(Q){log.write("IMAGE ERROR");P.hide()}});if(typeof $cn.config.CustomDefaultGridImage=="function"){$$("#titlelist .title .title-text").each(function(Q){var P=$cn.config.CustomDefaultGridImage(Q);Q.addClass(P)})}v=J.getChildren()}D=null;A={};for(G=0;G<(r*n);G++){if(G<v.length){A[G]={"margin-top":-(this.rowHeight*n)}}}if(device.getDeviceSoc()!="BCOM"){application.TempKeyBlockEnter=true;application.TempKeyBlockDuration=K*2;m=new Fx.Elements(v,{duration:(L)?0:K,fps:e,transition:h,onComplete:function(P){application.TempKeyBlockEnter=false;application.currentView.layoutIsDirty=true;this.hault=0;for(G=0;G<v.length;G++){if(v[G].style.marginTop&&parseInt(v[G].style.marginTop.replace("px",""))<0){v[G].destroy()}}log.write("Deleted overflow titles.");this.config.numStartIndex=C}.bind(this)});m.start(A)}else{for(var p=0;p<v.length;++p){v[p].setStyles(A[p])}application.currentView.layoutIsDirty=true;this.hault=0;for(G=0;G<v.length;G++){if(v[G].style.marginTop&&parseInt(v[G].style.marginTop.replace("px",""))<0){v[G].destroy()}}log.write("Deleted overflow titles.");this.config.numStartIndex=C}if(!application.element.current){application.element.current="app-gen-0"}var d=parseInt($(application.element.current).get("titleidx"),10);if(d+1+r>=this.totalRecords-r){log.write("*********** bottom of page *****************");k=BrowseView.ScrollBar.range}BrowseView.ScrollBar.setPosition(k);m=null}}}J=null;N=null}},navigate:function(m){if(this.isActive){if(this.prefetchSpinner){m.preventDefault();return}this.lastNavigationDirection=m.args[0].direction;if(m.args[0].direction=="up"||m.args[0].direction=="down"){m.preventDefault();log.write("hault: "+this.hault);if(this.hault!=1){var n=false,g=$("titlelist"),j=g.getChildren(),k=m.args[0].direction,h=parseInt($(application.element.current).get("titleidx"),10),f=h+(k=="up"?-this.config.numCols:this.config.numCols);if(f>=this.totalRecords){if(Math.floor((this.totalRecords-1)/this.config.numCols)>Math.floor(h/this.config.numCols)){f=this.totalRecords-1}}this.nextIndexTitle=f;if(f>=0&&f<this.totalRecords){this.currentTopLeft=parseInt(j[0].getElements("a")[0].get("titleidx"));if(f<this.currentTopLeft){if(this.prefetchSpinner){n=true}else{this.movegrid("up",1)}}else{if((f>=this.currentTopLeft+this.config.numDisplay)){if(this.prefetchSpinner){n=true}else{this.movegrid("down",1)}}else{var p=j[f-this.currentTopLeft];if(!p){return}if((p.getPosition().y+p.getSize().y)>$("titlemeta").getPosition().y){this.movegrid("down",1)}}}if(!n){var q=g.getElement("a[titleidx='"+f+"']");if(q){navigation.setFocus(q,true)}}}}}else{if(m.args[0].direction=="left"){if(this.itemidx%this.config.numCols==0){if(this.returnFocus){navigation.setFocus(this.returnFocus,true);m.preventDefault()}}else{f=this.itemidx-1;navigation.setFocusElement($("titlelist").getElement("a[titleidx='"+f+"']"),true);m.preventDefault()}}else{if(m.args[0].direction=="right"){m.preventDefault();if(this.itemidx%this.config.numCols==this.config.numCols-1||this.itemidx==this.totalRecords-1){if(document.getElementById("scrollbar")&&document.getElementById("scrollbar").style.display=="block"){navigation.setFocus(BrowseView.ScrollBar.thumb,true)}}else{f=this.itemidx+1;var d=$("titlelist").getElement("a[titleidx='"+f+"']");if(d){navigation.setFocusElement($("titlelist").getElement("a[titleidx='"+f+"']"),true)}}}}}}else{if((application.element.current&&application.element.current!="")&&document.getElementById(application.element.current)&&application.element.current==BrowseView.ScrollBar.thumb){if(m.args[0].direction=="left"&&$("titlelist").getSize().y){if(this.hault==0){var e=$("titlelist").getElementsByTagName("a");var l=Math.min(e.length-1,this.config.numCols-1);if(e.length>l){application.navigator.setFocusElement(e[l],true);m.preventDefault()}}else{m.preventDefault()}}}}},onSaveState:function(e){var d=e.args[0];d[this.id]={_data:this._data,tpl:this.tpl,isActive:this.isActive,rowHeight:this.rowHeight,returnFocus:this.returnFocus,hault:0,currentPage:this.currentPage,totalRecords:this.totalRecords,totalPages:this.totalPages,itemidx:this.itemidx,genreid:this.genreid,config:$extend({},this.config),showFade:this.showFade,itemsRequested:this.itemsRequested};this.itemsRequested=false},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id]);this.config=$extend({},d[this.id].config);if(this.itemsRequested){this.loadPage(this.currentPage)}},onHandleError:function(d){if(this.itemsRequested){this.currentPage--;this.itemsRequested=false}}},GridControl=new Class(GridControlProperties);var ModalControlProperties={id:"modalcontrol",persist:{},controls:{},buttons:[],layoutIsDirty:true,_data:[],tpl:null,scroll:false,lastFocus:null,firstFocus:null,contentControlId:"",isNowVisible:false,contentId:"ModalContent",initialize:function(e,d){this.id=e;if(d){this.contentId=d}this.tpl=new ui.template(this.contentId,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile()},setCssClass:function(d){$("modalcontrol").erase("class");$("modalcontrol").addClass(d);if(d!=this.id){$("modalcontrol").addClass(this.id)}},init:function(e,d){log.write("modalcontrol.init()");this.hide();if(e){this.persist=e}},cleanUI:function(){},loadData:function(d){log.write("loadData modal.js");this._data=[];this._data=d;this.draw()},draw:function(){log.write("draw modal.js");var d=this;this.cleanUI();this.tpl.empty();this._data.each(function(g){d.tpl.append(g)});var f=this.tpl.apply();if(!this.firstFocus){var e=$(this.contentId).getElement(".default");if(e){this.firstFocus=e.id}}},html:function(d){$(this.contentId).set("html",d)},resetFocus:function(){log.write("resetting modal focus");if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastFocus=application.element.current}},show:function(){this.isNowVisible=true;log.write("showing a modal");if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastFocus=application.element.current}if(this.firstFocus){if(pointer.isPointerModeActive()){pointer.lastFocusId=this.firstFocus;navigation.setFocus(null)}else{navigation.setFocus(this.firstFocus,true)}}this.setCssClass(this.id);var d=(application.resource.modalConfig[this.id])?application.resource.modalConfig[this.id]:(application.resource.modalConfig["default"]);for(style in d){$("ModalWindow").setStyle(style,d[style])}log.write("making modalcontrol visible");$("modalcontrol").show();application.events.subscribe(this,"back",this.onBack.bind(this))},hide:function(){this.isNowVisible=false;log.write("..... hiding modal .....");application.events.unsubscribe(this,"back");if(this.lastFocus){if(this.lastFocus==="playerctl"&&(!$("playerctl")||!$("playerctl").style||!$("playerctl").style.display||$("playerctl").style.display==="none")){log.write("modal title view set focus");BrowseView.TitleViewControl.setFocus()}else{log.write("modal title view nav focus");navigation.setFocus(this.lastFocus,true)}}else{navigation.setFocus("dock-home",true)}$("modalcontrol").hide();var d=document.getElementById("ModalWindow");d.removeAttribute("style")},onBack:function(d){if(d){d.preventDefault()}this.hide()},startPlay:function(e,f){log.write("start play");var d=this;var g=$cn.utilities.showLoadingModal(2000,"Loading Title...");$cn.methods.getPurchasedTitle(f,e,function(h){$cn.utilities.clearLoadingSpinner(g);log.write("Current Pass: "+f);if(!$cn.data.PassCache[f]){log.write("Adding pass to pass cache");$cn.data.PassCache[f]=h}var m=false,j="24";for(x=0;x<h.availableProducts.length;x++){if(h.availableProducts[x].purchaseType=="rent"){if($cn.utilities.getMeta("LicensesDelivered",h.metaValues)=="0"){m=true;j=h.availableProducts[x].rentalPeriod;break}}}if(m){log.write("---- rental pathway -----");var l=application.resource.checkout_messages.Rental_Warning;var k={Message:l.Message.replace("##name##",h.name),Content:l.Content.replace("##rentalperiod##",j).replace("##expirationmessage##",h.expirationMessage.replace("Expires","")),Close:"No",OK:"Yes",callback:function(n){if(n){d.hide();BrowseView.showPlay(e,f,0)}}};BrowseView.showMessage("message_okcancel",k)}else{log.write("---- not rental pathway -----");BrowseView.showPlay(e,f,0)}}.bind(this))}},ModalControl=new Class(ModalControlProperties);var TitleMetaWheelControl=new Class({Extends:WheelControl,Implements:WheelControl,id:"TitleMetaWheelControl",MetaData:[],handleWheelItemChange:function(f){log.write(f);if(f.context===ActiveWheel){var e=f.args[0];log.write("Title Wheel Item changed. Now fire custom method. "+f.args[0].wheelinstance);if(e.sourceid.indexOf("master")>-1){$("slavedatasource").getElements("div").destroy();f.context.loadSlaveDataSource(e.selectedvalue)}else{if(e.sourceid.indexOf("slave")>-1){log.write("The slave wheel item has changed. Update results.");var d=f.args[0].selectedvalue.split("|");this.loadSlaveGrid(d[0],d[1])}}}},loadSlaveGrid:function(l,g){var j=this.MetaData[l];switch(l){case"m_cast_bios":j.each(function(m){if(m.castID==g){BrowseView.LastGridProcess="bios";m.bio=m.bio.firstWithEllips(4500);application.events.publish("loadgrid",{grid:"biogrid",gridProcess:"bios",data:[m],columns:1})}});break;case"r_user_revs":case"r_critics":log.write(l+":"+g);j.each(function(n){if(n.reviewer==g){var m="reviewgrid";if(l=="r_user_revs"){m="userreviewgrid"}BrowseView.LastGridProcess="reviews";application.events.publish("loadgrid",{grid:"reviewgrid",gridProcess:"reviews",data:[n],columns:1,template:m})}});break;case"m_cast_crew":break;case"m_credits":var f=[],k=[],e,h;if(j){if(g=="0"){e="";j.castMetaValues.each(function(m){if(m&&m.keyName!=""&&m.keyValue!=""){e=e+"<p>"+m.keyName+" ("+m.keyValue+")</p>"}else{if(m&&m.keyName!=""){e=e+"<p>"+m.keyName+"</p>"}}});f.push({keyName:"Actors",keyValue:e});f.push({keyName:"",keyValue:"FBI Anti-piracy Warning: Unauthorized copying is punishable under Federal Law.<br />"});BrowseView.LastGridProcess="credits";application.events.publish("loadgrid",{grid:"creditsgrid",gridProcess:"credits",data:f,columns:1,template:"creditsgrid"})}else{e="";j.productionMetaValues.each(function(m){h=false;k.each(function(n){if(n.keyName==m.keyName){n.keyValue=n.keyValue+m.keyValue+"<br />";h=true}});if(!h){k.push({keyName:m.keyName,keyValue:m.keyValue+"<br />"})}});k.push({keyName:"",keyValue:"FBI Anti-piracy Warning: Unauthorized copying is punishable under Federal Law.<br />"});BrowseView.LastGridProcess="production";application.events.publish("loadgrid",{grid:"creditsgrid",gridProcess:"production",data:k,columns:1,template:"creditsgrid"})}}break;case"m_technical_details":if(j){var d=[];j.technicalDetailItems.each(function(m){if(m.videoRecordingFormat==g||m.name==g){d.push(m)}});if(d){BrowseView.LastGridProcess="tech";application.events.publish("loadgrid",{grid:"techgrid",gridProcess:"tech",data:d,columns:1,template:"techgrid"});if(!d[0]&&!d[0].audioFormat){$("audioTech").hide()}if(d[0].name=="UltraViolet"){$("uv-technical-details").removeClass("hidden");if(d[0].streaming){$("tech-streaming").show()}if(d[0].downloads){$("tech-downloads").show()}}else{$("videoTech").removeClass("hidden");$("audioTech").removeClass("hidden")}}}break;default:break}},isSpecialAudio:function(d){var e="hidden";log.write(d);$cn.config.HackedDtsTitles.each(function(f){if(BrowseView.CurrentTitleID==f&&d=="1080p"){e="visible"}});return e},loadSlaveDataSource:function(f){log.write("masterKey: "+f);var m=this;var d=false;if(this._slaveSource[this._masterSource[f]]){this._renderWheel($("slavedatasource"),this._slaveSource[f])}else{var l=(f.indexOf("s_")==0),h=(f.indexOf("r_")==0),j=(f.indexOf("m_")==0),g=null,k;if(l){log.write('Load Similar sub-sections. Right now only option is "ALL"');if(f.indexOf("s_")==0){application.events.publish("gridloading",{grid:"titlegrid",message:"loadinggeneric",cssClass:"meta"});$cn.methods.getBrowseListBySimilar(f,BrowseView.CurrentTitleID,1,0,function(n){m._slaveSource[f]=[];m._slaveSource[f].push({name:"All",iD:"All",parentID:0});d=true;m.loadSlave(f,g);BrowseView.LastGridProcess="similarAll";application.events.publish("loadgrid",{grid:"titlegrid",gridProcess:"similarAll",data:n,columns:2})})}d=true}else{if(h){var e="Undefined";if(f.indexOf("critics")>0){e="CritictsReview"}else{if(f.indexOf("user")>0){e="UserReview"}}application.events.publish("gridloading",{grid:"reviewgrid"});$cn.methods.getReviews(BrowseView.CurrentTitleID,e,function(r){m.MetaData[f]=r.reviews;m._slaveSource[f]=[];r.reviews.each(function(s){m._slaveSource[f].push({name:m.split(s.reviewer),iD:f+"|"+s.reviewer,parentID:0});d=true});var q,p;for(q=0;q<m._slaveSource[f].length;q++){for(p=0;p<m._slaveSource[f].length;p++){if(m._slaveSource[f][q].name.toLowerCase()<m._slaveSource[f][p].name.toLowerCase()){var n=m._slaveSource[f][q];m._slaveSource[f][q]=m._slaveSource[f][p];m._slaveSource[f][p]=n}}}if(r.reviews.length>0){g=r.reviews[0].reviewer}else{d=true}m.loadSlave(f,g)})}else{if(j){switch(f){case"m_cast_bios":application.events.publish("gridloading",{grid:"biogrid"});$cn.methods.getCastBios(BrowseView.CurrentTitleID,function(n){m.MetaData[f]=n.castMembers;m._slaveSource[f]=[];n.castMembers.each(function(p){m._slaveSource[f].push({name:m.split(p.name),subtext:p.role,iD:f+"|"+p.castID,parentID:0});d=true});if(n.castMembers.length>0){g=n.castMembers[0].castID}m.loadSlave(f,g)});break;case"m_images":application.events.publish("gridloading",{grid:"titlegrid",message:"loadinggeneric"});$cn.methods.getImages(BrowseView.CurrentTitleID,function(n){m.MetaData[f]=[];k=0;n.images.each(function(p){m.MetaData[f].push({imageURL:p.imageURL,idx:k});k++});m._slaveSource[f]=[];m._slaveSource[f].push({name:"All",iD:"All",parentID:0});d=true;m.loadSlave(f,g);BrowseView.loadImagePopup(n.images);BrowseView.LastGridProcess="images";application.events.publish("loadgrid",{grid:"imagegrid",gridProcess:"images",data:m.MetaData[f],columns:1})});break;case"m_cast_crew":$cn.methods.getCastAndCrew(BrowseView.CurrentTitleID,function(n){m.MetaData[f]=n.castMembers;m._slaveSource[f]=[];n.castMembers.each(function(p){m._slaveSource[f].push({name:p.name,subtext:p.role,iD:f+"|"+p.castID,parentID:0})});m.loadSlave(f,g)});break;case"m_credits":application.events.publish("gridloading",{grid:"creditsgrid"});$cn.methods.getCredits(BrowseView.CurrentTitleID,function(p){var n=-1;m.MetaData[f]=p;m._slaveSource[f]=[];if(p.castMetaValues.length>0){m._slaveSource[f].push({name:"Cast",iD:f+"|0",parentID:0});n=0}if(p.productionMetaValues.length>0){m._slaveSource[f].push({name:"Production",iD:f+"|1",parentID:0});n=(n==-1)?1:0}m.loadSlave(f,g);m.loadSlaveGrid("m_credits",n)});break;case"m_technical_details":application.events.publish("gridloading",{grid:"techgrid"});$cn.methods.getTechnicalDetails(BrowseView.CurrentTitleID,function(n){m._slaveSource[f]=[];m.MetaData[f]=n;n.technicalDetailItems.each(function(p){if(p.name=="UltraViolet"){if($cn.config.EnableUV===true){m._slaveSource[f].push({name:p.name.replace(" ","<br />"),iD:f+"|"+p.name,parentID:0})}else{}}else{m._slaveSource[f].push({name:p.name.replace(" ","<br />"),iD:f+"|"+p.videoRecordingFormat,parentID:0})}});m.loadSlave(f,g);m.loadSlaveGrid("m_technical_details",n.technicalDetailItems[0].videoRecordingFormat)});break;default:break}}}}}},loadSlave:function(e,d){this._renderWheel($("slavedatasource"),this._slaveSource[e]);if(d){this.loadSlaveGrid(e,d)}else{log.write("error: there are no slave wheel items for this content");BrowseView.LastGridProcess="emptylist";application.events.publish("loadgrid",{grid:"reviewgrid",gridProcess:"emptylist",data:[],columns:1,template:"reviewgrid"})}},loadData:function(f,g){var e=this;var d="";this.layoutIsDirty=true;this.saveHistory();this.cleanUI();this._masterSource=[];this._slaveSource=[];log.write("Current Title:");log.write(g);log.write("Current Collection");log.write(f);if(!$cn.data.baselineEnable){f.erase("m_credits");f.erase("m_cast_bios");f.erase("m_cast_crew")}if(!$cn.data.flixsterEnable){f.erase("r_critics");f.erase("r_user_revs");f.erase("m_technical_details")}if(!configuration.readValue("EnableTechnicalDetailsWheelOption")){f.erase("m_technical_details")}f.each(function(h){if(d==""){d=h}if(h.indexOf("s_")==0){e._masterSource[e._masterSource.length]={name:application.resource.td_similar[h],iD:h,parentID:0};e._slaveSource[h]=[];e._slaveSource[h].push({name:"All",iD:"all",parentID:h})}if(h.indexOf("m_")==0){e._masterSource[e._masterSource.length]={name:application.resource.td_moreinfo[h],iD:h,parentID:0}}if(h.indexOf("r_")==0){e._masterSource[e._masterSource.length]={name:application.resource.td_reviews[h],iD:h,parentID:0}}});if(this._masterSource.length>0){this._renderWheel($("masterdatasource"),this._masterSource);this.loadSlaveDataSource(d)}},navigate:function(e){var d=e.args[0];if(e.context===ActiveWheel){if((d.current=="selectedmaster")){if(d.direction=="left"){e.preventDefault();BrowseView.expandTitleDetails();BrowseView.TitleViewControl.enableButtons();navigation.setFocus("tdbuttonMoreInfo",true)}else{if(d.direction=="right"&&(this.isNavigating||!BrowseView.CurrentProcessLoaded)){e.preventDefault()}else{this.parent(e)}}}else{if(d.current=="selectedslave"){if(d.direction=="right"&&$("imagegrid").getStyle("display")=="block"){navigation.setFocus($("imagegrid").getElement("a").id,true)}else{this.parent(e)}}else{this.parent(e)}}}}});var GiftCardPanelControl=new Class({Extends:ModalControl,id:"giftcard",layoutIsDirty:true,isValid:false,tpl:null,sku:"",keyboard:null,isPurchasePath:false,initialize:function(){log.write("giftcard.init()");this.parent("giftcard")},show:function(d,f){$("ModalWindow").setAttribute("style","");var e=(d)?application.resource.gift_card_poup_heading_purchase_path:application.resource.gift_card_poup_heading;this.parent();this.loadData([{buttonTxt:"Cancel",headingTxt:e}]);BrowseView.GiftCardKeyboard.show();this.sku=(d)?f:0;this.isValid=false;this.isPurchasePath=d;application.events.subscribe(this,"back",this.handleBack.bind(this));application.events.subscribe(this,"navigate",this.handleNavigate.bind(this))},hide:function(){this.isValid=false;this.parent();application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"navigate")},apply:function(){if(this.isValid){$cn.data.CurrentPromotion=this.keyboard.value.trim()}},handleBack:function(d){d.preventDefault();application.currentView.GiftCardKeyboard.hide();this.hide()},handleNavigate:function(d){if(d.args[0].direction=="right"&&(application.element.current=="")){}},redeem:function(){$("giftcodeerror").innerHTML="";var d=this,f=null;this.isValid=false;this.isProcessing=true;var e=this.keyboard.value.trim();if(!e.length){this.isProcessing=false;$("giftcodeerror").innerHTML="Invalid code.";return}if(this.isPurchasePath){f=$cn.utilities.showLoadingModal(2000,"Redeem Gift Code...");$cn.methods.verifyCode(this.sku,e,function(g){$cn.utilities.clearLoadingSpinner(f);d.isProcessing=false;if($("giftcodeerror")==null){BrowseView.GiftCardPanel.show(true,d.sku);navigation.setFocus("gcredeem",true)}if(g.responseCode==0){d.isValid=true;d.keyboard.clear();if(g.discountType=="GiftCertificate"){$("giftcodetotal").innerHTML="-"+application.resource.currency_symbol+$cn.utilities.formatAsMoney(g.giftCertificateBalance);$("giftcodesredeemed").show();application.events.publish("redeemed",{giftCertificate:g.giftCertificateBalance})}else{if(g.discountType=="Coupon"){$("coupontotal").innerHTML="-"+application.resource.currency_symbol+$cn.utilities.formatAsMoney(g.discountAmount);$("couponseredeemed").show();application.events.publish("redeemed",{coupon:e,amount:g.discountAmount})}}}else{var h="Invalid code.";switch(g.responseCode){case 36:h="Coupon code already used.";break;case 37:h="Code already used.";break;default:break}d.keyboard.clear();$("giftcodeerror").innerHTML=h}})}else{f=$cn.utilities.showLoadingModal(2000,"Redeem Gift Code...");$cn.methods.applyGiftCode(e,function(g){$cn.utilities.clearLoadingSpinner(f);d.isProcessing=false;if($("giftcodeerror")==null){BrowseView.GiftCardPanel.show(false);navigation.setFocus("gcredeem",true)}if(g.responseCode==0){d.isValid=true;d.keyboard.clear();$("giftcodetotal").innerHTML="-"+application.resource.currency_symbol+$cn.utilities.formatAsMoney(g.giftCertificateBalance);$("giftcodesredeemed").show()}else{var h="Invalid code.";switch(g.responseCode){case 36:h="Code already used.";break;case 37:h="Code already used.";break;default:break}d.keyboard.clear();$("giftcodeerror").innerHTML=h}})}}});var ScrollBarProperties={id:"scrollbar",onScroll:null,range:0,position:0,tpl:null,thumb:null,isBusy:false,initialize:function(e,d){this.id=e;this.tpl=new ui.template(this.id,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile();this.tpl.append();this.tpl.apply();this.thumb=$(this.id).getElement(".scrollthumb").id;application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"pointerdeactivated",this.resetFocus.bind(this));if(!d){this.subscribePointmousedown()}else{this.unsubscribePointmousedown()}},activate:function(d){log.write("ScrollBar.activate is deprecated")},deactivate:function(){this.hide()},destroy:function(){application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"savestate");application.events.unsubscribe(this,"restorestate");application.events.unsubscribe(this,"pointermousedown",this.verticalDrag.bind(this))},hide:function(){$(this.id).hide()},draw:function(){if(this.range==0){return}var f=$(this.id);if(f){var e=$(this.thumb);var d=(this.range>0?this.position/this.range:0);var h=e.getSize().y;var g=this.arrow;if(g){g.addClass("hover");this.arrow=null}e.setStyles({"margin-top":(f.getElement(".scrollarea").clientHeight-h)*d});if(g){g.removeClass("hover")}}},getPosition:function(){return this.position},setPosition:function(d){d=Math.min(this.range,Math.max(0,d));if(d!=this.position){this.position=d;this.draw()}},setRange:function(d){if(d!=this.range){this.range=d;if(this.position>this.range){this.position=this.range}if(this.range>0){this.draw()}}if(this.range>0){$(this.id).show()}else{this.hide()}this.initScrollBarParam()},getThumb:function(){return this.thumb},setThumbPosition:function(d){d=Math.min(this.range,Math.max(0,d));if(d!=this.position){this.position=d}},initScrollBarParam:function(){var f=$(this.id);if(f){var d=$(this.thumb);var e=f.getElement(".scrollarea").clientHeight;var g=Math.min(e/3*2,Math.max(30,e/this.range));d.setStyle("height",g);this.rangeSize=e-g;this.pageSize=this.rangeSize/this.range}},subscribePointmousedown:function(){application.events.subscribe(this,"pointermousedown",this.verticalDrag.bind(this))},unsubscribePointmousedown:function(){application.events.unsubscribe(this,"pointermousedown")},loadData:function(e,d){this._data.scrollID="scrollbarID";this.draw()},navigate:function(d){if((application.element.current&&application.element.current!="")&&document.getElementById(application.element.current)&&application.element.current==this.thumb){if(d.args[0].direction=="down"||d.args[0].direction=="up"){this.arrow=$(this.id).getElement(d.args[0].direction=="down"?".scrollbottom":".scrolltop");if(this.onScroll!=null){this.onScroll(d.args[0].direction,this)}else{application.events.publish("scroll",{direction:d.args[0].direction,scrollbar:this})}d.preventDefault()}}},onViewChanged:function(d){this.currentView=d.args[0]},onSaveState:function(e){var d=e.args[0];d[this.id]={position:this.position,range:this.range}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id])},setScrollBarFocus:function(e,d){navigation.setFocusElement($(e));if(d){pointer.lastFocusId="LegalThumb"}else{pointer.lastFocusId="app-gen-0"}},resetFocus:function(){if(pointer.lastFocusId=="scrolltop"||pointer.lastFocusId=="scrollbottom"){navigation.setFocus("app-gen-0")}},verticalDrag:function(){this.initScrollBarParam();this.setScrollBarFocus("app-gen-0");var d=arguments[0].args[0].clientY;var f=arguments[0].args[0].clientY;var e=$(this.getThumb());var g=d-parseFloat(e.getStyle("margin-top"));pointer.ignorePointerEvents(true);$(document).addEvent("mousemove",function(j){var h=Math.min(Math.max(0,(j.page.y-g)),this.rangeSize);e.setStyles({"margin-top":h})}.bind(this));$(document).addEvent("mouseup",function(m){this.setScrollBarFocus("app-gen-0");var p=m.page.y-f;var k;if(p>0){k="down"}else{k="up"}var n=Math.round(p/this.pageSize);var l=this.getPosition()+n;var q=false;if(p>0&&l>=this.range){q=true}else{if(p<0&&l<=0){q=true}}this.deviation=p-n*this.pageSize;var h=parseFloat($(this.getThumb()).getStyle("margin-top"));if(q){if(p>0&&h-Math.floor(this.rangeSize)<0){q=false}else{if(p<0&&h>0){q=false}}}log.write("^^^^^^^^^^^^^^this.pageSize  "+this.pageSize);log.write("^^^^^^^^^^^^^^  oldPosition before move "+this.getPosition());log.write("^^^^^^^^^^^^^^  slidePageNumber before move "+n);if(n!=0){application.events.publish("scroll",{direction:k,rows:n,scrollbar:this,isDrag:true})}var j=h-(q?0:this.deviation);j=Math.min(Math.max(0,j),this.rangeSize);$(this.getThumb()).setStyles({"margin-top":j});log.write("^^^^^^^^^^^^^^  oldPosition after move"+this.getPosition());this.setThumbPosition(l);log.write("^^^^^^^^^^^^^^  newPosition "+l);$(document).removeEvents("mousemove");$(document).removeEvents("mouseup");pointer.ignorePointerEvents(false)}.bind(this))}},ScrollBar=new Class(ScrollBarProperties);var ScrollViewProperties={id:"scrollview",content:null,pageHeight:0,scrollbar:null,onScroll:null,initialize:function(d){this.content=d.getChildren()[0].getChildren()[0];this.scrollbar=new ScrollBar(d.getElement(".scrollbar").id,true);this.scrollbar.onScroll=this.onScroll.bind(this);application.events.subscribe(this,"scroll",this.scroll.bind(this));BrowseView.ScrollBar.unsubscribePointmousedown();application.events.subscribe(this,"pointermousedown",this.verticalDrag.bind(this));application.events.subscribe(this,"pointerdeactivated",this.resetFocus.bind(this))},destroy:function(){BrowseView.ScrollBar.subscribePointmousedown();this.scrollbar.destroy();application.events.unsubscribe(this,"scroll");application.events.unsubscribe(this,"pointermousedown");application.events.unsubscribe(this,"pointerdeactivated");$(this.scrollbar.getThumb()).removeEvents("mousedown");$(document).removeEvents("mousemove");$(document).removeEvents("mouseup")},draw:function(){var d=this.content.attributes.pageHeight;this.pageHeight=d==null?this.content.getParent().clientHeight:d.value.toInt();log.write("scroll amount: "+this.pageHeight);var f=this.content.getDimensions().y;this.scrollbar.setPosition(0);var e=Math.ceil(f/this.pageHeight)-1;this.scrollbar.setRange(e);if(e<2){this.scrollbar.hide()}},onScroll:function(f,g){if(this.content){var d=g.getPosition()+(f=="down"?1:-1);d=Math.min(Math.max(0,d),g.range);if(d!=g.getPosition()){var e=-d*this.pageHeight;this.content.setStyle("margin-top",e);g.setPosition(d)}}},scroll:function(g){if(this.content){totalheight=this.content.clientHeight;var f=g.args[0].direction;scrollbar=this.scrollbar;var d=scrollbar.getPosition()+(f=="down"?1:-1);d=Math.min(Math.max(0,d),scrollbar.range);if(d!=scrollbar.getPosition()){var e=-d*this.pageHeight;this.content.setStyle("margin-top",e);scrollbar.setPosition(d)}}},setScrollBarFocus:function(d){navigation.setFocusElement($(d));pointer.lastFocusId="LegalThumb"},resetFocus:function(){if(pointer.lastFocusId=="legalscrolltop"||pointer.lastFocusId=="legalscrollbottom"){navigation.setFocus("LegalThumb",true)}},verticalDrag:function(f){var d=f.args[0]||window.event;this.startY=d.clientY;this.contentStartY=d.clientY;this.setScrollBarFocus("LegalThumb");pointer.ignorePointerEvents(true);$(document).addEvent("mousemove",function(g){log.write("startYb"+this.startY);var h=g.page.y-this.startY;this.startY=g.page.y;log.write("startYa"+this.startY);var e=parseFloat($(this.scrollbar.getThumb()).getStyle("margin-top"));this.newTop=Math.min(Math.max(0,e+h),this.scrollbar.rangeSize);$(this.scrollbar.getThumb()).setStyles({"margin-top":this.newTop})}.bind(this));$(document).addEvent("mouseup",function(g){this.setScrollBarFocus("LegalThumb");var k=g.page.y-this.contentStartY;var e=Math.round(k/this.scrollbar.pageSize);var h=this.scrollbar.getPosition()+e;var j=false;if(k>0&&h>=this.scrollbar.range){j=true}else{if(k<0&&h<=0){j=true}}h=Math.min(Math.max(0,h),this.scrollbar.range);var n=-h*this.pageHeight;var l=new Fx.Morph(this.content,{duration:"short",transition:Fx.Transitions.Sine.easeOut});l.start({"margin-top":n});this.scrollbar.setThumbPosition(h);this.deviation=k-e*this.scrollbar.pageSize;var p=parseFloat($(this.scrollbar.getThumb()).getStyle("margin-top"));if(j){if(k>0&&p-Math.floor(this.scrollbar.rangeSize)<0){j=false}else{if(k<0&&p>0){j=false}}}var m=p-(j?0:this.deviation);m=Math.min(Math.max(0,m),this.scrollbar.rangeSize);$(this.scrollbar.getThumb()).setStyles({"margin-top":m});$(document).removeEvents("mousemove");$(document).removeEvents("mouseup");pointer.ignorePointerEvents(false)}.bind(this))}},ScrollView=new Class(ScrollViewProperties);var SearchWheelControl=new Class({Extends:WheelControl,id:"SearchWheelControl",container:"singlewheel",singleWheel:true,MetaData:[],masterSourceElement:"singlemasterdatasource",masterSelectedElement:"singleselectedmaster",cleanUI:function(){$("singlewheel").show();if($("singleselectedmaster")){$("singleselectedmaster").label=""}if($("singlemasterdatasource")){if($("singlemasterdatasource").getChildren().length>0){$("singlemasterdatasource").getChildren().destroy()}}},handleWheelItemChange:function(e){log.write(e);if(e.context===ActiveWheel){var d=e.args[0];log.write("Search Wheel Item changed. Now fire custom method. "+e.args[0].wheelinstance);application.events.publish("searchwheelchanged",{selectedvalue:d.selectedvalue})}},loadSearchMenu:function(){this.layoutIsDirty=true;this.cleanUI();var d=[];d.push({name:"Title",iD:"Title",parentID:0,list:0});if($cn.data.baselineEnable){d.push({name:"Actor",iD:"Actor",parentID:0,list:1});d.push({name:"Director",iD:"Director",parentID:0,list:1});d.push({name:"Writer",iD:"Writer",parentID:0,list:1})}d.push({name:"Keyword",iD:"Keyword",parentID:0,list:0});this.loadData(d,[{}])},navigate:function(d){if(d.context===ActiveWheel){if(document.getElementById(application.element.current)&&application.element.current=="singleselectedmaster"){if(d.args[0].direction=="left"){d.preventDefault();application.navigator.setFocus("dock-search",true)}else{if(d.args[0].direction=="right"){d.preventDefault();if($("FirstKey").style.display!="none"){application.navigator.setFocus("FirstKey",true)}else{application.navigator.setFocus("KeyboardKey1",true)}}else{this.parent(d)}}}}}});var KeyboardControl=new Class({id:"keyboard",persist:{},controls:{},layoutIsDirty:true,swappedState:"standard",tpl:null,_currentValue:"",initialize:function(){application.element.registerControl(this);application.events.subscribe(this,"keyboardback",this.keyback.bind(this));application.events.subscribe(this,"keyboardclear",this.keyclear.bind(this));application.events.subscribe(this,"keyboardselect",this.keyselect.bind(this));application.events.subscribe(this,"keyboardswap",this.keyboardswap.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this))},init:function(f,e){log.write("searchkeyboard.init()");var d=this;if(f){this.persist=f}},cleanUI:function(){},loadData:function(d){this.persist.title=d;this.draw()},draw:function(){this.cleanUI()},keyback:function(d){this._currentValue=this._currentValue.substring(0,this._currentValue.length-1);this.valuechange(d)},keyclear:function(d){this._currentValue="";$("SearchText").set("html","_");this.valuechange(d)},keyselect:function(d){log.write("keyboard select:"+d.args[0].value);log.write(d);if(this._currentValue.length<11){this._currentValue+=d.args[0].value}this.valuechange(d)},valuechange:function(d){if(d&&d.args[0].caller==this.id){if(this._currentValue.length<11){$("SearchText").set("html",this._currentValue+"_")}else{$("SearchText").set("html",this._currentValue)}this.handlechange();application.events.publish("keyboardvaluechanged",{currentValue:this._currentValue})}},handlechange:function(){},keyboardswap:function(d){log.write("keyboard swap");switch(d.args[0].value){case"alt":log.write($$("a.standard").each(function(e){e.hide()}));log.write($$("a.alt").each(function(e){e.show()}));navigation.setFocus("KeyboardStandardSwap",true);this.swappedState="alt";break;default:log.write($$("a.alt").each(function(e){e.hide()}));log.write($$("a.standard").each(function(e){e.show()}));navigation.setFocus("KeyboardAltSwap",true);this.swappedState="standard";break}application.currentView.layoutIsDirty=true;navigation.buildNavigation($("keyboard").getElements("a"))},show:function(){document.getElementById("keyboard").className=this.id;this._currentValue="";this.swappedState="standard";application.currentView.layoutIsDirty=true;navigation.buildNavigation($("keyboard").getElements("a"));$("keyboard").show()},hide:function(){document.getElementById("keyboard").className="";$("keyboard").hide()},onSaveState:function(e){var d=e.args[0];d[this.id]={_currentValue:this._currentValue,swappedState:this.swappedState}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id])}});var SearchKeyboardControl=new Class({Extends:KeyboardControl,id:"searchkeyboardcontrol",isActive:false,_currentCategory:"",_refined:false,_hault:0,_state:null,initialize:function(){this.parent();application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"keydown",this.handleKeyPress.bind(this));application.events.subscribe(this,"elementblur",this.gridBlur.bind(this));application.events.subscribe(this,"elementfocus",this.keyboardFocus.bind(this));application.events.subscribe(this,"refineselection",this.refineSelection.bind(this));application.events.subscribe(this,"searchwheelchanged",this.setcategory.bind(this))},keyboardFocus:function(d){if(document.getElementById(d.args[0].focusedelem)){if(document.getElementById(d.args[0].focusedelem).className.indexOf("key")>-1){if($("keyboard").isParentOf($(d.args[0].focusedelem))){log.write("keyboardfocus");this.isActive=true;this._hault=0;$("searchPanelMask").setStyle("visibility","hidden");if(this._refined){this._refined=false;application.state.previous();navigation.setFocus(d.args[0].focusedelem,true)}}}}},unsubEvents:function(){application.events.unsubscribe(this,"keydown");application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"elementblur");application.events.unsubscribe(this,"elementfocus");application.events.unsubscribe(this,"refineselection")},keyselect:function(d){log.write("keyboard select:"+d.args[0].value);log.write(d);this._currentValue+=d.args[0].value;this.valuechange(d)},valuechange:function(e){if(e&&e.args[0].caller==this.id){if(this._currentValue==""){this.shiftReset()}var d=this._currentValue;d=d.replace(/ /g,"&nbsp;");$("SearchText").set("html",d+"_");this.shiftLeft();this.handlechange()}},shiftLeft:function(){var h=parseInt($("SearchText").clientWidth),f=parseInt($("SearchTextWrap").getComputedSize().width),g=parseInt($("SearchText").getStyle("margin-left")),d,e;if(h>f){if(g==""){g=0}d=this.lastTextwidth-h;d=parseInt(d)+g;if(h+g>(f)+12){log.write("Out of search window - fixing");d=f-h-5}e=new Fx.Morph($("SearchText"),{duration:300,transition:Fx.Transitions.Sine.easeOut});e.start({"margin-left":d+"px"})}else{this.shiftReset()}this.lastTextwidth=parseInt($("SearchText").clientWidth)},shiftReset:function(){$("SearchText").setStyle("margin-left","0")},handleKeyPress:function(d){if(this.isActive){switch(d.args[0].event.keyCode){case application.keys.KEY_1:if(document.getElementById("KeyboardKey1").style.display=="block"){application.navigator.setFocus("KeyboardKey1",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"1"});break;case application.keys.KEY_2:if(document.getElementById("KeyboardKey2").style.display=="block"){application.navigator.setFocus("KeyboardKey2",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"2"});break;case application.keys.KEY_3:if(document.getElementById("KeyboardKey3").style.display=="block"){application.navigator.setFocus("KeyboardKey3",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"3"});break;case application.keys.KEY_4:if(document.getElementById("KeyboardKey4").style.display=="block"){application.navigator.setFocus("KeyboardKey4",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"4"});break;case application.keys.KEY_5:if(document.getElementById("KeyboardKey5").style.display=="block"){application.navigator.setFocus("KeyboardKey5",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"5"});break;case application.keys.KEY_6:if(document.getElementById("KeyboardKey6").style.display=="block"){application.navigator.setFocus("KeyboardKey6",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"6"});break;case application.keys.KEY_7:if(document.getElementById("KeyboardKey7").style.display=="block"){application.navigator.setFocus("KeyboardKey7",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"7"});break;case application.keys.KEY_8:if(document.getElementById("KeyboardKey8").style.display=="block"){application.navigator.setFocus("KeyboardKey8",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"8"});break;case application.keys.KEY_9:if(document.getElementById("KeyboardKey9").style.display=="block"){application.navigator.setFocus("KeyboardKey9",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"9"});break;case application.keys.KEY_0:if(document.getElementById("KeyboardKey0").style.display=="block"){application.navigator.setFocus("KeyboardKey0",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"0"});break;default:break}}},gridBlur:function(d){this.isActive=false},handlechange:function(){this._refined=false;$("ScreenSeparator").addClass("minimized");$("ScreenSeparator").removeClass("searchkeyboardcontrol-arrow");$("ScreenSeparatorThumb").removeClass("wheel-thumb-left").show();var d=this._currentValue;if(this._currentValue.length>0){if(this._currentCategory=="Director"||this._currentCategory=="Actor"||this._currentCategory=="Writer"){application.events.publish("gridloading",{grid:"titlegrid",message:"searching",columns:1,className:"refinementgrid",cssClass:"searchList"});$cn.methods.getSearchPerson(this._currentValue,this._currentCategory,function(f){log.write(f.castMembers.length);if(this._currentValue==d||this._currentValue.length>0){BrowseView.LastGridProcess="search";if(f.castMembers.length>0){var e=false;if(f.castMembers.length>16){document.getElementById("HorizontalFade").className="personSearch";document.getElementById("HorizontalFadeTop").className="personSearch";$("HorizontalFade").show();e=true}else{$("HorizontalFade").hide();$("HorizontalFadeTop").hide();document.getElementById("HorizontalFade").className="";document.getElementById("HorizontalFadeTop").className=""}application.events.publish("loadgrid",{grid:"titlegrid",data:f.castMembers,columns:1,gridProcess:"search",template:"refinementgrid",className:"refinementgrid",showFade:e,returnFocus:"KeyboardKeyBACKTop"})}else{application.events.publish("loadgrid",{grid:"titlegrid",columns:1,template:"refinementgrid",gridProcess:"search",className:"refinementgrid",returnFocus:"KeyboardKeyBACKTop"})}}}.bind(this))}else{$("HorizontalFade").hide();$("HorizontalFadeTop").hide();document.getElementById("HorizontalFade").className="";document.getElementById("HorizontalFadeTop").className="";application.events.publish("gridloading",{grid:"titlegrid",message:"searching",columns:2,cssClass:"search",className:"searchgrid"});$cn.methods.getSearchTitle(this._currentValue,this._currentCategory,function(e){if(this._currentValue==d){BrowseView.LastGridProcess="search";if(e&&e.items.length>0){application.events.publish("loadgrid",{grid:"titlegrid",data:e.items,columns:2,gridProcess:"search",template:"searchtitlelist",className:"searchgrid",returnFocus:"KeyboardKeyBACKTop"})}else{application.events.publish("loadgrid",{grid:"titlegrid",columns:2,gridProcess:"search",template:"searchtitlelist",className:"searchgrid",returnFocus:"KeyboardKeyBACKTop"})}}else{if(this._currentValue.length<1){application.events.publish("loadgrid",{grid:"titlegrid",columns:2,gridProcess:"search",template:"searchtitlelist",className:"searchgrid",returnFocus:"KeyboardKeyBACKTop"})}}}.bind(this))}}else{if(this._currentValue.length==0&&(this._currentCategory=="Director"||this._currentCategory=="Actor"||this._currentCategory=="Writer")){BrowseView.LastGridProcess="search";application.events.publish("loadgrid",{grid:"titlegrid",columns:1,gridProcess:"search",template:"refinementgrid",className:"refinementgrid"})}else{if(this._currentValue.length==0){BrowseView.LastGridProcess="search";application.events.publish("loadgrid",{grid:"titlegrid",columns:2,gridProcess:"search",template:"searchtitlelist",className:"searchgrid"})}}}},setcategory:function(d){this._currentCategory=d.args[0].selectedvalue;this.keyclear();this.shiftReset();if(document.getElementById("KeyboardStandardSwap")&&document.getElementById("KeyboardStandardSwap").style.display!="none"){log.write($$("a.alt").each(function(e){e.hide()}));log.write($$("a.standard").each(function(e){e.show()}));this.swappedState="standard"}application.currentView.layoutIsDirty=true;navigation.buildNavigation($("keyboard").getElements("a"));this.handlechange()},getkeyword:function(){return this._currentCategory=="Keyword"?this._currentValue:null},show:function(){this.keyclear();this.shiftReset();this.parent();if(document.getElementById("KeyboardStandardSwap")&&document.getElementById("KeyboardStandardSwap").style.display!="none"){log.write($$("a.alt").each(function(d){d.hide()}));log.write($$("a.standard").each(function(d){d.show()}));this.swappedState="standard"}document.getElementById("ScreenSeparator").className=this.id+" minimized";document.getElementById("ScreenSeparatorThumb").className="minimized";if($cn.config.EnableSearchScreenSeparator){$("ScreenSeparator").show()}$("keyboard").show()},hide:function(){this.parent();document.getElementById("ScreenSeparator").className="";document.getElementById("ScreenSeparatorThumb").className="";document.getElementById("HorizontalFade").className="";document.getElementById("HorizontalFadeTop").className="";$("HorizontalFade").hide();$("HorizontalFadeTop").hide();$("ScreenSeparator").hide();$("keyboard").hide()},handleBack:function(d){d.preventDefault();this.unsubEvents();this.hide()},navigate:function(f){if(this.isActive&&f.args[0].direction=="right"){var e=$(application.element.current).get("rightaction");if(e&&e=="focusgrid"){var d=document.getElementById("titlelist").getElementsByTagName("a");if(d.length>0){f.preventDefault();application.navigator.setFocus(d[0].id,true)}}}},refineSelection:function(e){var d={preventDefault:function(){_defaultPrevented=true},args:[{}]};$("HorizontalFade").hide();$("HorizontalFadeTop").hide();BrowseView.GridControl.onSaveState(d);BrowseView.ScrollBar.onSaveState(d);this._state=d.args[0];application.state.save();application.events.publish("gridloading",{grid:"titlegrid",message:"loadinggeneric",className:"searchgrid"});BrowseView.LastGridProcess="search-refineSelection";$cn.methods.getBrowseListByCastRole(e.args[0].id,this._currentCategory,1,function(g){var f=g.data.result;application.events.publish("loadgrid",{grid:"titlegrid",data:f.items,gridProcess:"search-refineSelection",columns:2,template:"searchtitlelist",className:"searchgrid",returnFocus:"KeyboardKeyBACKTop"});if(f.items&&f.items.length>0){}else{navigation.setFocus("KeyboardKeyBACKTop",true)}if($("titlelist").getElement(".title")){navigation.setFocus($("titlelist").getElement(".title").getElement("a").id,true)}$("ScreenSeparator").removeClass("minimized");$("ScreenSeparator").addClass("searchkeyboardcontrol-arrow");$("ScreenSeparatorThumb").addClass("wheel-thumb-left").show();$("searchPanelMask").setStyle("visibility","visible");this._refined=true}.bind(this))},onSaveState:function(e){this.parent(e);var d=e.args[0];d[this.id]._currentCategory=this._currentCategory;d[this.id]._refined=this._refined},});var GiftCardKeyboardControl=new Class({Extends:KeyboardControl,id:"giftcardkeyboardcontrol",_currentCategory:"",_refined:false,_hault:0,value:"",initialize:function(){this.parent()},keyboardFocus:function(d){if(document.getElementById(d.args[0].focusedelem)){if($("skinnykeyboard").isParentOf($(d.args[0].focusedelem))){log.write("skinnykeyboardfocus");if(this._refined){this.handlechange()}}}},unsubEvents:function(){application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"keydown")},handleKeyPress:function(d){switch(d.args[0].event.keyCode){case application.keys.KEY_1:application.navigator.setFocus("Skinny1",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"1"});break;case application.keys.KEY_2:application.navigator.setFocus("Skinny2",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"2"});break;case application.keys.KEY_3:application.navigator.setFocus("Skinny3",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"3"});break;case application.keys.KEY_4:application.navigator.setFocus("Skinny4",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"4"});break;case application.keys.KEY_5:application.navigator.setFocus("Skinny5",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"5"});break;case application.keys.KEY_6:application.navigator.setFocus("Skinny6",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"6"});break;case application.keys.KEY_7:application.navigator.setFocus("Skinny7",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"7"});break;case application.keys.KEY_8:application.navigator.setFocus("Skinny8",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"8"});break;case application.keys.KEY_9:application.navigator.setFocus("Skinny9",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"9"});break;case application.keys.KEY_0:application.navigator.setFocus("Skinny0",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"0"});break;default:break}},valuechange:function(d){if(d&&d.args[0].caller==this.id){if(this._currentValue==""){this.shiftReset()}$("SkinnySearchText").set("html",this._currentValue+"_");this.shiftLeft();this.handlechange()}},shiftLeft:function(){var g=parseInt($("SkinnySearchText").clientWidth);var e=parseInt($("SkinnySearchTextWrap").clientWidth)-15;var f=$("SkinnySearchText").getStyle("margin-left");if(g>e){if(f==""){f=0}var d=new Fx.Morph($("SkinnySearchText"),{duration:300,transition:Fx.Transitions.Sine.easeOut});d.start({"margin-left":e-g+"px"})}else{this.shiftReset()}},shiftReset:function(){$("SkinnySearchText").setStyle("margin-left","0")},keyselect:function(d){if(!BrowseView.GiftCardPanel.isProcessing){log.write("keyboard select:"+d.args[0].value);log.write(d);this._currentValue+=d.args[0].value;this.valuechange(d)}},clear:function(){$("SkinnySearchText").set("html","_");this.value="";this.shiftReset();this._currentValue=""},handlechange:function(){this.value=this._currentValue},setcategory:function(d){this._currentCategory=d.args[0].selectedvalue;this.keyclear();this.handlechange()},show:function(){this._currentValue="";$("SkinnySearchText").set("html","_");document.getElementById("skinnykeyboard").className=this.id;log.write($$("a.standard").each(function(d){d.show()}));$("skinnykeyboard").show();navigation.buildNavigation($("skinnykeyboard").getElements("a"));application.events.subscribe(this,"back",this.handleBack.bind(this));application.events.subscribe(this,"keydown",this.handleKeyPress.bind(this))},handleBack:function(d){d.preventDefault();this.unsubEvents();this.hide()},hide:function(){document.getElementById("keyboard").className="";this.unsubEvents();$("skinnykeyboard").hide()}});var SettingsWheelControl=new Class({Extends:WheelControl,Implements:WheelControl,id:"SettingsWheelControl",initialize:function(d){this.parent()},loadSettingsMenu:function(f){var e=[];e.push({name:application.resource.SettingsWheelOptionStrings.General,iD:"General",parentID:0});if(application.resource.SettingsWheelOptionStrings.ClosedCaptions!=undefined){e.push({name:application.resource.SettingsWheelOptionStrings.ClosedCaptions,iD:"ClosedCaptions",parentID:0})}if($cn.data.AllowedAudioProfiles&&$cn.data.AllowedAudioProfiles.length>0){e.push({name:application.resource.SettingsWheelOptionStrings.Audio,iD:"Audio",parentID:0})}e.push({name:application.resource.SettingsWheelOptionStrings.Family,iD:"Family",parentID:0});if(application.debugMode){e.push({name:application.resource.SettingsWheelOptionStrings.Debug,iD:"Debug",parentID:0})}var g=[];g.push({name:application.resource.SettingsWheelOptionStrings.Activate,iD:"Activate",parentID:"General"});if($cn.config.EnableGiftCertificates){g.push({name:application.resource.SettingsWheelOptionStrings.GiftCards,iD:"GiftCards",parentID:"General"})}if($cn.config.EnableUV){g.push({name:application.resource.SettingsWheelOptionStrings.UV,iD:"UV",parentID:"General"})}g.push({name:application.resource.SettingsWheelOptionStrings.About,iD:"About",parentID:"General"});if($cn.config.EnableSystemStatus){g.push({name:application.resource.SettingsWheelOptionStrings.SystemStatus,iD:"SystemStatus",parentID:"General"})}var d={General:g,Audio:[{name:application.resource.SettingsWheelOptionStrings.Format,iD:"Format",parentID:"Audio"}],Family:[{name:application.resource.SettingsWheelOptionStrings.Parental,iD:"Parental",parentID:"Family"},{name:application.resource.SettingsWheelOptionStrings.RequirePIN,iD:"RequirePIN",parentID:"Family"}],Library:[{name:application.resource.SettingsWheelOptionStrings.RoxioNow,iD:"RoxioNow",parentID:"Library"}]};if(application.resource.SettingsWheelOptionStrings.ClosedCaptions!=undefined){d.ClosedCaptions=[];d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCTextColor,iD:"CCTextColor",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCTextFont,iD:"CCTextFont",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCTextSize,iD:"CCTextSize",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCTextOpacity,iD:"CCTextOpacity",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCTextEdging,iD:"CCTextEdging",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCBackgroundColor,iD:"CCBackgroundColor",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCBackgroundOpacity,iD:"CCBackgroundOpacity",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCWindowColor,iD:"CCWindowColor",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCWindowOpacity,iD:"CCWindowOpacity",parentID:"ClosedCaptions"})}if(application.debugMode){d.Debug=[];d.Debug.push({name:application.resource.SettingsWheelOptionStrings.DeviceInfo,iD:"DeviceInfo",parentID:"Debug"});d.Debug.push({name:application.resource.SettingsWheelOptionStrings.ChangeEnvironment,iD:"ChangeEnvironment",parentID:"Debug"});d.Debug.push({name:application.resource.SettingsWheelOptionStrings.ConfigurationValues,iD:"ConfigurationValues",parentID:"Debug"});d.Debug.push({name:application.resource.SettingsWheelOptionStrings.AudioSupport,iD:"AudioSupport",parentID:"Debug"})}this.loadData(e,d,f)},loadData:function(f,d,e){this.cleanUI();this._masterSource=f;this._slaveSource=d;this.wheelChangedTimeout=200;if(f.length>0){this._renderWheel($(this.masterSourceElement),this._masterSource,(e)?e:0)}},navigate:function(g){this.parent(g);if(BrowseView.DockControl.selection=="dock-settings"){if((application.element.current&&application.element.current!="")&&document.getElementById(application.element.current)&&application.element.current=="selectedmaster"){if(g.args[0].direction=="left"){g.preventDefault();application.navigator.setFocus("dock-settings",true)}else{if(g.args[0].direction=="right"){g.preventDefault();application.navigator.setFocus("selectedslave",true)}}}else{if((application.element.current&&application.element.current!="")&&document.getElementById(application.element.current)&&application.element.current=="selectedslave"){if(g.args[0].direction=="right"){if(BrowseView.SettingsPanel.activePanelId){g.preventDefault();if(!this.isNavigating&&!BrowseView.SettingsPanel.isProcessing){var f=document.getElementById(BrowseView.SettingsPanel.activePanelId).getElementsByTagName("a");if(f.length>0){var e=false;var d=0;while(!e){if(f[d]){if(document.getElementById(f[d].id).offsetWidth!=0&&document.getElementById(f[d].id).offsetHeight!=0){application.navigator.setFocus(f[d].id,true);e=true}d++}else{e=true}}}}}}else{if(g.args[0].direction=="down"){if(BrowseView.SettingsPanel.activePanelId){if(BrowseView.SettingsPanel.isProcessing){g.preventDefault()}}}}}}}}});var SettingsPanelControlProperties={id:"settingspanel",persist:{},controls:{},layoutIsDirty:true,contentId:"SettingsPanel",tpl:null,secretKey:"",secretSequence:"",secretDebugKey:"492836",secretDirectionSequence:"udruudruuudr",currentWheelItem:"",isInitialized:false,initialize:function(){$("settingspanel").hide();this.loadView("Activate");log.write("settingspanel.init()");application.events.subscribe(this,"wheelvaluechanged",this.handleSettingWheelChange.bind(this));application.events.subscribe(this,"navigate",this.onNavigate.bind(this));this.tpl=new ui.template(this.contentId,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile()},loadView:function(d){},loadActivatePanel:function(e){var d=this;if(application.authSupported){this.isProcessing=true;this.verificationInProcess=true;$cn.methods.verifyAuthToken(function(f){if(this.currentWheelItem=="Activate"){if(!f){application.clearAuthToken();d.updateAuthStatus()}d.handleSettingWheelChange(e,true);this.isProcessing=false}}.bind(this))}else{d.handleSettingWheelChange(e,true)}},loadAboutPanel:function(e){var d=this;if(application.authSupported){this.isProcessing=true;log.write("Current Panel ID: "+this.activePanelId);$cn.methods.verifyAuthToken(function(f){if(this.currentWheelItem=="About"){if(f){$cn.methods.loadToken(function(g){if(this.currentWheelItem=="About"){$("settingsdeviceid").innerHTML=($cn.data.DeviceName!="")?$cn.utilities.forceWrap($cn.data.DeviceName,30,50):"Not Activated";d.handleSettingWheelChange(e,true);this.isProcessing=false;if(!("WebSocketManager" in window)){$$("#settingspanel .settingssdkversion").hide()}}}.bind(this))}else{application.clearAuthToken();d.updateAuthStatus();d.handleSettingWheelChange(e,true);this.isProcessing=false}}}.bind(this))}else{d.handleSettingWheelChange(e,true)}},loadUVPanel:function(e){var d=this;d.UV=new $cn.utilities.UserUVManager("settingsPanel");log.write("GETTING UV INFO");d.UV.checkUVAccount(function(){if("UV"===d.currentWheelItem){d.UVInfoLoaded=true;d.handleSettingWheelChange(e)}})},handleSettingWheelChange:function(g,f){var e=g.args[0],d=this;log.write("changing wheel...");if(e.wheelinstance=="SettingsWheelControl"){this.currentWheelItem=e.slavevalue;log.write("Current Wheel Value: "+this.currentWheelItem);if("UV"!==e.slavevalue){if(this.UV&&this.UV.timer){$cn.utilities.clearLoadingSpinner(this.UV.timer)}}$$("#settingspanel .panel").each(function(h){h.hide()});this.activePanelId=null;if((e.slavevalue=="General"||e.slavevalue=="Activate")&&$cn.data.AuthToken!=""&&!f){this.loadActivatePanel(g)}else{if(e.slavevalue=="About"&&$cn.data.AuthToken!=""&&!f){this.loadAboutPanel(g)}else{if(e.slavevalue=="UV"&&!this.UVInfoLoaded){this.loadUVPanel(g)}else{log.write("handling wheel change, last branch");this.isProcessing=true;if(!this.isInitialized){this.tpl.empty();this.tpl.append({version:configuration.readValue("version"),build:configuration.readValue("build"),Major:configuration.readValue("SDKVersion_Major"),Minor:configuration.readValue("SDKVersion_Minor"),Revision:configuration.readValue("SDKVersion_Revision"),Branch:configuration.readValue("SDKVersion_Branch"),Build:configuration.readValue("SDKVersion_Build"),deviceid:webservices.uniqueId,devicename:($cn.data.DeviceName!="")?$cn.utilities.forceWrap($cn.data.DeviceName,30,50):"Not Activated",accountlinkurl:$cn.data.AccountLinkUrl,firmwareversion:$cn.data.FirmwareVersion,affid:$cn.data.AffId,devicetype:webservices.destType,debugmode:($cn.config.SyncLogsExternally)?"Yes":"No",onscreendebug:($cn.config.OnScreenDebugLog)?"Yes":"No",env:application.CurrentEnvironment,modelnumber:device.realmodelid,countryid:$cn.data.CountryID,useragent:webservices.userAgent,logging:($cn.config.Debug)?"Yes":"No",baseline:($cn.data.baselineEnable)?"Yes":"No",jinni:($cn.data.jinniEnable)?"Yes":"No",flixster:($cn.data.flixsterEnable)?"Yes":"No",email:($cn.data.UserEmailAddress!="")?$cn.data.UserEmailAddress:"Not Activated"});if(this.UVInfoLoaded){this.tpl.empty();this.tpl.append({uvName:(d.UV.linkingAccount.user)?d.UV.linkingAccount.user.userName:"",uvEmail:(d.UV.linkingAccount.user)?d.UV.linkingAccount.user.email:"",uvStatus:d.getUVStatusMessage(),uvMessage:d.getUVMessage()});if(d.UV.linkingAccount.user){$("uvInfoUsername").removeClass("hidden");$("uvInfoEmail").removeClass("hidden")}if(d.UV.currentStatus){$("uvInfoStatus").removeClass("hidden")}this.UVInfoLoaded=false}}this.tpl.apply();if(!$(e.slavevalue)){if(BrowseView.SettingsWheelControl._slaveSource[e.slavevalue][0]){$(BrowseView.SettingsWheelControl._slaveSource[e.slavevalue][0].iD).show()}}else{log.write("Settings Panel (wheel changed): "+e.slavevalue);this.activePanelId=e.slavevalue;$(e.slavevalue).show();if(e.slavevalue=="Format"){this.selectAudioText($cn.data.PreferredAudioType)}log.write("$(data.slavevalue).show();")}if(!("WebSocketManager" in window)){$$("#settingspanel .settingssdkversion").hide()}application.currentView.layoutIsDirty=true;setTimeout(function(){this.isProcessing=false}.bind(this),400)}}}}},getUVStatusMessage:function(){var e="",d="";if("UVDeviceInactive"===this.UV.currentState){return""}if(this.UV.linkingAccount.linkingExpires){d=$cn.utilities.formatDate(this.UV.linkingAccount.linkingExpires,$cn.config.DateFormat)}if(this.UV.currentStatus){log.write("--- current status: status message: "+this.UV.currentStatus+" : ----");e=application.resource.uv_messages.settingsPanel.Status[this.UV.currentStatus].replace("##expiration##",d)}else{if(this.UV.currentState){e=application.resource.uv_messages.settingsPanel.Status[this.UV.currentState].replace("##expiration##",d)}}return e},getUVMessage:function(){var f="",e=application.resource.uv_messages.settingsPanel,d=(this.UV.currentStatus)?this.UV.currentStatus:this.UV.currentState;log.write("--- current status: uv message: "+d+" : ----");if(d=="AcctNotAvailable"){f=e.UVNotSupported.replace("##UvLink##",$cn.config.UVAccountLinkUrl)}else{if("UVDeviceInactive"===d){f=application.resource.uv_messages.settingsPanel.UVDeviceInactive.replace("##Activate##",$cn.data.ActivationURL)}else{if(d){f=e[d]}}}return f},requiresPurchasePin:function(){return($cn.data.PurchasePinEnabled)},requiresParentalControls:function(){return($cn.data.ParentPinEnabled)},requiresParentalControlsOnStartUp:function(){return($cn.data.ParentPinEnabledOnStartup)},selectedAudioFormat:function(d){var e=false;switch(d){case"Stereo":if($cn.data.PreferredAudioType=="Stereo_Standard"){e=true}break;case"DTS":if($cn.data.PreferredAudioType=="DTS_Express_51"||$cn.data.PreferredAudioType=="DTS_Express_Stereo"){e=true}break;case"Dolby":if($cn.data.PreferredAudioType=="Dolby_Digital_Plus_51"||$cn.data.PreferredAudioType=="Dolby_Digital_Plus_Stereo"){e=true}break;default:break}return e},showAudioType:function(d){var e="hidden";switch(d){case"DTS_Express_Stereo":if($cn.data.DTSStereoEnable){e=""}break;case"DTS_Express_51":if($cn.data.DTS51Enable){e=""}break;case"Dolby_Digital_Plus_51":if($cn.data.Dolby51Enable){e=""}break;case"Dolby_Digital_Plus_Stereo":if($cn.data.DolbyStereoEnable){e=""}break;default:break}return e},showAudioFormat:function(d){var e="hidden";switch(d){case"Stereo":if($cn.data.Dolby51Enable||$cn.data.DolbyStereoEnable||$cn.data.DTS51Enable||$cn.data.DTSStereoEnable){e=""}break;case"DTS":if($cn.data.DTS51Enable||$cn.data.DTSStereoEnable){e=""}break;case"Dolby":if($cn.data.Dolby51Enable||$cn.data.DolbyStereoEnable){e=""}break;default:break}return e},toggleBaseline:function(){$cn.data.baselineEnable=!$cn.data.baselineEnable;$("cbaseline").innerHTML=($cn.data.baselineEnable)?"Yes":"No"},toggleJinni:function(){$cn.data.jinniEnable=!$cn.data.jinniEnable;$("cjinni").innerHTML=($cn.data.jinniEnable)?"Yes":"No"},toggleFlixster:function(){$cn.data.flixsterEnable=!$cn.data.flixsterEnable;$("cflixster").innerHTML=($cn.data.flixsterEnable)?"Yes":"No"},toggleOnScreenDebug:function(){$cn.config.OnScreenDebugLog=!$cn.config.OnScreenDebugLog;$("osdebug").innerHTML=($cn.config.OnScreenDebugLog)?"Yes":"No";if($cn.config.OnScreenDebugLog){$("debugger").show()}else{$("debugger").hide()}},toggleParentalControlsOnStartUp:function(){if($cn.data.AuthToken==""){BrowseView.showActivate()}else{log.write("Current ParentPinEnabledOnStartup status: "+$cn.data.ParentPinEnabledOnStartup);var e=this,d=!$cn.data.ParentPinEnabledOnStartup;$cn.methods.loadToken(function(f){if($cn.data.ParentalControlsConfigured){application.events.publish("authparent",{callback:function(){e._toggleParentalControlsOnStartup(d)}})}else{BrowseView.showMessage("message_parentalcontrols",{Message:application.resource.switch_user_notsetup})}})}},toggleParentalControls:function(){if($cn.data.AuthToken==""){BrowseView.showActivate()}else{log.write("Current parental control status: "+$cn.data.ParentPinEnabled);var e=this,d=!$cn.data.ParentPinEnabled;$cn.methods.loadToken(function(f){if($cn.data.ParentalControlsConfigured){application.events.publish("authparent",{callback:function(){e._toggleParentalControls(d)}})}else{BrowseView.showMessage("message_parentalcontrols",{Message:application.resource.switch_user_notsetup})}})}},_toggleParentalControlsOnStartup:function(d){$cn.data.ParentPinEnabledOnStartup=d;log.write("New ParentPinEnabledOnStartup status: "+$cn.data.ParentPinEnabledOnStartup);document.getElementById("parentcheckonstartup").className="checkbox_"+$cn.data.ParentPinEnabledOnStartup;application.saveAuthToken()},_toggleParentalControls:function(d){$cn.data.ParentPinEnabled=d;$cn.data.IsParent=!$cn.data.ParentPinEnabled;log.write("New parental control status: "+$cn.data.ParentPinEnabled);log.write("Parental status: "+$cn.data.IsParent);webservices.clearContentCache(function(){document.getElementById("parentcheck").className="checkbox_"+$cn.data.ParentPinEnabled;BrowseView.reset();$("btnAccount").removeClass("locked");$("dock-back").addClass("disableBack");application.saveAuthToken();if($cn.data.ParentPinEnabled){$("btnAccount").addClass("locked")}})},togglePurchasePin:function(){if($cn.data.AuthToken==""){BrowseView.showActivate()}else{log.write("Current PurchasePinEnabled status: "+$cn.data.PurchasePinEnabled);var e=this,d=!$cn.data.PurchasePinEnabled;$cn.methods.loadToken(function(f){if($cn.data.ParentalControlsConfigured){application.events.publish("authparent",{callback:function(){e._togglePurchasePin(d)}})}else{BrowseView.showMessage("message_parentalcontrols",{Message:application.resource.switch_user_notsetup})}})}},_togglePurchasePin:function(d){$cn.data.PurchasePinEnabled=d;log.write("New PurchasePinEnabled control status: "+$cn.data.PurchasePinEnabled);document.getElementById("purchasepincheck").className="checkbox_"+$cn.data.PurchasePinEnabled;application.saveAuthToken()},show:function(){$("settingspanel").show();this.secretKey="";this.secretSequence="";this.isProcessing=false;if(!this.isInitialized){this.tpl.append({version:configuration.readValue("version"),build:configuration.readValue("build"),Major:configuration.readValue("SDKVersion_Major"),Minor:configuration.readValue("SDKVersion_Minor"),Revision:configuration.readValue("SDKVersion_Revision"),Branch:configuration.readValue("SDKVersion_Branch"),Build:configuration.readValue("SDKVersion_Build"),deviceid:webservices.uniqueId,devicename:($cn.data.DeviceName!="")?$cn.data.DeviceName:"Not Activated",accountlinkurl:$cn.data.AccountLinkUrl,firmwareversion:$cn.data.FirmwareVersion,affid:$cn.data.AffId,devicetype:webservices.destType,debugmode:($cn.config.SyncLogsExternally)?"Yes":"No",env:application.CurrentEnvironment,modelnumber:device.realmodelid,countryid:$cn.data.CountryID,logging:($cn.config.Debug)?"Yes":"No",baseline:($cn.data.baselineEnable)?"Yes":"No",jinni:($cn.data.jinniEnable)?"Yes":"No",flixster:($cn.data.flixsterEnable)?"Yes":"No",email:($cn.data.UserEmailAddress!="")?$cn.data.UserEmailAddress:"Not Activated"})}var d=this.tpl.apply();application.events.subscribe(this,"activated",this.updateActivationStatus.bind(this));application.events.subscribe(this,"badauthtoken",this.updateAuthStatus.bind(this));application.events.subscribe(this,"keydown",this.handleKeyDown.bind(this));application.events.subscribe(this,"activatecancelled",this.onActivateCancelled.bind(this))},hide:function(){application.events.unsubscribe(this,"activated");application.events.unsubscribe(this,"keydown");application.events.unsubscribe(this,"badauthtoken");application.events.unsubscribe(this,"activatecancelled");$("settingspanel").hide()},showAudioText:function(d){$("settingsaacselected").addClass("hidden");$("settingsdtsselected").addClass("hidden");$("settingsdolbyselected").addClass("hidden");switch(d){case"btnsettingsaudiostereo":case"audio_stereo":$("settingsaacselected").removeClass("hidden");break;case"btnsettingsaudiodts":case"audio_dts":$("settingsdtsselected").removeClass("hidden");break;case"btnsettingsaudiodolby":case"audio_digital":$("settingsdolbyselected").removeClass("hidden");break;default:break}},onBlur:function(d){log.write("onBlur called.");if(document.getElementById("Activate")){}},onNavigate:function(k){log.write("Navigate getting called.");if(document.getElementById("Activate")&&document.getElementById("Format").style.display=="block"){var j=k.args[0].current;if($(j).rel=="audioanchor"){if(k.args[0].direction=="up"||k.args[0].direction=="down"){k.preventDefault();var g=$$("a[rel=audioanchor]"),f=[],e=0,h=0,d;for(d=0;d<g.length;d++){if(j==g[d].id){h=e}if(document.getElementById(g[d].id).offsetWidth>0){f[f.length]=g[d];e++}}if(k.args[0].direction=="up"){if(h>0){navigation.setFocus(f[h-1].id,true)}else{navigation.setFocus(f[f.length-1].id,true)}}else{if(k.args[0].direction=="down"){if(h<f.length-1){navigation.setFocus(f[h+1].id,true)}else{navigation.setFocus(f[0].id,true)}}}}}}},onActivateCancelled:function(d){if(document.getElementById("Activate")){if(document.getElementById("GiftCards").style.display=="block"){navigation.setFocus("btnsettingsgc",true)}}},updateActivationStatus:function(d){log.write("SettingsPanel::updateActivationStatus called");$cn.methods.loadToken(function(e){if(document.getElementById("Activate")){document.getElementById("activate_devicenotactive").className="notactive_false";document.getElementById("activate_deviceactive").className="active_true";document.getElementById("settingsdeviceid").innerHTML=$cn.data.DeviceName;$("activate_devicenotactive").hide();$("activate_deviceactive").show();if($cn.data.ParentPinEnabled){document.getElementById("parentcheck").className="checkbox_true";if($cn.data.PurchasePinEnabled){document.getElementById("purchasepincheck").className="checkbox_true"}else{document.getElementById("purchasepincheck").className="checkbox_false"}}else{document.getElementById("parentcheck").className="checkbox_false"}application.currentView.layoutIsDirty=true;application.navigator.setFocus("selectedslave",true)}})},updateAuthStatus:function(d){log.write("updateAuthStatus callded: badauthtoken");if(document.getElementById("Activate")){document.getElementById("activate_devicenotactive").className="notactive_true";document.getElementById("activate_deviceactive").className="active_false";document.getElementById("settingsdeviceid").innerHTML="Not Activated";document.getElementById("purchasepincheck").className="checkbox_false";document.getElementById("parentcheck").className="checkbox_false";document.getElementById("parentcheckonstartup").className="checkbox_false";$("btnAccount").removeClass("locked");$("activate_devicenotactive").show();$("activate_deviceactive").hide()}},selectAudioFormat:function(f,d,e){switch(d){case"Stereo":$cn.data.PreferredAudioType="Stereo_Standard";break;case"DTS":if($cn.data.DTS51Enable){$cn.data.PreferredAudioType="DTS_Express_51"}else{$cn.data.PreferredAudioType="DTS_Express_Stereo"}break;case"Dolby":if($cn.data.Dolby51Enable){$cn.data.PreferredAudioType="Dolby_Digital_Plus_51"}else{$cn.data.PreferredAudioType="Dolby_Digital_Plus_Stereo"}break;default:break}configuration.writeValue("DefaultAudioFormat",$cn.data.PreferredAudioType);this.selectAudioText($cn.data.PreferredAudioType);$$("div.chk").removeClass("checkbox_true");$$("div.chk").addClass("checkbox_false");$(f).addClass("checkbox_true")},selectAudioText:function(d){switch(d){case"Stereo_Standard":this.showAudioText("btnsettingsaudiostereo");break;case"DTS_Express_51":case"DTS_Express_Stereo":this.showAudioText("btnsettingsaudiodts");break;case"Dolby_Digital_Plus_51":case"Dolby_Digital_Plus_Stereo":this.showAudioText("btnsettingsaudiodolby");break;default:break}},toggleDebug:function(){$cn.config.Debug=!$cn.config.Debug;$("cdebug").innerHTML=($cn.config.Debug)?"Yes":"No"},toggleRemoteLogging:function(){$cn.config.SyncLogsExternally=!$cn.config.SyncLogsExternally;$("cremote").innerHTML=($cn.config.SyncLogsExternally)?"Yes":"No"},handleKeyDown:function(d){switch(d.args[0].event.keyCode){case application.keys.KEY_UP:this.secretSequence+="u";break;case application.keys.KEY_DOWN:this.secretSequence+="d";break;case application.keys.KEY_RIGHT:this.secretSequence+="r";break;case application.keys.KEY_RED:this.secretKey+="a";break;case application.keys.KEY_1:this.secretKey+="1";break;case application.keys.KEY_2:this.secretKey+="2";break;case application.keys.KEY_3:this.secretKey+="3";break;case application.keys.KEY_4:this.secretKey+="4";break;case application.keys.KEY_5:this.secretKey+="5";break;case application.keys.KEY_6:this.secretKey+="6";break;case application.keys.KEY_7:this.secretKey+="7";break;case application.keys.KEY_8:this.secretKey+="8";break;case application.keys.KEY_9:this.secretKey+="9";break;case application.keys.KEY_0:this.secretKey+="0";break;default:break}log.write("Secret Key: "+this.secretKey+", Secret Sequence: "+this.secretSequence);if(this.secretKey=="a0852"){BrowseView.showChangeEnv()}else{if(this.secretKey==this.secretDebugKey||this.secretSequence==this.secretDirectionSequence){application.debugMode=true;BrowseView.goSettings(0)}else{if(this.secretKey.length>=this.secretDebugKey.length){this.secretKey=""}if(this.secretSequence.length>=this.secretDirectionSequence.length){this.secretSequence=""}}}},isActivated:function(){return($cn.data.AuthToken!="")?"true":"false"},getClosedCaptionPreview:function(){return ccrender.getClosedCaptionPreview()},updateClosedCaptionPreview:function(){if($$(".ClosedCaptionPreview")){$$(".ClosedCaptionPreview").set("html",this.getClosedCaptionPreview())}},setCCTextOpacity:function(d){$$("#SettingsCCTextOpacityContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");switch(d){case"Default":$("CCTextOpacityDefault").className="checkbox_true";$cn.data.CCTextOpacity="auto";break;case"Opaque":$("CCTextOpacityOpaque").className="checkbox_true";$cn.data.CCTextOpacity="100";break;case"SemiTransparent":$("CCTextOpacitySemiTransparent").className="checkbox_true";$cn.data.CCTextOpacity="50";break}this.updateClosedCaptionPreview();configuration.writeValue("CCTextOpacity",$cn.data.CCTextOpacity)},setCCTextFont:function(d){$$("#SettingsCCTextFontContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCTextFont"+d.capitalize()).className="checkbox_true";$cn.data.CCFont=d;this.updateClosedCaptionPreview();configuration.writeValue("CCFont",$cn.data.CCFont)},setCCTextEdge:function(d){$$("#SettingsCCTextEdgingContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCTextEdging"+d.capitalize()).className="checkbox_true";$cn.data.CCTextEdge=d;this.updateClosedCaptionPreview();configuration.writeValue("CCTextEdge",$cn.data.CCTextEdge)},setCCTextColor:function(d){$$("#SettingsCCTextColorContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCTextColor"+d.capitalize()).className="checkbox_true";$cn.data.CCTextColor=d;this.updateClosedCaptionPreview();configuration.writeValue("CCTextColor",$cn.data.CCTextColor)},setCCTextSize:function(e){$$("#SettingsCCTextSizeContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCTextSize"+e.capitalize()).className="checkbox_true";var d={auto:"auto",small:75,medium:100,large:125,extralarge:150};$cn.data.CCTextSize=d[e];this.updateClosedCaptionPreview();configuration.writeValue("CCTextSize",$cn.data.CCTextSize)},setCCBackgroundColor:function(d){$$("#SettingsCCBackgroundColorContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCBackgroundColor"+d.capitalize()).className="checkbox_true";$cn.data.CCBackgroundColor=d;this.updateClosedCaptionPreview();configuration.writeValue("CCBackgroundColor",$cn.data.CCBackgroundColor)},setCCBackgroundOpacity:function(e){$$("#SettingsCCBackgroundOpacityContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCBackgroundOpacity"+e.capitalize()).className="checkbox_true";var d={auto:"auto",opaque:100,semiTransparent:50,transparent:0};$cn.data.CCBackgroundOpacity=d[e];this.updateClosedCaptionPreview();configuration.writeValue("CCBackgroundOpacity",$cn.data.CCBackgroundOpacity)},setCCWindowColor:function(d){$$("#SettingsCCWindowColorContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCWindowColor"+d.capitalize()).className="checkbox_true";$cn.data.CCWindowColor=d;this.updateClosedCaptionPreview();configuration.writeValue("CCWindowColor",$cn.data.CCWindowColor)},setCCWindowOpacity:function(e){$$("#SettingsCCWindowOpacityContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCWindowOpacity"+e.capitalize()).className="checkbox_true";var d={auto:"auto",opaque:100,semiTransparent:50,transparent:0};$cn.data.CCWindowOpacity=d[e];this.updateClosedCaptionPreview();configuration.writeValue("CCWindowOpacity",$cn.data.CCWindowOpacity)}},SettingsPanelControl=new Class(SettingsPanelControlProperties);var TvSeasonsWheelControl=new Class({Extends:WheelControl,Implements:WheelControl,id:"TvSeasonsWheelControl",container:"searchwheel",singleWheel:true,MetaData:[],masterSourceElement:"singlemasterdatasource",masterSelectedElement:"singleselectedmaster",cleanUI:function(){if($("singleselectedmaster")){$("singleselectedmaster").label=""}if($("singlemasterdatasource")){if($("singlemasterdatasource").getChildren().length>0){$("singlemasterdatasource").getChildren().destroy()}}},handleWheelItemChange:function(f){log.write(f);if(f.context===ActiveWheel){var e=f.args[0];var d=this._masterSource[e.selectedidx];application.events.publish("gridloading",{grid:"titlegrid",message:"tvloading",className:"episodegrid",cssClass:"tv"});if(this.isLibrary){$cn.methods.getBundleListingPurchased(e.selectedvalue,function(j){log.write(j.bundleItems.length);var g=j.bundleItems;if(this.isSeasonal){g=g.slice();g.unshift({titleID:d.iD,name:application.resource.all_episodes,itemNumber:d.season})}if(d.watchFilter){var h=[];g.each(function(k){if(!k.hasWatched){h.push(k)}});g=h}BrowseView.LastGridProcess="tvseasons";application.events.publish("loadgrid",{grid:"titlegrid",data:g,columns:1,template:"listgrid",gridProcess:"tvseasons",className:"episodegrid",returnFocus:"singleselectedmaster"})}.bind(this))}else{$cn.methods.getBundleListing(e.selectedvalue,function(h){log.write(h.bundleItems.length);var g=h.bundleItems;if(this.isSeasonal){g=g.slice();g.unshift({titleID:d.iD,name:application.resource.all_episodes,itemNumber:d.name})}BrowseView.LastGridProcess="tvepisodes";application.events.publish("loadgrid",{grid:"titlegrid",data:g,columns:1,template:"listgrid",gridProcess:"tvepisodes",className:"episodegrid",returnFocus:"singleselectedmaster"})}.bind(this))}}},loadData:function(g,h){var f=0;var e="";this.layoutIsDirty=true;this.saveHistory();this.cleanUI();this._masterSource=[];if(this.isLibrary){if(this.isSeasonal){for(var d=0;d<g.length;d++){if(h==g[d].titleID){f=this._masterSource.length}this._masterSource.push({name:g[d].name,season:g[d].name,iD:g[d].titleID});if(!g[d].hasWatched){this._masterSource.push({name:g[d].name+"<br/>"+application.resource.unwatched_episodes,season:g[d].name,iD:g[d].titleID,watchFilter:true})}}}else{this._masterSource=[{name:application.resource.all_episodes,iD:g[0].titleID},{name:application.resource.unwatched_episodes,iD:g[0].titleID,watchFilter:true}]}}else{for(var d=0;d<g.length;d++){this._masterSource.push({name:g[d].name,iD:g[d].titleID});if(h==g[d].titleID){f=d}}}if(this._masterSource.length>0){$("titlegrid").show();$("singlewheel").show();this._renderWheel($("singlemasterdatasource"),this._masterSource,f);navigation.setFocus("singleselectedmaster",true)}},navigate:function(d){if(d.context===ActiveWheel&&d.args[0].current=="singleselectedmaster"){if(d.args[0].direction=="left"){navigation.setFocus("tdbuttonEpisodes");d.preventDefault()}else{this.parent(d)}}},onSaveState:function(e){this.parent(e);var d=e.args[0][this.id];d.isLibrary=this.isLibrary;d.isSeasonal=this.isSeasonal}});var EnvironmentPopup=new Class({Extends:ModalControl,popuptype:"",initialize:function(){this.parent("envchange")},show:function(){this.parent();var e=this,d;document.getElementById("envchangebtns").innerHTML="";for(d=0;d<application.Environments.length;d++){document.getElementById("envchangebtns").innerHTML+="<p>Select ("+d+") for "+application.Environments[d].name+"</p>"}application.events.subscribe(this,"back",this.handleBack.bind(this));setTimeout(function(){application.events.subscribe(e,"keydown",e.handleKeyPress.bind(e))},500)},unsubEvents:function(){application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"keydown")},handleBack:function(d){d.preventDefault();this.unsubEvents();this.hide()},setCurrentVal:function(d){application.CurrentEnvironment=d;application.endPointServer=d+".cinemanow.com";application.apiUrl="https://"+d+".cinemanow.com";log.write("Changing config (application.CurrentEnvironment): "+application.CurrentEnvironment);log.write("Changing config (application.endPointServer): "+application.endPointServer);log.write("Changing config (application.apiUrl): "+application.apiUrl);this.unsubEvents();this.hide();BrowseView.reset();configuration.writeValue("Environment",d)},handleKeyPress:function(d){switch(d.args[0].event.keyCode){case application.keys.KEY_1:this.setCurrentVal(application.Environments[1].key);break;case application.keys.KEY_2:this.setCurrentVal(application.Environments[2].key);break;case application.keys.KEY_3:this.setCurrentVal(application.Environments[3].key);break;case application.keys.KEY_4:this.setCurrentVal(application.Environments[4].key);break;case application.keys.KEY_5:this.setCurrentVal(application.Environments[5].key);break;case application.keys.KEY_6:this.setCurrentVal(application.Environments[6].key);break;case application.keys.KEY_7:this.setCurrentVal(application.Environments[7].key);break;case application.keys.KEY_8:this.setCurrentVal(application.Environments[8].key);break;case application.keys.KEY_9:this.setCurrentVal(application.Environments[9].key);break;case application.keys.KEY_0:this.setCurrentVal(application.Environments[0].key);break;default:break}}});var ActivatePanelObject={Extends:ModalControl,Implements:ModalControl,id:"activate",persist:{},controls:{},layoutIsDirty:true,tpl:null,code:"",pollTimer:null,pollTimerStarted:false,inPolling:false,initialize:function(){log.write("activate.init()");this.parent("activate")},loadData:function(f,e){var d=this;log.write("code is: "+e);this.parent(f);if(this.pollTimer===null){this.pollTimer=new Timer();this.pollTimer.Interval=5000;this.pollTimer.Tick=function(){if(document.getElementById("ActivateContent").style.display=="none"){log.write("Activate panel is not displayed but is still polling. Stop it!");d.pollTimer.Stop();d.pollTimerStarted=false}else{if(d.inPolling){return}log.write("Polling for auth token...");d.inPolling=true;$cn.methods.pollForToken(function(g){d.inPolling=false;if(g.authToken){if(g.authToken.length>0){$cn.utilities.setParentalSettings(g);d.hide();d.pollTimerStarted=false;d.pollTimer.Stop();if(BrowseView.ActivationPcView===null){BrowseView.ActivationPcView=new ActivationPcView()}BrowseView.ActivationPcView.activeFromWelcome=false;BrowseView.ActivationPcView.payload=d.payload;BrowseView.ActivationPcView.showActivateSuccessPage()}}})}}}this.displayCode(e);navigation.setFocusElement($("ModalContent").getElement(".default"),true)},displayCode:function(e,f){var d=this;log.write("displayCode");log.write(e);if(e){d.getCodeUpdateHtml(e,d,f)}else{log.write("code doesn't exist. Go get a code");$cn.methods.getActivationString(function(g){d.getCodeUpdateHtml(g,d,f)})}},getCodeUpdateHtml:function(g,f){var d;log.write("activation string:: "+g);f.code=g;for(d=0;d<g.length;d++){try{$("Code"+d).innerHTML=g.substring(d,d+1)}catch(k){log.write(log.dumpObj(k));return}}if(application.authSupported){if(!f.pollTimerStarted){f.pollTimerStarted=true;f.pollTimer.Start()}}$("modalcontrol").addClass("show"+g.length);$("ModalWindow").setAttribute("style","");var j=(application.resource.modalConfig["activate_show"+g.length]);for(var h in j){$("ModalWindow").setStyle(h,j[h])}log.write("Modal Class: "+$("modalcontrol").className);$("modalcontrol").removeClass("activate");$$("#ActivationFooter span.url").set("html",$cn.data.ActivationURL)},show:function(d){log.write("showing modal");this.parent();this.payload=d;application.TempKeyBlock=false;application.currentView.layoutIsDirty=true},hide:function(){this.parent();$cn.data.d2dPath=false;log.write("Hiding activate");if(application.authSupported){log.write("Stopping Activation timer.");if(this.pollTimer){this.pollTimer.Stop();this.pollTimerStarted=false;this.inPolling=false}}application.currentView.layoutIsDirty=true},poll:function(){$cn.methods.pollForToken(function(d){log.write(log.dumpObj(d.data.result))})},onBack:function(d){this.parent(d);log.write("onBack getting called");if(this.payload&&this.payload.onCancel){log.write("onBack with payload getting called");this.payload.onCancel.call()}else{application.events.publish("activatecancelled",{})}}},ActivatePanel=new Class(ActivatePanelObject);var TitleCheckOutWheelControl=new Class({Extends:WheelControl,Implements:WheelControl,id:"TitleCheckOutWheelControl",container:"singlewheel",singleWheel:true,MetaData:[],persist:{},masterSourceElement:"singlemasterdatasource",masterSelectedElement:"singleselectedmaster",cleanUI:function(){if($("singleselectedmaster")){$("singleselectedmaster").label=""}if($("singlemasterdatasource")){if($("singlemasterdatasource").getChildren().length>0){$("singlemasterdatasource").getChildren().destroy()}}},handleWheelItemChange:function(e){if(e.context===ActiveWheel){var d=e.args[0];log.write("Title Wheel Item changed. Now fire custom method. "+e.args[0].wheelinstance);application.events.publish("titlecheckoutwheelchanged",{selectedvalue:d.selectedvalue,titleID:this.persist.title.titleID});BrowseView.CurrentWheelValue=d.selectedvalue+":"}},loadCheckOutData:function(f){this.layoutIsDirty=true;this.cleanUI();var k=$cn.data.TitleDetailCache[f];this.persist.title=k;this.wheelChangedTimeout=200;if(k){var j=k.availableProducts,g=[],d;for(d=0;d<j.length;d++){var h="";if(j[d].availableAssets.length>0){switch(j[d].purchaseType){case"any":h="Buy";break;case"buy":h=$cn.utilities.getBuyTextForTitle(k);if(j[d].skuType.indexOf("Upgrade")!=-1){this.disctodigital=true;h+=" Disc to Digital"}h+="<br/>"+application.resource.currency_symbol+j[d].price;break;case"rent":h="Rent "+j[d].rentalPeriod+" Hr<br />"+application.resource.currency_symbol+j[d].price;break;case"subscription":h="Subscription";break}var e=false;if(j[d].skuType.indexOf("HD")>-1){e=true}if(e){h=h+'<div id="hdbadge" ></div>'}if(j[d].skuType.indexOf("Upgrade")==-1||(j[d].skuType.indexOf("Upgrade")!=-1&&k.titleID==$cn.data.d2dTitleInfo.id)){g.push({name:h,iD:j[d].skuID,parentID:0,purchaseType:j[d],titleID:k.titleID})}}}this.loadData(g,[{}]);if(g.length>1||this.disctodigital){$("singlewheel").show();$("checkout_container").removeClass("nowheel");navigation.setFocus("singleselectedmaster",true)}else{$("singlewheel").hide();$("checkout_container").addClass("nowheel");BrowseView.CheckoutPanel.activate()}}},navigate:function(g){if(g.context===ActiveWheel){var f=g.args[0];if(f.current=="singleselectedmaster"){if(f.direction=="left"){g.preventDefault();navigation.setFocus("tdbuttonCheckout")}else{if(f.direction=="right"){g.preventDefault();if($("singlemasterdatasource")){var d=$$("#singlemasterdatasource div.hover");if(d.length>0){var e=d[0];if(e){e.removeClass("hover");e.addClass("hdHighlight")}}}if(!this.isNavigating){BrowseView.CheckoutPanel.activate()}}else{this.parent(g)}}}else{if(f.current=="checkout_order"||f.current=="checkout_redeem"||f.current=="checkout_payment"||f.current=="checkout_cancel"){if(f.direction=="left"){if($("singlemasterdatasource")){var d=$$("#singlemasterdatasource div.hdHighlight");if(d.length>0){var e=d[0];if(e){e.addClass("hover");if(f.current!="checkout_cancel"){e.removeClass("hdHighlight")}}}}}}}}}});var RecomendationWheelControl=new Class({Extends:WheelControl,Implements:WheelControl,id:"RecomendationWheelControl",returnFocus:null,titleID:null,MetaData:[],dataLoaded:false,masterIdx:0,slaveIdx:0,activate:function(){this.parent();this.returnFocus=application.element.current},handleWheelItemChange:function(f){log.write(f);if(f.context===ActiveWheel&&f.args[0]){var e=f.args[0];log.write("Title Wheel Item changed. Now fire custom method. "+f.args[0].wheelinstance);if(e.sourceid.indexOf("master")>-1){$("slavedatasource").getElements("div").destroy();f.context.loadSlaveDataSource(e.selectedvalue)}else{if(e.sourceid.indexOf("slave")>-1){log.write("The slave wheel item has changed. Update results.");var d=f.args[0].selectedvalue.split("|");this.masterIdx=d[0];this.slaveIdx=d[1];this.loadSlaveGrid(d[0],d[1])}}}},loadSlaveGrid:function(h,f){var e=(h.indexOf("s_")>-1);var g=1;var d=this;if(e){application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:2,className:"similar"});BrowseView.LastGridProcess="similar";$cn.methods.getBrowseListByGeneWithSimilarBy(f,this.titleID,g,function(j){d.dataLoaded=true;BrowseView.CurrentProcessLoaded=true;application.events.publish("loadgrid",{grid:"titlegrid",data:j.data.result.items,columns:2,altMessage:"",gridProcess:"similar",className:"similar",template:"similarlist"})})}else{if(h=="m_cast_crew"){application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:2,className:"similar"});BrowseView.LastGridProcess="similar";$cn.methods.getBrowseListByCast(f,g,function(j){d.dataLoaded=true;BrowseView.CurrentProcessLoaded=true;application.events.publish("loadgrid",{grid:"titlegrid",data:j.data.result.items,columns:2,altMessage:"",gridProcess:"similar",className:"similar",template:"similarlist"})})}}},loadSlaveDataSource:function(g){var f=this;var h=(g.indexOf("m_")==0);var e=(g.indexOf("s_")==0);if(this._slaveSource[g]){application.events.publish("recommendeddataloaded");this._renderWheel($("slavedatasource"),this._slaveSource[g]);if(e||h){var d=this._slaveSource[g][0].iD.split("|");this.masterIdx=g;this.slaveIdx=d[1];this.loadSlaveGrid(g,d[1])}}else{if(h){switch(g){case"m_cast_crew":$cn.methods.getCastAndCrew(this.titleID,function(k){f.MetaData[g]=k.castMembers;f._slaveSource[g]=[];k.castMembers.each(function(l){f._slaveSource[g].push({name:f.split(l.name),iD:g+"|"+l.castID,parentID:0})});f._renderWheel($("slavedatasource"),f._slaveSource[g]);var j=f._slaveSource[g][0].iD.split("|");application.events.publish("recommendeddataloaded");f.loadSlaveGrid(g,j[1])});break;default:break}}}},loadSlave:function(e,d){if(d){this.loadSlaveGrid(e,d)}else{this.loadSla