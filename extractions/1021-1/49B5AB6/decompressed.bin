let rights are included with the purchase of this title, including:"},success:{Message:"Your UltraViolet account has been successfully ##status##.",OK:"Continue"},settingsPanel:{UVDeviceInactive:"CinemaNow is not currently activated on this device. Go to ##Activate## to activate CinemaNow and link to an existing UltraViolet account or create a new one.",UVNotSupported:"Your CinemaNow account is not currently linked to an UltraViolet account. Go to ##UvLink## to link an UltraViolet account to your CinemaNow account and enable access to your UltraViolet Digitial Collection.",Active:"Your CinemaNow account is currently linked to an UltraViolet account enabling access to your UltraViolet Digital Collection.",Pending:"Your UltraViolet account is pending. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection.",Deleted:"Your UltraViolet account has been deleted. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection.",Suspended:"Your UltraViolet account has been suspended. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection.",BlockedTOU:"Your UltraViolet account has been blocked since the UltraViolet Terms of Use have been updated since you last accepted them. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection",Archived:"Your UltraViolet account is not active. Please log into your UltraViolet account at www.uvvu.com for more information",Unlinking:"Your UltraViolet account is not active. Please log into your UltraViolet account at www.uvvu.com for more information",Inactive:"Your UltraViolet account is inactive. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection.","Server Error":"There was a Server Error (551). UltraViolet features are temporarily inaccessible. Please try again later.",Status:{Active:"Linked to CinemaNow (Expires on ##expiration##)",Pending:"Pending",AcctNotAvailable:"Account Not Available",Unlinking:"Unlinking",BlockedTOU:"Blocked due to UltraViolet Terms of Use update",Archived:"Inactive",Suspended:"Suspended",Deleted:"Deleted",Inactive:"Inactive","Server Error":"Server Error"}},helpString:'For details on where you can watch this title, go to <span class="white">www.uvvu.com</span>',uvTermsOfService:{ChangedMessage:"The UltraViolet Terms of Use has changed",UnacceptedMessage:"UltraViolet Terms of Use",Content:"To purchase, access or playback UltraViolet content, you must accept the latest UltraViolet Terms of Use.",OK:"Accept UltraViolet Terms of Use",Close:"Not Now"}},d2d_messages:{invalid:{Message:"The disc you inserted could not be validated",Content:"You need to load the original disc that was used to qualify for the Disc to Digital Purchase",OK:"OK"},already_own:{Message:"We have found a similar title in your library",Content:'You have chosen to buy <span class="white">##title##</span> via Disc to Digital, but you already have <span class="white">##libTitle##</span> in your library. Do you still want to purchase <span class="white">##title##</span> for $##price##?',OK:"Continue",Cancel:"Cancel"}},store_messages:{no_internet:{Title:"Checkout",Message:"Unable to connect to the Internet.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">512 {m}</span>',OK:"Try Again",OK_Action:"retry",Cancel:"Cancel",Cancel_Action:"",MessageType:"message_error_default"},timeout_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2012 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},socket_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2013 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},system_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},Title_ID_Not_Found:{Title:"Error",Message:"We're sorry, the title no longer exists or you are trying to play the title from a geographical location that is not supported.",Content:"Currently, you can only play CinemaNow titles within the United States. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <br /><span class="errorCode">515 {m}</span>',Cancel:"OK",MessageType:"message_content_callback"},Similar_Titles_Not_Found:{Title:"Error",Message:"Similar titles not found.",Content:"No results were found.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <br /><span class="url">{responseCode} {m}</span>',Cancel:"Cancel",MessageType:"message_content_callback"}},testing_messages:{connectionHeading:'<span class="white">Connection Type: ##type##</span><br/>',storeHeading:'<span class="white">Store Connection: ##status##</span><br/>',activationHeading:'<span class="white">Activation Status: ##status##</span><br/>',defaultString:"Errors",connected:"No Errors",notActivated:"Not Activated",activated:"Activated",testingBandwidth:"1 of 6 Testing Bandwidth",bwMessage:{SpeedResult1:"A sustained bandwidth of ##speed## Mbps is too slow to watch streaming videos at high quality. We recommend upgrading your Internet connection. ",SpeedResult2:"Good News! A sustained bandwidth of ##speed## Mbps will be sufficient to watch streaming videos at high quality. You might consider upgrading your Internet connection in order to view HD videos at the highest quality.",SpeedResult3:"Good News! A sustained bandwidth of ##speed## Mbps is excellent. You can view HD videos at the highest quality. "},connectionInfo:{None:"You are not connnected to the internet.",Wireless:"Wireless is typically slower than a wired connection. Try a wired connection for faster performance."},activationInfo:"You will be able to buy and rent movies if you activate.",storeInfo:"The server is not responding.",connectionType:{none:"None",wireless:"Wireless",wired:"Wired",unknown:"Unknown"},show_details:{Title:"System Status Check Details",connectionType:"",connectionInfo:"",storeConnection:"",Cancel:"Close",MessageType:"message_system_details"}},player_messages:{connectiontooslow_error:{Title:"Video Playback",Message:"Your Internet connection is too slow to instantly stream this video.",Content:"We recommend that you upgrade your Internet connection to enable instant streaming.",OK:"Continue",Cancel:"Cancel",MessageType:"message_error_connectiontooslow"},connectiontooslow_error_sd:{Title:"Video Playback",Message:"Your Internet connection is too slow to instantly stream SD video.",Content:"We recommend that you upgrade your Internet connection to enable instant SD streaming.",OK:"Continue",Cancel:"Cancel",MessageType:"message_error_connectiontooslow"},connectiontooslow_error_hd:{Title:"Video Playback",Message:"Your Internet connection is too slow to instantly stream HD video.",Content:"We recommend that you upgrade your Internet connection to enable instant streaming.",OK:"Continue",Cancel:"Cancel",MessageType:"message_error_connectiontooslow"},connectiontooslow_error_player:{Title:"Video Playback",Message:"Your Internet connection is currently too slow to stream this video.",Content:"<p>Other connected devices sharing your Internet connection may be downloading large files, or there may be heavy Internet usage in your local area.</p><p>We recommend that you upgrade your Internet connection so you can enjoy instant streaming without interruptions:</p><p>For a good video experience, we recommend 4 Mbps.<br/>For the best HD or 3D experience, we recommend at least 8 Mbps.</p>",OK:"Stop",Cancel:"Continue",MessageType:"message_error_connectiontooslow_player"},askabouthdswap_error:{Title:"Video Playback",Message:"Your Internet connection is currently too slow to stream this video in HD.<br/>For the best HD experience, we recommend at least 8 Mbps",Content:"If your connection speed is at least 8 Mbps, there may be heavy Internet usage in your local area or other devices sharing your Internet connection may be downloading large files. Cancel any downloads in progress or other operations that use bandwidth and then try resuming in HD.",Footer:"OTHER OPTIONS<br/>If your connection speed is slower than 8 Mbps, consider upgrading your Internet connection so you can enjoy instant HD streaming without interruptions. For now, you can resume your program in SD to help ensure there will be no further interruptions. You may also choose to stop playback and resume later.",TryAgain:"Resume in HD",OK:"Continue in SD",Cancel:"Stop Playback",MessageType:"message_error_askabouthd"},no_internet:{Title:"Video Playback",Message:"Unable to connect to the Internet.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">512</span>',OK:"Try Again",OK_Action:"retry",Cancel:"Cancel",Cancel_Action:"",MessageType:"message_error_default"},OnNetworkDisconnected:{Title:"Video Playback",Message:"Unable to connect to the Internet.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">512</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},OnConnectionFailed:{Title:"Video Playback",Message:"Unable to connect to the Internet.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">512</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},timeout_error:{Title:"Video Playback",Message:"Unable to contact the server.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2012</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},socket_error:{Title:"Video Playback",Message:"Unable to contact the server.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2013</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},system_error:{Title:"Video Playback",Message:"We're sorry. We have encountered a technical playback error.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_playback"},OnRenderError:{Title:"Video Playback",Message:"We're sorry. We have encountered a technical playback error.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_playback"},OnStreamNotFound:{Title:"Video Playback",Message:"We're sorry. We have encountered a technical playback error.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_playback"},OnStreamNotFound_trailer:{Title:"Video Playback",Message:"Unable to playback trailer.",Content:"The trailer is currently unavailable. Please try again later.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_playback"},OnAuthenticationFailed:{Title:"Video Playback",Message:"Unable to connect to license server.",Content:"Please check your Internet connection, and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_default"},OnWideVineError_550:{Title:"Video Playback",Message:"Unable to contact the server. ",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_default"},OnWideVineError_2004:{Title:"Video Playback",Message:"Unable to contact the server. ",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_default"},OnWideVineError_513:{Title:"Video Playback",Message:"This title cannot be watched at this moment because it is currently playing on another device simultaneously.",Content:"The same title cannot be watched simultaneously on more than one device due to content licensing restrictions. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">513</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_514:{Title:"Video Playback",Message:"No credit card has been added to your account.",Content:'You\'ll need to provide a valid credit card in order to proceed with playback. <br /><br />Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">514</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},OnWideVineError_515:{Title:"Video Playback",Message:"We're sorry, the title no longer exists or you are trying to play the title from a geographical location that is not supported.",Content:"Currently, you can only play CinemaNow titles within the United States.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">515</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_516:{Title:"Video Playback",Message:"We're sorry. It appears this title cannot be played at your current geographic location due to content owner restrictions.",Content:"Currently, you can only play CinemaNow titles within the United States.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">516</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_517:{Title:"Video Playback",Message:"We're sorry. We have encountered a technical error.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">517</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_520:{Title:"Video Playback",Message:"We're sorry, the title you are trying to stream is not available or on a different device.",Content:"Please reactivate this device with your CinemaNow account and retry. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">520</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_521:{Title:"Video Playback",Message:"We're sorry, the title you are trying to stream is not available or on a different device.",Content:"Please reactivate this device with your CinemaNow account and retry. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">521</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_522:{Title:"Video Playback",Message:"We're sorry, your rental has expired or your title is no longer available for streaming.",Content:"Please re-purchase the title and retry in a few minutes. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">522</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_523:{Title:"Video Playback",Message:"We're sorry, your user name with this device cannot be matched.",Content:"Please reactivate this device with your CinemaNow account. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">523</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_524:{Title:"Video Playback",Message:"We're sorry. It appears this video cannot be watched on this device because you have used up all your available licenses.",Content:"You will need to stop playback from other devices, remove the video, or repurchase it. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">524</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_525:{Title:"Video Playback",Message:"We're sorry, the title was not found.",Content:"Please reactivate your device or update its software.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">525</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_570:{Title:"Video Playback",Message:"Your account has been locked.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">570</span>',Cancel:"OK",MessageType:"message_error_playback"}},lib_d2d_info:{title:"How to start the Disc to Digital process.",step1:"Insert a DVD that you own into your device while CinemaNow is running.",step2:"CinemaNow will locate if there is a Disc to Digital offer for your Disc Media Type.",step3:"If your Disk Media Title appears as an offer in the CinemaNow store. follow the simple on-screen instructions."},show_play_error:{Not_Owned:{Title:"",Message:"You do not own this movie."},Bought_SD:{Title:"",Message:"You already own this movie."},Bought_HD:{Title:"",Message:"You already own this movie in HD."},Active_Rental_SD:{Title:"",Message:"Your current rental of this movie is still active. "},Active_Rental_HD:{Title:"",Message:"Your current HD rental of this movie is still active."},Expired_Rental_SD:{Title:"",Message:"You previously rented this movie, but it has expired."},Expired_Rental_HD:{Title:"",Message:"You previously rented this movie in HD, but it has expired."},TV_Own_Some_Episodes:{Title:"",Message:""},TV_Own_Season_SD:{Title:"",Message:""},TV_Own_Season_HD:{Title:"",Message:""}},confirmation:{buy:{Movie:"BUY","TV_Season ":"BUY SEASON",TV_Episode:"BUY EPISODE"},rent:"RENT for {Period} Hrs",hd:" in HD"},processing_strings:{search_donotuse:"Searching..."},activation_messages:{success:{Message:'<strong class="white">Device activated successfully.</strong>',Title:"",OK:"OK"}},LibMasterWheelOptions:{Movies:"Movies",Movie_Rentals:"Movie Rentals",HD_Movies:"HD Movies",TV_Shows:"TV Shows",HD_TV_Shows:"HD TV Shows",UV_Movies:"My<br/>UltraViolet",D2D_Movies:"Disc to<br/>Digital"},LibSlaveWheelOptions:{All:"All",Never_Watched:"Never<br/>Watched",Unavailable:"Unavailable",Expired:"Expired",Expiring_Soon:"Expiring<br/>Soon",Info:"Info",UltraViolet:"UltraViolet",Action:"Action",Adventure:"Adventure",Animation:"Animation",Comedy:"Comedy",Drama:"Drama",Family:"Family",Horror:"Horror",Reality:"Reality",Romance:"Romance","Sci-Fi":"Sci-Fi",Sports:"Sports",Thriller:"Thriller",Westerns:"Westerns","Animation and Cartoons":"Animation and Cartoons","Food and Leisure":"Food and Leisure","Home and Garden":"Home and Garden",Music:"Music","Reality and Game Shows":"Reality and Game Shows",Other:"Other"},SettingsWheelOptionStrings:{General:"General",ClosedCaptions:"Closed<br />Captions",CCTextColor:"Text<br />Color",CCTextFont:"Text<br />Font",CCTextSize:"Text<br />Size",CCTextOpacity:"Text<br />Opacity",CCTextEdging:"Text<br />Edging",CCBackgroundColor:"Background<br />Color",CCBackgroundOpacity:"Background<br />Opacity",CCWindowColor:"Window<br />Color",CCWindowOpacity:"Window<br />Opacity",Audio:"Audio",Family:"Family",Debug:"Test Setup Page",Library:"My Library",Activate:"Activate<br />Device",GiftCards:"Gift Cards",UV:"UltraViolet<br/>Account",About:"About",Format:"Format",Parental:"Parental<br/>Controls",RequirePIN:"Require PIN for Purchases",RoxioNow:"Account Linking",DeviceInfo:"Device Info",ChangeEnvironment:"Change Environment",ConfigurationValues:"Configuration Values",AudioSupport:"Change Audio Format Support",SystemStatus:"System Status"},HelpWheelOptionStrings:{GettingStarted:"Getting<br />Started",BrowsingStore:"Browsing the Store",Searching:"Searching",WishList:"Wish List",Library:"My Library",ParentalControls:"Parental<br/>Controls",OnscreenControls:"On-screen Controls",CustomerSupport:"Customer Support",RentingBuying:"Renting or Buying",Ultraviolet:"UltraViolet"},support_strings:{Support:'Having trouble? Go to <span class="url">www.cinemanow.com/support</span>',ErrorCode:"Error code: "},pinPopup:{left:"202"},titleview_strings:{Duration_Concat:" / ",Starring_Concat_Length:"130"}};(function(){var d;application.resource.uv_responseCodes={};for(d in application.resource.uv_responses){if(application.resource.uv_responses.hasOwnProperty(d)){application.resource.uv_responseCodes[application.resource.uv_responses[d].code]=application.resource.uv_responses[d]}}}());var BrowseView={id:"store",persist:{},controls:{},focusState:{},layoutIsDirty:true,WheelControl:null,GiftCardPanel:null,SearchWheelControl:null,TitleMetaWheelControl:null,RecomendationWheelControl:null,TitleCheckOutWheelControl:null,SignInControl:null,GridController:null,GridControl:null,MerchControl:null,MessagePopup:null,SystemStatusPopup:null,AudioPopup:null,DockControl:null,Legal:null,hasShownActivate:false,CurrentTitleID:"",orderHailMary:false,orderIsProcessing:false,bwPercentProgress:0,bwTempCount:0,bwTempTotalSpeed:0,LastGridProcess:"",CurrentProcessLoaded:null,TitleViewControl:null,WishListLastLoaded:new Date(),titleViewLoading:false,uniquePurchaseId:false,CurrentWheelValue:"",tryAgainToPlayCount:0,init:function(g,f){var e=this,d;log.write("store.init()");this.DockControl=new DockControl();if($cn.data.SystemOffline){e.showSystemMessage();return}this.GridController=new GridController();if(g){this.persist=g}this.WheelControl=new WheelControl();this.GridControl=new GridControl();this.ImageGrid=new ContentGrid("imagegrid");this.BioGrid=new ContentGrid("biogrid");this.ReviewGrid=new ContentGrid("reviewgrid");this.CreditsGrid=new ContentGrid("creditsgrid");this.TechGrid=new ContentGrid("techgrid");this.MerchControl=new MerchControl();this.WelcomeControl=new WelcomeControl();this.ActivationPcView=new ActivationPcView();this.SystemStatusPopup=new SystemStatusPopup();if($cn.config.EnableD2D&&$cn.config.DeviceD2DEnabled){this.DiscToDigitalGrid=new ContentGrid("disctodigitalgrid");this.GridController.register(this.DiscToDigitalGrid)}this.GridController.register(this.GridControl);this.GridController.register(this.ImageGrid);this.GridController.register(this.BioGrid);this.GridController.register(this.ReviewGrid);this.GridController.register(this.CreditsGrid);this.GridController.register(this.TechGrid);this.ScrollBar=new ScrollBar("scrollbar");this.SearchKeyboard=new SearchKeyboardControl();this.SettingsPanel=new SettingsPanelControl();this.CheckoutPanel=new CheckoutPanelControl();this.GiftCardPanel=new GiftCardPanelControl();this.HelpPanel=new HelpPanelControl();this.WishList=new WishList();this.TitleViewControl=new TitleViewControl();this.GiftCardKeyboard=new GiftCardKeyboardControl();this.GiftCardPanel.keyboard=this.GiftCardKeyboard;this.goHome();application.events.subscribe(this.TitleViewControl,"loadtitleview",function(j){var k,h=($cn.data.d2dPath?0:2000);log.write("titleViewLoading: "+e.titleViewLoading);if(e.titleViewLoading||BrowseView.GridController.spinnerSpinning){return}k=$cn.utilities.showLoadingModal(h,"Loading Title...");e.titleViewLoading=true;application.TempKeyBlock=true;application.TempKeyBlockDuration=1500;application.state.save();log.session.addActivity("Title_Details",["Title_ID",String(j.args[0].id)]);application.state.current="titleview";BrowseView.CurrentTitleID=j.args[0].id;BrowseView.CurrentTitleLayout=j.args[0].type;if(j.args[0].type&&j.args[0].type=="library"){log.write("type is library");if(j.args[0].passID){$cn.methods.verifyAuthToken(function(l){if(l){$cn.methods.getPurchasedTitle(j.args[0].passID,j.args[0].id,function(m){var p,n;if(m.titleID!=0){if($cn.utilities.isTrue(m.isPassUV)){e.UV=new $cn.utilities.UserUVManager("CheckoutPanel");$cn.utilities.clearLoadingSpinner(k);e.UV.checkUVAccount(function(q){if(q){k=$cn.utilities.showLoadingModal(h,"Loading Title...");BrowseView.loadTitle(m,j.args[0].action,k)}else{e.titleViewLoading=false}},true)}else{BrowseView.loadTitle(m,j.args[0].action,k)}}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;p=application.resource.store_messages.Title_ID_Not_Found;n={Message:p.Message,Content:p.Content,Footer:p.Footer.replace("{m}",e.resolveMethodCode("getPurchasedTitle")),Close:p.Cancel,callback:function(q){log.write("Error (Unrecoverable)...")}};BrowseView.showMessage(p.MessageType,n)}})}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;BrowseView.showActivate()}})}else{log.write("type is NOT library");$cn.methods.getTitleListing(j.args[0].id,true,function(l){var n=$extend({passID:-1},l),p,m;if(n.titleID!=0){BrowseView.loadTitle(n,j.args[0].action,k)}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;p=application.resource.store_messages.Title_ID_Not_Found;m={Message:p.Message,Content:p.Content,Footer:p.Footer.replace("{m}",e.resolveMethodCode("getFullSummary")),Close:p.Cancel,callback:function(q){log.write("Error (Unrecoverable)...")}};BrowseView.showMessage(p.MessageType,m)}})}}else{if(j.args[0].checklibrary&&$cn.data.AuthToken.length!=0){log.write("we are in args checklibrary");$cn.methods.lookupPurchaseDetailsForTitle(j.args[0].id,function(l){var n,m;if(l.responseCode==0&&l.isAvailable){log.write("we are in is available");$cn.methods.getPurchasedTitle(l.passID,j.args[0].id,function(p){if(j.args[0].action=="checkout"){j.args[0].action=""}if(p.titleID!=0){BrowseView.loadTitle(p,j.args[0].action,k)}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;n=application.resource.store_messages.Title_ID_Not_Found;m={Message:n.Message,Content:n.Content,Footer:n.Footer.replace("{m}",e.resolveMethodCode("getPurchasedTitle")),Close:n.Cancel,callback:function(q){log.write("Error (Unrecoverable)...")}};BrowseView.showMessage(n.MessageType,m)}})}else{log.write("we are not in is available");$cn.methods.getTitleListing(j.args[0].id,true,function(p){var r,q;$("uicontainer").removeClass("redbuttons");if(p.titleID!=0){BrowseView.loadTitle(p,j.args[0].action,k)}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;r=application.resource.store_messages.Title_ID_Not_Found;q={Message:r.Message,Content:r.Content,Footer:r.Footer.replace("{m}",e.resolveMethodCode("getFullSummary")),Close:r.Cancel,callback:function(s){log.write("Error (Unrecoverable)...")}};BrowseView.showMessage(r.MessageType,q)}});l.errorHandled=true}})}else{$cn.methods.getTitleListing(j.args[0].id,true,function(l){var n,m;if($cn.data.d2dPath){l.availableProducts.unshift($cn.data.d2dTitleOffers.availableOffers[0])}$("uicontainer").removeClass("redbuttons");if(l.titleID!=0){BrowseView.loadTitle(l,j.args[0].action,k)}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;n=application.resource.store_messages.Title_ID_Not_Found;m={Message:n.Message,Content:n.Content,Footer:n.Footer.replace("{m}",e.resolveMethodCode("getFullSummary")),Close:n.Cancel,callback:function(p){log.write("Error (Unrecoverable)...")}};BrowseView.showMessage(n.MessageType,m)}})}}});application.events.subscribe(this,"exit",this.onExit.bind(this));application.events.subscribe(this,"no_choice_exit",this.onNoChoiceExit.bind(this));application.events.subscribe(this,"return",this.onReturn.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"gridloading",this.handleGridLoading.bind(this));application.events.subscribe(this,"gridloaded",this.handleGridLoaded.bind(this));application.events.subscribe(application,"badauthtoken",this.handleBadAuthToken.bind(this));application.events.subscribe(application,"authparent",this.handleAuthParent.bind(this));application.events.subscribe(this,"goback",this.handleGoBack.bind(this));application.events.subscribe(this,"recommendeddataloaded",this.handleLoadRecommendation.bind(this));application.events.subscribe(this,"error",function(){var h=this;setTimeout(function(){h.onHandleError.bind(h)()},2500)}.bind(this));application.events.subscribe(this,"elementfocus",this.onFocus.bind(this));application.events.subscribe(this,"elementblur",this.onBlur.bind(this));application.events.subscribe(application,"ready",function(){if(application.ApplicationError){$("wheel").hide();$("SplashScreen").hide();if(document.getElementById("welcome")){$("welcome").hide()}e.showMessage(application.ApplicationError.type,application.ApplicationError);return}if(application.regionError){$("wheel").hide();$("SplashScreen").hide();if(document.getElementById("welcome")){$("welcome").hide()}e.showMessage(application.regionError.type,application.regionError);return}application.isLoaded=true;if($cn.data.isConnected){if($cn.data.SystemOffline){e.showSystemMessage()}else{log.write("ParentPinEnabled: "+$cn.data.ParentPinEnabled+", $cn.data.IsParent: "+$cn.data.IsParent+", $cn.data.ParentPinEnabledOnStartup: "+$cn.data.ParentPinEnabledOnStartup);d=e.initCallback.bind(e);log.write("Check to see if Eula needs to be displayed. $cn.data.DisplayEula: "+$cn.data.DisplayEula);if($cn.data.DisplayEula){application.blockWidgetAccess=true;setTimeout(function(){e.showEula("eula",true)},100)}else{d()}}}else{application.events.publish(application,"error",{type:"no_internet",recoverable:false})}});application.events.subscribe(application,"activated",function(j){log.write("User has been activated.");log.write("$cn.data.ParentPinEnabled: "+$cn.data.ParentPinEnabled);if($cn.data.ParentPinEnabled){$("btnAccount").addClass("locked");$cn.data.IsParent=false;BrowseView.reset()}else{$cn.data.IsParent=true;if($cn.data.ContentIsFiltered){BrowseView.reset()}}if(j&&j.args[0]){var h=j.args[0];if(h.method!="getStreamingAssetLocation"){log.write("Making post activation call.");if(h.endPoint){webservices.makeAsyncRequest(h.endPoint,h.method,h.params,h.cb_context,h.callback,true)}else{if(h.callback){h.callback.call()}}}else{log.write("Cannot make post activation call because the last call was playback. Wait for user input")}}application.state._viewstate["library-view"]=null;application.state._viewstate["wishlist-view"]=null}.bind(this))},initCallback:function(){var d=this;application.blockWidgetAccess=false;if(!$cn.data.partnerOfferID){setTimeout(function(){$("SplashScreen").hide()},2500)}if($cn.data.d2dPath){if($cn.data.d2dTitleInfo.id===null||$cn.data.d2dTitleInfo.error){d.showD2DUnavailable()}else{if($cn.data.AuthToken.length!=0&&$cn.data.AuthTokenActive==true){application.events.publish("loadtitleview",{id:$cn.data.d2dTitleInfo.id,action:"checkout"})}else{log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");$("defaultWelcome").addClass("hidden");$("diskToDigitalWelcome").removeClass("hidden");d.WelcomeControl.getStarted();d.WelcomeControl.show()}}}else{if($cn.data.partnerOfferID){d.handleDeepLinking()}else{if($cn.data.AuthToken.length!=0&&$cn.data.AuthTokenActive==true){log.debug("$cn.data.EnableMerchPage: "+$cn.data.EnableMerchPage);d.WelcomeControl.hide();if($cn.data.EnableMerchPage){d.showMerch()}else{application.navigator.setFocus("selectedmaster",true)}}else{$("SplashScreen").hide();d.WelcomeControl.show();application.navigator.setFocus("welcomebutton",true)}}}if($cn.data.ParentPinEnabled){$("btnAccount").addClass("locked")}},showD2DUnavailable:function(){$cn.data.d2dPath=false;this.WelcomeControl.show();$("d2dUnavailable").show();log.write("D2D NO GO ");log.write("D2D NO GO ");log.write("D2D NO GO ");log.write("D2D NO GO ");log.write("D2D NO GO ");log.write("D2D NO GO ");log.write("D2D NO GO ");application.navigator.setFocus("d2dbrowsebutton",true)},tryStoreDeepLink:function(e){var d=this;var g="getShortSummary",f={TitleID:e};webservices.makeAsyncRequest(application.EndPoints.titledata,g,f,d,function(h){var j=false;if(h.data&&h.data.result){if(h.data.result.responseCode==0){$cn.data.partnerOfferAction="";application.currentView.currentState=null;application.events.publish("loadtitleview",{id:e});j=true}else{if(h.data.result.responseCode==20){h.data.result.errorHandled=true}else{j=true}}}if(!j){$cn.data.partnerOfferID="";$("SplashScreen").hide();d.initCallback()}},$cn.methods.GetCacheKey(g,f))},tryLibraryDeepLink:function(e){var d=this;webservices.makeAsyncRequest(application.EndPoints.commerce,"lookupPurchaseDetailsForTitle",{TitleID:e},this,function(f){var g=false;if(f.data&&f.data.result){if(f.data.result.responseCode==0){if(f.data.result.state!=="Not_Owned"){if(!f.data.result.isAvailable){$cn.data.partnerOfferAction=""}application.currentView.currentState=null;application.events.publish("loadtitleview",{id:e,passID:f.data.result.passID,type:"library"});g=true}}else{g=true}}if(!g){log.write("Deep linking Not handled by title lookup. Try store lookup.");d.tryStoreDeepLink(e)}})},handleDeepLinking:function(){var d=$cn.data.partnerOfferID;if($cn.data.AuthToken.length!=0&&$cn.data.AuthTokenActive==true){this.tryLibraryDeepLink(d)}else{this.tryStoreDeepLink(d)}},checkForUpdates:function(){},clone:function(){var d=$extend({},application.currentView);d.ScrollBar=$extend({},application.currentView.ScrollBar);return d},showPlayer:function(h,g,d,f,k,j,e){this.setView("player-view");if(this.PlayerControl==null){this.PlayerControl=new PlayerControl()}this.PlayerControl.load(h,g,d,f,k,j,e);if(j&&j!=""){$("PlayerLogo").addClass("redbuttons")}else{$("PlayerLogo").removeClass("redbuttons")}this.PlayerControl.show()},showTrailer:function(f,e){var d=this;log.write("Showing trailer: "+f+" : "+e);var g=$cn.utilities.showLoadingModal(0,"Loading...");$cn.methods.getBonusAssetLocation(e,function(h){$cn.utilities.clearLoadingSpinner(g);d.showPlayer(f,h.streamID,$cn.utilities.buildPlaybackURL(h.streamingAssetLocation,h.streamID,h.dRMServerURL,h.dRMACKServerURL,h.heartbeatURL,h.heartbeatPollInSeconds,false,h.customData),0,false,"",h.availableClosedCaptions)})},showPlay:function(j,d,f,e,l){var n=this,k=false,m=$cn.data.PassCache[d],h,g;$cn.methods.verifyAuthToken(function(p){if(p){if($cn.utilities.isTrue(m.isPassUV)&&!l){this.UV=new $cn.utilities.UserUVManager("showPlay");this.UV.checkUVAccount(function(r){if(r){n.showPlay(j,d,f,e,true)}},true);return}k=false;if(m&&m.availableProducts){m.availableProducts.each(function(s){var r;if(!k){for(r=0;r<s.availableAssets.length;r++){k=(s.availableAssets[r].file_FileProfile=="HIGH_DEFINITION");if(k){break}}}})}if(m&&m.availableProducts){log.write("If user is in library, check to see if they are trying to play a rental and have not received a license.");if(this.currentState=="titleview"&&!e){log.write("shouldShowRentalWarning: "+this.TitleViewControl.shouldShowRentalWarning());if(this.TitleViewControl.shouldShowRentalWarning()&&f==0){h=application.resource.checkout_messages.Rental_Warning;g={Message:h.Message.replace("##name##",m.name),Content:h.Content.replace("##rentalperiod##",this.TitleViewControl.getRentalPeriod()).replace("##expirationmessage##",m.expirationMessage.replace("Expires","")),Close:"No",OK:"Yes",callback:function(r){if(r){var s=$cn.utilities.getAudioProfileTypesForPurchase(d);if(!$cn.data.PreferredAudioTypeSet&&s.length>0&&!e){n.showAudioOptions(j,d,f)}else{BrowseView.showPlay(j,d,0,true)}}else{}}};BrowseView.showMessage("message_okcancel",g);return}}var q=$cn.utilities.getAudioProfileTypesForPurchase(d);if(!$cn.data.PreferredAudioTypeSet&&q.length>0){n.showAudioOptions(j,d,f,function(){$cn.methods.getStreamingAssetLocation(d,k?"HIGH_DEFINITION ":"STANDARD",function(r){n.showPlayer(j,r.streamID,$cn.utilities.buildPlaybackURL(r.streamingAssetLocation,r.streamID,r.dRMServerURL,r.dRMACKServerURL,r.heartbeatURL,r.heartbeatPollInSeconds,k,r.customData),f,k,d,r.availableClosedCaptions)})})}else{$cn.methods.setAudioDefaultProperty($cn.utilities.currentlyPlayingAudioProfile(d),function(){$cn.methods.getStreamingAssetLocation(d,k?"HIGH_DEFINITION ":"STANDARD",function(r){n.showPlayer(j,r.streamID,$cn.utilities.buildPlaybackURL(r.streamingAssetLocation,r.streamID,r.dRMServerURL,r.dRMACKServerURL,r.heartbeatURL,r.heartbeatPollInSeconds,k,r.customData),f,k,d,r.availableClosedCaptions)})})}}else{if(d&&d!=""&&d!=0){$cn.methods.lookupPurchaseDetailsForTitle(j,function(r){if(!r.isAvailable){application.events.publish("error",{type:"show_play_error",state:r.state,titleID:j});return}var s=$cn.utilities.getAudioProfileTypesForPurchase(d);if(!$cn.data.PreferredAudioTypeSet&&s.length>0){n.showAudioOptions(j,d,f,function(){$cn.methods.getStreamingAssetLocation(d,k?"HIGH_DEFINITION ":"STANDARD",function(u){n.showPlayer(j,u.streamID,$cn.utilities.buildPlaybackURL(u.streamingAssetLocation,u.streamID,u.dRMServerURL,u.dRMACKServerURL,u.heartbeatURL,u.heartbeatPollInSeconds,k,u.customData),f,k,d,u.availableClosedCaptions)})})}else{$cn.methods.setAudioDefaultProperty($cn.utilities.currentlyPlayingAudioProfile(d),function(){$cn.methods.getStreamingAssetLocation(d,k?"HIGH_DEFINITION ":"STANDARD",function(u){n.showPlayer(j,u.streamID,$cn.utilities.buildPlaybackURL(u.streamingAssetLocation,u.streamID,u.dRMServerURL,u.dRMACKServerURL,u.heartbeatURL,u.heartbeatPollInSeconds,k,u.customData),f,k,d,u.availableClosedCaptions)})})}})}}}else{BrowseView.showActivate()}}.bind(this))},showLegalInfo:function(e){var d=this;this.Legal=new LegalPopup("legal");var f=$cn.utilities.showLoadingModal(2000,"Loading...");$cn.methods.getLegalInfo(function(g){$cn.utilities.clearLoadingSpinner(f);d.Legal.loadData([{title:application.resource.legal_title,text:g}]);d.layoutIsDirty=true;d.Legal.firstFocus="LegalOK";d.Legal.show()})},showTerms:function(e){var d=this;this.Legal=new LegalPopup("legal");var f=$cn.utilities.showLoadingModal(2000,"Loading...");$cn.methods.getTermsOfService(function(g){$cn.utilities.clearLoadingSpinner(f);d.Legal.loadData([{title:application.resource.terms_title,text:g}]);d.layoutIsDirty=true;d.Legal.firstFocus="LegalOK";d.Legal.show()})},showPrivacy:function(e){var d=this;this.Legal=new LegalPopup("legal");var f=$cn.utilities.showLoadingModal(2000,"Loading...");$cn.methods.getPrivacyPolicy(function(g){$cn.utilities.clearLoadingSpinner(f);d.Legal.loadData([{title:application.resource.privacy_title,text:g}]);d.layoutIsDirty=true;d.Legal.firstFocus="LegalOK";d.Legal.show()})},showEula:function(h,f,e){this.Legal=new LegalPopup(h);var d=this;var g=$cn.utilities.showLoadingModal(2000,"Loading...");$cn.methods.getEulaText(function(j){$cn.utilities.clearLoadingSpinner(g);d.Legal.loadData([{title:application.resource.eula_title,text:$cn.data.EulaText}]);d.layoutIsDirty=true;d.Legal.firstFocus="LegalOK";d.Legal.show(e);if("eula"===h){d.Legal.cachedCss=$("modalcontainer").getStyles("background","width","height","z-index","position");if(f){$("modalcontainer").setStyles({background:"black"})}}if(f){$("Overlay").setStyle("background-color","black")}$("SplashScreen").hide()})},acceptEula:function(){var d=this;$cn.methods.acceptEula(function(e){d.Legal.hide();if(d.Legal.cachedCss){$("modalcontainer").setStyles(d.Legal.cachedCss);delete d.Legal.cachedCss}d.Legal.hide();$("Overlay").setStyle("background-color","transparent");d.initCallback()})},showChangeEnv:function(){if(this.EnvironmentPopup==null){this.EnvironmentPopup=new EnvironmentPopup()}this.EnvironmentPopup.loadData([{endpoint:"txt"}]);this.EnvironmentPopup.show()},showActivate:function(f){var g,e=this;if(this.ActivatePanel==null){this.ActivatePanel=new ActivatePanel()}if(document.getElementById("skinnykeyboard").style.display=="block"){this.GiftCardKeyboard.hide()}log.write("showing activate panel");this.layoutIsDirty=true;this.hasShownActivate=true;var d=this.hasShownActivate?"Cancel":"Continue Without Activating";g=$cn.utilities.showLoadingModal(2000,"Loading Activation String...");$cn.methods.getActivationString(function(h){$cn.utilities.clearLoadingSpinner(g);e.ActivatePanel.show(f);e.ActivatePanel.loadData([{buttonTxt:d}],h)})},hideActivate:function(){log.write("hiding activate panel");this.layoutIsDirty=true;this.ActivatePanel.hide()},showSpeed:function(){this.showingOtherModal=true;if(this.MessagePopup){this.MessagePopup.hide()}if(this.SpeedPopup==null){this.SpeedPopup=new SpeedPopup()}this.SpeedPopup.firstFocus="SpeedCancel";this.SpeedPopup.loadData([{cancel:"Cancel"}]);log.write("showing speed panel");this.layoutIsDirty=true;this.SpeedPopup.show();this.SpeedPopup.startSpeedCheck()},showSystemStatus:function(){log.write("System status is initiated");if(this.MessagePopup){this.MessagePopup.hide()}if(this.SystemStatusPopup===null){this.SystemStatusPopup=new SystemStatusPopup()}this.SystemStatusPopup.firstFocus="SystemStatusCancel";this.SystemStatusPopup.loadData([{cancel:"",duration:""}]);this.layoutIsDirty=true;this.SystemStatusPopup.show();this.SystemStatusPopup.start()},showSystemDetails:function(){log.write("System status Details Page");messagepath=application.resource.testing_messages.show_details;data={Title:messagepath.Title,InformativeText:$cn.data.SystemTests.informativeText,Cancel:"Close",Path:messagepath.MessageType};this.showMessage(messagepath.MessageType,data)},bwMessage:function(){var d=application.resource.testing_messages.bwMessage.SpeedResult1;if($cn.data.bwTest.speedBytes>0&&$cn.data.bwTest.speedBytes<125000){d=application.resource.testing_messages.bwMessage.SpeedResult1}else{if($cn.data.bwTest.speedBytes>0&&$cn.data.bwTest.speedBytes<1250000){d=application.resource.testing_messages.bwMessage.SpeedResult2}else{if($cn.data.bwTest.speedBytes>0){d=application.resource.testing_messages.bwMessage.SpeedResult3}}}d=d.replace("##speed##",parseInt($cn.data.bwTest.speedBytes*8/10000,10)/100);$$("#SystemStatus .bwMessage .theResult").set("html",d)},showAudioOptions:function(e,f,d,g){if(this.MessagePopup){this.MessagePopup.hide()}if(this.AudioPopup==null){this.AudioPopup=new AudioPopup()}this.layoutIsDirty=true;this.AudioPopup.loadData([{val:"void"}]);this.AudioPopup.show(e,f,d,g)},handleAuthParent:function(d){var e=(d.args&&d.args[0]&&d.args[0].callback)?d.args[0].callback:null;this.showPin(e)},showPin:function(d){if(this.PinPopup==null){this.PinPopup=new PinPopup()}if(pointer.isPointerModeActive()){pointer.lastFocusId="Pin0"}this.PinPopup.firstFocus="Pin0";this.PinPopup.loadData([{cancel:"Cancel"}]);if(d){this.PinPopup.callback=d}log.write("showing pin panel");this.layoutIsDirty=true;this.PinPopup.show()},showCCPopup:function(d){if(this.CCPopup==null){this.CCPopup=new CCPopup()}this.CCPopup.loadData([{cancel:"Cancel"}]);if(d){this.CCPopup.callback=d}log.write("showing CCPopup ");this.layoutIsDirty=true;this.CCPopup.show()},showConfirm:function(j,k,f,e,h,g,d){if(!this.ConfirmPopup){this.ConfirmPopup=new ConfirmPopup()}g.name=j.name;g.titleID=j.titleID;g.season="";g.episode="";if(j.titleType=="TV_Episode"){g.name=$cn.utilities.getMeta("ShowName",j.metaValues);g.season=$cn.utilities.getMeta("SeasonName",j.metaValues)+", "+$cn.utilities.getMeta("EpisodeNumber",j.metaValues);g.episode='"'+j.name+'"'}else{if(j.titleType=="TV_Season"){g.name=$cn.utilities.getMeta("ShowName",j.metaValues);g.season=j.name}}this.CurrentProcessLoaded=true;this.ConfirmPopup.loadData([g]);this.ConfirmPopup.setStatus(k,f,e,h,d)},showRate:function(e){if(!this.RatePopup){this.RatePopup=new RatePopup()}var d;d=BrowseView.TitleViewControl.getUserRatingFloat();$cn.methods.verifyAuthToken(function(f){if(f){this.RatePopup.loadData([{titleID:e,rate:"Rate"}]);this.RatePopup.firstFocus="RateControl";this.layoutIsDirty=true;this.RatePopup.show();this.RatePopup.setRate(d||3)}else{this.showActivate()}}.bind(this))},showHelp:function(){if(this.CurrentProcessLoaded){navigation.setFocusElement(null);application.state.save();log.session.addActivity("help");$("uicontainer").removeClass("redbuttons");$("wheel").hide();$("singlewheel").show();this.GridControl.cleanUI();this.TitleViewControl.cleanUI();this.hideExtras("HelpPanel");if(!this.HelpWheelControl){this.HelpWheelControl=new HelpWheelControl()}this.HelpPanel.show();this.HelpWheelControl.activate();this.HelpWheelControl.loadHelpMenu();navigation.setFocus("singleselectedmaster",true);this.setView("help-view");this.layoutIsDirty=true}},onExit:function(d){if(d.preventDefault){d.preventDefault()}if(!application.regionError){this.showExit()}},onNoChoiceExit:function(e){var d=this;e.preventDefault();if($$("div.giftcard").length>0&&$$("div.giftcard")[0].style.display=="block"){this.hideGiftCard()}d.Legal.hide();BrowseView.showMessage("message_exit",{callback:function(f){log.write("Exit?: "+f);if(f){application.exit()}else{d.showEula("eula")}}})},onReturn:function(d){d.preventDefault();this.showReturn()},onFocus:function(f){var d,e;log.write(f);if(f.args[0].focusedelem=="selectedmaster"||f.args[0].focusedelem=="selectedslave"||f.args[0].focusedelem=="singleselectedmaster"){d="";if(f.args[0].focusedelem=="selectedmaster"){d="masterdatasource"}else{if(f.args[0].focusedelem=="selectedslave"){d="slavedatasource"}else{if(f.args[0].focusedelem=="singleselectedmaster"){d="singlemasterdatasource"}}}e=application.loadAnimation("wheel");$$("#"+d+" div.wheelitem").each(function(g){if(g.getStyle("color")==e.properties.primary.color){g.setStyle("color",e.properties.primary.focus)}})}},onBlur:function(f){var d,e;if(f.args[0].bluredelem=="selectedmaster"||f.args[0].bluredelem=="selectedslave"||f.args[0].bluredelem=="singleselectedmaster"){d="";if(f.args[0].blureditem=="selectedmaster"){d="masterdatasource"}else{if(f.args[0].blureditem=="selectedslave"){d="slavedatasource"}else{if(f.args[0].blureditem=="singleselectedmaster"){d="singlemasterdatasource"}}}e=application.loadAnimation("wheel");$$("#"+d+" div.wheelitem").each(function(g){if(g.getStyle("color")==e.properties.primary.focus){g.setStyle("color",e.properties.primary.color)}})}},showExit:function(){if($$("div.giftcard").length>0&&$$("div.giftcard")[0].style.display=="block"){this.hideGiftCard()}BrowseView.showMessage("message_exit",{callback:function(d){log.write("Exit?: "+d);if(d){if(BrowseView.currentState=="player-view"){BrowseView.PlayerControl.stopPlayer();BrowseView.PlayerControl._saveStatus("stopped",function(){device.exit()})}application.exit()}}})},showReturn:function(){if($$("div.giftcard").length>0&&$$("div.giftcard")[0].style.display=="block"){this.hideGiftCard()}BrowseView.showMessage("message_return",{callback:function(d){log.write("Return to Media Hub?: "+d);if(d){device.sendReturnEvent()}}})},exitStore:function(){if(BrowseView.currentState=="player-view"){BrowseView.PlayerControl.stopPlayer();Player.Shutdown();BrowseView.PlayerControl._saveStatus("stopped",function(){device.exit()});BrowseView.currentState=null}application.exit()},returnStore:function(){if(BrowseView.currentState=="player-view"){BrowseView.PlayerControl.stopPlayer();BrowseView.PlayerControl._saveStatus("stopped",function(){device.sendReturnEvent()});BrowseView.currentState=null}else{device.sendReturnEvent()}application.exit()},showMessage:function(d,f,e){if(document.getElementById("skinnykeyboard")&&document.getElementById("skinnykeyboard").style.display=="block"){this.GiftCardKeyboard.hide()}if(this.MessagePopup){this.MessagePopup.hide()}this.MessagePopup=new MessagePopup(d);this.MessagePopup.loadData(f);this.layoutIsDirty=true;this.MessagePopup.show(e)},loadImagePopup:function(d){if(!this.ImagePopup){this.ImagePopup=new ImagePopup()}this.ImagePopup.loadData(d)},showImages:function(){if(this.ImagePopup){this.ImagePopup.show()}},showSystemMessage:function(){this.showMessage("message_service",{Message:$cn.data.SystemUnavailableMessage,close:"close"})},handleBadAuthToken:function(d){log.write("bad auth token detected. Clear info. Current view: "+this.currentState+", Current element: "+application.element.current);application.clearAuthToken();this.CurrentProcessLoaded=true;this.GiftCardPanel.isProcessing=false;if(this.currentState=="titleview_wheel"&&application.element.current=="checkout_order"){application.isBusy=false;this.orderIsProcessing=false}if(this.currentState=="library-view"){this.goLibrary()}else{if(this.currentState=="wishlist-view"){this.goWishlist()}else{this.showActivate(d.args[0])}}if(this.SettingsPanelControl){this.SettingsPanelControl.isInitialized=false}$("btnAccount").removeClass("locked")},handleGridLoading:function(e){var d=this;this.CurrentProcessLoaded=false;if(application.isLoaded){document.getElementById("gridview").className="grid-loading";document.getElementById("GridOverlay").className="";application.putInnerHTML(document.getElementById("gridloadingprocessstring"),"");application.putInnerHTML(document.getElementById("genericloadingprocessstring"),"");if(e.args[0].cssClass&&e.args[0].cssClass!=""){if(application.resource.processing_strings[e.args[0].cssClass]){$("GridOverlay").addClass("gridspinnertext");application.putInnerHTML(document.getElementById("gridloadingprocessstring"),application.resource.processing_strings[e.args[0].cssClass]);application.putInnerHTML(document.getElementById("genericloadingprocessstring"),application.resource.processing_strings[e.args[0].cssClass])}}$("gridspinnercontainer").setStyle("width",$(e.args[0].grid).offsetWidth+"px");$("gridloadercontainer").show();if(!d.CurrentProcessLoaded){if($("store").hasClass("episode-panel")){$("titlelist").innerHTML="";log.write("spinner cleared!!!!!!!!!!!!")}log.write("calling spinner init");BrowseView.GridController.initSpinner()}}},handleGridLoaded:function(e){var d;$("gridloadercontainer").hide();document.getElementById("gridview").className="";this.CurrentProcessLoaded=true;this.GridController.deinitSpinner();var f=document.getElementById("titlegrid");if(f&&f.style.display!="none"){if((application.element.current!=""&&!document.getElementById(application.element.current))){d=$("titlegrid").getElementsByTagName("a");if(d.length>0){application.navigator.setFocus(d[0].id,true)}}}},showChangeUser:function(){var d;if(this.CurrentProcessLoaded){d=1;if($cn.data.AllowedAudioProfiles&&$cn.data.AllowedAudioProfiles.length>0){d=2}if(application.resource.SettingsWheelOptionStrings.ClosedCaptions!=undefined){d++}this.goSettings(d)}},showTitleDetails:function(e,f){var d=this;this.SearchKeyboard.hide();this.CheckoutPanel.hide();this.HelpPanel.hide();this.TitleLoading=true;this.layoutIsDirty=true;this.expandTitleDetails(function(g){if(!$cn.data.d2dPath){$cn.utilities.clearLoadingSpinner(f)}d.titleViewLoading=false;d.TitleViewControl.show();log.write("... action is: "+e);if(e==="checkout"){d.showCheckOut(d.TitleViewControl.persist.title.titleID,f)}else{if(e==="nextEpisode"||e==="skipFocus"){}else{d.TitleViewControl.setFocus()}}d.TitleLoading=false;$cn.data.LoadTitleID="";application.events.publish("displaytitledetails",{});if($cn.data.partnerOfferID){$("SplashScreen").hide();if($cn.data.partnerOfferAction==="play"){$cn.data.partnerOfferAction="";BrowseView.showPlay(d.TitleViewControl.persist.title.titleID,d.TitleViewControl.persist.title.passID,0)}application.state._history=[];$("dock-back").removeClass("disableBack");application.state.exitOnBack=true;$cn.data.partnerOfferID=""}})},onPanelClose:function(d){if(this.panel!=null){$("store").removeClass(this.panel);switch(this.panel){case"checkout-panel":this.CheckoutPanel.hide();break;case"episode-panel":this.EpisodePanel.hide();break;case"similar-panel":break;case"moreinfo-panel":break}}this.panel=null;this.setView("titleview");this.TitleViewControl.enableButtons()},expandTitleDetails:function(d){$("titledetails").setStyle("overflow","visible");$("WheelSeparator").hide();$("titledetailsmask").setStyle("visibility","hidden");log.write("Device SOC:"+device.getDeviceSoc());BrowseView.onPanelClose();BrowseView.ScrollBar.deactivate();$("wheel").hide();$("singlewheel").hide();BrowseView.hideExtras("hideTitleDetails");BrowseView.layoutIsDirty=true;$("titledetails").setStyles({width:840,left:0});if(d){d.call()}},showTvEpisodes:function(d){$("wheel").hide();if(!this.EpisodePanel){this.EpisodePanel=new EpisodePanelControl()}this.EpisodePanel.show(d)},shrinkTitleDetails:function(d,h){var f,e,g;log.write("Shrinking... panel:"+d);$("titledetails").setStyle("overflow","hidden");f=this;e=$("store");e.addClass("title-panel");e.addClass(d);this.panel=d;$("WheelSeparator").show();$("titledetailsmask").setStyle("visibility","visible");if(!device.getDeviceSoc()=="BCOM"){g=new Fx.Morph($("titledetails"),{duration:300,transition:Fx.Transitions.Sine.easeOut,onComplete:function(j){f.currentState="titleview_wheel";BrowseView.TitleViewControl.disableButtons();log.write("$$$$$$$$$$$$$ "+f.panel+"$$$$$$$$$$$$$$$$");if(d=="checkout-panel"){f.CheckoutPanel.show()}if(h){navigation.setFocus(h,true)}}});g.start({width:250,left:0})}else{f.currentState="titleview_wheel";BrowseView.TitleViewControl.disableButtons();log.write("$$$$$$$$$$$$$ "+f.panel+"$$$$$$$$$$$$$$$$");$("titledetails").setStyles({width:250,left:0});if(d=="checkout-panel"){f.CheckoutPanel.show()}if(h){navigation.setFocus(h,true)}}},hideTitleDetails:function(){var d;this.CheckoutPanel.hide();$("WheelSeparator").hide();if(!device.getDeviceSoc()=="BCOM"){d=new Fx.Morph($("titledetails"),{duration:300,transition:Fx.Transitions.Sine.easeOut,onComplete:function(f){$("titledetails").hide();application.currentView.layoutIsDirty=true}});d.start({width:0,left:0})}else{$("titledetails").setStyles({width:0,left:0})}$("store").removeClass("title-panel");$("store").removeClass("episode-panel")},hideTitleDetailsMask:function(){log.write("hideTitleDetailsMask! panel:"+this.panel);var d=this.panel;BrowseView.expandTitleDetails();BrowseView.TitleViewControl.enableButtons();if(d!=null){if(d=="checkout-panel"){pointer.lastFocusId="tdbuttonCheckout"}if(d=="moreinfo-panel"){pointer.lastFocusId="tdbuttonMoreInfo"}if(d=="similar-panel"){pointer.lastFocusId="tdbuttonSimilar"}}},handleLoadRecommendation:function(d){log.write("$$$$$$$$$$$$$$$$$$$$$$$$ SHOW WHEEL $$$$$$$$$$$$$$$$$$$$$$$$");$("wheel").show()},showSimilar:function(e){log.write("Similar-ing...");var f=$cn.utilities.showLoadingModal(1000,"Loading Similar Titles...");$("wheel").show();$("singlewheel").hide();$("titlegrid_container").removeClass("header");this.GridControl.cleanUI();this.CheckoutPanel.hide();this.HelpPanel.hide();this.currentTitle=$cn.data.TitleDetailCache[e];if(!this.RecomendationWheelControl){this.RecomendationWheelControl=new RecomendationWheelControl()}var d=this;this.RecomendationWheelControl.loadData(e,function(h,g){$cn.utilities.clearLoadingSpinner(f);if(h==0){d.shrinkTitleDetails("similar-panel","selectedmaster")}else{messagepath=application.resource.store_messages.Similar_Titles_Not_Found;data={Message:messagepath.Message,Content:messagepath.Content,Footer:messagepath.Footer,Close:messagepath.Cancel,callback:function(j){log.write("Similar: Call to load Similar pane data load failed; responseCode is "+h+"; responseMessage is "+g)}};if(data.Footer){data.Footer=data.Footer.replace("{responseCode}",h);data.Footer=data.Footer.replace("{m}",this.resolveMethodCode("getGenesByWheelOptionPlural"))}BrowseView.showMessage(messagepath.MessageType,data)}})},showMoreInfo:function(){log.write("More Info-ing...");this.CheckoutPanel.hide();this.HelpPanel.hide();$("singlewheel").hide();$("wheel").show();if(!this.TitleMetaWheelControl){this.TitleMetaWheelControl=new TitleMetaWheelControl()}this.GridController.initSpinner();this.TitleMetaWheelControl.activate();this.TitleMetaWheelControl.loadData(this.moreInfoItems,this.currentTitle);this.shrinkTitleDetails("moreinfo-panel","selectedmaster")},showCheckOut:function(d,e){log.write("Checkout...");this.LastGridProcess="";if($cn.data.d2dPath){application.state.purge()}$("wheel").hide();$("singlewheel").show();this.SearchKeyboard.hide();this.HelpPanel.hide();$("titlegrid").hide();this.GridController.hideAll();this.ScrollBar.hide();if(!this.TitleCheckOutWheelControl){this.TitleCheckOutWheelControl=new TitleCheckOutWheelControl()}$cn.utilities.clearLoadingSpinner(e);this.TitleCheckOutWheelControl.activate();this.TitleCheckOutWheelControl.loadCheckOutData(d);this.CheckoutPanel.show();this.shrinkTitleDetails("checkout-panel");application.currentView.layoutIsDirty=true},goCheckOut:function(n,h,e,f,l){var m=this,g,k,j,d;application.TempKeyBlock=true;log.write("Keys blocked during checkout");application.TempKeyBlockDuration=90000;log.write("================= goCheckOut =======================");log.write("uniquePurchaseId is: "+m.uniquePurchaseId);if(this.orderIsProcessing){return}log.write("titleid is: "+n);log.write("skuid is: "+h);if(!m.uniquePurchaseId){$cn.data.LastBandwidthCheck=false;m.uniquePurchaseId=$cn.utilities.uniqueIdentifier()}if(application.authSupported){if($cn.data.AuthToken==""){this.showActivate()}else{if($cn.data.PurchasePinEnabled&&!f){application.TempKeyBlock=false;application.TempKeyBlockDuration=1000;this.showPin(function(){m.goCheckOut(n,h,e,true)});return}this.currentTitle=$cn.data.TitleDetailCache[n];g=$cn.utilities.isHdTitle(this.currentTitle,h);k=$cn.utilities.isSurroundSoundTitle(this.currentTitle,h);if(!l){l=$cn.utilities.bandwidthCheckValid(g)}this.CurrentProcessLoaded=false;this.orderIsProcessing=true;if(!l){log.write("doCheckout: performing bandwidth check");this.HelpPanel.hide();this.hideExtras(["CheckoutPanel","hideTitleDetails"]);this.showMessage("message_loading",{Message:application.resource.loading_enum.orderprocessing});BandwidthCheck.purchaseBandwidthCheck(n,h,e,g,PlaybackBandwidthTest);return}else{this.HelpPanel.hide();this.hideExtras(["CheckoutPanel","hideTitleDetails"]);this.showMessage("message_loading",{Message:application.resource.loading_enum.orderprocessing});$cn.methods.getTermsOfServiceAcceptance(function(p){log.write("++++++++++ tos acceptance is: "+p);if(!p){log.write("++++ not accepted ++++++");BrowseView.showMessage("message_okcancel",{Message:application.resource.terms_title,Content:application.resource.terms_changed,OK:"Try Again",Close:"Cancel",callback:function(q){if(q){m.errorCleanup();m.goCheckOut(n,h,e)}else{m.errorCleanup()}}})}else{$cn.methods.doPurchase(h,n,e,function(A){var w,v,u,r,s,q;if(!A){application.TempKeyBlock=false;w=application.resource.checkout_messages.system_error;v={Message:w.Message,Content:w.Content,Footer:w.Footer.replace("{m}",this.resolveMethodCode("doPurchase")),OK:w.OK,Close:w.Cancel,Path:w.MessageType,callback:function(B){if(B){BrowseView.goCheckOut(n,h,e)}}.bind(this)};m.errorCleanup();m.showMessage(w.MessageType,v)}else{if(A.responseCode!=0){application.TempKeyBlock=false;if(A.responseCode>=120&&A.responseCode<=400){w=application.resource.checkout_messages.uv_error;w.Message=A.responseMessage}else{w=application.resource.checkout_messages[A.responseMessage.replace(/ /g,"_")]}if(!w){w=application.resource.checkout_messages.system_error}log.write("Error message Path: "+w);u=(w.MessageType)?w.MessageType:"message_okcancel";if(!w.OK){u="message_content"}v={Message:w.Message,Content:w.Content,Footer:w.Footer.replace("{m}",this.resolveMethodCode("doPurchase")),OK:w.OK,Close:w.Cancel,Path:w,callback:function(B){if(B){BrowseView.goCheckOut(n,h,e)}}.bind(this)};m.errorCleanup();m.showMessage(u,v)}else{application.TempKeyBlock=false;application.TempKeyBlockDuration=1000;if(BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}navigation.setFocusElement(null);application.events.publish("purchasecomplete",{skuid:h});application.state._viewstate["library-view"]=null;r="play";s="";q=$cn.utilities.getPurchaseSkuProduct(this.currentTitle,h);if(q.purchaseType=="rent"){s="rent"+q.rentalPeriod}else{s=q.purchaseType+this.currentTitle.titleType}m.showConfirm(m.currentTitle,q.purchaseType,s,r,g,A,k)}}application.TempKeyBlock=false;application.TempKeyBlockDuration=1000;m.orderIsProcessing=false;m.uniquePurchaseId=false}.bind(m))}})}}}else{application.TempKeyBlock=false;application.TempKeyBlockDuration=1000;navigation.setFocusElement(null);this.currentTitle=$cn.data.TitleDetailCache[n];g=$cn.utilities.isHdTitle(this.currentTitle,h);k=$cn.utilities.isSurroundSoundTitle(this.currentTitle,h);j=$cn.utilities.getPurchaseSkuProduct(this.currentTitle,h);this.showConfirm(this.currentTitle,j.purchaseType,j.purchaseType+this.currentTitle.titleType,"play",g,function(){},k)}},errorCleanup:function(){application.TempKeyBlock=false;application.TempKeyBlockDuration=1000;this.CurrentProcessLoaded=true;this.orderIsProcessing=false;this.uniquePurchaseId=false},showMerch:function(){this.setView("merch-view");this.MerchControl.show()},goGiftCard:function(d,f){var e=this;$cn.methods.verifyAuthToken(function(g){if(g){if(e.MessagePopup){e.MessagePopup=null}e.GiftCardPanel.show(d,f);navigation.setFocus("SkinnyFirstKey",true)}else{BrowseView.showActivate()}}.bind(this))},hideGiftCard:function(){this.GiftCardKeyboard.hide();this.GiftCardPanel.hide()},goHome:function(d){if(this.CurrentProcessLoaded||!application.isLoaded){var e=this.currentState;log.write("store.goHome: Navigating to home page - dontsave = "+d);log.session.addActivity("store");if(this.currentState!=null&&!d){navigation.setFocusElement(null);application.state.save()}if(!this.loadSavedState("browse-view")){$("uicontainer").removeClass("redbuttons");this.hideExtras("BrowseView");$("titlegrid").show();$("wheel").show();$("singlewheel").hide();this.GridControl.currentId=0;this.WheelControl.activate();this.WheelControl.loadData($cn.data.masterWheel,$cn.data.slaveWheel)}if(e!=null&&!d){$("dock-back").removeClass("disableBack")}navigation.setFocus("selectedmaster",true);this.setView("browse-view");this.layoutIsDirty=true}},goSearch:function(){if(this.CurrentProcessLoaded){navigation.setFocusElement(null);application.state.save();log.session.addActivity("search");$("uicontainer").removeClass("redbuttons");this.layoutIsDirty=true;this.hideExtras();$("wheel").hide();this.SearchKeyboard.show();this.CheckoutPanel.cleanUI();this.TitleViewControl.cleanUI();this.GridControl.cleanUI();this.setView("search-view");if(!this.SearchWheelControl){this.SearchWheelControl=new SearchWheelControl()}this.SearchWheelControl.activate();this.SearchWheelControl.loadSearchMenu();navigation.setFocus("FirstKey",true)}},addToWishList:function(d){if($cn.data.AuthToken==""){this.showActivate({callback:function(){this.addToWishList(d)}.bind(this)})}else{$cn.methods.addItemToWishList(d,function(e){if(e&&(e.responseCode==0||e.responseCode!=0)){application.events.publish("wishlistinsert",d)}})}},goWishlist:function(){if(this.CurrentProcessLoaded){this._goWishlist()}},_goWishlist:function(){var e=$cn.utilities.DateDiff(new Date(),this.WishListLastLoaded),d=this,f;if(e<this.viewLoadingTimeout){return}this.WishListLastLoaded=new Date();navigation.setFocusElement(null);application.state.save();log.session.addActivity("wish_list");f=$cn.utilities.showLoadingModal(2000,application.resource.loading_enum.loadingwishlist);$cn.methods.verifyAuthToken(function(g){$cn.utilities.clearLoadingSpinner(f);if(!g){application.clearAuthToken();application.state._viewstate["wishlist-view"]=null}if(!this.loadSavedState("wishlist-view")){$("titledetails").hide();$("WheelSeparator").hide();$("uicontainer").removeClass("redbuttons");this.hideExtras();$("wheel").hide();$("singlewheel").hide();this.GridControl.cleanUI();if(!this.WishList){this.WishList=new WishList()}this.WishList.show()}this.setView("wishlist-view");this.layoutIsDirty=true;if(BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}}.bind(this))},goLibrary:function(e,d){if(this.CurrentProcessLoaded){this._goLibrary(e,d)}},_goLibrary:function(f,e){var d=this;navigation.setFocusElement(null);application.state.save();if(f){f()}log.session.addActivity("library");$cn.utilities.showSharedLoadingModal(2000,application.resource.loading_enum.library);$cn.methods.verifyAuthToken(function(g){if(!g){$cn.utilities.clearSharedLoadingSpinner();application.clearAuthToken();application.state._viewstate["library-view"]=null}if(!this.loadSavedState("library-view")){this.hideExtras();$("wheel").hide();$("singlewheel").hide();$("titlegrid").hide();$("scrollbar").hide();$("titledetails").hide();$("WheelSeparator").hide();this.hideExtras();if(!this.Library){this.Library=new Library()}this.Library.show()}this.setView("library-view");if(e){e()}}.bind(this))},setLibrary:function(d){$("uicontainer").addClass("redbuttons");if(!d){this.setView("library-view")}},goSettings:function(d){if(this.CurrentProcessLoaded){navigation.setFocusElement(null);application.state.save();log.session.addActivity("settings");log.write("showing settings");$("uicontainer").removeClass("redbuttons");this.layoutIsDirty=true;this.TitleViewControl.cleanUI();this.hideExtras("SettingsPanel");$("wheel").show();$("singlewheel").hide();this.GridControl.cleanUI();if(!this.SettingsWheelControl){this.SettingsWheelControl=new SettingsWheelControl()}this.SettingsWheelControl.activate();this.SettingsWheelControl.loadSettingsMenu(d);this.SettingsPanel.show();if(d&&d!=0){navigation.setFocus("btnsettingsparental",true)}else{navigation.setFocus("selectedmaster",true)}this.setView("settings-view")}},render:function(){},handleGoBack:function(f){var d=this,e;if(this.CurrentProcessLoaded){if(this.TitleLoading){f.preventDefault();return}BrowseView.CurrentProcessLoaded=true;switch(this.currentState){case"titleview_wheel":f.preventDefault();if(document.getElementById("imagepopup").style.display=="block"){this.ImagePopup.hide()}else{this.expandTitleDetails(function(g){$("titledetails").show();d.layoutIsDirty=true;if(ActiveWheel.id=="TitleMetaWheelControl"){application.navigator.setFocus("tdbuttonMoreInfo",true)}else{if(ActiveWheel.id=="RecomendationWheelControl"){application.navigator.setFocus("tdbuttonSimilar",true)}else{if(ActiveWheel.id=="TvSeasonsWheelControl"){application.navigator.setFocus("tdbuttonEpisodes",true)}else{log.write("Tracer to see if the goback method is moving focus from the error popup.");e=document.getElementById("ButtonPanel").getElementsByTagName("a");if(e.length>0){application.navigator.setFocus(e[0].id,true)}else{application.navigator.setFocus("dock-home",true)}}}}})}break;case"wishlist-view":if(this.TitleViewControl.persist.title){if(application.state._history.length>1&&application.state._history[application.state._history.length-1].currentState=="titleview"){this.TitleViewControl.update({forceUpdate:true})}}break}}else{f.preventDefault()}},hideExtras:function(d){if(!d||(d&&d.indexOf("SearchKeyboard")==-1)){this.SearchKeyboard.hide()}if(!d||(d&&d.indexOf("CheckoutPanel")==-1)){this.CheckoutPanel.hide()}if(!d||(d&&d.indexOf("SettingsPanel")==-1)){this.SettingsPanel.hide()}if(!d||(d&&d.indexOf("hideTitleDetails")==-1)){this.hideTitleDetails()}if(!d||(d&&d.indexOf("GiftCardKeyboard")==-1)){this.GiftCardKeyboard.hide()}if(!d||(d&&d.indexOf("GridController")==-1)){this.GridController.hideAll()}if(!d||(d&&d.indexOf("ScrollBar")==-1)){this.ScrollBar.hide()}if(!d||(d&&d.indexOf("HelpPanel")==-1)){this.HelpPanel.hide()}if(this.Library){if(!d||(d&&d.indexOf("Library")==-1)){this.Library.hide()}}if(!d||(d&&d.indexOf("BrowseView")!==-1)){$("titledetails").hide();$("WheelSeparator").hide()}$("messagepanel").hide();$("titlegrid_container").removeClass("header")},showLogo:function(){$("logo").show()},hideLogo:function(){$("logo").hide()},loadTitle:function(f,e,g){var d;log.write(f.wheelItems);this.similarItems=[];this.moreInfoItems=[];for(d=0;d<f.wheelItems.length;d++){if(f.wheelItems[d].indexOf("s_")==0||f.wheelItems[d].indexOf("m_cast_crew")>-1){this.similarItems.push(f.wheelItems[d])}else{this.moreInfoItems.push(f.wheelItems[d])}}if(f.titleType=="TV_Episode"){$cn.methods.getBundleListing(f.showTitleID,function(h){f.show=h.name;f.seasonal=f.seasonTitleID!=0;if(f.seasonTitleID){$cn.methods.getBundleListing(f.seasonTitleID,function(k){if(k.bundleItems.length==0){BrowseView.TitleViewControl.noBundleError=true;log.write("$$$$$ ERROR - Empty bundle listing $$$$$")}for(var j=0;j<k.bundleItems.length;++j){if(k.bundleItems[j].titleID==f.titleID){f.season=k.name+", Episode "+k.bundleItems[j].itemNumber;if(k.bundleItems.length>j+1){f.nextEpisodeID=k.bundleItems[j+1].titleID}break}}this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}.bind(this));return}else{for(d=0;d<h.bundleItems.length;++d){if(h.bundleItems[d].titleID==f.titleID){f.season="Episode "+h.bundleItems[d].itemNumber;break}}this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}}.bind(this))}else{if(f.titleType=="TV_Season"){$cn.methods.getBundleListing(f.showTitleID,function(h){f.show=$cn.utilities.getMeta("ShowName",f.metaValues);f.season=f.name;f.seasonal=true;this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}.bind(this))}else{if(f.titleType=="TV_Show"){f.show=f.name;$cn.methods.getBundleListing(f.showTitleID,function(h){if(h.bundleItems.length==1){$cn.methods.getBundleListing(h.bundleItems[0].titleID,function(j){f.seasonal=j.bundleItems.length>0;this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}.bind(this))}else{f.seasonal=true;this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}}.bind(this))}else{this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}}}},loadSavedState:function(e){var d;if(this.currentState!=e){d=this.currentState;if(application.state.loadState(e)){this.currentState=d;return true}}return false},reset:function(d){log.write("Resetting view state - current state: "+this.currentState);application.reset();if(d==null){d=this.currentState}switch(d){case"search-view":this.currentState=null;BrowseView.goSearch();break;case"wishlist-view":this.currentState=null;BrowseView.goWishlist();break;case"library-view":this.currentState=null;BrowseView.goLibrary();break;case"browse-view":case"titleview":case"titleview_wheel":this.currentState=null;BrowseView.goHome();break}},setView:function(d){var e;if(d!=this.currentState){this.layoutIsDirty=true;e=$("store");e.removeClass(this.currentState);e.addClass(d);this.currentState=d;application.events.publish("viewchanged",d);log.write("Current view: "+d)}},onSaveState:function(e){var d=e.args[0];d[this.id]={currentState:this.currentState,panel:this.panel}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id]);log.write("Current State: "+this.currentState);if((!application.element.current||application.element.current!="")||(application.element.current&&application.element.current!=""&&!document.getElementById(application.element.current))){switch(this.currentState){case"merch-view":if(!application.element.current||(application.element.current&&application.element.current=="")){navigation.setFocus("f_button",true)}break;case"browse-view":if(!application.element.current||(application.element.current&&application.element.current=="")){navigation.setFocus("selectedmaster",true)}break;case"search-view":if(!application.element.current||(application.element.current&&application.element.current=="")){navigation.setFocus("FirstKey",true)}break;case"wishlist-view":break;case"library-view":if(!application.element.current||(application.element.current&&application.element.current=="")){this.Library.setFocus()}$cn.utilities.clearSharedLoadingSpinner();break;case"settings-view":navigation.setFocus("selectedmaster",true);break;case"titleview":this.TitleViewControl.setFocus();break;case"help-view":navigation.setFocus("singleselectedmaster",true);break}}},onBlockedKey:function(d){d.preventDefault()},resolveMethodCode:function(e){var d=" - 0.1";switch(e){case"getNavigation":d=" - 1.1";break;case"getMerchandize":d=" - 1.2";break;case"getBrowseList":d=" - 1.3";break;case"getBrowseListByCast":d=" - 1.4";break;case"getBrowseListByCastRole":d=" - 1.5";break;case"getBrowseListByGene":d=" - 1.6";break;case"getBrowseListByGeneWithSimilarBy":d=" - 1.7";break;case"getGenesByWheelOptionPlural":d=" - 1.8";break;case"getBundleListing":d=" - 1.10";break;case"getBundleListingPurchased":d=" - 1.11";break;case"getShortSummary":d=" - 1.12";break;case"getFullSummary":d=" - 1.13";break;case"getGenesByWheelOption":d=" - 1.14";break;case"getCastAndCrew":d=" - 1.15";break;case"getCastBio":d=" - 1.16";break;case"getCastBios":d=" - 1.17";break;case"getCredits":d=" - 1.18";break;case"getImages":d=" - 1.19";break;case"getTechnicalDetails":d=" - 1.20";break;case"getReviews":d=" - 1.21";break;case"rateTitle":d=" - 1.22";break;case"getBrowseListBySimilar":d=" - 1.92";break;case"getShortSummaryPlural":d=" - 1.96";break;case"searchTitle":d=" - 2.24";break;case"searchPerson":d=" - 2.25";break;case"getWishlist":d=" - 2.26";break;case"checkUserWishListForItems":d=" - 2.27";break;case"addItemToWishList":d=" - 2.28";break;case"removeAllItemsFromWishList":d=" - 2.29";break;case"removeItemFromWishList":d=" - 2.30";break;case"getWishlistExt":d=" - 2.124";break;case"doPurchase":d=" - 3.32";break;case"checkIfTitleInLibrary":d=" - 3.33";break;case"lookupPurchaseDetailsForTitle":d=" - 3.34";break;case"getBillingInfo":d=" - 3.35";break;case"verifyCode":d=" - 3.36";break;case"applyGiftCode":d=" - 3.37";break;case"calcOrderTax":d=" - 3.103";break;case"pollForToken":d=" - 4.39";break;case"verifyAuthToken":d=" - 4.40";break;case"loadToken":d=" - 4.41";break;case"getActivationString":d=" - 4.42";break;case"checkParentPin":d=" - 4.43";break;case"toggleParentPin":d=" - 4.44";break;case"togglePurchasePin":d=" - 4.45";break;case"getLinkingAccount":d=" - 4.132";break;case"getLegalInfo":d=" - 5.46";break;case"getEulaText":d=" - 5.47";break;case"acceptEula":d=" - 5.48";break;case"setupDevice":d=" - 5.49";break;case"recordSessionData":d=" - 5.50";break;case"recordSessionConnectionSpeedTest":d=" - 5.51";break;case"defineErrorCode":d=" - 5.52";break;case"CheckHeaderValues":d=" - 5.53";break;case"getAudioDefaultProperty":d=" - 5.54";break;case"setAudioDefaultProperty":d=" - 5.55";break;case"getTermsOfService":d=" - 5.114";break;case"getPrivacyPolicy":d=" - 5.115";break;case"getTermsOfServiceAcceptance":d=" - 5.126";break;case"getPurchasedTitle":d=" - 6.56";break;case"getUserLibrary":d=" - 6.57";break;case"getGenres":d=" - 6.58";break;case"getAvailGenresAndLibSlaveWheelOptions":d=" - 6.59";break;case"getAvailLibSlaveWheelOptionByMasterWheel":d=" - 6.60";break;case"getAvailMasterWheelOptions":d=" - 6.61";break;case"getUserLibraryCounts":d=" - 6.62";break;case"getUserLibraryExt":d=" - 6.128";break;case"getBonusAssetLocation":d=" - 7.63";break;case"getStreamingAssetLocation":d=" - 7.64";break;case"sendStopMessageForStream":d=" - 7.65";break;case"loadLastStreamingAssetLocationForPass":d=" - 7.66";break;case"updateResumeTimeForPass":d=" - 7.123";break;default:break}return d},onHandleError:function(r){var v=this,k=null,h=null,j={},d="0.1",m=this,g,u,q,w,p,s,f,l;v.titleViewLoading=false;try{log.write("Error Method: "+r.args[0].method+", Error type: "+r.args[0].type+", Error status: "+r.args[0].status);d=r.args[0].method;if(!application.ui.wasInitialized){r.preventDefault();log.write("============ pre ui init error caught =============");application.ui.init(function(){application.loadView(BrowseView);$("wheel").hide();$("dock").hide();$("logo").hide();$("SplashScreen").hide();r.restartApp=true;v.onHandleError(r)},true);return}else{$("SplashScreen").hide()}}catch(n){}try{if(d=="recordSessionData"){log.write("Error saving session data. Ignore and continue as usual.");return}if(typeof r.preventDefault=="function"){r.preventDefault()}if(d!="doPurchase"){log.write('payload.args[0].type === "system_error":'+(r.args[0].type==="system_error"));log.write("payload.args[0].status == 500:"+(r.args[0].status==500));if($("ActivatePanel")&&$("ModalWindow")){$("ActivatePanel").hide();$("ModalWindow").show()}if(d==="getActivationString"&&r.args[0].status==500){k=application.resource.system_messages["spoof_check_error"];$("modalcontrol").addClass("show5");$("ModalWindow").setAttribute("style","");u=(application.resource.modalConfig.activate_show5);for(g in u){$("ModalWindow").setStyle(g,u[g])}log.write("Modal Class for error: "+$("modalcontrol").className);$("modalcontrol").removeClass("activate")}else{k=application.exception.resolveMessagePath(this.currentState)[r.args[0].type]}h=(k&&k.MessageType)?k.MessageType:"message_okcancel";if(k.Footer){k.Footer=k.Footer.replace("{m}",this.resolveMethodCode(d))}}}catch(n){log.write("Something very bad happened. Unrecoverable. Message path for current state "+this.currentState+" and type "+r.args[0].type+" could not be found.");j={Message:"Unable to contact the server.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550 {m}</span>',OK:"Close",callback:function(e){if(!e){if(BrowseView.currentState=="player-view"){log.write("stopping player, and backing out to tile view");application.events.publish("back")}}}};if(j.Footer){j.Footer=j.Footer.replace("{m}",this.resolveMethodCode(d))}this.showMessage("message_error_default",j);return}if($("gridloadercontainer")){$("gridloadercontainer").hide()}this.errorCleanup();if(this.GridController){this.GridController.deinitSpinner()}if(r.restartApp){s=function(){$("SplashScreen").show();$("SplashProgress").hide();window.location.reload(false)};h="message_restart";j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:s};if(j.Footer){j.Footer=j.Footer.replace("{m}",this.resolveMethodCode(d))}this.showMessage(h,j);return}switch(r.args[0].type){case"while_purchase_bw_internet_out":k=application.resource.checkout_messages.purchase_error;h="message_error_purchase";q=r.args[0].params;w=q.titleid;p=$cn.data.TitleDetailCache[w];j={Message:k.Message.replace("##title##",p.name),Content:k.Content,OK:k.OK,Close:k.Cancel,Path:k,Footer:k.Footer.replace("{m}",v.resolveMethodCode(d)),callback:function(e){if(e){log.write("Going to Library.");$("WheelSeparator").hide();$("titledetailsmask").setStyle("visibility","hidden");BrowseView.goLibrary()}}};v.errorCleanup();v.showMessage(h,j);break;case"no_internet":case"timeout_error":case"socket_error":if(d=="sendStopMessageForStream"){r.args[0].callback.call(r.args[0].cb_context,{data:{result:" "}});return}log.write("ERROR: no_internet, timeout_error, or socket_error occurred: "+r.args[0].type);log.write("TEST INTERNET CONNECTION");application.testConnection(function(e){log.write("INTERNET CONNECTION RESULT ("+e.result+")");log.write("TimeoutMethod: "+d);log.write("the hail mary is set to: "+m.orderHailMary);if(d!="doPurchase"){log.write("store.handleError Debug: Not Purchase Method");if(!e.result){if(m.orderHailMary){webservices.killCurrentRequest();log.write("Mary hailed");k=application.resource.checkout_messages.purchase_error;m.orderHailMary=false;m.orderIsProcessing=false}else{if(m.orderIsProcessing){k=application.resource.checkout_messages.purchase_error;m.orderHailMary=false;m.orderIsProcessing=false}else{k=application.exception.resolveMessagePath(v.currentState)[r.args[0].type];log.write("store.handleError Debug: Default processing  of type "+r.args[0].type+" for no hail mary and no order, setting basic error message to "+k);$cn.utilities.clearLoadingSpinner()}}if(m.orderHailMary){h=(k.MessageType)?k.MessageType:"message_error_purchase"}else{h=(k.MessageType)?k.MessageType:"message_okcancel"}application.isConnected=false}if(m.orderHailMary){w=r.args[0].params.TitleID;p=$cn.data.TitleDetailCache[w];j={Message:k.Message.replace("##title##",p.name),Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(A){if(A){log.write("Going to Library.");$("WheelSeparator").hide();$("titledetailsmask").setStyle("visibility","hidden");BrowseView.goLibrary()}}}}else{if(d==="getActivationString"){j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(A){if(A){BrowseView.showActivate()}}}}else{j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(A){if(A){v.showMessage("message_loading",{Message:""});log.write("store.onHandleError Debug: Trying to call previous method...");webservices.makeAsyncRequest(r.args[0].endPoint,r.args[0].method,r.args[0].params,r.args[0].cb_context,function(B){if(v.MessagePopup){v.MessagePopup.hide()}log.write("store.onHandleError Debug: Internal response callback - invoking payload callback");r.args[0].callback.call(r.args[0].cb_context,B)},true,false)}}}}}log.write("=== restart app is: "+r.restartApp);log.write("=== data callaback is: "+j.callback);if(j.Footer){j.Footer=j.Footer.replace("{m}",v.resolveMethodCode(d))}v.showMessage(h,j)}else{log.write("Purchase Method. Now wait for an additional 30 seconds to see if the transaction completes.");setTimeout(function(){log.write("We now have waited an additional 30 seconds, try to see if we now have access to the movie.");log.write(log.dumpObj(r.args[0].params));m.orderHailMary=true;$cn.methods.lookupPurchaseDetailsForTitle(r.args[0].params.TitleID,function(A){var F,C,D,E,B;log.write(log.dumpObj(A));if(A.passID>0){log.write("PassID valid go to library.");r.args[0].params.passID=A.passID;r.args[0].params.titleID=r.args[0].params.TitleID;F=$cn.utilities.isHdTitle(v.currentTitle,r.args[0].params.SKUID);C=$cn.utilities.isSurroundSoundTitle(v.currentTitle,r.args[0].params.SKUID);if(BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}application.events.publish("purchasecomplete",{skuid:r.args[0].params.SKUID});application.state._viewstate["library-view"]=null;D="play";E="";B=$cn.utilities.getPurchaseSkuProduct(v.currentTitle,r.args[0].params.SKUID);if(B.purchaseType=="rent"){E="rent"+B.rentalPeriod}else{E=B.purchaseType+v.currentTitle.titleType}v.showConfirm(v.currentTitle,B.purchaseType,E,D,F,A,C);v.orderIsProcessing=false}else{log.write("PassID not valid throw purchase error.");k=application.resource.checkout_messages.purchase_error;h="message_error_purchase";q=r.args[0].params;w=q.titleid;p=$cn.data.TitleDetailCache[w];j={Message:k.Message.replace("##title##",p.name),Content:k.Content,OK:k.OK,Close:k.Cancel,Path:k,Footer:k.Footer.replace("{m}",v.resolveMethodCode(d)),callback:function(G){if(G){log.write("Going to Library.");$("WheelSeparator").hide();$("titledetailsmask").setStyle("visibility","hidden");BrowseView.goLibrary()}}.bind(this)};v.errorCleanup();v.showMessage(h,j)}})}.bind(this),(application.appSetting("WSRequestTry2Timeout")*1000))}});break;case"system_error":if(d=="doPurchase"){k=application.resource.checkout_messages.purchase_error;h="message_error_purchase";p=$cn.data.TitleDetailCache[r.args[0].params.TitleID];k.Message=k.Message.replace("##title##",p.name)}j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(e){if(e){v.showMessage("message_loading",{Message:""});log.write("Trying to call previous method...");webservices.makeAsyncRequest(r.args[0].endPoint,r.args[0].method,r.args[0].params,this,function(A){log.write("Response...");v.MessagePopup.hide();r.args[0].callback.call(r.args[0].cb_context,A)},true,false)}}};if(j.Footer){j.Footer=j.Footer.replace("{m}",this.resolveMethodCode(d))}this.showMessage(h,j);break;case"country_invalid":break;case"OnNetworkDisconnected":case"OnConnectionFailed":case"OnWideVineError_514":case"OnWideVineError_2004":j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(e){log.write("Error (Recoverable)..."+e);if(e){application.testConnection(function(A){log.write("INTERNET CONNECTION RESULT ("+A.result+")");if(A.result){var C=$cn.utilities.showLoadingModal(0,"Loading...");var B=setInterval(function(){this.tryAgainToPlayCount++;if(this.tryAgainToPlayCount>15){clearInterval(B);this.tryAgainToPlayCount=0;$cn.utilities.clearLoadingSpinner(C);application.events.publish("error",{type:"OnNetworkDisconnected",titleID:r.args[0].titleID,streamID:r.args[0].streamID,url:r.args[0].url,startTimeSeconds:r.args[0].startTimeSeconds,isHd:r.args[0].isHd,passID:r.args[0].passID})}else{if(!Player.initialized){clearInterval(B);this.tryAgainToPlayCount=0;$cn.utilities.clearLoadingSpinner(C);application.navigator.setFocus(BrowseView.PlayerControl.lastFocus,true);BrowseView.showPlayer(r.args[0].titleID,r.args[0].streamID,r.args[0].url,r.args[0].startTimeSeconds,r.args[0].isHd,r.args[0].passID)}}}.bind(this),2000)}else{application.events.publish("error",{type:"OnNetworkDisconnected",titleID:r.args[0].titleID,streamID:r.args[0].streamID,url:r.args[0].url,startTimeSeconds:r.args[0].startTimeSeconds,isHd:r.args[0].isHd,passID:r.args[0].passID})}})}else{application.events.publish("back")}}};this.showMessage(h,j);break;case"OnAuthenticationFailed":j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(e){log.write("Error (Recoverable)..."+e);if(e){application.navigator.setFocus(BrowseView.PlayerControl.lastFocus,true);BrowseView.showPlayer(r.args[0].titleID,r.args[0].streamID,r.args[0].url,r.args[0].startTimeSeconds,r.args[0].isHd,r.args[0].passID,r.args[0].availableClosedCaptions)}else{BrowseView.PlayerControl.hasError=false;BrowseView.PlayerControl._handleReturnKey()}}};this.showMessage(h,j);break;case"OnStreamNotFound":case"OnStreamNotFound_trailer":case"OnRenderError":case"OnWideVineError_513":case"OnWideVineError_515":case"OnWideVineError_516":case"OnWideVineError_517":case"OnWideVineError_520":case"OnWideVineError_521":case"OnWideVineError_522":case"OnWideVineError_523":case"OnWideVineError_524":case"OnWideVineError_525":case"OnWideVineError_550":case"OnWideVineError_570":j={Message:k.Message,Content:k.Content,Footer:k.Footer,Close:k.Cancel,callback:function(e){log.write("Error (Unrecoverable)...");application.events.publish("back")}};this.showMessage(h,j);break;case"show_play_error":f=r.args[0].state;l=(r.args[0].titleID)?r.args[0].titleID:"";k=application.resource[r.args[0].type][f];h="message_standard";j={Message:k.Message,OK:k.OK,callback:function(){if(f=="Not_Owned"){application.events.publish("loadtitleview",{id:l,noSaveState:true})}}};v.showMessage(h,j);break;case"connectiontooslow_error":if(BandwidthCheck.callbackType=="purchase"){k=application.resource.player_messages[(r.args[0].isHd)?"connectiontooslow_error_hd":"connectiontooslow_error_sd"]}else{if(BandwidthCheck.callbackType=="player"){k=application.resource.player_messages["connectiontooslow_error"]}}h="message_error_connectiontooslow";j={Message:k.Message,Content:k.Content,OK:k.OK,callback:function(e){var A;if(e){if(BandwidthCheck.callbackParams){log.write("Calling bandwidthcheck success callback.");A=BandwidthCheck.callbackParams;if(BandwidthCheck.callbackType=="purchase"){BrowseView.orderIsProcessing=false;BrowseView.goCheckOut(A.titleid,A.skuid,A.couponcode,A.pinValidated,A.bandwidthValidated)}else{if(BandwidthCheck.callbackType=="player"){BrowseView.PlayerControl._play(A.url,A.resume)}}}}else{if(BandwidthCheck.callbackType=="player"){BrowseView.PlayerControl.bandwidthError=true;log.write("stopping player, and backing out to tile view");application.events.publish("back")}}}};this.CurrentProcessLoaded=true;this.showMessage(h,j);break;case"connectiontooslow_error_player":k=application.resource.player_messages["connectiontooslow_error_player"];h="message_error_connectiontooslow_player";j={Message:k.Message,Content:k.Content,OK:k.OK,Cancel:k.Cancel,callback:function(e){var A=r.args[0];if(e){BrowseView.PlayerControl._resume()}else{log.write("stopping player, and backing out to tile view");application.events.publish("stop",{event:{keycode:70}})}}};this.CurrentProcessLoaded=true;this.showMessage(h,j,true);break;case"askabouthdswap_error":k=application.resource.player_messages["askabouthdswap_error"];h="message_error_askabouthd";j={Message:k.Message,Content:k.Content,Footer:k.Footer,TryAgain:k.TryAgain,OK:k.OK,Cancel:k.Cancel,callback:function(e){var A=r.args[0];switch(e){case"tryagain":BrowseView.PlayerControl._resume();break;case"ok":BrowseView.PlayerControl._handleHdSwap();break;case"cancel":application.events.publish("stop",{event:{keycode:70}});break}}};this.CurrentProcessLoaded=true;this.showMessage(h,j,true);break;default:break}}};function PlaybackBandwidthTest(j){var f,l=j.split("?"),k,g,h,e,d;switch(l[0]){case"SpeedUpdate":g=parseInt(l[1],10);if(g>=0){BrowseView.bwTempTotalSpeed+=g;BrowseView.bwTempCount+=1}log.write("PlaybackBandwidthTest: SpeedUpdate: checkSpeed "+g+"   avgspeed "+(BrowseView.bwTempTotalSpeed/BrowseView.bwTempCount));break;case"ProgressUpdate":BrowseView.bwPercentProgress=parseInt(l[1],10);if(BrowseView.bwPercentProgress%10==0){log.write("PlaybackBandwidthTest: ProgressUpdate: "+BrowseView.bwPercentProgress)}break;case"Complete":h=BrowseView.bwTempCount;e=BrowseView.bwTempTotalSpeed;BrowseView.bwPercentProgress=0;BrowseView.bwTempCount=0;BrowseView.bwTempTotalSpeed=0;if(1!==parseInt(l[1],10)){log.write("PlaybackBandwidthTest: Complete: Error! "+parseInt(l[1],10));if(BandwidthCheck.callbackParams){f=BandwidthCheck.callbackParams;if(BandwidthCheck.callbackType=="purchase"){application.events.publish("error",{type:"while_purchase_bw_internet_out",recoverable:false,method:"doPurchase",params:f})}else{if(BandwidthCheck.callbackType=="player"){}}}return}log.write("BW Test completed");k=new Date();g=parseInt(e/h,10);$cn.data.LastBandwidthCheck=k;$cn.data.LastBandwidthSpeed=g;log.write("Speedtest: "+g+" bytes per sec.");log.write("BandwidthCheck.lastRan: "+BandwidthCheck.lastRan);log.write("Recording connection speed (duration): "+$cn.utilities.DateDiff(k,BandwidthCheck.lastRan));$cn.methods.recordSessionConnectionSpeedTest($cn.utilities.DateDiff(k,BandwidthCheck.lastRan),function(){var m=BandwidthCheck.callbackParams;$cn.data.speedchecked=true;log.write("bw speeed: "+g+", mini bw speed: "+BandwidthCheck.successCondition);if(BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}if(g<BandwidthCheck.successCondition){if(BandwidthCheck.callbackType=="purchase"){d="doPurchase"}else{if(BandwidthCheck.callbackType=="player"){d="player";BrowseView.PlayerControl._clearAllBufferTimeouts()}}log.write("Connection Too Slow error Method: "+d);application.events.publish("error",{type:"connectiontooslow_error",method:d,params:m,isHd:(BandwidthCheck.successCondition==application.appSetting("HDMinimumBandwidth"))})}else{if(BandwidthCheck.callbackParams){log.write("Calling bandwidthcheck success callback.");if(BandwidthCheck.callbackType=="purchase"){BrowseView.orderIsProcessing=false;BrowseView.goCheckOut(m.titleid,m.skuid,m.couponcode,m.pinValidated,m.bandwidthValidated)}else{if(BandwidthCheck.callbackType=="player"){BrowseView.PlayerControl._play(m.url,m.resume)}}}}});break}}var DockControlObjects={id:"dock",persist:{},controls:{},buttons:[],layoutIsDirty:true,hasFocus:false,tpl:null,selection:null,initialize:function(){this.tpl=new ui.template("dockcontainer",application.ui.loadTpl(this.id+".tpl"));this.tpl.compile();this.draw();application.events.subscribe(application,"viewchanged",this.onViewChanged.bind(this));application.events.subscribe(this,"elementfocus",this.onFocusChanged.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"navigate",this.onNavigate.bind(this))},init:function(d){log.write("dockcontrol.init()");if(d){this.persist=d}},draw:function(){var e="PARENTAL CONTROLS";var f=false;this.tpl.append({SignInString:e});this.tpl.apply();if(f){$("btnAccount").removeClass("double-line")}else{$("btnAccount").addClass("double-line")}if(configuration.readValue("BackButtonStyle")){var d=$("dock-back");d.removeClass("btnBack");d.addClass("btnBack"+configuration.readValue("BackButtonStyle"))}},onNavigate:function(e){if(application.debugMode===true){application.debugMode=false;application.doNotRestoreSettings=true}if($("dock-back").hasClass("disableBack")){$("dock-home").setAttribute("up","dock-exit");$("dock-exit").setAttribute("down","dock-home")}else{$("dock-home").setAttribute("up","dock-back");$("dock-exit").setAttribute("down","dock-back")}if(e.args[0].direction=="left"&&application.element.current=="dock-back"){log.write("left pressed on dock back")}if(BrowseView.currentState=="titleview"){if(application.element.current.indexOf("dock-")==0||application.element.current.indexOf("btnAccount")==0){if(e.args[0].direction=="right"){var d=document.getElementById("ButtonPanel").getElementsByTagName("a");if(d.length>0){e.preventDefault();BrowseView.TitleViewControl.setFocus()}}}}},onFocusChanged:function(d){log.write("dock.onFocusChanged");if(document.getElementById(d.args[0].focusedelem)){if($(this.id).isParentOf($(d.args[0].focusedelem))){if(!this.hasFocus){this.hasFocus=true}}else{this.hasFocus=false}}},onViewChanged:function(f){var e=document.getElementById("dockcontainer").getElementsByTagName("a"),d;for(d=0;d<e.length;d++){$(e[d].id).removeClass("selected");this.selection=null}switch(f.args[0]){case"browse-view":this.selection="dock-home";break;case"search-view":this.selection="dock-search";break;case"wishlist-view":this.selection="dock-wishlist";break;case"library-view":this.selection="dock-library";break;case"settings-view":this.selection="dock-settings";break;case"help-view":this.selection="dock-help";break}if(this.selection!=null){$(this.selection).addClass("selected")}},onSaveState:function(e){var d=e.args[0];d[this.id]={selection:this.selection,hasFocus:this.hasFocus}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id])},dockbackPointerFocus:function(){if(!$("dock-back").hasClass("disableBack")){pointer.lastFocusId="dock-back";application.navigator.setFocus("dock-back")}else{application.navigator.setFocus(null)}}};var DockControl=new Class(DockControlObjects);var ItemAnimationMap=["tertiary","secondary","primary","secondary","tertiary"];var Wheel=new Class({source:[],container:null,itemHeight:0,padding:0,selection:0,topPosition:0,wheelChangedTimeout:1000,initialize:function(e,d){this.id=e;this.container=d;application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this))},clean:function(){var d=$(this.container);if(d){if(d.getChildren().length>0){d.getChildren().destroy()}}this.selection=0},indexOf:function(d){var e=this.selection+(d-2);if(e<0){e=(this.source.length<5?-1:e+this.source.length)}else{if(e>=this.source.length){e=(this.source.length<5?-1:e-this.source.length)}}return e},measureElement:function(j){var g=j.getElements("td"),f=null,d=0;if(g&&g.length&&g[0]&&g[0].firstChild){f=g[0].firstChild}if(f){var e=document.createRange();e.selectNodeContents(f);if(e.getBoundingClientRect){var h=e.getBoundingClientRect();if(h){d=h.bottom-h.top}}}return{y:d}},move:function(n){var l=false;var j=this.indexOf(2+n);if(j!=-1){if(n<0){var e=this.indexOf(-1);if(e!=-1){this.renderItem(e,-1)}}else{var h=this.indexOf(5);if(h!=-1){this.renderItem(h,5)}}var q=this;var k=$(this.container).getChildren();this.selection=j;this.topPosition-=n;var f={};var g=application.loadAnimation("wheel");for(m=0;m<k.length;m++){var p=k[m];p.slot=this.topPosition+m;p.idx=this.indexOf(p.slot);var d=(p.slot<0||p.slot>=ItemAnimationMap.length)?ItemAnimationMap[0]:ItemAnimationMap[p.slot];f[m]=$extend({},g.properties[d]);f[m].top=p.slot*this.itemHeight+(this.padding/2);if(p.slot==2){p.addClass("hover");f[m].color=f[m].focus}else{p.removeClass("hover")}}if(g){var r=$extend({},g.options);if(device.getDeviceSoc()!="BCOM"){if(((1000/r.fps)*2)>=r.duration){r.duration=100;r.fps=1000/r.duration}r.onComplete=function(u){for(var s=0;s<k.length;++s){this.onComplete(k[s])}}.bind(this);new Fx.Elements(k,r).start(f);l=true}else{for(var m=0;m<k.length;++m){k[m].setStyles(f[m]);this.onComplete(k[m])}}}}return l},onComplete:function(f){var d=this;if(f.slot<0||f.slot>4){if(f.slot==this.topPosition){f.destroy();this.topPosition=$(this.container).getFirst().slot}else{f.destroy()}}else{if(f.slot==2&&f.idx==this.selection){if(this.onWheelChanged){var e=this.source[this.selection].iD;this.lastKey=this.source[this.selection].iD;setTimeout(function(){if(e==d.lastKey){log.write("onWheelchanged");log.write("key: "+e+", lastKey: "+d.lastKey);d.onWheelChanged({sourceid:d.container,source:d.source,selectedidx:d.selection,selectedvalue:d.source[d.selection].iD})}},d.wheelChangedTimeout)}}}},render:function(e,d){this.clean();this.source=e;this.selection=(d?d:0);this.itemHeight=($cn.utilities.measure($(this.container)).y-this.padding)/5;this.topPosition=2;for(var f=0;f<5;++f){d=this.indexOf(f);if(d!=-1){this.renderItem(d,f)}}if(application.element.current==="selectedslave"){navigation.setFocusElement($("selectedslave"),true)}},renderItem:function(p,n){var f=$(this.container),h=new Element("div",{"class":"wheelitem"}),q=Math.floor(this.itemHeight*n+(this.padding/2)),d,m,r,g,s,j,k,l,e;h.set("genreid",this.source[p].iD);h.setStyle("visibility","hidden");h.slot=n;l=$cn.config.CenterWheel?"align='center'":"";if(n<this.topPosition){this.topPosition=n}if(n<0){q=f.getFirst().style.top.toInt()-this.itemHeight;h.inject(f,"top")}else{if(f.getLast()){q=f.getLast().style.top.toInt()+this.itemHeight}h.inject($(this.container))}d=this.source[p];if(d.name){j=d.name;if(typeof($cn.config.CustomTextCasing)=="function"){j=$cn.config.CustomTextCasing(j)}m="<table class='item-holder'><tr><td "+l+">"+j+"</td></tr></table>";application.putInnerHTML(h,m);s=this.measureElement(h).y;if(s>this.itemHeight){j=this.truncateText(h,j,this.itemHeight,0,j.length,l).trim();if(j.endsWith("-")){j=j.substring(0,j.length-1)}m="<table class='item-holder'><tr><td "+l+">"+j+"</td></tr></table>";application.putInnerHTML(h,m)}}k=application.loadAnimation("wheel");e=(n<0||n>=ItemAnimationMap.length)?ItemAnimationMap[0]:ItemAnimationMap[n];new Fx.Morph(h,k.options).set(k.properties[e]);h.setStyle("top",q+"px");h.setStyle("visibility","visible");if(n==2){h.addClass("hover")}},truncateText:function(h,j,d,l,g,e){if(l<g-1){var k=Math.round((l+g)/2);var f="<table class='item-holder'><tr><td "+e+">"+$cn.utilities.ellipsis(j,k)+"</td></tr></table>";application.putInnerHTML(h,f);if(this.measureElement(h).y<=d){return this.truncateText(h,j,d,k,g,e)}else{return this.truncateText(h,j,d,l,k,e)}}else{return $cn.utilities.ellipsis(j,l)}},onSaveState:function(e){var d=e.args[0];d[this.id]={source:this.source,selection:this.selection,topPosition:this.topPosition}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id])}});var ActiveWheel=null;var WheelControl=new Class({id:"WheelControl",type:"wheel",persist:{},controls:{},history:[],layoutIsDirty:true,isNavigating:false,singleWheel:false,_masterWheel:null,_slaveWheel:null,_masterSource:[],_slaveSource:[],wheelChangedTimeout:1000,masterSourceElement:"masterdatasource",masterSelectedElement:"selectedmaster",itemHeight:0,initialize:function(e){log.write("Initializing: "+this.id);var d=this;if(e){this.persist=e}application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"pointerdeactivated",this.onPointerdeactivated.bind(this))},activate:function(){if(ActiveWheel!==this){if(ActiveWheel){application.events.unsubscribe(ActiveWheel,"wheelitemchanged");application.events.unsubscribe(ActiveWheel,"wheelrendered");application.events.unsubscribe(ActiveWheel,"navigate")}application.events.subscribe(this,"wheelitemchanged",this.handleWheelItemChange.bind(this));application.events.subscribe(this,"wheelrendered",this.wheelRendered.bind(this));application.events.subscribe(this,"navigate",this.navigate.bind(this));ActiveWheel=this}},cleanUI:function(){if($(this.masterSelectedElement)){$(this.masterSelectedElement).label=""}if($("selectedslave")){$("selectedslave").label=""}if($(this.masterSourceElement)){if($(this.masterSourceElement).getChildren().length>0){$(this.masterSourceElement).getChildren().destroy()}}if($("slavedatasource")){if($("slavedatasource").getChildren().length>0){$("slavedatasource").getChildren().destroy()}}},loadData:function(f,d,e){this.cleanUI();this._masterSource=f;this._slaveSource=d;if(f.length>0){this._renderWheel($(this.masterSourceElement),this._masterSource,e)}},wheelRendered:function(e){if(e.context===ActiveWheel){var d=e.args[0];if(d.source.indexOf("master")>-1){$("slavedatasource").getElements("div").destroy();e.context._renderWheel($("slavedatasource"),e.context._slaveSource[d.selectedvalue]);application.events.publish("wheelitemchanged",{wheelinstance:d.wheelinstance,sourceid:d.sourceid,source:d.source,selectedidx:d.selectedidx,selectedvalue:(e.context._slaveSource[d.selectedvalue])?e.context._slaveSource[d.selectedvalue][0].iD:d.selectedvalue})}}},handleWheelItemChange:function(k){log.write("context id: "+k.context.id);log.write("active id: "+ActiveWheel.id);if(k.context===ActiveWheel){log.write("Generic Wheel Item changed. id: "+k.args[0].wheelinstance);var g=this,j=k.args[0],f,e=j.source[j.selectedidx].parentID,d=j.selectedvalue,h=0;this.lastValue=d;if(j.sourceid.indexOf("slave")>-1){f=j.source.length;while(f--){if(j.source[f].iD==d){this.lastSlaveValue=j.source[f].name}}}if(j.sourceid.indexOf("master")>-1){e=j.selectedvalue;if(this.lastSlaveValue){f=k.context._slaveSource[e].length;while(f--){if(k.context._slaveSource[e][f].name==this.lastSlaveValue){d=k.context._slaveSource[e][f].iD;h=f}}}if(h===0){this.lastSlaveValue=false;d=k.context._slaveSource[e][0].iD}$("slavedatasource").getElements("div").destroy();k.context._renderWheel($("slavedatasource"),k.context._slaveSource[j.selectedvalue],h)}BrowseView.CurrentWheelValue=e+":"+d;if(g.lastValue&&(g.lastValue==e||g.lastValue==d)){application.events.publish("wheelvaluechanged",{wheelinstance:g.id,mastervalue:e,slavevalue:d})}}},onWheelChanged:function(d){this.isNavigating=false;log.write("onWheelChanged::called()");d.wheelinstance=this.id;application.events.publish("wheelitemchanged",d)},_morph:function(e,f,d,g){if(!g){g=function(){}}if(e.morphInstance){e.morphInstance.cancel()}e.morphInstance=new Fx.Morph(e,{duration:f,transition:Fx.Transitions.Sine.easeOut,onComplete:g}).start(d)},saveHistory:function(){var d=$(this.type);var e=$extend(this,{});this.history.push({instance:e,dom:d})},loadPrevious:function(){log.write("function: "+this.id+".previousView()");var d=this.history.pop()},_renderWheel:function(d,g,f){if(g&&g.length>0){var e=this;if(f==null){f=0}if(d.id==this.masterSourceElement){if(!this._masterWheel){this._masterWheel=new Wheel(this.id+"_master",this.masterSourceElement);this._masterWheel.wheelChangedTimeout=this.wheelChangedTimeout;this._masterWheel.onWheelChanged=function(h){e.onWheelChanged(h)}}log.write("rendering wheel");this._masterWheel.render(g,f);application.events.publish("wheelrendered",{wheelinstance:e.id,sourceid:e.id,source:"masterdatasource",selectedidx:f,selectedvalue:g[f].iD});return}else{if(d.id=="slavedatasource"){if(!this._slaveWheel){this._slaveWheel=new Wheel(this.id+"_slave","slavedatasource");this._slaveWheel.wheelChangedTimeout=this.wheelChangedTimeout;this._slaveWheel.onWheelChanged=function(h){e.onWheelChanged(h)}}this._slaveWheel.render(g,f);application.events.publish("wheelrendered",{sourceid:e.id,source:"slavedatasource",selectedidx:f,selectedvalue:g[f].iD});return}}}},navigate:function(g){log.write("navigate wheel");var h=(this.singleWheel)?"singleselectedmaster":"selectedmaster";if(g.context===ActiveWheel){if(application.element.current==h||application.element.current=="selectedslave"){if(g.args[0].direction=="up"||g.args[0].direction=="down"){g.preventDefault();if(this.lastNavigate){log.write(this.lastNavigate+", "+$cn.utilities.DateDiff(new Date(),this.lastNavigate))}if(!this.lastNavigate||(this.lastNavigate&&$cn.utilities.DateDiff(new Date(),this.lastNavigate)>500)){if(this._masterWheel){this.lastNavigate=new Date();var f=g.args[0].direction=="up"?-1:1;var d=application.element.current==h?this._masterWheel:this._slaveWheel;this.isNavigating=d.move(f);return}}else{log.write("Clicking too fast, ignore wheel change.");return}}else{if(g.args[0].direction=="right"&&$("titlegrid").style.display=="block"){if(application.element.current=="selectedslave"||(this.singleWheel)){if(this.isNavigating||!BrowseView.CurrentProcessLoaded){g.preventDefault()}else{var e=$("titlegrid").getElementsByTagName("a");if(e.length>0){g.preventDefault();application.navigator.setFocus(e[0].id)}}}else{if(application.element.current=="selectedmaster"&&(this.isNavigating)){g.preventDefault()}}}else{if(g.args[0].direction=="left"){if(application.element.current=="selectedmaster"||(this.singleWheel)){switch(BrowseView.currentState){case"browse-view":g.preventDefault();navigation.setFocus("dock-home");break;case"search-view":g.preventDefault();navigation.setFocus("dock-search");break;case"wishlist-view":g.preventDefault();navigation.setFocus("dock-wishlist");break;case"library-view":g.preventDefault();navigation.setFocus("dock-library");break;case"settings-view":g.preventDefault();navigation.setFocus("dock-settings");break;case"help-view":g.preventDefault();navigation.setFocus("dock-help");break}}}}}}}},render:function(){},split:function(f){var d="",e=f.split(" "),g="";e.each(function(h){if(h.length>0){if(h.length>12){if(h.indexOf("-")>-1){log.write(h);g=h.split("-");g.each(function(j){if(j.stripHTML().length>12){d=d+j.stripHTML().substring(0,11)+"<br />";d=d+j.stripHTML().substring(11,h.stripHTML().length)+"<br />"}else{d=d+j+"<br />"}})}else{if(h.stripHTML().length>12){d=d+h.substring(0,11)+"<br />";d=d+h.substring(11,h.length)+"<br />"}else{d=d+h}}}else{d=d+h+"<br />"}}});if(d.endsWith("-<br />")){d=d.substring(0,d.lastIndexOf("-<br />"))+"<br />"}return d},onSaveState:function(e){var d=e.args[0];d[this.id]={_masterSource:this._masterSource,_slaveSource:this._slaveSource};if(this===ActiveWheel){d.ActiveWheel=this}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id]);if(d.ActiveWheel===this){this.activate()}},onPointerdeactivated:function(){if(pointer.lastFocusId=="selectedmaster"){this.hideWheelMask("masterwheelmaskup");this.hideWheelMask("masterwheelmaskdown")}else{if(pointer.lastFocusId=="selectedslave"){this.hideWheelMask("slavewheelmaskup");this.hideWheelMask("slavewheelmaskdown")}else{if(pointer.lastFocusId=="singleselectedmaster"){this.hideWheelMask("singlewheelmaskup");this.hideWheelMask("singlewheelmaskdown")}}}},setWheelPointerFocus:function(e,f,d){$(e).setStyle("opacity",d);navigation.setFocusElement($(f));pointer.lastFocusId=f},setWheelPointerLoseFocus:function(e,d){this.hideWheelMask(e);pointer.lastFocusId=d},clickWheelAction:function(f,d,g,e){application.element.current=g;$(f).setStyle("opacity",e);application.events.publish("navigate",{direction:d,current:g});navigation.setFocusElement($(g));pointer.lastFocusId=g},hideWheelMask:function(d){$(d).setStyle("opacity","0.0");$(d).setStyle("visibility","visible")}});var TitleViewControlProperties={id:"titleviewcontrol",persist:{},controls:{},tv:false,episode:false,season:false,tvshow:false,isLibrary:false,showingRating:false,layoutIsDirty:true,noBundleError:false,tpl:null,initialize:function(){application.events.subscribe(this,"elementfocus",this.updateSeparator);application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"wishlistinsert",this.onWishlistInsert.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"updatewishlistbutton",this.onWishlistError.bind(this))},updateSeparator:function(e){if(document.getElementById(e.args[0].focusedelem)&&(BrowseView.currentState=="titleview_wheel"||BrowseView.currentState=="titleview_tvepisodes")){var d=$("titledetailscontainer").getElement(".buttonpanel");if(d&&$(e.args[0].focusedelem).getParent().hasClass("buttonpanel")){BrowseView.expandTitleDetails();BrowseView.TitleViewControl.enableButtons()}}},init:function(e,d){log.write("titleviewcontrol.init()");if(e){this.persist=e}},cleanUI:function(){if($("titledetailscontainer")){if($("titledetailscontainer").getChildren().length>0){$("titledetailscontainer").getChildren().destroy()}}},loadData:function(e){var d;this.persist.title=e;this.showingRating=false;this.tv=e.titleType.substring(3,0)=="TV_";this.season=e.titleType=="TV_Season";this.episode=e.titleType=="TV_Episode";this.tvshow=e.titleType=="TV_Show";this.audioProfiles=$cn.utilities.getAudioProfileForTitle(e.titleID);d=this.tvshow?"titleview.tvtitle":"titleview.title";this.tpl=new ui.template("titledetailscontainer",application.ui.loadTpl(d));this.tpl.compile();this.draw()},drawMeta:function(d,e){log.write("Getting meta for: "+d);if(!e){var f=$cn.utilities.getMeta(d,this.persist.title.metaValues);if(d=="Flixster Users"||d=="CriticsReview"){f=f.replace(" liked it","").replace(" liked it.","")}return f}else{f=$cn.utilities.getMeta(d,this.persist.title.metaValues)}return $cn.utilities.formatDate(f,e)},show3rdPartyData:function(){var d="";if(this.showMetaField("CriticsReview")=="_hidden"&&this.showMetaField("Flixster Users")=="_hidden"){d="_hidden"}return d},thirdPartyReviewsEnabled:function(){var d="";if(!$cn.data.flixsterEnable){d="_hidden"}return d},getAudioCssClass:function(){var d=this.audioProfiles.Dolby_Digital_Plus_51;if(!d){d=this.audioProfiles.Dolby_Digital_Plus_Stereo;if(!d){d=this.audioProfiles.DTS_Express_51;if(!d){d=this.audioProfiles.DTS_Express_Stereo}}}if(!d){return"_hidden"}else{return""}},getSurroundAudioCssClass:function(){var d=this.audioProfiles.Dolby_Digital_Plus_51;if(!d){d=this.audioProfiles.DTS_Express_51}if(!d||(this.displaySurroundSoundBadge()=="hideextra")){return"_hidden"}else{return""}},getAudioIconCssClass:function(e){var d=this.audioProfiles[e];var f="_hidden";if(d&&!this.isLibrary){f=""}else{if(d&&this.isLibrary&&!this.audioProfiles.HDOnly){f=""}else{if(d&&this.isLibrary&&this.audioProfiles.HDOnly&&$cn.utilities.getMeta("HD",this.persist.title.metaValues)=="True"){f=""}}}return f},showAudioMetaField:function(e){var d=this.audioProfiles[e];if("HDOnly"==e&&d){return""}var f="_hidden";if(d&&!this.isLibrary){f=""}else{if(d&&this.isLibrary&&!this.audioProfiles.HDOnly){f=""}else{if(d&&this.isLibrary&&this.audioProfiles.HDOnly&&$cn.utilities.getMeta("HD",this.persist.title.metaValues)=="True"){f=""}}}return f},showAudioTechnicalField:function(d,e){var f="_hidden";if(d=="Standard Definition"&&this.getAudioCssClass()!="_hidden"&&!this.audioProfiles.HDOnly&&this.audioProfiles[e]){f=""}else{if(d=="High Definition"&&this.getAudioCssClass()!="_hidden"&&this.audioProfiles[e]){f=""}}return f},showUVTechnicalDetails:function(d){if(d=="UltraViolet"){return(this.isLibrary?application.resource.uv_messages.technical_details.uv_library_view:application.resource.uv_messages.technical_details.uv_store_view)}},showMetaField:function(e){var d=$cn.utilities.getMeta(e,this.persist.title.metaValues);if(d.length==0){return"_hidden"}return""},showReviewMetaFields:function(){var f="",e="",d="";f=$cn.utilities.getMeta("Flixster Users",this.persist.title.metaValues);e=$cn.utilities.getMeta("CriticsReview",this.persist.title.metaValues);if(f.length==0&&e.length==0){d="hidden"}return d},drawTomatoFactor:function(g){var f="splaticon";g=$cn.utilities.getMeta(g,this.persist.title.metaValues);if(g&&g.length>0){try{var d=g.split("%");if(parseInt(d[0].trim())>=60){f="freshicon"}}catch(h){}}return f},getDirectorCssClass:function(){return(this.persist.title.directors.length==0)?"_hidden":""},getCastCssClass:function(){return(this.persist.title.actors.length==0)?"_hidden":""},drawStarRating:function(e){log.write("Drawing rating for: "+e);for(var d=1;d<=5;d++){$("TitleStar"+d).erase("class");if(e>=d){$("TitleStar"+d).addClass("fullstar")}else{if(e<d&&e>(d-1)){$("TitleStar"+d).addClass("halfstar")}}}},getTrailer:function(){var d="";this.hasTrailer=false;this.persist.title.bonusAssets.each(function(e){if(e.bonusType=="Trailer"){d=e.bonusAssetID;this.hasTrailer=true}}.bind(this));return d},getPurchaseButtonText:function(){return $cn.utilities.purchaseText(this.persist.title)},getActors:function(){return $cn.utilities.ellipsis(this.persist.title.actors,application.resource.titleview_strings.Starring_Concat_Length)},getUserRatingFloat:function(d){var g=0;try{if(!d){g=parseFloat($cn.utilities.getMeta("YourRating",this.persist.title.metaValues))}else{g=parseFloat(d)}}catch(f){g=0}return g},setUserRating:function(d){$cn.utilities.setMeta("YourRating",d,this.persist.title.metaValues)},getUserRating:function(d){var e=this.getUserRatingFloat(d);return(e>0)?"block":"none"},getRateButtonText:function(){var e=parseFloat($cn.utilities.getMeta("YourRating",this.persist.title.metaValues));var d="Rate it";if(e>0){d="Change Rating"}return d},getEpisodeShowTitle:function(){return(this.persist.title.show?this.persist.title.show:"")},getEpisodeShowSeason:function(){return(this.persist.title.season?this.persist.title.season:"")},displayBonusAsset:function(d){var e="hideextra";this.persist.title.bonusAssets.each(function(f){if(f.bonusType==d){e="showextra"}});log.write("BonusAsset: "+e);return e},displayAvailability:function(e){var d=e!=null?e:false;if(this.persist&&this.persist.title.watchStatus&&this.persist.title.watchStatus!=WatchStatus.WatchNow&&this.persist.title.watchStatus!=WatchStatus.ExpiredRental){d=!d}return d?"showextra":"hideextra"},displayExtra:function(e,g){var d,f;if(e==="HasUV"&&!$cn.config.EnableUV){return"hideextra"}if(this.persist.title.isPassUV&&e==="HasUV"){d=this.persist.title.isPassUV}else{d=$cn.utilities.getMeta(e,this.persist.title.metaValues)}f="hideextra";if(((d=="True"||(d!="False"&&d!=""))&&!g)||(d=="False"&&g)){f="showextra"}return f},displayCCbadge:function(){var d="hideextra";b=$cn.utilities.getMeta("HasClosedCaption",this.persist.title.metaValues);if(b=="True"){d="showextra"}return d},displaySurroundSoundBadge:function(){var d=this.audioProfiles.Dolby_Digital_Plus_51,e="hideextra";if(d&&!this.isLibrary){e="showextra"}else{if(d&&this.isLibrary&&!this.audioProfiles.HDOnly){e="showextra"}else{if(d&&this.isLibrary&&this.audioProfiles.HDOnly&&$cn.utilities.getMeta("HD",this.persist.title.metaValues)=="True"){e="showextra"}}}return e},displayMoreInfo:function(){var e=0,d;for(d=0;d<this.persist.title.wheelItems.length;d++){if((this.persist.title.wheelItems[d]=="m_credits"||this.persist.title.wheelItems[d]=="m_cast_bios"||this.persist.title.wheelItems[d]=="m_cast_crew")&&$cn.data.baselineEnable){e++}if((this.persist.title.wheelItems[d]=="r_critics"||this.persist.title.wheelItems[d]=="r_user_revs"||this.persist.title.wheelItems[d]=="m_technical_details"&&configuration.readValue("EnableTechnicalDetailsWheelOption"))&&$cn.data.flixsterEnable){e++}}return(e>0)?"showextra":"hideextra"},displayExtraIfPresent:function(e){var d=$cn.utilities.getMeta(e,this.persist.title.metaValues);var f="hideextra";if(d&&d!=""&&d.length>0){f="showextra"}return f},drawDurationString:function(){var f="",e=this.drawMeta("AirDate",$cn.config.DateFormat?$cn.config.DateFormat:"longDate"),d=$cn.utilities.getMeta("RunTime",this.persist.title.metaValues);if(/^-|^0+\s/.test(d)){d="";log.write("runTime was either 0 or negative and has been removed.")}if(this.episode){if(e&&e.length>0){f=this.formatReviewDate(e)}}else{if(this.persist.title.releaseYear&&this.persist.title.releaseYear.length>0){f=this.persist.title.releaseYear}}if(!this.season&&!this.tvshow){if(d&&d.length>0){if(f&&f.length>0){f=f+application.resource.titleview_strings.Duration_Concat}else{f=""}f=f+d}}if(!f||f.length==0){if(document.getElementById("titlemeta_duration")){$("titlemeta_duration").hide()}}return f},storeLogo:function(){if(this.persist.title&&this.persist.title.storeLogoUrl){log.write("STORE URL: <img src='"+this.persist.title.storeLogoUrl+"' id='storeLogo' alt='' />");return"<img src='"+this.persist.title.storeLogoUrl+"' id='storeLogo' alt='' style='vertical-align:middle;margin-left:5px;'  />"}else{log.write("STORE URL: NOTHING");return""}},getRentalStatus:function(){var d="";if(this.persist.title.watchStatus=="ExpiredRental"){d=this.persist.title.expirationMessage}else{if(this.persist.title.expirationMessage&&this.persist.title.expirationMessage!=""){d="("+this.persist.title.expirationMessage+") "}}return d},formatReviewDate:function(n){var m="",g=null,f="",l="",j="",h=new Array("January","February","March","April","May","June","July","August","September","October","November","December");try{g=Date.parse(n);if(!isNaN(g.getDate())){f=g.getDate();l=g.getMonth();j=g.getFullYear();m=h[l]+" "+f+", "+j}}catch(k){alert(k);m=""}return m},reviewIcon:function(d){return(d&&d!="")?d:""},getVisibleElements:function(e){var d=[];if(e){var f=e.getChildren();for(var g=0;g<f.length;g++){if(f[g].getStyle("display")=="block"){d.push(f[g])}}}return d},draw:function(){var j;this.cleanUI();log.write(this.persist.title);$("ruler").setStyles({"font-weight":"bold","font-size":"17px"});if(this.persist.title.passID){BrowseView.setLibrary(true);this.isLibrary=true}this.persist.title.name=this.persist.title.name.ellipsToPixels(460);this.tpl.append(this.persist.title);this.tpl.apply();var k=this.persist.title.watchStatus!=null&&this.persist.title.watchStatus!=WatchStatus.WatchNow&&this.persist.title.watchStatus!=WatchStatus.ExpiredRental;log.write("$cn.data.flixsterEnable: "+$cn.data.flixsterEnable);if($cn.data.flixsterEnable){if(this.displayExtraIfPresent("CriticsReview")=="showextra"&&this.displayExtraIfPresent("Flixster Users")=="showextra"&&$("reviewcontainer")){$("reviewcontainer").addClass("bothreviewssvisible")}}if(!this.tvshow){var p="buttonpanel.title";if(this.persist.title.passID){if(this.season){p="buttonpanel.library.alternate"}else{if(k){p="buttonpanel.library.alternate"}else{p="buttonpanel.library"}}}j=new ui.template("ButtonPanel",application.ui.loadTpl(p));j.compile();j.append(this.persist.title);j.apply();if(k){$("ButtonPanel").addClass("unavailabletitle")}}if(this.tv){if(!this.persist.title.seasonal){application.putInnerHTML($("tdbuttonEpisodes"),application.resource.episodes)}if(!this.noBundleError&&!k){$("tdbuttonEpisodes").removeClass("hideextra")}else{this.noBundleError=false}$("titlemeta_criticsreview").addClass("hideextra");$("titlemeta_flixsterusers").addClass("hideextra");if(!this.tvshow){if($("reviewcontainer")){$("reviewcontainer").addClass("hideextra")}$("tdbuttonRating").hide();$("ratingstar").hide()}if(this.season){if(document.getElementById("duration")){$("duration").hide()}}$$(".tv").show();$$(".movie").hide();if(!this.episode){if($("tdbuttonWatchTrailer")){$("tdbuttonWatchTrailer").addClass("hideextra")}if($("tdbuttonCheckout")){$("tdbuttonCheckout").addClass("hideextra")}$$("#mainstage .episode").hide()}if(this.season||this.episode){$("titlemeta_rating").hide()}}if(this.persist.title.passID){BrowseView.setLibrary(true);this.isLibrary=true;$("purchaseinfostringdetails").hide();if(this.persist.title.passID>0){$("titlepurchasedstring").removeClass("hidden")}if(this.persist.title.watchStatus=="ExpiredRental"){$("tdbuttonExpired").removeClass("hideextra");$("tdbuttonPlay").hide()}if((this.persist.title.streamStartTimeSeconds>$cn.config.EarliestResumeS-$cn.config.RewindUponResumeS)&&this.persist.title.watchStatus==WatchStatus.WatchNow){$("tdbuttonResumePlay").removeClass("hideextra")}if(this.episode&&this.persist.title.nextEpisodeID){$("ButtonPanel").addClass("nextepisode")}log.write("Current Pass: "+this.persist.title.passID);if(!$cn.data.PassCache[this.persist.title.passID]){log.write("Adding pass to pass cache");$cn.data.PassCache[this.persist.title.passID]=this.persist.title}}if(this.hasSimiliar()&&!k){$("tdbuttonSimilar").show()}else{$("tdbuttonSimilar").hide()}if(this.persist.title.availableProducts.length==0&&$("tdbuttonCheckout")){$("tdbuttonCheckout").hide()}this.drawStarRating(parseFloat($cn.utilities.getMeta("YourRating",this.persist.title.metaValues)));application.currentView.layoutIsDirty=true;log.write("Detail Image:");$("titledetailsboxartwrap").show();var h=document.getElementById("TitleBoxArt");if(h&&!h.onerror){h.onerror=function(q){$("titledetailsboxartwrap").hide()}}var m=this.displaySurroundSoundBadge();log.write("showSurroundSound: "+m);if(m=="hideextra"){$("fiveonebadge").hide()}var l=$("ButtonPanel"),e=l.getElements(".half"),d=this.getVisibleElements(e[0]),n=this.getVisibleElements(e[1]),g,f;if(n.length>d.length){g=n.length-d.length;for(f=0;f<g;++f){e[1].removeChild(n[f]);e[0].getParent().insertBefore(n[f],e[0])}}else{if(d.length>n.length){g=d.length-n.length;for(f=0;f<g;++f){e[0].removeChild(d[f]);e[0].getParent().insertBefore(d[f],e[0])}}}},shouldShowRentalWarning:function(){var e=false,f=false,d;for(d=0;d<this.persist.title.availableProducts.length;d++){if(this.persist.title.availableProducts[d].purchaseType=="rent"){e=true;break}}if(e){if($cn.utilities.getMeta("LicensesDelivered",this.persist.title.metaValues)=="0"){f=true}}return f},getRentalPeriod:function(){var e="24",d;for(d=0;d<this.persist.title.availableProducts.length;d++){if(this.persist.title.availableProducts[d].purchaseType=="rent"){log.write("Found rental period: "+this.persist.title.availableProducts[d].rentalPeriod);e=this.persist.title.availableProducts[d].rentalPeriod;break}}return e},update:function(e){var d=this;this.showingRating=false;log.write(".... payload.leaveFocusAlone ..... is: "+e.leaveFocusAlone);if(BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}if(e&&e.passID){if(this.persist.title){this.persist.title.passID=e.passID}}log.write("TitleView.update(User Rating: "+this.getUserRatingFloat()+", payload.stopPositionMins: "+e.stopPositionMins+", payload.stopPositionPercent: "+e.stopPositionPercent+")");if(document.getElementById("titledetails").style.display=="block"||e.forceUpdate){if(this.persist.title&&this.persist.title.passID){$cn.methods.getPurchasedTitle(this.persist.title.passID,this.persist.title.titleID,function(f){if(e.setFocus){BrowseView.loadTitle(f,"nextEpisode");if($("tdbuttonNextEpisode").getStyle("display")!=="block"){log.write("Next Episode Button is Hidden, Dont set focus");d.setFocus()}else{log.write("Calling next Episode focus: "+e.setFocus);application.navigator.setFocus(e.setFocus,true);application.element.current=e.setFocus}}else{if(!e.leaveFocusAlone){BrowseView.loadTitle(f);log.write("..... resetting focus .....");d.setFocus()}else{BrowseView.loadTitle(f,"skipFocus");log.write("..... not resetting focus .....")}}if(d.getUserRatingFloat()==0&&(e.stopPositionMins>=30||e.stopPositionPercent>=96)){log.write("Show rate modal");d.showingRating=true;if(d.tv){BrowseView.showRate(d.persist.title.titleID)}else{BrowseView.showRate(d.persist.title.titleID)}}})}else{if(e.forceUpdate){log.write(".... forcing update ....");$cn.methods.getTitleListing(this.persist.title.titleID,true,function(f){BrowseView.loadTitle(f);navigation.setFocus("tdbuttonCheckout",true)})}else{log.write(".... last branch ....");navigation.setFocus("tdbuttonCheckout",true)}}if(e.bandwidthError){log.write("Bandwidth error!!!!!!")}}},goLibrary:function(d,e){BrowseView.TitleViewControl.setFocus();$cn.methods.getPurchasedTitle(e,d,function(f){BrowseView.loadTitle(f,"")})},navigate:function(payload){var buttons,contender,currentLeft,currentTop,bLength,visButtons=[];if(!payload.preventCustom){if((application.element.current&&application.element.current!="")&&document.getElementById(application.element.current)&&$(application.element.current).getParent()!=null&&($(application.element.current).getParent().hasClass("buttonpanel")||$(application.element.current).getParent().getParent().hasClass("buttonpanel"))){if(payload.args[0].direction=="right"){if(payload.args[0].current==$(application.element.current).get("id")&&$(application.element.current).get("rightaction")){eval("("+$(application.element.current).get("rightaction")+")");payload.preventDefault()}}else{if(BrowseView.currentState=="titleview"&&payload.args[0].direction=="left"){buttons=$("ButtonPanel").getElements("a");contender=-1;currentLeft=document.getElementById(application.element.current).offsetLeft;currentTop=document.getElementById(application.element.current).offsetTop;for(var i=0;i<buttons.length;i++){if(buttons[i].offsetWidth){if(parseInt(buttons[i].offsetLeft)<parseInt(currentLeft)&&parseInt(buttons[i].offsetTop)==parseInt(currentTop)){contender=i;break}}}if(contender==-1){for(var i=0;i<buttons.length;i++){if(buttons[i].offsetWidth){if(parseInt(buttons[i].offsetLeft)<parseInt(currentLeft)&&parseInt(buttons[i].offsetTop)<parseInt(currentTop)){contender=i}}}}if(contender==-1){payload.preventDefault();navigation.setFocus("dock-back",true)}else{payload.preventDefault();navigation.setFocus(buttons[contender].id,true)}}else{if(BrowseView.currentState=="titleview"&&payload.args[0].direction=="down"){buttons=$("ButtonPanel").getElements("a");contender=-1;currentLeft=document.getElementById(application.element.current).offsetLeft;currentTop=document.getElementById(application.element.current).offsetTop;for(var i=0;i<buttons.length;i++){if(buttons[i].offsetWidth){if(parseInt(buttons[i].offsetLeft)==parseInt(currentLeft)&&parseInt(buttons[i].offsetTop)>parseInt(currentTop)){contender=i;break}}}if(contender==-1){for(var i=0;i<buttons.length;i++){if(buttons[i].offsetWidth){if(parseInt(buttons[i].offsetLeft)>parseInt(currentLeft)&&parseInt(buttons[i].offsetTop)>parseInt(currentTop)){contender=i;break}}}}if(contender==-1){payload.preventDefault();for(var i=0;i<buttons.length;i++){if(buttons[i].offsetWidth){if(buttons[i].id==application.element.current&&parseInt(buttons[i].offsetTop)==parseInt(currentTop)){bLength=buttons.length;while(bLength--){if(buttons[bLength].getStyle("display")=="block"){visButtons.unshift(buttons[bLength])}}navigation.setFocus(visButtons[0].id,true);break}}}}else{payload.preventDefault();navigation.setFocus(buttons[contender].id,true)}}else{if(BrowseView.currentState=="titleview"&&payload.args[0].direction=="up"){buttons=$("ButtonPanel").getElements("a");bLength=buttons.length;log.write(bLength);while(bLength--){if(buttons[bLength].getStyle("display")=="block"){visButtons.unshift(buttons[bLength])}}bLength=visButtons.length;if(application.element.current==visButtons[0].id){payload.preventDefault();if(visButtons[0].offsetWidth==visButtons[(bLength-1)].offsetWidth){navigation.setFocus(visButtons[(bLength-1)].id,true)}else{if($("tdbuttonWishlist-1")&&$("tdbuttonWishlist-1").getStyle("display")=="block"){navigation.setFocus(visButtons[(bLength-1)].id,true)}else{if($(visButtons[(bLength-2)].id).getParent().getPrevious(".half")){navigation.setFocus(visButtons[(bLength-3)].id,true)}else{navigation.setFocus(visButtons[(bLength-2)].id,true)}}}}}}}}}}},hasSimiliar:function(){var e=false;var d=this;if($cn.data.jinniEnable&&($cn.utilities.getMeta("SimilarAvail",d.persist.title.metaValues)=="True")){if(this.persist.title.wheelItems.length>0){this.persist.title.wheelItems.each(function(f){if(f.indexOf("s_")==0){e=true}})}}if(!e&&$cn.data.baselineEnable){if(this.persist.title.wheelItems.length>0){this.persist.title.wheelItems.each(function(f){if(f.indexOf("m_cast_crew")==0){e=true}})}}return e},setFocus:function(){log.write("Setting title view focus...");if(!this.showingRating){log.write("Not showing the rating...");var f=$("ButtonPanel").getElements("a");var e=-1;for(var d=0;d<f.length;d++){if(f[d].id=="tdbuttonResumePlay"&&document.getElementById("tdbuttonResumePlay").className.indexOf("hideextra")==-1){e=d;log.write("contender: "+f[d].id);break}log.write(f[d].id+":"+f[d].offsetWidth);if(f[d].offsetWidth){if(e==-1){e=d;continue}else{if(parseInt(f[d].offsetLeft)<parseInt(f[e].offsetLeft)&&parseInt(f[d].offsetTop)<=parseInt(f[e].offsetTop)){e=d}}}}log.write("contender"+e);if(document.getElementById("modalcontrol")&&document.getElementById("modalcontrol").className=="message_exit"&&document.getElementById("modalcontrol").style.display=="block"){if(e!=-1){BrowseView.MessagePopup.lastFocus=f[e].id}else{if(f.length>0){BrowseView.MessagePopup.lastFocus=f[0].id}}}else{if(e!=-1){log.write("titleview.setfocus: "+f[e].id);navigation.setFocus(f[e].id,tru