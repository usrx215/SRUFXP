).destroy()}if(d){d()}}.bind(this),200)}else{if($cn.data.EnableMerchPage){setTimeout(function(){$("welcome").destroy();if(d){d()}BrowseView.showMerch();application.navigator.setFocus("f_button",true)}.bind(this),200)}else{$("store").set("class","browse-view");BrowseView.showMessage("message_loading",{Message:application.resource.loading_enum.loadinggeneric});BrowseView.goHome(true);setTimeout(function(){if($("welcome")){$("welcome").destroy()}if(BrowseView&&BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}if(d){d()}application.navigator.setFocus("selectedmaster",true)}.bind(this),2000)}}},onPointerActivated:function(){pointer.lastFocusId="welcomebutton"}},WelcomeControl=new Class(WelcomeControlProperties);var AudioPopup=new Class({Extends:ModalControl,id:"audiopopup",titleID:0,passID:0,resume:0,callback:null,initialize:function(){log.write("audiopopup.init()");this.parent(this.id)},navigate:function(k){if($$("div.audiopopup").length>0&&$$("div.audiopopup")[0].style.display=="block"){var j=k.args[0].current;if($(j).rel=="audioanchor"){if(k.args[0].direction=="up"||k.args[0].direction=="down"){k.preventDefault();var g=$$("a[rel=audioanchor]"),f=[],e=0,h=0,d;for(d=0;d<g.length;d++){if(j==g[d].id){h=e}if(document.getElementById(g[d].id).offsetWidth>0){f[f.length]=g[d];e++}}if(k.args[0].direction=="up"){if(h>0){navigation.setFocus(f[h-1].id,true)}else{navigation.setFocus(f[f.length-1].id,true)}}else{if(k.args[0].direction=="down"){if(h<f.length-1){navigation.setFocus(f[h+1].id,true)}else{navigation.setFocus(f[0].id,true)}}}}}}},show:function(h,j,g,k){var d;this.lastFocus=application.element.current;this.parent();this.titleID=h;this.passID=j;this.resume=g;this.callback=k;application.events.subscribe(this,"elementfocus",this.onFocus.bind(this));application.events.subscribe(this,"navigate",this.navigate.bind(this));var f=$cn.utilities.getAudioProfileTypesForPurchase(j);for(var e=0;e<f.length;e++){if(f[e]=="Dolby"){$("audio_dolby").removeClass("hidden");application.navigator.setFocus("audio_dolby",true)}if(f[e]=="DTS"){$("audio_dts").removeClass("hidden");application.navigator.setFocus("audio_dts",true)}}},hide:function(){application.events.unsubscribe(this,"elementfocus");application.events.unsubscribe(this,"navigate");this.parent()},onFocus:function(){if($$("div.audiopopup").length>0){switch(application.element.current){case"audio_stereo":$$("p.audiopromo").addClass("hidden");$("aacselected").removeClass("hidden");break;case"audio_dts":$$("p.audiopromo").addClass("hidden");$("dtsselected").removeClass("hidden");break;case"audio_dolby":$$("p.audiopromo").addClass("hidden");$("dolbyselected").removeClass("hidden");break;default:break}}},selectAudioFormat:function(d){$cn.data.PreferredAudioType=d;$cn.data.PreferredAudioTypeSet=true;configuration.writeValue("DefaultAudioFormat",$cn.data.PreferredAudioType);configuration.writeValue("AudioSetupDisplayed",$cn.data.PreferredAudioTypeSet);$cn.methods.setAudioDefaultProperty(d,function(){this.hide();if(this.callback){this.callback.call()}else{BrowseView.showPlay(this.titleID,this.passID,this.resume,true)}}.bind(this))}});var CCPopup=new Class({Extends:ModalControl,id:"ccsettingpopup",_ccValues:{},_ccSeleted:{},_currentIndex:0,callback:null,hideCallback:null,initialize:function(){this.parent("ccsettingpopup");this._ccValues={CCTextColor:["auto","white","black","red","green","blue","yellow","magenta","cyan"],CCTextOpacity:["auto",100,75,50,25],CCTextSize:["auto",200,150,100,75,50],CCFont:["auto","monospaceSerif","proportionalSerif","monospaceSansSerif","proportionalSansSerif","casual","cursive","smallCaps"],CCBackgroundColor:["auto","white","black","red","green","blue","yellow","magenta","cyan"],CCBackgroundOpacity:["auto",100,75,50,25,0],CCTextEdge:["auto","none","raised","depressed","uniform","drop_shadowed"],CCWindowColor:["auto","white","black","red","green","blue","yellow","magenta","cyan"],CCWindowOpacity:["auto",100,75,0],CCLanguage:["auto","normal","simplified"]};this._ccSeleted={CCTextColor:{index:0,value:"auto"},CCTextOpacity:{index:0,value:"auto"},CCTextSize:{index:0,value:"auto"},CCFont:{index:0,value:"auto"},CCBackgroundColor:{index:0,value:"auto"},CCBackgroundOpacity:{index:0,value:"auto"},CCTextEdge:{index:0,value:"auto"},CCWindowColor:{index:0,value:"auto"},CCWindowOpacity:{index:0,value:"auto"},CCLanguage:{index:0,value:"auto"}};this._ccSeleted.CCTextColor.value=$cn.data.CCTextColor?$cn.data.CCTextColor:"auto";this._ccSeleted.CCTextOpacity.value=$cn.data.CCTextOpacity||$cn.data.CCTextOpacity==0?$cn.data.CCTextOpacity:"auto";this._ccSeleted.CCTextSize.value=$cn.data.CCTextSize?$cn.data.CCTextSize:"auto";this._ccSeleted.CCFont.value=$cn.data.CCFont?$cn.data.CCFont:"auto";this._ccSeleted.CCBackgroundColor.value=$cn.data.CCBackgroundColor?$cn.data.CCBackgroundColor:"auto";this._ccSeleted.CCBackgroundOpacity.value=$cn.data.CCBackgroundOpacity||$cn.data.CCBackgroundOpacity==0?$cn.data.CCBackgroundOpacity:"auto";this._ccSeleted.CCTextEdge.value=$cn.data.CCTextEdge?$cn.data.CCTextEdge:"auto";this._ccSeleted.CCWindowColor.value=$cn.data.CCWindowColor?$cn.data.CCWindowColor:"auto";this._ccSeleted.CCWindowOpacity.value=$cn.data.CCWindowOpacity||$cn.data.CCWindowOpacity==0?$cn.data.CCWindowOpacity:"auto";this._ccSeleted.CCLanguage.value=$cn.data.CCLanguage?$cn.data.CCLanguage:"auto"},navigate:function(g){if(document.getElementById(application.element.current)&&$(application.element.current).hasClass("ccOption")){switch(g.args[0].direction){case"up":break;case"down":break;case"left":g.preventDefault();var e=g.context._ccValues[application.element.current];var f=g.context._ccSeleted[application.element.current];var h=f.index;var d=f.value;h=h-1<0?e.length-1:h-1;f.value=e[h];f.index=h;g.context._ccSeleted[application.element.current]=f;$(application.element.current).set("html",f.value);break;case"right":g.preventDefault();var e=g.context._ccValues[application.element.current];var f=g.context._ccSeleted[application.element.current];var h=f.index;var d=f.value;h=h+1>e.length-1?0:h+1;f.value=e[h];f.index=h;g.context._ccSeleted[application.element.current]=f;$(application.element.current).set("html",f.value);break}}},show:function(){$("CCTextColor").set("html",$cn.data.CCTextColor?$cn.data.CCTextColor:"auto");$("CCTextOpacity").set("html",$cn.data.CCTextOpacity||$cn.data.CCTextOpacity==0?$cn.data.CCTextOpacity:"auto");$("CCTextSize").set("html",$cn.data.CCTextSize?$cn.data.CCTextSize:"auto");$("CCFont").set("html",$cn.data.CCFont?$cn.data.CCFont:"auto");$("CCBackgroundColor").set("html",$cn.data.CCBackgroundColor?$cn.data.CCBackgroundColor:"auto");$("CCBackgroundOpacity").set("html",$cn.data.CCBackgroundOpacity||$cn.data.CCBackgroundOpacity==0?$cn.data.CCBackgroundOpacity:"auto");$("CCTextEdge").set("html",$cn.data.CCTextEdge?$cn.data.CCTextEdge:"auto");$("CCWindowColor").set("html",$cn.data.CCWindowColor?$cn.data.CCWindowColor:"auto");$("CCWindowOpacity").set("html",$cn.data.CCWindowOpacity||$cn.data.CCWindowOpacity==0?$cn.data.CCWindowOpacity:"auto");$("CCLanguage").set("html",$cn.data.CCLanguage?$cn.data.CCLanguage:"auto");this.parent();application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"back",this.handleBack.bind(this));application.events.subscribe(this,"keydown",this.handleKeyPress.bind(this))},unsubEvents:function(){application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"keydown")},handleBack:function(d){d.preventDefault();this.unsubEvents();this.hide()},handleKeyPress:function(d){},saveSettings:function(){$cn.data.CCTextColor=this._ccSeleted.CCTextColor.value;$cn.data.CCTextOpacity=this._ccSeleted.CCTextOpacity.value;$cn.data.CCTextSize=this._ccSeleted.CCTextSize.value;$cn.data.CCFont=this._ccSeleted.CCFont.value;$cn.data.CCBackgroundColor=this._ccSeleted.CCBackgroundColor.value;$cn.data.CCBackgroundOpacity=this._ccSeleted.CCBackgroundOpacity.value;$cn.data.CCTextEdge=this._ccSeleted.CCTextEdge.value;$cn.data.CCWindowColor=this._ccSeleted.CCWindowColor.value;$cn.data.CCWindowOpacity=this._ccSeleted.CCWindowOpacity.value;$cn.data.CCLanguage=this._ccSeleted.CCLanguage.value;application.saveAuthToken();this.hide()},hide:function(){this.unsubEvents();this.parent()},cancel:function(){this.hide()}});var MerchControlProperties={id:"merchcontrol",persist:{},controls:{},buttons:[],layoutIsDirty:true,_data:[],tpl:null,tplTvShows:null,tplNewMovies:null,tplFeature:null,tplCollection:null,tplActions:null,scroll:false,lastFocus:null,firstFocus:null,contentControlId:"",contentId:"merchcontrol",initialize:function(e,d){application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));this.id=e;this.tplTvShows=new ui.template("newtvshows",application.ui.loadTpl("merch_newtvshows.tpl"));this.tplTvShows.compile();this.tplNewMovies=new ui.template("newmovies",application.ui.loadTpl("merch_newmovies.tpl"));this.tplNewMovies.compile();this.tplFeature=new ui.template("featuredpromotion",application.ui.loadTpl("merch_feature.tpl"));this.tplFeature.compile();this.tplCollection=new ui.template("newcollections",application.ui.loadTpl("merch_collection.tpl"));this.tplCollection.compile();this.tplActions=new ui.template("actionbuttoncontainer",application.ui.loadTpl("merchactionbuttons.tpl"));this.tplActions.compile()},init:function(e,d){log.write("merchcontrol.init()");if(e){this.persist=e}},cleanUI:function(){},loadData:function(d){this._data=[];this._data=d},show:function(){var e=this,d,f=$cn.config.MaxMerchThumbs||5;log.write("Showing Merch Page.");application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"displaytitledetails",this.loadtitleview.bind(this));application.events.subscribe(this,"loadgenreview",this.loadgenreview.bind(this));if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastFocus=application.element.current}$("newcollectionheader").set("text",$cn.data.Merch.newCollectionHeader);$("newmovieheader").set("text",$cn.data.Merch.newMovieHeader);$("newtvshowheader").set("text",$cn.data.Merch.newTVShowHeader);$("merchpage").show();this.tplNewMovies.empty();this.tplTvShows.empty();this.tplFeature.empty();this.tplCollection.empty();this.tplActions.empty();this.tplFeature.append($cn.data.Merch.featuredPromotion);if($("featuredtitleheader")){$("featuredtitleheader").set("text",$cn.data.Merch.featuredPromotion.name)}d=0;$cn.data.Merch.newMovies.each(function(g){if(d<f){g.titleidx=d++;if(typeof $cn.config.CustomDefaultGridImage=="function"){g.defaultImageClass=$cn.config.CustomDefaultGridImage()}e.tplNewMovies.append(g)}});d=0;$cn.data.Merch.newTVShows.each(function(g){if(d<f){g.titleidx=d++;if(typeof $cn.config.CustomDefaultGridImage=="function"){g.defaultImageClass=$cn.config.CustomDefaultGridImage()}e.tplTvShows.append(g)}});d=0;if($cn.data.Merch.newCollections.length){log.write("we have new collections length");for(d=0;d<$cn.data.Merch.newCollections.length;d+=1){if($cn.config.MaxMerchCollections&&$cn.data.Merch.newCollections.length>$cn.config.MaxMerchCollections){$cn.data.Merch.newCollections.length=$cn.config.MaxMerchCollections}$cn.data.Merch.newCollections[d].titleidx=d;e.tplCollection.append($cn.data.Merch.newCollections[d])}}else{log.write("we do NOT have new collections length");e.tplCollection.append($cn.data.Merch.newCollections)}d=0;$cn.data.Merch.actionButtons.each(function(g){g.titleidx=d++;e.tplActions.append(g)});this.tplNewMovies.apply();this.tplTvShows.apply();this.tplFeature.apply();this.tplCollection.apply();this.tplActions.apply();navigation.setFocus("f_button",true)},keydown:function(d){switch(d){case"Store":this.hide();BrowseView.goHome();break;case"MyLibrary":this.hide();navigation.setFocus("dock-library",true);BrowseView.goLibrary(function(){$("mainstage").hide()},function(){$("mainstage").show()});break;default:break}},navigate:function(j){var d,h=$(application.element.current).get("class").replace("hover","").replace("default","").trim(),f=$cn.config.MaxMerchThumbs<$cn.data.Merch.newMovies.length?$cn.config.MaxMerchThumbs:$cn.data.Merch.newMovies.length,e=$cn.config.MaxMerchThumbs<$cn.data.Merch.newTVShows.length?$cn.config.MaxMerchThumbs:$cn.data.Merch.newTVShows.length,g=$cn.data.Merch.newCollections.length;direction=j.args[0].direction;if(h.indexOf("activate")==-1&&document.getElementById("modalcontrol").style.display!="block"){if(BrowseView.currentState=="merch-view"){log.write("Merch page listening.");j.preventDefault();switch(h){case"featuredpromotion":if(direction==="up"){navigation.setFocusElement($("newcollections").getElement("a[titleidx='"+(g-1)+"']"),true)}if(direction==="down"){navigation.setFocusElement($("newcollections").getElement("a[titleidx='0']"),true)}else{if(direction==="right"){navigation.setFocusElement($("newmovies").getElement("a[titleidx='0']"),true)}else{if(direction==="left"){navigation.setFocusElement($("newmovies").getElement("a[titleidx='"+(f-1)+"']"),true)}}}break;case"newmovie":d=parseInt($(application.element.current).get("titleidx"));if(direction==="down"){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='"+d+"']"),true)}if(direction==="up"){if(d<2){navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='0']"),true)}else{navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='1']"),true)}}else{if(direction==="right"){if(f>d+1){navigation.setFocusElement($("newmovies").getElement("a[titleidx='"+(d+1)+"']"),true)}else{navigation.setFocusElement($("featuredpromotion").getElement("a"),true)}}else{if(direction==="left"){if(d>0){navigation.setFocusElement($("newmovies").getElement("a[titleidx='"+(d-1)+"']"),true)}else{navigation.setFocusElement($("featuredpromotion").getElement("a"),true)}}}}break;case"newtvshows":d=parseInt($(application.element.current).get("titleidx"));if(direction==="up"){navigation.setFocusElement($("newmovies").getElement("a[titleidx='"+d+"']"),true)}else{if(direction==="down"){if(d<2){navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='0']"),true)}else{navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='1']"),true)}}else{if(direction==="right"){if(e>d+1){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='"+(d+1)+"']"),true)}else{navigation.setFocusElement($("newcollections").getElement("a"),true)}}else{if(direction==="left"){if(d>0){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='"+(d-1)+"']"),true)}else{navigation.setFocusElement($("newcollections").getElement("a"),true)}}}}}break;case"button":d=parseInt($(application.element.current).get("titleidx"));if(direction==="up"){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='"+(d===0?0:2)+"']"),true)}if(direction==="down"){navigation.setFocusElement($("newmovies").getElement("a[titleidx='"+(d===0?0:2)+"']"),true)}else{if(direction==="right"){if($cn.data.Merch.actionButtons.length>(d+1)){navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='"+(d+1)+"']"),true)}else{navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='0']"),true)}}else{if(direction==="left"){navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='"+(d?0:1)+"']"),true)}}}break;case"collection":d=parseInt($(application.element.current).get("titleidx"));if(direction==="right"){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='0']"),true)}else{if(direction==="left"){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='"+(e-1)+"']"),true)}else{if(d===0&&direction==="up"){navigation.setFocusElement($("featuredpromotion").getElement("a"),true)}else{if(d+1===g&&direction==="down"){navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='0']"),true)}else{if(direction==="up"){navigation.setFocusElement($("newcollections").getElement("a[titleidx='"+(d-1)+"']"),true)}else{if(direction==="down"){navigation.setFocusElement($("newcollections").getElement("a[titleidx='"+(d+1)+"']"),true)}}}}}}break;default:break}}}},loadgenreview:function(l){var e=l.args[0],m=null,g=null,j=null,n=0,k=0,f=0,h=0;if(!$cn.utilities.haveGenreId(e.id)){$("merchpage").hide();BrowseView.goHome();return}$("merchpage").hide();for(var q in $cn.data.slaveWheel){$cn.data.slaveWheel[q].each(function(p){if(p.iD==e.id){h=p.parentId;j=$cn.data.slaveWheel[q];g=p;j.each(function(r){if(g.iD==r.iD){f=n}n++})}})}n=0;$cn.data.masterWheel.each(function(p){if(h==p.iD){k=n;m=p}n++});BrowseView.goHome();BrowseView.WheelControl.loadData($cn.data.masterWheel,$cn.data.slaveWheel,k);BrowseView.WheelControl._slaveWheel.render(j,f);application.events.publish("wheelrendered",{sourceid:"WheelControl",source:"slavedatasource",selectedidx:f,selectedvalue:g.iD});application.events.publish("wheelitemchanged",{wheelinstance:"WheelControl",sourceid:"WheelControl",source:"slavedatasource",selectedidx:f,selectedvalue:g.iD});var d=$("titlegrid").getElementsByTagName("a");if(d.length>0){navigation.setFocusElement($("titlegrid").getElement(d[0].id),true)}else{navigation.setFocus("selectedslave",true)}},loadtitleview:function(d){$("merchpage").hide()},hide:function(){BrowseView.hideExtras();$("titlegrid").show();$("wheel").show();$("dock").show();navigation.setFocus("selectedmaster",true);$("merchpage").hide();application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"displaytitledetails");application.events.unsubscribe(this,"loadgenreview")},onBack:function(d){if(d){d.preventDefault()}},onRestoreState:function(){if(BrowseView.currentState==="merch-view"){application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"displaytitledetails");application.events.unsubscribe(this,"loadgenreview");application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"displaytitledetails",this.loadtitleview.bind(this));application.events.subscribe(this,"loadgenreview",this.loadgenreview.bind(this));$("merchpage").show()}}},MerchControl=new Class(MerchControlProperties);var SignInControl=new Class({id:"signincontrol",persist:{},controls:{},buttons:[],layoutIsDirty:true,_data:[],tpl:null,lastFocus:null,firstFocus:null,contentControlId:"",contentId:"merchcontrol",initialize:function(f,d){this.id=f;var e=f;if(f=="accountfeature"||f=="checkout"){e="activate"}this.tpl=new ui.template(d,application.ui.loadTpl("signin_"+e+".tpl"));this.tpl.compile()},init:function(f,e){log.write("signincontrol.init()");var d=this;if(f){this.persist=f}},cleanUI:function(){},loadData:function(d){this._data=[];this._data=d},show:function(){$("dock").hide();$("wheel").hide();$("gridview").hide();$("signin").show();application.events.subscribe(this,"loadforgotpassword",this.forgotpassword.bind(this));if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastFocus=application.element.current}var d="",e="";if(this.id=="accountfeature"){d="You need to activate this device to use this feature."}else{if(this.id=="checkout"){d="You need to activate this device to make purchases."}else{e="hide"}}this.tpl.empty();this.tpl.append({message:d,className:e});this.tpl.apply();navigation.setFocus("SignInUserName")},signin:function(){alert("signin")},forgotpassword:function(d){alert("forgotpassword")},createaccount:function(d){alert("create account")},activate:function(d){alert("activate")},hide:function(){},onBack:function(d){if(d){d.preventDefault()}}});var ActivationPcView=new Class({id:"activateview",persist:{},controls:{},layoutIsDirty:true,tpl:null,code:"",pollTimer:null,pollTimerStarted:false,inPolling:false,activeFromWelcome:true,payload:null,focusElement:"",initialize:function(){log.write("activate.init()")},cancel:function(){$("activatefullscreen").hide();application.navigator.setFocus("leftbutton",true);this.pollTimer.Stop();this.pollTimerStarted=false;this.inPolling=false},startBase:function(){this.loadData();if(document.getElementById("activationintro")){$("activationintro").hide()}$("activationbody").show()},start:function(){this.startBase();application.navigator.setFocus("generatenewcodebutton",true)},startFirstTime:function(){this.startBase();application.navigator.setFocus("activationbodycancelbutton",true)},loadData:function(){var d=this;this.displayCode();if(this.pollTimer===null){this.pollTimer=new Timer();this.pollTimer.Interval=5000;this.pollTimer.Tick=function(){if(document.getElementById("ActivateContent").style.display=="none"){log.write("Activate panel is not displayed but is still polling. Stop it!");d.pollTimer.Stop();d.pollTimerStarted=false}else{if(d.inPolling){return}log.write("Polling for auth token...");d.inPolling=true;$cn.methods.pollForToken(function(e){d.inPolling=false;if(e.authToken){if(e.authToken.length>0){$cn.utilities.setParentalSettings(e);d.pollTimerStarted=false;d.pollTimer.Stop();d.showActivateSuccessPage()}}})}}}},showActivateSuccessPage:function(){var d=this;if(!this.activeFromWelcome){$("activatefullscreen").show();$("activationintro").hide()}$("activationdevicename").innerHTML='"'+$cn.data.DeviceName+'"';$("acctCredit").innerHTML="";$("accountCredit").hide();$("accountCreditNoBilling").hide();$("noBilling").hide();$cn.methods.getBillingInfo(function(e){if(e.giftCertificateBalance>0){$("acctCredit").innerHTML=application.resource.currency_symbol+$cn.utilities.formatAsMoney(e.giftCertificateBalance);$("accountCredit").show();if(e.cCLast4===""){$("accountCreditNoBilling").show()}}else{if(e.cCLast4===""){$("noBilling").show()}}if($cn.config.EnableUV){$("activationsuccesscontent").addClass("successuvbg")}else{$("uvNotifyMessage").hide()}$("activationbody").hide();$("activationsuccess").show();d.focusElement=application.element.current;application.navigator.setFocus("activationcontinuebutton",true)})},displayCode:function(){var e=this,d,f;f=$cn.utilities.showLoadingModal(2000,"Loading Activation String...");application.TempKeyBlock=true;$cn.methods.getActivationString(function(g){application.TempKeyBlock=false;$cn.utilities.clearLoadingSpinner(f);log.write("activation string: "+g);e.code=g;for(d=0;d<g.length;d++){try{$("Code"+d).innerHTML=g.substring(d,d+1)}catch(h){log.write(log.dumpObj(h));return}}if(application.authSupported){if(!e.pollTimerStarted){e.pollTimerStarted=true;e.pollTimer.Start()}}})},show:function(){var d=$("activationintro"),e=$("activationbody");$("activatefullscreen").show();$("Code0").innerHTML="";$("Code1").innerHTML="";$("Code2").innerHTML="";$("Code3").innerHTML="";$("Code4").innerHTML="";$("Code5").innerHTML="";$("Code6").innerHTML="";application.currentView.layoutIsDirty=true;$$("#activationintro .content .url").set("html",$cn.data.ActivationURL);$$("#activationbody span.url").set("html",$cn.data.ActivationURL);if(d){e.hide();d.show();application.navigator.setFocus("okaybuttonactivation",true)}else{e.show();this.startFirstTime()}},hide:function(){log.write("Hiding activate");if(this.activeFromWelcome){if(application.authSupported){log.write("Stopping Activation timer.");if(this.pollTimer){this.pollTimer.Stop();this.pollTimerStarted=false;this.inPolling=false}}BrowseView.WelcomeControl.hide(function(){$("activatefullscreen").hide()})}else{application.element.current=this.focusElement;$("activatefullscreen").hide();application.events.publish("activated",(this.payload)?this.payload:{});if(!this.payload){application.navigator.setFocus(this.focusElement,true)}}application.currentView.layoutIsDirty=true},poll:function(){$cn.methods.pollForToken(function(d){log.write(log.dumpObj(d.data.result))})},onBack:function(d){this.parent(d);log.write("onBack getting called");if(this.payload&&this.payload.onCancel){log.write("onBack with payload getting called");this.payload.onCancel.call()}else{application.events.publish("activatecancelled",{})}}});