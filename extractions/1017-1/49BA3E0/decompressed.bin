veGrid(e,this._slaveSource[e][0].iD.split("|")[1])}},loadData:function(e,f){var d=this;$cn.methods.getGenesByWheelOptionPlural(e,function(k){var p,m;log.write("recommendationswheel.loadData Debug: BrowseView.currentState: "+BrowseView.currentState);if((BrowseView.currentState=="titleview_wheel"||BrowseView.currentState=="titleview")&&k&&(k.responseCode==0||k.responseCode==22)&&k.wheelOptions){var g="";d.saveHistory();d.cleanUI();d.titleID=e;d._masterSource=[];d._slaveSource={};d.dataLoaded=false;BrowseView.CurrentProcessLoaded=false;application.events.publish("gridloading",{grid:"titlegrid",className:"similar"});d.activate();if($cn.data.jinniEnable){for(p=0;p<k.wheelOptions.length;p++){var q=k.wheelOptions[p];if(q.geneList.length>0){if(g==""){g=q.wheelOption}var n=$cn.data.TitleDetailCache[e],l;if(q.wheelOption=="s_all"&&n.titleType=="TV_Show"){l=application.resource.td_similar["s_all_"+n.titleType]}else{l=application.resource.td_similar[q.wheelOption]}d._masterSource[d._masterSource.length]={name:l,iD:q.wheelOption,parentID:0};d._slaveSource[q.wheelOption]=[];for(m=0;m<q.geneList.length;m++){var j=q.geneList[m];d._slaveSource[q.wheelOption].push({name:j.name,iD:q.wheelOption+"|"+j.geneId,parentID:q.wheelOption})}}}}if($cn.data.baselineEnable){if(BrowseView.currentTitle){for(var h=0;h<BrowseView.currentTitle.wheelItems.length;h++){if(BrowseView.currentTitle.wheelItems[h].indexOf("m_cast_crew")>-1){g=(g!="")?g:"m_cast_crew";d._masterSource[d._masterSource.length]={name:application.resource.td_similar.m_cast_crew,iD:"m_cast_crew",parentID:0};break}}d._renderWheel($("masterdatasource"),d._masterSource);d.loadSlaveDataSource(g)}else{$cn.methods.getTitleListing(e,true,function(r){BrowseView.currentTitle=r;for(var s=0;s<BrowseView.currentTitle.wheelItems.length;s++){if(BrowseView.currentTitle.wheelItems[s].indexOf("m_cast_crew")>-1){g=(g!="")?g:"m_cast_crew";d._masterSource[d._masterSource.length]={name:application.resource.td_similar.m_cast_crew,iD:"m_cast_crew",parentID:0};break}}d._renderWheel($("masterdatasource"),d._masterSource);d.loadSlaveDataSource(g)}.bind(this))}}}if(k.responseCode==22){f.call(d,0,"Cast and Crew added")}else{f.call(d,k.responseCode,k.responseMessage)}})},navigate:function(e){var d=e.args[0];if(e.context===ActiveWheel){if(d.current&&(d.current=="selectedmaster")){if(d.direction=="left"){if(this.dataLoaded){e.preventDefault();BrowseView.expandTitleDetails();BrowseView.TitleViewControl.enableButtons();navigation.setFocus("tdbuttonSimilar",true)}else{e.preventDefault()}}else{this.parent(e)}}else{this.parent(e)}}}});var CheckoutPanelControlProperties={id:"checkoutpanel",couponCode:0,discountAmount:0,persist:{},controls:{},layoutIsDirty:true,inLibrary:false,isActive:false,spinnerPos:1,spinnerTimer:null,spinnerSpinning:false,spinnerPosition:1,paymentInfoAvailable:false,paymentInfoListener:null,loadingTimer:null,tpl:null,tplCart:null,purchaseDetails:{},getPersist:function(){return this.persist},initialize:function(){if($("checkoutpanel")){$("checkoutpanel").hide()}this.loadView("checkout.buy");log.write("checkoutpanel.init()");this.spinnerTimer=new Timer();this.spinnerTimer.Interval=80;paymentInfoAvailable=false;paymentInfoListener=null;application.events.subscribe(this,"titlecheckoutwheelchanged",this.handleSettingWheelChange.bind(this));application.events.subscribe(this,"redeemed",this.onRedeemed.bind(this))},activate:function(){navigation.setFocusElement($("checkoutpanel").getElement(".default"),true);this.isActive=true},deactivate:function(){if(this.isActive){this.isActive=false}},cleanUI:function(){if($("checkout_container")){if($("checkout_container").getChildren().length>0){$("checkout_container").getChildren().destroy()}}},loadView:function(d){this.tpl=new ui.template("checkout_container",application.ui.loadTpl(d));this.tpl.compile()},getTitleObject:function(){return $cn.data.TitleDetailCache[this.persist.titleID]},showSummaryItem:function(d){if(document.getElementById(d)){$(d).removeClass("hidden")}$$("."+d).removeClass("hidden")},loadData:function(n){var m,k,h,e,l,d,j,f,p;this.paymentInfoAvailable=false;this.paymentInfoListener=null;this.couponCode=0;this.discountAmount=0;this.persist.titleID=n.titleID;k=this.getTitleObject();for(m=0;m<k.availableProducts.length;m++){if(k.availableProducts[m].skuID==n.selectedvalue){this.persist.sku=k.availableProducts[m]}}h=this.persist.sku;e=k.show?k.show:k.name;l=k.episode?k.episode:"";d="";if(k.titleType=="TV_Episode"){d='"'+k.name+'"';$("checkout_container").addClass("episode")}else{$("checkout_container").removeClass("episode")}var q={sku:h.skuID,name:e.ellipsToPixels(233),season:l,episode:d,titleID:k.titleID,mPAARating:k.mPAARating,loyalty_rent:$cn.utilities.getMeta("LoyaltyPointsForRent",k.metaValues),loyalty_buy:$cn.utilities.getMeta("LoyaltyPointsForBuy",k.metaValues),isHD:false,message:""};this.tpl.empty();this.tpl.append(q);this.tpl.apply();if(h.skuType.indexOf("HD")>-1){$("1080phd").removeClass("hidden");q.isHD=true}var g=false;for(m=0;m<k.metaValues.length;m++){if(k.metaValues[m].keyName=="Extras"&&k.metaValues[m].keyValue=="True"){g=true}if(k.metaValues[m].keyName=="promoText"&&k.metaValues[m].keyValue!==""){$("promoText").removeClass("hidden")}}if(k.titleType=="Movie"){if(h.purchaseType=="rent"){$("singlePlayback").removeClass("hidden");this.showSummaryItem("checkoutRental");if(!q.isHD){this.showSummaryItem("checkoutRentalSD")}j=$cn.utilities.getMeta("LoyaltyPointsForRent",k.metaValues);if(j!==""&&parseInt(j,10)>0){$("loyaltyrent").removeClass("hidden")}}else{if(h.purchaseType=="buy"&&h.skuType.indexOf("Upgrade")!=-1){$("checkout_top").getElement(".title").innerHTML=k.name.ellipsToPixels(100)+" - Disc to Digital Version";$$(".d2dCheckout").removeClass("hidden")}else{if(h.purchaseType=="buy"){this.showSummaryItem("ownIt");$("multiPlayback").removeClass("hidden");if(g){$("digitalextras").removeClass("hidden")}f=$cn.utilities.getMeta("LoyaltyPointsForBuy",k.metaValues);if(f!==""&&parseInt(f,10)>0){$("loyaltybuy").removeClass("hidden")}p=this.skuIsUv();if($cn.utilities.isTrue(p)&&$("uvPlayback")){$("uvPlayback").removeClass("hidden")}}}}}else{if(k.titleType=="TV_Episode"){$("multiPlayback").removeClass("hidden");this.showSummaryItem("ownIt");if(g){$("digitalextras").removeClass("hidden")}}}application.currentView.layoutIsDirty=true;$("checkout_container").show();$cn.methods.lookupPurchaseDetailsForTitle(k.titleID,function(r){$cn.methods.getBillingInfo(this.onBillingInfoLoaded.bind(this));if(r.responseCode==31){r.isAvailable=false;r.state="Not_Owned";r.errorHandled=true}this.inLibrary=r.isAvailable;if(r.state!="Not_Owned"){var s=this.getTitleObject();this.persist.passID=r.passID;if(s.show){application.putInnerHTML($("checkout_message"),application.resource.ownership_state.tv_title[r.state])}else{application.putInnerHTML($("checkout_message"),application.resource.ownership_state.title[r.state])}}}.bind(this))},titleInLibrary:function(){return this.inLibrary},skuIsUv:function(){var d=$cn.utilities.isTrue($cn.utilities.getMeta("HasUV",this.getTitleObject().metaValues)),e="not set";if(d){e=$cn.utilities.isTrue(this.getPersist().sku.isUV)}log.write("This "+(d?"is":"is not")+" a UV title");log.write("This "+(e?"is":"is not")+"a UV sku");return d&&e},skuIsD2D:function(){if($cn.config.EnableD2D&&$cn.config.DeviceD2DEnabled){log.write("TEST d2d");var d=this.getPersist();log.write(JSON.stringify(d));return(d.sku.skuType.indexOf("Upgrade")!=-1)}else{return false}},checkD2DValid:function(){var d=1;return $cn.data.d2dTitleInfo.validDisc!=d},goCheckOut:function(e){var d=this;if(d.titleInLibrary()&&!e){if(d.skuIsUv()){d.checkIfUserOwnsUvTitle(d.showAlreadyPurchasedModal.bind(d))}else{d.showAlreadyPurchasedModal()}}else{if($cn.config.EnableUV&&$cn.config.EnableUVPurchases&&d.skuIsUv()){if(typeof this.UV==="undefined"){this.UV=new $cn.utilities.UserUVManager("CheckoutPanel")}$cn.methods.verifyAuthToken(function(f){if(f){d.UV.checkUVAccount(function(g){if(g){d.buyItemInStore()}},true)}else{BrowseView.showActivate()}})}else{d.buyItemInStore()}}},showWarningModal:function(f){var d=this;log.write("messageObj is: "+JSON.stringify(f));log.write("real warning modal");var e={Message:f.Message,Content:f.Content,OK:f.OK,Close:f.Cancel,callback:function(g){if(g){d.goCheckOut()}}.bind(d)};BrowseView.showMessage("message_okcancel_vert",e)},buyItemInStore:function(){BrowseView.goCheckOut(this.getPersist().titleID,this.getPersist().sku.skuID,this.couponCode)},showSimilarPurchaseD2DModal:function(g){var f=application.resource.d2d_messages.already_own,d=this,e={Message:f.Message,Content:f.Content.replace(/##title##/g,this.getTitleObject().name).replace("##libTitle##",g.name).replace("##price##",this.persist.sku.price),Close:f.Cancel,OK:f.OK,Class:"similarD2DModal",callback:function(h){if(h){d.goCheckOut(true)}}};BrowseView.showMessage("message_okcancel",e)},showAlreadyPurchasedModal:function(d){var h,e=this,g=this.getPersist();if(d){h=application.resource.uv_messages.already_own}else{h=application.resource.already_purchased}var f={Message:h.Message,Content:h.Content,OK:h.OK,Close:h.Cancel,Action:h.Action,callback:function(j){switch(j){case"buy":e.goCheckOut(true);break;case"play":BrowseView.MessagePopupCached.startPlay(g.titleID,g.passID);break}}};BrowseView.showMessage("message_alreadyownuv",f)},checkIfUserOwnsUvTitle:function(d){$cn.methods.getPurchasedTitle(this.persist.passID,this.persist.titleID,function(e){var f=$cn.utilities.isTrue(e.isPassUV);d(f)})},checkUVOwnership:function(){var d=true;if(d){var e={Message:application.resource.uv_messages.already_own.Message,Content:application.resource.uv_messages.already_own.Content,OK:application.resource.uv_messages.already_own.OK,Close:application.resource.uv_messages.already_own.Cancel,Action:application.resource.uv_messages.already_own.Action,callback:function(f){}.bind(this)};BrowseView.showMessage("message_alreadyownuv",e)}else{BrowseView.goCheckOut(this.persist.titleID,this.persist.sku.skuID,this.couponCode)}},goPaymentBreakdown:function(){if(!this.paymentInfoAvailable){log.write("--- payment info not yet available, setting listener ---");this.loadingTimer=$cn.utilities.showLoadingModal(2000,"Loading Payment Info...");this.paymentInfoListener=this.goPaymentBreakdown;return}var d=this;$cn.methods.verifyAuthToken(function(e){if(e){d.showPaymentBreakdown()}else{BrowseView.showActivate()}}.bind(this))},showPaymentBreakdown:function(){var k,g;$cn.utilities.clearLoadingSpinner(this.loadingTimer);var e=0;var h="",f="";if((this.purchaseDetails.amount_tax>0&&this.purchaseDetails.amount_tax!=="")||($cn.config.EnableTaxAPI&&this.purchaseDetails.amount_tax!=0)){h="";f=""}else{if($cn.config.EnableTaxAPI){h='<span class="white"> * </span>';f='<tr><td colspan="2" align="right" style="height:50px">'+application.resource.tax_string+"</td></tr>"}}var j='<table width="90%" align="center">';j+='<tr><td align="left">Item Subtotal:</td><td align="right">'+application.resource.currency_symbol+this.purchaseDetails.amount_subtotal+"</td></tr>";if(this.purchaseDetails.amount_giftcard_remaining>0){k=(parseFloat(this.purchaseDetails.amount_giftcard)-parseFloat(this.purchaseDetails.amount_coupon)).toFixed(2);g=(parseFloat(this.purchaseDetails.amount_giftcard_remaining)-k).toFixed(2);j+='<tr><td align="left">Gift Card(s) ('+application.resource.currency_symbol+g+' remaining):</td><td align="right">-'+application.resource.currency_symbol+k+"</td></tr>"}if(this.purchaseDetails.amount_coupon>0){j+='<tr><td align="left">Coupon(s):</td><td align="right">-'+application.resource.currency_symbol+this.purchaseDetails.amount_coupon+"</td></tr>"}if(this.purchaseDetails.amount_tax!=0){j+='<tr><td align="left">Applicable Tax:</td><td align="right">'+application.resource.currency_symbol+this.purchaseDetails.amount_tax+"</td></tr>"}j+='<tr><td colspan="2">&nbsp;</td></tr>';j+='<tr><td align="left" class="white">Total to '+this.purchaseDetails.total_confirm+": "+h+'</td><td class="white" align="right">'+application.resource.currency_symbol+this.purchaseDetails.amount_total+"</td></tr>";j+='<tr><td colspan="2">&nbsp;</td></tr>';if(this.purchaseDetails.lastfour&&this.purchaseDetails.lastfour.length>0){j+='<tr><td align="left">Credit Card ending in '+this.purchaseDetails.lastfour+':</td><td align="right">'+application.resource.currency_symbol+this.purchaseDetails.amount_total+"</td></tr>"}else{j+='<tr><td align="left">Credit Card:</td><td align="right">'+application.resource.currency_symbol+this.purchaseDetails.amount_total+"</td></tr>"}j+='<tr><td colspan="2">&nbsp;</td></tr>';j+=f;j+="</table>";var d={id:"tmp"};application.events.subscribe(d,"navigate",function(l){l.preventDefault();log.write("Blocked navigation per 2011 bug.")});BrowseView.showMessage("payment_table_popup",{Message:"PAYMENT BREAKDOWN",Content:j,OK:"Close",callback:function(l){log.write("back: "+l);application.events.unsubscribe(d,"navigate")}.bind(this)})},onBillingInfoLoaded:function(l){if(l.responseCode==31){l.giftCertificateBalance=0;l.cCLast4="";l.errorHandled=true}var d=0,j=l.giftCertificateBalance,h=Math.round(this.persist.sku.price*100),g,f=this.persist.sku,k,e,m;switch(f.purchaseType){case"any":case"buy":k=application.resource.confirmation.buy[this.getTitleObject().titleType];break;case"rent":k=application.resource.confirmation.rent;k=k.replace("{Period}",f.rentalPeriod);break}if(f.skuType.indexOf("HD")>-1){k+=application.resource.confirmation.hd}m=(l.cCLast4&&l.cCLast4.length>0)?" "+l.cCLast4:"";$cn.methods.calcOrderTax(this.persist.sku.skuID,null,function(n){if(l.responseCode==31){n.subTotal=0;n.tax=0;n.errorHandled=true}var q,p;h=n.subTotal>0?Math.round(n.subTotal*100):h;g=h+Math.round(n.tax*100)-this.discountAmount;if(g>0){d=Math.min(j,g);g-=d}else{g=0}this.purchaseDetails={amount_subtotal:$cn.utilities.formatAsMoney(h),amount_tax:$cn.utilities.formatAsMoney(n.tax*100),amount_coupon:$cn.utilities.formatAsMoney(this.discountAmount),amount_giftcard:$cn.utilities.formatAsMoney(this.discountAmount+d),amount_total_discount:$cn.utilities.formatAsMoney(this.discountAmount+d),amount_giftcard_remaining:$cn.utilities.formatAsMoney(j),amount_creditcard:$cn.utilities.formatAsMoney(g),amount_total:$cn.utilities.formatAsMoney(g),tax_string:application.resource.tax_string,lastfour:m,total_confirm:k};if(this.tplCart===null){this.tplCart=new ui.template("cartdetails",application.ui.loadTpl("cartdetails.tpl"))}else{this.tplCart.empty()}this.tplCart.append(this.purchaseDetails);this.tplCart.apply();p=$("cartdetails");if(document.getElementById("cartdetails")){if(this.discountAmount>0){if(0+j>0){p.getElements(".giftcard_coupon").show()}else{p.getElements(".coupon").show()}}else{if(d>0){p.getElements(".giftcard").show()}}q=$("giftcard_remaining");if(j<=0&&q){q.hide()}p.getElements(".taxes").hide();p.getElements("#taxesString").hide();p.getElement(".total .col1 span.white").hide();if((n.tax>0&&n.tax!=="")||($cn.config.EnableTaxAPI&&n.tax!==0)){p.getElements(".taxes").show()}else{if($cn.config.EnableTaxAPI){p.getElements("#taxesString").show();p.getElement(".total .col1 span.white").show()}}}this.paymentInfoAvailable=true;if(this.paymentInfoListener){log.write("--- was waiting for payment info, now firing ---");this.paymentInfoListener();this.paymentInfoListener=null}$("checkout1").addClass("placeorder")}.bind(this))},handleSettingWheelChange:function(e){var d=e.args[0];switch(d.name){case"buy":case"rent":this.loadView("checkout.buy");break;case"freepreview":this.loadView("checkout.freepreview");break}this.loadData(d)},show:function(){$("checkoutpanel").show();application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"activated",this.updateCheckoutPanelStatus.bind(this));if($cn.data.d2dPath){if(!this.checkD2DValid()){var e=application.resource.d2d_messages.invalid,d={Message:e.Message,Content:e.Content,Close:e.OK};BrowseView.showMessage("message_d2d_content",d)}BrowseView.CurrentProcessLoaded=true;$cn.data.d2dPath=false}},hide:function(){application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"activated");$("checkoutpanel").hide();log.write("enable buttons");this.deactivate()},getWarning:function(d){if(d=="R"||d=="NC17"||d=="NR"){$("movieWarning").removeClass("hidden");$("checkoutProductList").addClass("hidden")}else{if(d=="TVMA"){$("tvWarning").removeClass("hidden");$("checkoutProductList").addClass("hidden")}else{if(d=="MA"){$("matureWarning").removeClass("hidden");$("checkoutProductList").addClass("hidden")}}}},navigate:function(payload){var p=payload.args[0];if($("checkoutpanel").isParentOf($(p.current))){if(p.direction=="left"&&$(p.current).get("left")===null){this.deactivate();var focusID=$("singlewheel").offsetWidth?"singleselectedmaster":"tdbuttonCheckout";navigation.setFocus(focusID,true);payload.preventDefault()}else{if(p.direction=="right"&&$(p.current).get("right")===null){payload.preventDefault();if(!this.isNavigating){if($(p.current).get("rightaction")=="true"){eval("("+$(application.element.current).get("rightaction")+")")}}}}}},onRedeemed:function(d){if(d.args[0].coupon){this.couponCode=d.args[0].coupon;this.discountAmount=d.args[0].amount}$cn.methods.getBillingInfo(this.onBillingInfoLoaded.bind(this))},updateCheckoutPanelStatus:function(d){$cn.methods.lookupPurchaseDetailsForTitle(this.getTitleObject().titleID,function(e){$cn.methods.getBillingInfo(this.onBillingInfoLoaded.bind(this));this.inLibrary=e.isAvailable;if(e.state!="Not_Owned"){var f=this.getTitleObject();this.persist.passID=e.passID;if(f.show){application.putInnerHTML($("checkout_message"),application.resource.ownership_state.tv_title[e.state])}else{application.putInnerHTML($("checkout_message"),application.resource.ownership_state.title[e.state])}}}.bind(this))}},CheckoutPanelControl=new Class(CheckoutPanelControlProperties);var RatePopup=new Class({Extends:ModalControl,id:"ratepopup",persist:{},controls:{},layoutIsDirty:true,tpl:null,_rating:0,_titleID:null,initialize:function(d){this.parent("ratepopup");this.contentControlId="RateStars";application.events.subscribe(this,"elementfocus",this.focus.bind(this));application.events.subscribe(this,"navigate",this.navigate.bind(this))},setRate:function(d){this._rating=d;d=d.toString().replace(/\./,"");$("RateHolder").erase("class");$("RateHolder").addClass("rate"+d)},loadData:function(d){log.write(d);this._titleID=d[0].titleID;this.parent(d)},hideIfNoFlixster:function(){var d="";if(!$cn.data.flixsterEnable){d="hide"}return d},showIfNoFlixster:function(){var d="";if($cn.data.flixsterEnable){d="hide"}return d},saveRate:function(){var d=this;log.write("Saving rate: "+this._rating);$cn.methods.rateTitle(this._titleID,this._rating,function(e){d.hide();$("YourRating").hide();if($("tdbuttonRating").getChildren("span").length){$("tdbuttonRating").getFirst("span").set("html","Change Rating")}else{$("tdbuttonRating").set("html","Change Rating")}BrowseView.TitleViewControl.setUserRating(d._rating);BrowseView.TitleViewControl.drawStarRating(parseFloat(d._rating));$("ratingstar").removeClass("display_none")})},show:function(){$("ModalWindow").setAttribute("style","");this.parent();application.events.subscribe(this,"pointerRate",this.pointerRate.bind(this));application.events.subscribe(this,"pointeractivated",this.setFocus.bind(this));application.events.subscribe(this,"pointerdeactivated",this.setFocus.bind(this));this.setFocus()},hide:function(){BrowseView.TitleViewControl.showingRating=false;this.parent();application.events.unsubscribe(this,"pointerRate");application.events.unsubscribe(this,"pointeractivated");application.events.unsubscribe(this,"pointerdeactivated")},flashArrow:function(d){$("RatingLeftArrow").removeClass("hover");$("RatingRightArrow").removeClass("hover");if(d=="left"){$("RatingLeftArrow").addClass("hover")}else{$("RatingRightArrow").addClass("hover")}setTimeout(function(){$("RatingLeftArrow").removeClass("hover");$("RatingRightArrow").removeClass("hover")},200)},navigate:function(e){if(application.element.current=="RateControl"){if(e.args[0].direction=="left"||(e.args[0].direction=="right"&&(!e.args[0].keypressed||e.args[0].keypressed!=application.keys.KEY_ENTER))){e.preventDefault();var d=0;switch(e.args[0].direction){case"left":d=e.context._rating>0.5?e.context._rating-0.5:0.5;this.flashArrow(e.args[0].direction);break;case"right":d=e.context._rating<5?e.context._rating+0.5:5;this.flashArrow(e.args[0].direction);break}e.context.setRate(d)}else{if(e.args[0].keypressed&&e.args[0].keypressed==application.keys.KEY_ENTER){this.saveRate()}else{if(e.args[0].direction=="down"){$("RateStars").removeClass("focus")}}}}},pointerRate:function(e){if(application.element.current=="RatingLeftArrow"||application.element.current=="RatingRightArrow"){pointer.lastFocusId="RateControl";if(e.args[0].direction=="left"||e.args[0].direction=="right"){e.preventDefault();var d=0;switch(e.args[0].direction){case"left":d=e.context._rating>0.5?e.context._rating-0.5:0.5;break;case"right":d=e.context._rating<5?e.context._rating+0.5:5;break}e.context.setRate(d)}}},focus:function(d){if(d.args[0].focusedelem=="RateControl"){$("RateStars").addClass("focus")}},setFocus:function(){if(pointer.isPointerModeActive()){$("RateStars").removeClass("focus");pointer.lastFocusId="RateControl"}else{if(!$("RateCancel").hasClass("hover")&&!$("RateStars").hasClass("hover")){$("RateStars").addClass("focus");application.navigator.setFocus("RateControl",true)}}},setFocusTo:function(e,d){if(d){$(e).removeClass("hover")}else{$(e).addClass("hover");application.navigator.setFocus($(e),true)}},});var PinPopup=new Class({Extends:ModalControl,id:"pinpopup",_pinValues:[-1,-1,-1,-1],_currentIndex:0,show5:false,callback:null,hideCallback:null,count:4,initialize:function(){this.parent("pinpopup");this.count=this.show5?5:4},setPointerFocus:function(d){if(application.element.current!=("Pin"+d)){if(this._pinValues[d]==-1){if(d>0){if(this._pinValues[d-1]==-1){if(application.element.current){pointer.lastFocusId=application.element.current}navigation.setFocus(null);log.write("Pinpopup.setPointerFoucs setFocus to null.");return}}$("PinFocusUpMask").show();$("PinFocusDownMask").show();pointer.lastFocusId="Pin"+d;navigation.setFocus("Pin"+d);log.write("Pinpopup.setPointerFoucs setFocus to Pin"+d)}else{if(application.element.current){pointer.lastFocusId=application.element.current}navigation.setFocus(null)}}else{log.write("Pinpopup.setPointerFoucs Else.");pointer.lastFocusId="Pin"+d}},setPinCode:function(d){if(application.element.current==null||application.element.current.indexOf("Pin")==-1){return}if(d=="up"){if(this._pinValues[this._currentIndex]<9){this._pinValues[this._currentIndex]++}else{if(this._pinValues[this._currentIndex]==9){this._pinValues[this._currentIndex]=0}}}else{if(d=="down"){if(this._pinValues[this._currentIndex]>0){this._pinValues[this._currentIndex]--}else{if(this._pinValues[this._currentIndex]<=0){this._pinValues[this._currentIndex]=9}}}}$("Pin"+this._currentIndex).innerHTML=this._pinValues[this._currentIndex]==-1?"":this._pinValues[this._currentIndex]},clickPincodeField:function(e){if(("Pin"+e)==application.element.current){pointer.lastFocusId=application.element.current;if(this._pinValues[e]>-1){navigation.setFocus(null);return}else{return}}else{if(this._pinValues[e]>-1){$("PinFocusUpMask").show();$("PinFocusDownMask").show();for(var d=e;d<this.count;d++){this._pinValues[d]=-1;$("Pin"+d).innerHTML=""}log.write("clickPincodeField:  Pin"+e);pointer.lastFocusId="Pin"+e;navigation.setFocus("Pin"+e)}}},setPinFocusArrow:function(e,d){if(application.element.current==null||application.element.current.indexOf("Pin")==-1){return}$("PinFocusUp").show();$("PinFocusDown").show();if(e=="up"){if(d){$("PinFocusUp").addClass("hover")}else{$("PinFocusUp").removeClass("hover")}}else{if(e=="down"){if(d){$("PinFocusDown").addClass("hover")}else{$("PinFocusDown").removeClass("hover")}}}},select:function(e){if(application.element.current.indexOf("Pin")==0&&application.element.current.length==4){var d=this.show5?5:4;if(e.context._currentIndex<d){e.context._currentIndex++;if(e.context._currentIndex<d){e.context.moveFocusItems(e);navigation.setFocus("Pin"+e.context._currentIndex)}}if(e.context._currentIndex==d){e.context.checkPin()}}},flashArrow:function(d){$("PinFocusUp").removeClass("hover");$("PinFocusDown").removeClass("hover");if(d=="up"){$("PinFocusUp").addClass("hover")}else{$("PinFocusDown").addClass("hover")}setTimeout(function(){$("PinFocusUp").removeClass("hover");$("PinFocusDown").removeClass("hover")},200)},navigate:function(e){if(document.getElementById(application.element.current)&&$(application.element.current).hasClass("numeric")){e.preventDefault();var g=true;var d=this.show5?5:4;switch(e.args[0].direction){case"up":if(e.context._pinValues[e.context._currentIndex]<9){e.context._pinValues[e.context._currentIndex]++}else{if(e.context._pinValues[e.context._currentIndex]==9){e.context._pinValues[e.context._currentIndex]=0}}this.flashArrow(e.args[0].direction);break;case"down":if(e.context._pinValues[e.context._currentIndex]>0){e.context._pinValues[e.context._currentIndex]--}else{if(e.context._pinValues[e.context._currentIndex]<=0){e.context._pinValues[e.context._currentIndex]=9}}this.flashArrow(e.args[0].direction);break;case"left":if((application.element.current.replace(/Pin/,"")*1)>0){e.context._pinValues[e.context._currentIndex]=-1;e.context._pinValues[e.context._currentIndex-1]=-1;application.navigator.setFocus("Pin"+(e.context._currentIndex-1))}else{g=false;application.navigator.setFocus("PinCancel")}break;case"right":if((application.element.current.replace(/Pin/,"")*1)<(d-1)){if(e.context._pinValues[e.context._currentIndex]>-1){e.context._pinValues[e.context._currentIndex+1]=-1;application.navigator.setFocus("Pin"+(e.context._currentIndex+1))}}else{if(e.context._pinValues[e.context._currentIndex]!=-1){g=false;this.checkPin()}}break}if(g){var f=e.context._pinValues[e.context._currentIndex];document.getElementById(application.element.current).innerHTML=f==-1?"":f}}else{if(application.element.current=="PinCancel"&&e.args[0].direction=="right"){e.context._pinValues=[-1,-1,-1,-1];e.context._resetPins()}}},moveFocusItems:function(f){var d=parseInt(application.resource.pinPopup.left)+(f.context._currentIndex*102);var e=d-35;$("PinFocusUp").setStyle("left",d+"px");$("PinFocusDown").setStyle("left",d+"px");$("PinFocusUpMask").setStyle("left",e+"px");$("PinFocusDownMask").setStyle("left",e+"px")},focus:function(d){if(application.element.current.indexOf("Pin")==0&&application.element.current.length==4){d.context._currentIndex=application.element.current.replace(/Pin/,"")*1;log.write("Current Index: "+d.context._currentIndex);d.context._resetPins();if(d.context._pinValues[d.context._currentIndex]<0){d.context._pinValues[d.context._currentIndex]=-1}var e=d.context._pinValues[d.context._currentIndex];document.getElementById(application.element.current).innerHTML=e==-1?"":e;$("PinFocusUp").show();$("PinFocusDown").show();$("PinIncorrect").hide();$("PinNav").show();d.context.moveFocusItems(d)}if(application.element.current=="PinCancel"){$("PinFocusUp").hide();$("PinFocusDown").hide()}},show:function(){this._pinValues=[-1,-1,-1,-1];this.parent();this._resetPins();if(!pointer.isPointerModeActive()&&application.element.current.indexOf("Pin")==0){$("PinFocusUp").show();$("PinFocusDown").show()}$("PinIncorrect").hide();if(!this.show5){$("Pin4").getParent().hide()}else{$("Pin4").getParent().show()}application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"elementfocus",this.focus.bind(this));application.events.subscribe(this,"elementblur",this.blur.bind(this));application.events.subscribe(this,"back",this.handleBack.bind(this));application.events.subscribe(this,"keydown",this.handleKeyPress.bind(this));application.events.subscribe(this,"checkpin",this.checkPin.bind(this))},unsubEvents:function(){application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"elementfocus");application.events.unsubscribe(this,"elementblur");application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"keydown");application.events.unsubscribe(this,"checkpin")},handleBack:function(d){d.preventDefault();this.unsubEvents();this.hide()},handleKeyPress:function(d){if(document.getElementById(application.element.current)&&$(application.element.current).hasClass("numeric")){switch(d.args[0].event.keyCode){case application.keys.KEY_1:this.setCurrentVal(1,d);break;case application.keys.KEY_2:this.setCurrentVal(2,d);break;case application.keys.KEY_3:this.setCurrentVal(3,d);break;case application.keys.KEY_4:this.setCurrentVal(4,d);break;case application.keys.KEY_5:this.setCurrentVal(5,d);break;case application.keys.KEY_6:this.setCurrentVal(6,d);break;case application.keys.KEY_7:this.setCurrentVal(7,d);break;case application.keys.KEY_8:this.setCurrentVal(8,d);break;case application.keys.KEY_9:this.setCurrentVal(9,d);break;case application.keys.KEY_0:this.setCurrentVal(0,d);break;case application.keys.KEY_ENTER:if(this._pinValues[this._currentIndex]!=-1){this.select(d)}break;default:break}}},setCurrentVal:function(d,e){this._pinValues[this._currentIndex]=d;document.getElementById(application.element.current).innerHTML=d==-1?"":d;this.select(e)},blur:function(f){$("PinFocusUp").hide();$("PinFocusDown").hide();$("PinFocusUpMask").hide();$("PinFocusDownMask").hide();f.context._resetPins();var e=true;if(pointer.isPointerModeActive()){for(var d=0;d<this.count;d++){if(this._pinValues[d]==-1){e=false;break}}if(e){application.events.publish("checkpin")}}},_resetPins:function(){for(var d=0;d<5;d++){if(this._pinValues[d]>-1){$("Pin"+d).innerHTML="*"}else{$("Pin"+d).innerHTML=""}}},checkPin:function(){if(this.show5){this._pinValues[4]=""}$("Pin3").innerHTML="*";var e=this._pinValues.join("");this._pinValues=[-1,-1,-1,-1];var d=this;if(application.authSupported){application.isBusy=true;navigation.setFocusElement(null);$cn.methods.checkParentPin(e,function(f){application.isBusy=false;if(f){d._currentIndex=0;d.hide();d.unsubEvents();if(d.callback){d.callback.call(d)}}else{d._pinValues=[-1,-1,-1,-1];d._resetPins();d._currentIndex=0;if(!pointer.isPointerModeActive()){application.navigator.setFocus("Pin0")}else{pointer.lastFocusId="Pin0"}$("PinIncorrect").show();$("PinNav").hide()}})}else{d._pinValues=[-1,-1,-1,-1];d._resetPins();d._currentIndex=0;$(application.element.current).innerHTML=0;if(!pointer.isPointerModeActive()){application.navigator.setFocus("Pin0",true)}else{pointer.lastFocusId="Pin0"}$("PinIncorrect").show();$("PinNav").hide()}},hide:function(){this.unsubEvents();this.parent()},cancel:function(){this.hide()}});var ConfirmPopup=new Class({Extends:ModalControl,id:"confirmpopup",purchaseType:"buy",rentalLimit:"",initialize:function(){this.parent(this.id)},goLibrary:function(d,e){navigation.setFocusElement(null);$cn.methods.getPurchasedTitle(e,d,function(f){BrowseView.loadTitle(f,"");this.hide(function(){BrowseView.TitleViewControl.setFocus()})}.bind(this));BrowseView.setView("library-view")},startPlay:function(d,e){this.hide();this.parent(d,e)},setStatus:function(j,f,e,g,d){$("ConfirmationContainer").erase("class");$("ConfirmationContainer").addClass(j);$("ConfirmationContainer").addClass(f);$("ConfirmationContainer").addClass(e);if(g){$("ConfirmationContainer").addClass("hd")}if(d){$("ConfirmationContainer").addClass("surround")}var h="ConfirmPlay";switch(e){case"episode1":h="ConfirmPlayEpisode1";break;case"resume":h="ConfirmResumePlay";break}this.rentalLimit=(f.indexOf("rent")>-1)?f.replace("rent",""):"";this.purchaseType=j;this.firstFocus=h;this.layoutIsDirty=true;this.show()},hide:function(d){this.parent();$("ModalWindow").erase("style");if(d===null){d=function(){BrowseView.TitleViewControl.setFocus()}}BrowseView.expandTitleDetails(d)},show:function(){this.parent();var d=$("ConfirmationContainer").getSize();$("ModalWindow").setStyles({top:(($("uicontainer").clientHeight-d.y)/2)+"px",height:d.y+"px",visibility:"inherit"})}});var MessagePopup=new Class({Extends:ModalControl,id:"messagepopup",callback:null,spinnerPos:1,spinnerTimer:null,initialize:function(d){this.parent(d)},draw:function(){this.parent();var f=false;var d=-413;var g=-461;if(!f){d=-1004;g=-1052}if($(this.contentId).getElement(".spinnercontainer")){var e=this;this.spinnerTimer=new Timer();this.spinnerTimer.Interval=80;this.spinnerTimer.Tick=function(){if(document.getElementById("messagespinner")){e.spinnerPosition=(e.spinnerPosition+1)%16;var h=e.spinnerPosition*80*-1;var j=d;if(e.spinnerPosition>7){h=(e.spinnerPosition-8)*80*-1;j=g}var k=document.getElementById("messagespinner");k.style.backgroundPosition=parseInt(h)+"px "+j+"px"}}}},initSpinner:function(){log.write("Loading Data");application.IsBusy=true;this.spinnerPosition=1;this.spinnerTimer.Start()},deinitSpinner:function(){this.spinnerTimer.Stop()},loadData:function(d){this.callback=d.callback;this.parent([d])},show:function(e){var d=$("ModalWindow");d.setStyle("visibility","hidden");this.parent();var f=$("messagemodalwrap").getSize();if(!e){d.setStyles({top:(($("uicontainer").clientHeight-f.y)/2)+"px",height:f.y+"px",visibility:null})}else{d.setStyles({visibility:null})}if(this.spinnerTimer){this.initSpinner()}application.isBusy=true;application.events.subscribe(this,"blockednavigate",this.blockBusy.bind(this))},hide:function(d){this.parent();application.isBusy=false;if(this.spinnerTimer){this.deinitSpinner()}BrowseView.MessagePopupCached=BrowseView.MessagePopup;BrowseView.MessagePopup=null;$("ModalWindow").setStyles({top:null,height:null});log.write("Hiding modal, and now calling callback...");if(this.callback){this.callback(d)}BrowseView.MessagePopupCached=null;application.events.unsubscribe(this,"blockednavigate")},blockBusy:function(f){var e=document.getElementById("ModalWindow").getElementsByTagName("a"),g=false,d;for(d=0;d<e.length;d++){if(e[d].id==application.element.current){var f={event:f.args[0].event,direction:f.args[0].direction,current:application.element.current};application.events.publish("navigate",f);break}}}});var SpeedInterval;var SpeedPopup=new Class({Extends:ModalControl,Implements:ModalControl,id:"speedpopup",_pinValues:[0,0,0,0,0],_currentIndex:0,initialize:function(){this.parent("speedpopup")},startSpeedCheck:function(){$("SpeedTest").show();$("SpeedResult").hide();$("SpeedUpgrade").hide();SpeedInterval=BandwidthCheck.popupBandwidthCheck(this,this.onComplete,true)},showUpgrade:function(){$("SpeedTest").hide();$("SpeedResult").hide();$("SpeedUpgrade").show();navigation.setFocus("SpeedClose2",true)},hide:function(){this.parent();clearInterval(SpeedInterval);BrowseView.showingOtherModal=false;if(this.lastFocus==="transportStop"){BrowseView.TitleViewControl.setFocus()}},onComplete:function(f){if(document.getElementById("SpeedStatusMessage")){$("SpeedStatusMessage").set("html","Testing latency...");if(f){var g=f.split("?");log.write(f);switch(g[0]){case"Complete":log.write("Speedtest: "+$cn.data.bwTest.speedBytes+" bytes per sec.");$cn.data.speedchecked=true;var e=true;var h="SpeedResult1";if($cn.data.bwTest.speedBytes>0){if($cn.data.bwTest.speedBytes<$cn.config.SDMinimumBandwidth){h="SpeedResult1"}else{if($cn.data.bwTest.speedBytes<$cn.config.HDMinimumBandwidth){h="SpeedResult2"}else{h="SpeedResult3"}}}else{e=false}log.write("showing: "+h);if(e){var d=(parseInt($cn.data.bwTest.speedBytes*8/10000)/100)+" Mbps";$("SpeedDownload").set("html",d);$("SpeedDownload2").set("html",d);$("SpeedTest").hide();$("SpeedUpgrade").hide();$("SpeedResult").show();$(h).show();if($$("#modalcontrol.speedpopup").getStyle("display")!="none"){navigation.setFocus("SpeedUpgradeButton",true)}}break;case"ProgressUpdate":application.currentView.layoutIsDirty=true;$("SpeedStatusBar").setStyle("width",g[1]+"%");break;case"SpeedUpdate":$cn.data.bwTest.speedBytes=parseInt(g[1]);break}}else{if($cn.data.bwTest.calls>=10){clearInterval(SpeedInterval);$("SpeedTest").hide();$("SpeedResult").show();$("SpeedResult1").show()}$("SpeedDownload").set("html","22 Mbps");$("SpeedDownload2").set("html","22 Mbps");navigation.setFocus("SpeedUpgradeButton",true);application.currentView.layoutIsDirty=true;$("SpeedStatusBar").setStyle("width",($cn.data.bwTest.calls*10)+"%");$cn.data.bwTest.calls++}}}});var SystemStatusPopup=new Class({Extends:ModalControl,Implements:ModalControl,startTime:null,id:"systemstatuspopup",slownessTimeout:null,slownessCheckupInterval:null,testsToPerformIndep:[{funName:"testBandwidth",defaultString:"0",htmlLocation:"#SystemStatus .bwResults .theResult",htmlLocation2:"#SystemStatus .bwSummary .theResult",completed:false,result:null},{funName:"testConnectionType",defaultString:"Not Connected",htmlLocation:"#SystemStatus .connectionResults .theResult",completed:false,result:null},{funName:"testActivationStatus",defaultString:"Not Connected",htmlLocation:"#SystemStatus .activationResults .theResult",completed:false,result:null}],testsToPerformDep:[{funName:"testIpAddress",defaultString:"Not Connected",htmlLocation:"#SystemStatus .ipResults .theResult",completed:false,result:null},{funName:"testEmailAddress",defaultString:"Not Activated",htmlLocation:"#SystemStatus .emailResults .theResult",completed:false,result:null},{funName:"testResConnection",defaultString:"Not Connected",htmlLocation:"#SystemStatus .resResults .theResult",completed:false,result:null}],_currentIndex:0,initialize:function(){this.parent("systemstatuspopup");this.storeTestsAsData(this.testsToPerformDep,this.testsToPerformIndep)},storeTestsAsData:function(){var e,d;$cn.data.SystemTests=[];for(e=0;e<arguments.length;++e){for(d=0;d<arguments[e].length;++d){$cn.data.SystemTests.push(arguments[e][d])}}},start:function(){this.testingFinished=false;this.clearPreviousResults();this.clearCompletedTests(this.testsToPerformIndep,this.testsToPerformDep);this.runTests(this.testsToPerformIndep);this.showResultsPanel();if($cn.config.SystemStatusTimeoutS){this.setSlownessTimeout($cn.config.SystemStatusTimeoutS)}else{log.write("XXXXXXXXXXX Warning XXXXXXXXXXXXXX");log.write("You are showing the System Status Popup without setting a timeout!!!");log.write("XXXXXXXXXXX Warning XXXXXXXXXXXXXX")}this.setSlownessCheckupInterval()},setSlownessTimeout:function(e){var d=this;this.slownessTimeout=setTimeout(function(){d.testingDone()},e*1000)},setSlownessCheckupInterval:function(){var d=$("SystemTestTimeRemaining");$cn.data.bwTest.intervalUpdated=true;this.slownessCheckupInterval=setInterval(function(){var e=parseInt(d.innerHTML,10)+1;if(!$cn.data.bwTest.intervalUpdated){d.innerHTML=e>$cn.config.SystemStatusTimeoutS?$cn.config.SystemStatusTimeoutS:e}$cn.data.bwTest.intervalUpdated=false},1000)},showResultsPanel:function(){$$("#settingspanel .systemstatuscotainer").hide();$$("#settingspanel .systemstatusresults").show()},clearPreviousResults:function(){$$("#SystemStatus .systemstatusresults .theResult").each(function(d){d.innerHTML=""})},clearCompletedTests:function(){var e,d;for(e=0;e<arguments.length;++e){for(d=0;d<arguments[e].length;++d){arguments[e][d].completed=false;arguments[e][d].result=null;this.setDefaultForTest(arguments[e][d])}}},runTests:function(e){var d;for(d=0;d<e.length;++d){this[e[d].funName](e[d].funName)}},testDone:function(d){var g,f,e=0,h=[this.testsToPerformIndep,this.testsToPerformDep],k=0;log.write("completed test "+d);this.getTest(d).completed=true;for(g=0;g<h.length;++g){k=k+h[g].length}for(g=0;g<h.length;++g){for(f=0;f<h[g].length;++f){if(h[g][f].completed){e=e+1}}}log.write(e+" tests done out of "+k);if(e===k){this.testingDone()}},getTest:function(d){var e;for(e=0;e<this.testsToPerformIndep.length;++e){if(d===this.testsToPerformIndep[e].funName){return this.testsToPerformIndep[e]}}for(e=0;e<this.testsToPerformDep.length;++e){if(d===this.testsToPerformDep[e].funName){return this.testsToPerformDep[e]}}return null},setString:function(d,e){log.write("###########");log.write("Setting: "+d+" to: "+e);log.write("###########");$$(d).set("html",e)},setDefaultForTest:function(d){this.setString(d.htmlLocation,d.defaultString)},setStringForTest:function(e,d){this.setString(e.htmlLocation,d)},testBandwidth:function(d){var e,f=this.getTest(d);log.write("test BW "+d+" begin");this.setString(f.htmlLocation2,"");BandwidthCheck.popupBandwidthCheck(this,this.onBwTestUpdate,false)},testConnectionType:function(d){var e=-1;var f=this.getTest(d);log.write("test Connection "+d+" begin");if($cn.utilities.Network.GetActiveType){e=$cn.utilities.Network.GetActiveType()}else{if(device.backupIPConnectionSupported){e=1}}this.testIpAddress("testIpAddress",e);switch(e){case -1:e=application.resource.testing_messages.connectionType.none;break;case 0:e=application.resource.testing_messages.connectionType.wireless;break;case 1:e=application.resource.testing_messages.connectionType.wired;break;default:e=application.resource.testing_messages.connectionType.unknown;break}log.write("your connection is: "+e);f.result=e;this.testDone(d)},testActivationStatus:function(d){var e=this,f=this.getTest(d);log.write("test Activation "+d+" begin");$cn.methods.verifyAuthToken(function(g){f.result=g?application.resource.testing_messages.activated:application.resource.testing_messages.notActivated;e.testResConnection("testResConnection");e.testEmailAddress("testEmailAddress",g);e.testDone(d)},true)},testIpAddress:function(d,f){var e="Unknown",g=this.getTest(d);log.write("test IP "+d+" begin");switch(f){case 0:case 1:log.write("about to get IP");if($cn.utilities.Network.GetIP){log.write("getting ip for connection type: "+f);e=$cn.utilities.Network.GetIP(f)}else{if(device.backupIPConnectionSupported){e="127.0.0.1"}}break}g.result=e;log.write("your ip address is: "+e);this.testDone(d)},testEmailAddress:function(e,d){var f=this,g=this.getTest(e);log.write("test Email "+e+" begin");if(d){$cn.methods.loadToken(function(){if($cn.data.UserEmailAddress){g.result=$cn.data.UserEmailAddress}f.testDone(e)},true)}else{g.result=g.defaultString;f.testDone(e)}},testResConnection:function(d){var e=this.getTest(d);log.write("test RES "+d+" begin");e.result=application.resource.testing_messages.connected;this.testDone(d)},testingDone:function(){this.testingFinished=true;log.write("$$$$ done with all tests");if(this.slownessTimeout){clearTimeout(this.slownessTimeout)}if(this.slownessCheckupInterval){clearInterval(this.slownessCheckupInterval)}if(!this.getTest("testBandwidth").completed){BrowseView.bwMessage()}this.hide()},onBwTestUpdate:function(h){var f=$("SystemStatusBar"),d=$("SystemTestTimeRemaining"),e,g,k,l;if(f){$("SystemStatusMessage").set("html",application.resource.testing_messages.testingBandwidth);if(h){var j=h.split("?");log.write(h);switch(j[0]){case"Complete":log.write("Speedtest: "+$cn.data.bwTest.speedBytes+" bytes per sec.");log.debug("Speedtest: "+$cn.data.bwTest.speedBytes+" bytes per sec.");l=$cn.data.bwTest.self.getTest("testBandwidth");l.result=parseInt($cn.data.bwTest.speedBytes*8/10000,10)/100;$cn.data.bwTest.self.testDone("testBandwidth");if(!this.testingFinished){BrowseView.bwMessage()}break;case"ProgressUpdate":$cn.data.bwTest.intervalUpdated=true;application.currentView.layoutIsDirty=true;f.setStyle("width",j[1]+"%");e=(new Date()-$cn.data.bwTest.self.startTime)/1000;if(j[1]!=0){g=100-j[1];k=e/j[1];d.innerHTML=Math.ceil(g*k)}break;case"SpeedUpdate":$cn.data.bwTest.intervalUpdated=true;$cn.data.bwTest.speedBytes=parseInt(j[1]);break}}else{$cn.data.bwTest.intervalUpdated=true;if($cn.data.bwTest.calls>=10){l=$cn.data.bwTest.self.getTest("testBandwidth");l.result=parseInt($cn.data.bwTest.speedBytes*8/10000,10)/100;$cn.data.bwTest.self.testDone("testBandwidth")}BrowseView.bwMessage();application.currentView.layoutIsDirty=true;$("SystemStatusBar").setStyle("width",($cn.data.bwTest.calls*10)+"%");$cn.data.bwTest.calls++}}},hide:function(){this.parent();this.updateHtmlWithResults();this.showWarningMarks();this.setCorrectFocus()},updateHtmlWithResults:function(){var d,e;for(d=0;d<$cn.data.SystemTests.length;++d){e=$cn.data.SystemTests[d];if(e.completed){this.setStringForTest(e,e.result)}}},showWarningMarks:function(){var f,e=false,d=application.resource.testing_messages;$cn.data.SystemTests.moreDetails={};$cn.data.SystemTests.moreDetails.data={};$cn.data.SystemTests.informativeText="";f=this.getTest("testConnectionType");if(f.result===d.connectionType.wireless||f.result===d.connectionType.none){e=true;this.makeWarningVisible(f);$cn.data.SystemTests.informativeText+=d.connectionHeading.replace("##type##",f.result)+d.connectionInfo[f.result]+"<br/><br/>"}f=this.getTest("testActivationStatus");if(f.result===application.resource.testing_messages.notActivated){e=true;this.makeWarningVisible(f);$cn.data.SystemTests.informativeText+=d.activationHeading.replace("##status##",f.result)+d.activationInfo+"<br/><br/>"}f=this.getTest("testResConnection");if(f.result===f.defaultString){e=true;this.makeWarningVisible(f);$cn.data.SystemTests.informativeText+=d.storeHeading.replace("##status##",f.result)+d.storeInfo+"<br/><br/>"}if(e){$$(".systemstatusresults #results-more-details").setStyle("display","inline-block")}},makeWarningVisible:function(d){$$(d.htmlLocation).getNext("span").setStyle("display","inline-block")},setCorrectFocus:function(){if($("results-more-details").getStyle("display")!=="none"){application.navigator.setFocus("results-more-details",true)}else{application.navigator.setFocus("results-test-again",true)}}});var WishListProperties={id:"wishlistpanel",isActive:false,currentFilter:null,currentPosition:0,tpl:null,initialize:function(){log.write(this.id+".init()");application.events.subscribe(this,"wheelitemchanged",this.handleWheelItemChange.bind(this));application.events.subscribe(this,"gridloaded",this.handleGridLoaded.bind(this));application.events.subscribe(this,"wishlistitem",this.showOptions.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this))},handleGridLoaded:function(e){if(BrowseView.currentState=="wishlist-view"){if(this.lastSelectedItem&&this.lastSelectedItem!=""){var d=$("titlelist");var f=d.getElement("a[titleid='"+this.lastSelectedItem+"']");if(f){navigation.setFocus(f.id,true)}else{log.write("handling grid loaded by setting focuse to wheel");navigation.setFocus("singleselectedmaster",true)}this.lastSelectedItem=""}}},handleWheelItemChange:function(e){if(this.WishlistWheelControl===ActiveWheel){var d=e.args[0];log.write("Selected value: "+d.selectedvalue);this.loadList(d.selectedvalue)}},hide:function(){this.isActive=false},loadList:function(e){if(BrowseView.currentState=="wishlist-view"){var d=this;this.filter=e;if($cn.data.AuthToken!=""){if(this.data&&this.data[e]){this.currentFilter=e;BrowseView.LastGridProcess="wishlist";application.events.publish("loadgrid",{grid:"titlegrid",data:this.data[e],gridProcess:"wishlist",position:this.currentPosition,columns:4,template:"wishlist",className:"wishlistgrid"});$("messagepanel").hide();$("titlegrid").show()}else{$("titlegrid").hide();d.showMessage("wishlist_empty")}}else{$("singlewheel").hide();$("titlegrid").hide();this.showMessage("wishlist_notactivated")}this.currentPosition=0}},loadWheel:function(){var d={},e;this.lastSelectedItem="";if(this.stateRestored==true){if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastSelectedItem=$(application.element.current).get("titleid")}}e=$cn.utilities.showLoadingModal(0,application.resource.loading_enum.loadingwishlist);$cn.methods.getWishlist("Movie",function(f){log.write("getWishList callback is being executed");if(BrowseView.currentState=="wishlist-view"){if(f.items&&f.items.length){d.Movie=f.items}$cn.methods.getWishlist("TV_Show",function(g){$cn.utilities.clearLoadingSpinner(e);if(BrowseView.currentState=="wishlist-view"){if(g.items&&g.items.length){d.TV_Show=g.items}var h=[];if(d.Movie){h.push({name:"Movies",iD:"Movie",parentID:0})}if(d.TV_Show){h.push({name:"TV Shows",iD:"TV_Show",parentID:0})}if(h.length){log.write("Loading wishlist wheel!");this.data=d;$("singlewheel").show();this.WishlistWheelControl.activate();this.WishlistWheelControl.loadData(h,this.currentFilter);if(application.element.current==="singleselectedmaster"){navigation.setFocus("singleselectedmaster",true)}}else{$("singlewheel").hide();this.showMessage("wishlist_empty")}}}.bind(this))}else{$cn.utilities.clearLoadingSpinner(e)}}.bind(this))},loadWheelExt:function(){var d={},e=null;this.lastSelectedItem="";if(this.stateRestored==true){if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastSelectedItem=$(application.element.current).get("titleid")}}e=$cn.utilities.showLoadingModal(0,application.resource.loading_enum.loadingwishlist);$cn.methods.getWishlistExt("All",function(f){$cn.utilities.clearLoadingSpinner(e);if(BrowseView.currentState=="wishlist-view"){var h=[];if(f.items&&f.items.length){d.Movie=[];d.TV_Show=[];var g;for(g=0;g<f.items.length;g++){if(f.items[g].titleClassification=="Movie"){d.Movie.push(f.items[g])}else{d.TV_Show.push(f.items[g])}}if(d.Movie.length>0){h.push({name:"Movies",iD:"Movie",parentID:0})}if(d.TV_Show.length>0){h.push({name:"TV Shows",iD:"TV_Show",parentID:0})}}if(h.length){log.write("Loading wishlist wheel!");this.data=d;$("singlewheel").show();this.WishlistWheelControl.activate();this.WishlistWheelControl.loadData(h,this.currentFilter);if(application.element.current==="singleselectedmaster"){navigation.setFocus("singleselectedmaster",true)}}else{$("singlewheel").hide();this.showMessage("wishlist_empty")}}}.bind(this))},setFocus:function(){setTimeout(function(){if($("singlewheel").offsetWidth){navigation.setFocus("singleselectedmaster",true)}else{var d=$("messagepanel").getElement("a.default");if(d){navigation.setFocus(d,true)}}},100)},show:function(){this.isActive=true;this.currentFilter=null;this.currentPosition=0;this.stateRestored=false;if(!this.WishlistWheelControl){this.WishlistWheelControl=new WishlistWheelControl()}if($cn.data.AuthToken!=""){navigation.setFocus("singleselectedmaster",true);this.loadWheelExt()}else{this.showMessage("wishlist_notactivated",true)}},showMessage:function(d){if(this.tpl!=null){this.tpl.empty()}this.tpl=new ui.template("messagepanel",application.ui.loadTpl(d+".tpl"));this.tpl.compile();this.tpl.append();this.tpl.apply();var e=$("messagepanel_container");e.erase("class");e.addClass(d);log.write("showing message panel ("+d+")");$("messagepanel").show();this.setFocus()},showOptions:function(d){$cn.methods.getTitleListing(d.args[0].id,true,function(l){var f=l.name,k="",j="",h=null,g=(l.availableProducts.length)?"wishlist_options_buy":"wishlist_options",e,m=$cn.config.HighlightColor?$cn.config.HighlightColor:"#FFFFFF";if(l.titleType=="Movie"){h=$cn.utilities.purchaseText(l)}else{h=application.resource.buy_text[l.titleType];if(l.titleType=="TV_Episode"){f=$cn.utilities.getMeta("ShowName",l.metaValues);k=$cn.utilities.getMeta("SeasonName",l.metaValues);if(k.length>0){k+=", "}k+=$cn.utilities.getMeta("EpisodeNumber",l.metaValues);j='"'+l.name+'"'}else{if(l.titleType=="TV_Season"){f=$cn.utilities.getMeta("ShowName",l.metaValues);k=l.name}}}e=$cn.utilities.getMeta("PromoString",l.metaValues);if(e.length){h=h+" "+e}f=$cn.utilities.ellipsis(f,30);BrowseView.showMessage(g,{Title:'<span style="color:'+m+'">'+f+"</span>",Season:k,Episode:j,TitleID:l.titleID,mPAARating:l.mPAARating,PurchaseText:h,Index:BrowseView.GridControl.itemidx})})},showPurchase:function(d){BrowseView.MessagePopup.hide();application.TempKeyBlock=true;application.TempKeyBlockDuration=2500;application.events.publish("loadtitleview",{id:d,action:"checkout"})},showDetail:function(d){BrowseView.MessagePopup.hide();application.TempKeyBlock=true;application.TempKeyBlockDuration=2500;application.events.publish("loadtitleview",{id:d})},remove:function(f,d){BrowseView.MessagePopup.hide();var e=function(g){if(g.responseCode==0){BrowseView.GridControl.remove(d);if(BrowseView.GridControl.itemCount()==0){$("titlegrid").hide();this.show()}}};log.write("Wishlist.remove: titleId: "+f+"   index: "+d+"   count: "+BrowseView.GridControl.itemCount());$cn.methods.removeItemFromWishList(f,e.bind(this))},onActivate:function(){BrowseView.showActivate({callback:function(){this.show();this.setFocus()}.bind(this)})},onSaveState:function(f){var e=f.args[0];var d=0;if(this.isActive&&this.currentFilter){d=BrowseView.GridControl.getPosition()}e[this.id]={isActive:this.isActive,currentFilter:this.currentFilter,currentPosition:d}},onRestoreState:function(e){var d=e.args[0];if(d.store.currentState=="wishlist-view"){d=d[this.id];$extend(this,d);if(this.isActive){$("messagepanel").hide();$("scrollbar").hide();$("titlegrid").hide();$("singlewheel").hide();if($cn.data.AuthToken!=""){this.stateRestored=true;this.loadWheelExt();if(application.element.current==null){navigation.setFocus("singleselectedmaster",true)}}else{this.showMessage("wishlist_notactivated")}}}else{this.isActive=false}}},WishList=new Class(WishListProperties);var WishlistWheelControlProperties={Extends:WheelControl,Implements:WheelControl,id:"WishlistWheelControl",container:"singlewheel",singleWheel:true,MetaData:[],masterSourceElement:"singlemasterdatasource",masterSelectedElement:"singleselectedmaster",cleanUI:function(){if($("singleselectedmaster")){$("singleselectedmaster").label=""}if($("singlemasterdatasource")){if($("singlemasterdatasource").getChildren().length>0){$("singlemasterdatasource").getChildren().destroy()}}},handleWheelItemChange:function(d){log.write(d)},loadData:function(g,f){var d=0;if(f){for(var e=0;e<g.length;++e){if(g[e].iD==f){d=e;break}}}this.cleanUI();this._masterSource=g;this._renderWheel($(this.masterSourceElement),this._masterSource,d)}},WishlistWheelControl=new Class(WishlistWheelControlProperties);var LegalPopup=new Class({Extends:ModalControl,scrollview:null,initialize:function(d){this.parent(d)},setCssClass:function(e){var d=(e=="uvtermsofservice"?e:"legal");this.parent(d)},draw:function(){this.parent();var d=$(this.contentId).getElement(".scroll");if(d){this.scrollview=new ScrollView(d)}},show:function(d){if(d){this.theCallback=d}this.parent();if(this.scrollview){this.scrollview.draw()}},hide:function(){this.parent();if(this.scrollview){this.scrollview.destroy()}if(this.theCallback){this.theCallback()}},onBack:function(d){if(this.id=="eula"){d.preventDefault()}else{this.parent(d)}}});var PlayerControlProperties={id:"player",debug:false,debugAsset:"http://edge.cinemanow.com.edgesuite.net/adaptive/studio/tyson_5f09d885_wv_SD_TRAILER.vob|DEVICE_ID=dev12345|STREAM_ID=strm1234|IP_ADDR=vmes4|DRM_URL=https://fcpstage.shibboleth.tv/widevine/cypherpc/cgi-bin/GetEMMs.cgi|ACK_URL=http://vmes4/cgi-bin|I_SEEK=TIME|CUR_TIME=PTS|COMPONENT=WV",debugCCAsset:[{language:"en",closedCaptionAssetLocation:"http://us1cc.res.com.edgesuite.net/d/detour_f2b6e7d5_cc_lid_0_1.xml"}],persist:{},controls:{},buttons:[],STOPPED:0,PLAYING:1,PAUSED:2,TRICKPLAY:3,SKIPPING:4,MAX_VOL:100,MIN_VOL:0,totalTime:1,_totalbarSD:3,_totalbarHD:6,_isLoaded:false,isBuffering:false,trickPlayCnt:5,_playIndex:5,_trickPlayArr:new Array(-32,-16,-8,-4,-2,1,2,4,8,16,32),_currentStatus:0,_startPos:0,_isHd:false,_currentFileType:"STANDARD",_title:{},_bufferCount:0,_lastBuffer:0,_longBufferCount:0,_lastLongBuffer:0,_singleLongTracker:[],_errorTimeBuffer:3000,hasError:false,_readyForTrick:false,_trackBuffers:true,layoutIsDirty:true,noMoreErrors:false,tpl:null,selection:null,identifier:null,playerLoadingSpinner:null,playerLoadingSpinnerSpinning:false,doRegisterBuffers:true,registerTimeout:null,resumeTime:null,stutterTimer:null,stutterPosition:0,skipTime:0,skipStartPosition:0,skipWatchTimer:null,locateTickTimer:null,locateDirection:"",locateTimerOn:false,loadingTimer:null,loadingLimit:0,loadingInProgress:false,playPauseKey:"play",inLocateMode:false,ccData:{},elementCache:{},initialize:function(){application.events.subscribe(this,"pause",this._onPauseButton.bind(this));application.events.subscribe(this,"play",this._onPlayButton.bind(this));application.events.subscribe(this,"stop",this._onStopButton.bind(this));application.events.subscribe(this,"rewind",this._onRewindButton.bind(this));application.events.subscribe(this,"fastforward",this._onFastforwardButton.bind(this));application.events.subscribe(this,"skipback",this._onSkipbackButton.bind(this));application.events.subscribe(this,"skipforward",this._onSkipforwardButton.bind(this));application.events.subscribe(this,"play_pause",this._onPlayPauseButton.bind(this));application.events.subscribe(this,"cc_toggle",this._onClosedCaptionButton.bind(this))},_onSkipbackButton:function(){if(BrowseView.currentState=="player-view"){if(!this.hasError){BrowseView.PlayerControl._skiprw()}}},_onSkipforwardButton:function(){if(BrowseView.currentState=="player-view"){if(!this.hasError){BrowseView.PlayerControl._skipff()}}},_onPauseButton:function(){if(BrowseView.currentState=="player-view"){if(!this.hasError){BrowseView.PlayerControl._pause()}}},_onPlayButton:function(){if(BrowseView.currentState=="player-view"){if(!this.hasError){BrowseView.PlayerControl._resume()}}},_onStopButton:function(){if(BrowseView.currentState=="player-view"){this.hasError=false;BrowseView.PlayerControl._stop()}},_onPlayPauseButton:function(){if(BrowseView.currentState=="player-view"){if(!this.hasError){BrowseView.PlayerControl._playpause()}}},_onClosedCaptionButton:function(){if(BrowseView.currentState=="player-view"){if(!this.getCachedElement("CCState")||this.isBuffering||!this._isLoaded){return}if(this.hasError){return}if(this._isControlHidden()){this.showControls()}if(ccrender.isCCAvailable()){this._exitLocateMode("CCState");this.onClosedCaptionToggle()}this._regKeyTimeout("navigate")}},_mouseOverPlayerlocate:function(){if(this._currentStatus==this.STOPPED||this._currentStatus==this.PLAYING){this.getCachedElement("CurrentTime").show()}else{this.getCachedElement("CurrentTime").hide()}},_onMouseoutPlayerlocate:function(){this.getCachedElement("CurrentTime").hide()},_resetMoveDistanceAndSkipTime:function(f,d,e){if((e+f)<=0){f=-e}else{if((e+f)>d){f=d-e}else{f=f}}this.skipTime=this.totalTime*f/d;if((this.skipStartPosition+this.skipTime)<=0){this.skipTime=1-this.skipStartPosition}else{if((this.skipStartPosition+this.skipTime)>(this.totalTime-5000)){this.skipTime=this.totalTime-5000-this.skipStartPosition}else{this.skipTime=this.skipTime}}},_onMousedownPlayerlocate:function(){if(this.isBuffering||!this._isLoaded){log.write("===== Can't Mousemove on Buffering or unloaded ===== ");return}this.getCachedElement("playerlocate").addClass("hover");if(this._currentStatus==this.STOPPED||this._currentStatus==this.PLAYING){this.getCachedElement("CurrentTime").show();this.getCachedElement("Trick").removeClass("hidden")}else{this.getCachedElement("Trick").addClass("hidden")}var j,d=$("VideoProgressContainer").offsetWidth,f=arguments[0].args[0].clientX,g=parseFloat(this.getCachedElement("VideoProgress").offsetWidth),e=$("VideoProgressContainer").getStyle("left"),h=arguments[0].args[0].target.id;this._registerHideControls("playerlocate");this.showControls();this.inLocateMode=true;this.skipStartPosition=this._currentTime;if(h=="VideoProgressContainer"||h=="VideoProgressShade"){this.getCachedElement("playerlocate").addClass("hover");j=arguments[0].args[0].clientX-127;this.skipTime=this.totalTime*j/d-this.skipStartPosition;this.setProgressBar((this._currentTime/this.totalTime*100),((this.skipStartPosition+this.skipTime)/this.totalTime*100));this.onLocateToPosition();this.skipTime=0;this._regKeyTimeout("playerlocate");$(document).addEvent("mouseup",function(k){this.getCachedElement("playerlocate").addClass("hover");$(document).removeEvents("mouseup");this.getCachedElement("Trick").removeClass("hidden")}.bind(this));$("playerlocate").addEvent("mouseout",function(k){this.getCachedElement("playerlocate").removeClass("hover");$(document).removeEvents("mouseout")}.bind(this))}else{$(document).addEvent("mousemove",function(k){this.getCachedElement("playerlocate").addClass("hover");this.getCachedElement("CurrentTime").show();j=k.client.x-f;this._resetMoveDistanceAndSkipTime(j,d,g);this.setProgressBar((this._currentTime/this.totalTime*100),((this.skipStartPosition+this.skipTime)/this.totalTime*100));this.getCachedElement("CurrentTime").set("html",$cn.utilities.convertMStoTime(this.skipStartPosition+this.skipTime))}.bind(this));$(document).addEvent("mouseup",function(k){j=k.client.x-f;this._resetMoveDistanceAndSkipTime(j,d,g);this.onLocateToPosition();this.skipTime=0;this._regKeyTimeout("playerlocate");$(document).removeEvents("mousemove");$(document).removeEvents("mouseup");this.getCachedElement("Trick").removeClass("hidden")}.bind(this))}},_onNavigate:function(f){if(BrowseView.currentState=="player-view"){var d=f.args[0].current,e=f.args[0].direction;if(application.isBusy){return}else{if(!this._isLoaded||(this._isLoaded&&this.isBuffering)||(this._currentStatus===this.SKIPPING&&(e=="up"||e=="down"))){log.write("===== Can't navigate on loading, buffering or skipping =====");f.preventDefault();return}}if(this._isControlHidden()){this.showControls();f.preventDefault()}else{if((d=="playerlocate"&&(e=="left"||e=="right"))||(this._isFocusOnTransport(d)&&(e=="up"||e=="down"))||(d=="CCState"&&(e=="up"||e=="down"))){this.getCachedElement("CurrentTime").show();this.getCachedElement("Trick").addClass("hidden")}else{this.getCachedElement("CurrentTime").hide();this.getCachedElement("Trick").removeClass("hidden")}if(d==="playerlocate"&&(e==="right"||e==="left")){if(!this.locateTickTimer){this.locateTickTimer=new Timer();this.locateTickTimer.Interval=100;this.locateTickTimer.Tick=function(){if(this.locateTimerOn){if(!this._locatePlaybackTime(this.locateDirection==="right")){this.locateTimerOn=false;this.locateDirection=""}}else{this.locateTickTimer.Stop()}}.bind(this)}if(!this.locateDirection){if(this._locatePlaybackTime(e==="right")){this.locateDirection=e}}else{if(e===this.locateDirection&&!this.locateTimerOn){this.locateTimerOn=true;this.locateTickTimer.Start()}}}if(this.inLocateMode&&(this._currentStatus===this.PLAYING||this._currentStatus===this.TRICKPLAY)&&(d=="playerlocate"&&(e=="up"||e=="down"))){this._exitLocateMode()}}this._regKeyTimeout("navigate")}},_onKeyUp:function(f){if(BrowseView.currentState=="player-view"){if(this.isBuffering||!this._isLoaded){log.write("===== Can't navigate on Buffering or unloaded ===== ");return}var d=f.args[0].current,e=f.args[0].direction;if(d==="playerlocate"&&(e==="right"||e==="left")){this.locateDirection="";this.locateTimerOn=false}}},_locatePlaybackTime:function(d){var h=0,g=false,j=10000,f=Math.max(Math.floor(this.totalTime/100),10000),e=0;if(!this.inLocateMode){h=(d)?j:0-j;if(this._isPositionInBound(this._currentTime+h)){this.skipTime=h;this.skipStartPosition=this._currentTime;g=true;log.write("_locatePlaybackTime: first positioning offset: "+this.skipTime/1000)}}else{e=(this.locateTimerOn)?f:j;h=d?this.skipTime+e:this.skipTime-e;if(!h){h=d?e:0-e}if(this._isPositionInBound(this.skipStartPosition+h)){this.skipTime=h;g=true;log.write("_locatePlaybackTime: cumulative positioning offset: "+this.skipTime/1000)}}if(g){if(!this.inLocateMode){this.inLocateMode=true}this.setProgressBar((this._currentTime/this.totalTime*100),((this.skipStartPosition+this.skipTime)/this.totalTime*100));this.getCachedElement("CurrentTime").set("html",$cn.utilities.convertMStoTime(this.skipStartPosition+this.skipTime))}return g},_isControlHidden:function(){return parseInt(this.getCachedElement("PlayerLocateBottom").getStyle("bottom"))===-140},_isFocusOnTransport:function(d){var e=this.getCachedElement(d);if(e&&e.getParent().id==="PlayerTransportBar"){return true}else{return false}},_isPositionInBound:function(d){return 1000<=d&&d<=this.totalTime-5000},_exitLocateMode:function(d){this.inLocateMode=false;this.locateTimerOn=false;if(d){application.navigator.setFocus(d);this.getCachedElement("CurrentTime").hide();this.getCachedElement("Trick").removeClass("hidden")}},_onRewindButton:function(f){if(!this._isLoaded){log.write("===== Can't RW file not loaded ===== ");return}if((this._currentTime<=2000)&&(this._trickPlayArr[this.trickPlayCnt]<1)){return}if(this.hasError){return}var d=f.context;if(d._trickTest){var e=new Date();var g=$cn.utilities.DateDiff(e,d._trickTest);log.write("newDate: "+e.toString()+", self._rwTest: "+d._trickTest.toString()+", seconds: "+g);if(!d._readyForTrick&&g<2000){log.write("ignore rw");return}else{d._readyForTrick=true}d._trickTest=e}d._trickTest=new Date();d._registerHideControls("rw");d._rewind()},_onFastforwardButton:function(f){if(!this._isLoaded){log.write("===== Can't FF file is not loaded ===== ");return}if((this._currentTime<=2000)&&(this._trickPlayArr[this.trickPlayCnt]<1)){return}if(this.hasError){return}var d=f.context;if(d._trickTest){var e=new Date(),g=$cn.utilities.DateDiff(e,d._trickTest);log.write("newDate: "+e.toString()+", self._ffTest: "+d._trickTest.toString()+", seconds: "+g);if(!d._readyForTrick&&g<2000){log.write("ignore ff");return}else{d._readyForTrick=true}d._trickTest=e}d._trickTest=new Date();d._registerHideControls("ff");d._fastForward()},_onError:function(d){this._clearAllBufferTimeouts();if(this.noMoreErrors||(BrowseView.MessagePopup&&BrowseView.MessagePopup.isNowVisible)){log.write("-- Errors occuring too close together. Ignoring this one. --");return}this.noMoreErrors=true;setTimeout(function(){this.noMoreErrors=false}.bind(this),this._errorTimeBuffer);log.write("Error Occurred: "+d);this.trickPlayCnt=this._playIndex;this.hideLoading();this.isBuffering=false;this.hasError=true;if(d=="askabouthdswap_error"||d=="connectiontooslow_error_player"){this._currentStatus=this.PAUSED}else{this.stopPlayer();this._currentStatus=this.STOPPED}application.events.publish("error",this._makeErrorObject(d))},_makeErrorObject:function(d){return{type:d,titleID:this.persist.titleID,streamID:this.persist.streamid,url:this.persist.url,startTimeSeconds:parseInt(this._currentTime/1000,10),isHd:this._isHd,passID:this.persist.passID}},listenForLoad:function(){this._isLoaded=true},showStreamSwitch:function(){var d="PlayerLoading";$("PlayerLoadingDescription").show();BrowseView.PlayerControl.spinnerid="PlayerSpinner";BrowseView.PlayerControl.playeridx=0;if(BrowseView.PlayerControl.playerLoadingSpinner==null){BrowseView.PlayerControl.playerLoadingSpinner=new Timer();BrowseView.PlayerControl.playerLoadingSpinner.Interval=80;BrowseView.PlayerControl.playerLoadingSpinner.Tick=function(){if(!BrowseView.PlayerControl.playerLoadingSpinnerSpinning){BrowseView.PlayerControl.playerLoadingSpinner.Stop();BrowseView.PlayerControl.playerLoadingSpinnerSpinning=false;return}var h=false;var e=-413;var k=-461;if(!h){e=-1004;k=-1052}if(document.getElementById(BrowseView.PlayerControl.spinnerid)){var j=document.getElementById(BrowseView.PlayerControl.spinnerid);BrowseView.PlayerControl.playeridx=(BrowseView.PlayerControl.playeridx+1)%16;var f=BrowseView.PlayerControl.playeridx*80*-1;var g=e;if(BrowseView.PlayerControl.playeridx>7){f=(BrowseView.PlayerControl.playeridx-8)*80*-1;g=k}j.style.backgroundPosition=parseInt(f)+"px "+g+"px"}}}if(!BrowseView.PlayerControl.playerLoadingSpinnerSpinning){log.write("starting spinner");BrowseView.PlayerControl.playerLoadingSpinnerSpinning=true;BrowseView.PlayerControl.playerLoadingSpinner.Start();if(!BrowseView.PlayerControl.isBuffering){BrowseView.PlayerControl.isBuffering=true;this.registerBuffer()}}$(d).show()},setLoadingProgress:function(d){this.loadingLimit=d},showLoadingProgress:function(){var e=0,d=0;if(!this.loadingTimer){this.loadingTimer=new Timer();this.loadingTimer.Interval=100;this.loadingTimer.Tick=function(){if(this.loadingInProgress){if(d<this.loadingLimit){if(0<e&&e<d){e=d}d=this.loadingLimit}if(e<d&&e<100){e+=2}}else{e=0;d=0;this.loadingTimer.Stop()}$("PlayerLoadingProgress").style.width=e+"%"}.bind(this)}if(!this.loadingInProgress){this.setLoadingProgress(20);this.loadingInProgress=true;this.loadingTimer.Interval=100;this.loadingTimer.Start();$("PlayerLoadingDescription").hide();$("PlayerLoading").show();$("PlayerLoadingProgressContainer").show();$("PlayerSpinner").hide()}},showLoading:function(e){var f=e?"PlayerLoadingResume":"PlayerLoading",d;$("PlayerLoadingDescription").hide();BrowseView.PlayerControl.spinnerid=e?"PlayerSpinnerResume":"PlayerSpinner";BrowseView.PlayerControl.playeridx=0;if(BrowseView.PlayerControl.playerLoadingSpinner==null){BrowseView.PlayerControl.playerLoadingSpinner=new Timer();BrowseView.PlayerControl.playerLoadingSpinner.Interval=80;BrowseView.PlayerControl.playerLoadingSpinner.Tick=function(){var k,g,m,l,h,j;if(!BrowseView.PlayerControl.playerLoadingSpinnerSpinning){BrowseView.PlayerControl.playerLoadingSpinner.Stop();BrowseView.PlayerControl.playerLoadingSpinnerSpinning=false;return}k=false;g=-413;m=-461;if(!k){g=-1004;m=-1052}if(document.getElementById(BrowseView.PlayerControl.spinnerid)){l=document.getElementById(BrowseView.PlayerControl.spinnerid);BrowseView.PlayerControl.playeridx=(BrowseView.PlayerControl.playeridx+1)%16;h=BrowseView.PlayerControl.playeridx*80*-1;j=g;if(BrowseView.PlayerControl.playeridx>7){h=(BrowseView.PlayerControl.playeridx-8)*80*-1;j=m}l.style.backgroundPosition=parseInt(h)+"px "+j+"px"}}}if(!BrowseView.PlayerControl.playerLoadingSpinnerSpinning){log.write("starting spinner");BrowseView.PlayerControl.playerLoadingSpinnerSpinning=true;BrowseView.PlayerControl.playerLoadingSpinner.Start();if(!BrowseView.PlayerControl.isBuffering){BrowseView.PlayerControl.isBuffering=true;this.registerBuffer()}}$(f).show();$("PlayerSpinner").show();$("PlayerLoadingProgressContainer").hide()},hideLoading:function(){if(this.loadingTimer){this.loadingInProgress=false}if(this.playerLoadingSpinner){this.playerLoadingSpinner.Stop();this.playerLoadingSpinnerSpinning=false}$("PlayerLoading").hide();$("PlayerLoadingResume").hide()},show:function(){this.lastFocus=application.element.current;BrowseView.PlayerControl._currentTime=0;this._swappedToSD=false;this._isLoaded=false;this._readyForTrick=false;application.events.subscribe(this,"back",this.handleBack.bind(this));application.events.subscribe(this,"goback",this.handleBack.bind(this));application.events.subscribe(this,"select",this.handleSelect.bind(this));application.events.subscribe(this,"navigate",this._onNavigate.bind(this));application.events.subscribe(this,"keyup",this._onKeyUp.bind(this));application.events.subscribe(this,"pointerclick",this._onPlayerClick.bind(this));application.events.subscribe(this,"pointeractivated",this._onPlayerClick.bind(this));application.events.subscribe(this,"pointerdeactivated",this._onPlayerClick.bind(this));application.events.subscribe(this,"pointermousedown",this._onMousedownPlayerlocate.bind(this));application.events.subscribe(this,"pointermouseout",this._onMouseoutPlayerlocate.bind(this));$("playerlocate").addEvent("mouseover",this._mouseOverPlayerlocate.bind(this));BrowseView.hideLogo();$("dock").hide();$("uicontainer").addClass("initPlayerBackground");$("store").set("class","");$("mainstage").hide();$("imagepopup").hide();if(!pointer.isPointerModeActive()){$("PlayerLoadingCancel").hide()}application.navigator.setFocus("transportPlayPause",true);$("PlayerLogo").removeClass("redbuttons");$("PlayerContainer").show();this.mouseMoveWakeupCtl();Player.SetVisibility(true)},hide:function(){application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"goback");application.events.unsubscribe(this,"select");application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"keyup");application.events.unsubscribe(this,"pointerclick");application.events.unsubscribe(this,"pointeractivated");application.events.unsubscribe(this,"pointerdeactivated");application.events.unsubscribe(this,"pointermousedown");application.events.unsubscribe(this,"pointermouseout");navigation.setFocus(this.lastFocus,true);$("PlayerContainer").hide();Player.SetVisibility(false);$("uicontainer").addClass("containerBackground");this.unbindeMouseMoveWakeupCtl();BrowseView.showLogo();$("dock").show();$("mainstage").show()},_clearAllBufferTimeouts:function(){var d;log.write("++++++ clearing all timeouts");if(BrowseView.PlayerControl.playerTimeout){clearTimeout(BrowseView.PlayerControl.playerTimeout);BrowseView.PlayerControl.playerTimeout=false}if(BrowseView.PlayerControl.bufferCheckTimeout){clearTimeout(BrowseView.PlayerControl.bufferCheckTimeout);BrowseView.PlayerControl.bufferCheckTimeout=false}for(d=0;d<this._singleLongTracker.length;++d){if(this._singleLongTracker[d]){clearTimeout(this._singleLongTracker[d]);this._singleLongTracker[d]=false}}this._lastBuffer=0;this._bufferCount=0;this._lastLongBuffer=0;this._longBufferCount=0},load:function(l,n,e,g,k,d,m,h){this._clearAllBufferTimeouts();this.identifier=$cn.utilities.uniqueIdentifier();log.write("uid is: "+this.identifier);log.write("================ Player.load() ===================");application.bandwidthCheck.callbackType="player";var p=this,j=(d==""),f=$cn.utilities.currentlyPlayingAudioProfile(d);$("PlayerLoadingTitle").set("html","");if(this.playerLoadingSpinnerSpinning&&this.playerLoadingSpinner){this.playerLoadingSpinner.Stop();this.playerLoadingSpinnerSpinning=false}(j)?this.showLoading():this.showLoadingProgress();this.persist.titleID=l;this.persist.passID=d;this.persist.streamid=n;this.persist.url=e;this._isHd=k;this.hasError=false;this.trickPlayCnt=this._playIndex;this._isLoaded=false;this.bandwidthError=false;this.resumeTime=g;this._currentStatus=this.STOPPED;this.stutterPosition=0;this.playPauseKey="play";this._trackBuffers=true;this.clearElementCache();this._currentTime=0;this.totalTime=0;this.setProgressBar(0,-1);this.getCachedElement("TimeSpent").set("html","");this.getCachedElement("TimeRemain").set("html","");log.write("this._isHd: "+this._isHd+", audioProfileType: "+f);this.getCachedElement("audiotype").className="";this.getCachedElement("surround").removeClass("visible");$("audiobadges_player").hide();if(!j){if(f!="Stereo_Standard"&&this._isHd){this.getCachedElement("audiotype").className=f;this.getCachedElement("surround").addClass("visible");if(BrowseView.TitleViewControl.getAudioIconCssClass("Dolby_Digital_Plus_Stereo")){$("dolbyplus_player").hide()}else{$("dolbyplus_player").show();if(BrowseView.TitleViewControl.showAudioMetaField("HDOnly")){$("dolbyplus_player").addClass("hd")}else{$("dolbyplus_player").removeClass("hd")}}if(BrowseView.TitleViewControl.getAudioIconCssClass("Dolby_Digital_Plus_51")){$("dolby51_player").hide()}else{$("dolby51_player").show();if(BrowseView.TitleViewControl.showAudioMetaField("HDOnly")){$("dolby51_player").addClass("hd")}else{$("dolby51_player").removeClass("hd")}}if(BrowseView.TitleViewControl.getAudioIconCssClass("DTS_Express_51")){$("dtsexpress51_player").hide()}else{$("dtsexpress51_player").show();if(BrowseView.TitleViewControl.showAudioMetaField("HDOnly")){$("dtsexpress51_player").addClass("hd")}else{$("dtsexpress51_player").removeClass("hd")}}if(BrowseView.TitleViewControl.getAudioIconCssClass("DTS_Express_Stereo")){$("dtsexpress20_player").hide()}else{$("dtsexpress20_player").show();if(BrowseView.TitleViewControl.showAudioMetaField("HDOnly")){$("dtsexpress20_player").addClass("hd")}else{$("dtsexpress20_player").removeClass("hd")}}$("audiobadges_player").show()}}this.isTrailer=(j);$cn.methods.getTitleListing(l,false,function(w){p._title=w;var v=p._title.titleType.substring(3,0)=="TV_",r=p._title.titleType=="TV_Episode",E=p._title.name,D="",u="",A,s;if(p.resumeTime>$cn.config.EarliestResumeS){s=(p.resumeTime-$cn.config.RewindUponResumeS)}else{s=p.resumeTime}if(r){var C=$cn.utilities.getMeta("ShowName",p._title.metaValues);var G=$cn.utilities.getMeta("SeasonName",p._title.metaValues);var q=$cn.utilities.getMeta("EpisodeNumber",p._title.metaValues);var F=$cn.utilities.getMeta("EpisodeName",p._title.metaValues);if(C){E=C}if(G){D+=G+", "}if(q){D+=q+": ";u=q+": "}D+='"'+p._title.name+'"'}u+='"'+p._title.name+'" ';var B="Loading "+u;B+=k?'<div class="HDContainer"><span class="HD"></span></div> ':"";B+=($("audiotype").className.length>0)?'<div class="AudioContainer"><span class="surround"></span></div> ':"";if(!j){B+=$cn.utilities.getMeta("HasClosedCaption",p._title.metaValues)=="True"?'<div class="CCBadgeContainer"><span class="ccBadge"></span></div> ':""}B+="...";$("PlayerLoadingTitle").set("html",B);p.setTitleDisplay(E,D);p.ccData=m;var H=(p.ccData!=undefined)&&(p.ccData.length>0);ccrender.init("TimedTexts");p.updateCCState(H);log.write("Preparing to play content. url: "+e+"at position "+s);if(h){log.write("we are hdsd switching - set bw test passed to true");A=true}else{A=$cn.utilities.bandwidthCheckValid(p._isHd);log.write("we are not hdsd switching - bw test is: "+A)}if(!j&&!A){p.setLoadingProgress(65);p.loadingTimer.Stop();p.loadingTimer.Interval=250;p.loadingTimer.Start()}log.write("bandwidthCheckValid is: "+A);if(A){if(application.playbackSupported&&(p.debug||e==null)){p._play(p.debugAsset,0)}else{p._play(e,(g<$cn.config.EarliestResumeS-$cn.config.RewindUponResumeS)?0:s)}}else{BandwidthCheck.playerBandwidthCheck(e,p._isHd,g,s,PlaybackBandwidthTest)}})},handleBack:function(d){if(BrowseView.currentState=="player-view"&&$$("div.message_exit").length==0){d.preventDefault();if(this.isBuffering){this.isBuffering=false;this._clearAllBufferTimeouts()}this.hasError=false;this._stop(true)}},handleSelect:function(d){if(BrowseView.currentState=="player-view"){if(!application.isBusy&&this._currentStatus===this.PLAYING&&this._isControlHidden()){this.showControls();this._regKeyTimeout("navigate");d.preventDefault()}}},setPlayStateDisplay:function(e,d){$("PlayerContainer").erase("class");$("PlayerContainer").addClass(e);$("PlayerContainer").addClass(e+"_"+d);if(d&&d!=""){$("PlayerContainer").addClass("skiptext");this.getCachedElement("TransportRW").set("html","<div>"+d+"</div>");this.getCachedElement("TransportFF").set("html","<div>"+d+"</div>");this.getCachedElement("TransportSkipRW").set("html","<div>"+d+"</div>");this.getCachedElement("TransportSkipFF").set("html","<div>"+d+"</div>");this.getCachedElement("TrickText").set("html",d)}if(e==="play"){this.getCachedElement("VideoQuality").show()}else{this.getCachedElement("VideoQuality").hide()}this.getCachedElement("TransportCenter").show()},setProgressBar:function(f,d){var e=0;if(d>-1){if(f<d){this.getCachedElement("VideoProgress").style.width=f+"%";this.getCachedElement("VideoProgressShade").style.width=d+"%";e=this.getCachedElement("VideoProgressShade").offsetWidth+115}else{this.getCachedElement("VideoProgressShade").style.width=f+"%";this.getCachedElement("VideoProgress").style.width=d+"%";e=this.getCachedElement("VideoProgress").offsetWidth+115}}else{this.getCachedElement("VideoProgress").style.width=f+"%";this.getCachedElement("VideoProgressShade").style.width=f+"%";e=this.getCachedElement("VideoProgress").offsetWidth+115}this.getCachedElement("TrickRW").style.left=e+"px";this.getCachedElement("TrickFF").style.left=e+"px";this.getCachedElement("TrickSkipFF").style.left=e+"px";this.getCachedElement("TrickSkipRW").style.left=e+"px";this.getCachedElement("TrickText").style.left=(e+25)+"px";this.getCachedElement("CurrentTime").style.left=(e-15)+"px";this.getCachedElement("playerlocate").style.left=(e-137)+"px"},setQuality:function(f){var e=this.getCachedElement("VideoQuality");e.erase("class");e.addClass("q"+f);if(this._isHd&&f>2){e.addClass("hd")}var d="";switch(f){case 1:d=this._isHd?"":"0.7 Mbps";break;case 2:d=this._isHd?"2.0 Mbps":"1.0 Mbps";break;case 3:d=this._isHd?"4.0 Mbps":"1.5 Mbps";break;case 4:d=this._isHd?"8.0 Mbps":"2.0 Mbps";break}this.getCachedElement("BitrateText").set("html",d)},setTimeDisplay:function(e){this._currentTime=e;this.getCachedElement("TimeSpent").set("html",$cn.utilities.convertMStoTime(e));this.getCachedElement("TimeRemain").set("html","-"+$cn.utilities.convertMStoTime(parseInt(parseInt(this.totalTime)-parseInt(e))));var f=(e/this.totalTime*100),d;if(this._currentStatus===this.SKIPPING||this.inLocateMode){d=((this.skipStartPosition+this.skipTime)/this.totalTime*100)}else{d=-1;this.getCachedElement("CurrentTime").set("html",$cn.utilities.convertMStoTime(e))}this.setProgressBar(f,d);device.displayTime(e)},setTitleDisplay:function(e,d){$("VideoTitle").set("html",e);$("VideoSummary").set("html",d)},updateCCState:function(f){var e=this.getCachedElement("CCState"),d=ccrender.isCCEnabled();ccrender.setCCAvailable(f);if(e){e.removeClass("CCOn");e.removeClass("CCOff");e.removeClass("CCUnavailableOn");e.removeClass("CCUnavailableOff");if(f){this.getCachedElement("transportSkipRW").setAttribute("left","CCState");this.getCachedElement("transportSkipFW").setAttribute("right","CCState");if(d){e.addClass("CCOn")}else{e.addClass("CCOff")}}else{this.getCachedElement("transportSkipRW").setAttribute("left","transportSkipFW");this.getCachedElement("transportSkipFW").setAttribute("right","transportSkipRW");if(d){e.addClass("CCUnavailableOn")}else{e.addClass("CCUnavailableOff")}}}},hideControls:function(d,f){log.write("caller == "+d+", BrowseView.PlayerControl._hideCtrlId: "+BrowseView.PlayerControl._hideCtrlId);if(d==BrowseView.PlayerControl._hideCtrlId||f){var g=new Fx.Morph($("PlayerTop"),{duration:300,transition:Fx.Transitions.Sine.easeOut});var e=new Fx.Morph($("PlayerLocateBottom"),{duration:300,transition:Fx.Transitions.Sine.easeOut});g.start({top:"-90px"});e.start({bottom:"-140px"});$("TransportCenter").hide();this._exitLocateMode()}},showControls:function(){if(BrowseView.PlayerControl._currentStatus==BrowseView.PlayerControl.PLAYING){BrowseView.PlayerControl._StreamBitRates()}else{}var e=new Fx.Morph($("PlayerTop"),{duration:300,transition:Fx.Transitions.Sine.easeOut});var d=new Fx.Morph($("PlayerLocateBottom"),{duration:300,transition:Fx.Transitions.Sine.easeOut});e.start({top:"0px"});d.start({bottom:"0px"})},registerBuffer:function(){var j,h,e=this,k,f,d=this.identifier,g;log.write("+++ doRegisterBuffers: "+this.doRegisterBuffers);log.write("+++ currentStatus: "+this._currentStatus);log.write("********* playerTimeout is: "+this.playerTimeout);if(!this.playerTimeout){log.write("+++ creating a new playerTimeout");this.playerTimeout=setTimeout(function(){log.write("Buffering Timeout called back. Current Player Identity: "+e.identifier+", this timer created by: "+d+". Now check if anything should be done.");if(!e._isLoaded&&e.identifier===d){log.write("Something should be done. Buffering Timeout: Player is not loaded show error. Assuming we are unplugged.");e._onError("OnNetworkDisconnected")}},application.appSetting("PlayerBufferTimeout"))}log.write("+++ Creating this.playerTimeout: "+this.playerTimeout+" with identity "+this.identifier);if(!this.doRegisterBuffers||!this._trackBuffers||this._currentStatus!=this.PLAYING){log.write("doRegisterBuffers is: "+this.doRegisterBuffers);log.write("_trackBuffers is: "+this._trackBuffers);log.write("_currentStatus is "+this._currentStatus);log.write("--- bail from registerBuffer ---");return}this._bufferCount++;this._longBufferCount++;this._singleLongTracker[this._singleLongTracker.length]=setTimeout(function(){log.write("+++++++++++++++++++++ reduce called");e._longBufferCount=e._longBufferCount-1;log.write("+++++++++++++++++++++ reduce long buffer count by one to: "+e._longBufferCount)},application.appSetting("LongWindowMinutes")*60*1000);if(this._lastBuffer===0||this._lastLongBuffer===0){this._lastBuffer=new Date();this._lastLongBuffer=new Date()}else{f=new Date();j=$cn.utilities.DateDiff(f,this._lastBuffer);k=this.msToSeconds(j);if(k>application.appSetting("HDChokeTimeSpan")){this._bufferCount=1}this._lastBuffer=f;j=$cn.utilities.DateDiff(f,this._lastLongBuffer);k=this.msToSeconds(j);this._lastLongBuffer=f;if(this._bufferCount>=application.appSetting("HDChokeLimit")||this._longBufferCount>=application.appSetting("HDLongChokeLimit")){if(e._isHd){BrowseView.PlayerControl._onError("askabouthdswap_error")}else{log.write("+++++++++++++++++++++ Too many SD buffers shown. Connetion too slow.");BrowseView.PlayerControl._onError("connectiontooslow_error_player")}}}log.write("+++++++++++++++++++++ short buffer count: "+this._bufferCount);log.write("+++++++++++++++++++++ long buffer count: "+this._longBufferCount);log.write("+++++++++++++++++++++ time: "+(new Date()))},focusClosedCaptionToggle:function(){var d=this.getCachedElement("CCState");if(d.hasClass("CCUnavailableOff")||d.hasClass("CCUnavailableOn")){return}else{pointer.lastFocusId="CCState";navigation.setFocus(d)}},_handleHdSwap:function(){if(this._swappedToSD){return}this._swappedToSD=true;this._isHd=false;this._clearAllBufferTimeouts();this.stopPlayer();this._currentStatus=this.STOPPED},_OnTimeChanged:function(d){if(d>2000&&!this.isBuffering){this._readyForTrick=true}this.setTimeDisplay(d)},_play:function(f,e){log.write("+++ PLAY +++");var g=2000;var d=0;var h=0;if(Player){if(f){h=f.length}if(h&&h>g){log.write("PlayerControl._play, url is too long!")}else{if(h>0&&h<=g){this.setLoadingProgress(90);this._currentStatus=this.PLAYING;device.play(this,f,e,this.ccData);this.setPlayStateDisplay("play")}}}},_pause:function(){if(this.isBuffering||!this._isLoaded||this._currentStatus==this.SKIPPING){log.write("===== Can't Pause on Buffering, unloaded or skipping ===== ");return}this._exitLocateMode("transportPlayPause");if(this._currentStatus!=this.PAUSED){log.write("===== Start movie pausing ===== ");var e=this.trickPlayCnt;var d=this._currentStatus;this._currentStatus=this.PAUSED;this.playPauseKey="pause";Player.Pause();if(this.trickPlayCnt!=this._playIndex){this.trickPlayCnt=this._playIndex}this.showControls();this.setPlayStateDisplay("pause");device.setOnScreenSaver();this._registerHideControls("pause");log.write("Screen Saver Turned on while playback is stopped.");device.displayPause()}else{if(configuration.readValue("PauseResumeEnable")==true){this._resume()}else{log.write("===== Can't Pause, movie is already paused ===== ")}}},_resume:function(){if(this.isBuffering||!this._isLoaded){log.write("===== Can't Resume on Buffering or unloaded ===== ");return}this._exitLocateMode("transportPlayPause");if(this._currentStatus==this.SKIPPING){if(this.skipWatchTimer){clearTimeout(this.skipWatchTimer);this.skipWatchTimer=null}log.write("_resume: skip chapter, skipTime("+this.skipTime/1000+"), new position("+(this.skipStartPosition+this.skipTime)/1000+")");Player.LocateToPosition(parseInt((this.skipStartPosition+this.skipTime)/1000));this.isBuffering=true;this.showLoading(true);return}if(this.hasError&&this._currentStatus==this.PAUSED){this.hasError=false;this._clearAllBufferTimeouts()}log.write("_resume() called and we are not buffering");if(this._currentStatus!=this.PLAYING){log.write("+++=== Movie resuming ===+++");var f=this.trickPlayCnt;var d=this._currentStatus;device.setOffScreenSaver();log.write("Screen Saver Turned off during playback.");if(d==this.PAUSED){var e=Player.Resume();log.write("Resume Response:"+e);if(e!=1){log.write("Player.Resume FAILED. Reset values and ignore the request.");this.trickPlayCnt=f;this._currentStatus=d;return}}if(this.trickPlayCnt!=this._playIndex){log.write("Reset Playback speed.");this.trickPlayCnt=this._playIndex;if(Player.SetPlaybackSpeed(this._trickPlayArr[this.trickPlayCnt])==1){this._handleTrickplay(this._trickPlayArr[this.trickPlayCnt])}else{log.write("Player.SetPlaybackSpeed FAILED. Reset values and ignore the request.");this.trickPlayCnt=f;this._currentStatus=d;return}}this.setPlayStateDisplay("play");this._currentStatus=this.PLAYING;this._regKeyTimeout("resume");this.playPauseKey="play";device.displayPlay()}else{log.write("===== Can't Resume movie already playing ===== ");this.showControls();this.setPlayStateDisplay("play");this._regKeyTimeout("resume")}},_playpause:function(){if(this._currentStatus==this.PLAYING||(this._currentStatus==this.TRICKPLAY&&this.playPauseKey=="pause")){this._pause()}else{if(this._currentStatus==this.PAUSED||(this._currentStatus==this.TRICKPLAY&&this.playPauseKey=="play")){this._resume()}}},stopPlayer:function(){setTimeout(function(){Player.Stop()},0);ccrender.clean()},_stop:function(d){$(document).removeEvents("mousemove");log.write("Attempting to stop.");var e=this;if(this.isBuffering){log.write("===== Can't Stop on Buffering ===== ");return}this.stopPlayer();this._exitLocateMode("transportStop");if(this._currentStatus!=this.STOPPED){this._currentStatus=this.STOPPED;this._saveStatus("stopped",function(){log.write("Manage Stream Instance - Stop response received.");e.isBuffering=false;e.trickPlayCnt=e._playIndex;log.write("Current stopping status: "+e._currentTime);device.setOnScreenSaver();log.write("Screen Saver Turned on while playback is stopped.");device.displayStop();e._handleReturnKey(d)})}else{this._handleReturnKey(d)}},_fastForward:function(){if(this.isBuffering||this._currentStatus==this.SKIPPING){log.write("===== Can't TrickPlay on Buffering or skipping ===== ");return}else{this._exitLocateMode("transportFW");if(this._readyForTrick){var g=this.trickPlayCnt;var d=this._currentStatus;if(this._currentStatus==this.PAUSED){Player.Resume();this.trickPlayCnt=this._playIndex+1}else{if(this.trickPlayCnt<this._playIndex){this.trickPlayCnt=this._playIndex}this.trickPlayCnt++;if(this.trickPlayCnt>=this._trickPlayArr.length){this.trickPlayCnt=this._playIndex+1}}this._readyForTrick=false;log.write("_trickPlayArr["+this.trickPlayCnt+"] :: "+this._trickPlayArr[this.trickPlayCnt]);var e=Player.SetPlaybackSpeed(this._trickPlayArr[this.trickPlayCnt]);log.write("setspeed:"+e);if(e==1){log.write("Handle Trickplay UI");this._handleTrickplay(this._trickPlayArr[this.trickPlayCnt]);if(this._trickPlayArr[this.trickPlayCnt]==1){this._currentStatus=this.PLAYING;this._regKeyTimeout("tp")}else{this.setToTrickPlay()}}else{log.write("Player.SetPlaybackSpeed FAILED. Reset values and ignore the request.");this.trickPlayCnt=g;this._currentStatus=d;if(this._currentStatus==this.PAUSED){var f=Player.Pause()}}}}},setToTrickPlay:function(){this._currentStatus=this.TRICKPLAY},_rewind:function(){if(this.isBuffering||this._currentStatus==this.SKIPPING){log.write("===== Can't TrickPlay on Buffering or skipping ===== ");return}this._exitLocateMode("transportRW");if(this._readyForTrick){var g=this.trickPlayCnt;var d=this._currentStatus;if(this._currentStatus==this.PAUSED){Player.Resume();this.trickPlayCnt=this._playIndex-1}else{if(this.trickPlayCnt>this._playIndex){this.trickPlayCnt=this._playIndex}this.trickPlayCnt--;if(this.trickPlayCnt<0){this.trickPlayCnt=this._playIndex-1}}this._readyForTrick=false;var e=Player.SetPlaybackSpeed(this._trickPlayArr[this.trickPlayCnt]);log.write("setspeed:"+e);log.write("setspeed:"+e);if(e==1){log.write("_trickPlayArr["+this.trickPlayCnt+"] :: "+this._trickPlayArr[this.trickPlayCnt]);this._handleTrickplay(this._trickPlayArr[this.trickPlayCnt]);if(this._trickPlayArr[this.trickPlayCnt]==1){this._currentStatus=this.PLAYING;this._regKeyTimeout("tp")}else{this.setToTrickPlay()}}else{log.write("Player.SetPlaybackSpeed FAILED. Reset values and ignore the request.");this.trickPlayCnt=g;this._currentStatus=d;if(this._currentStatus==this.PAUSED){var f=Player.Pause()}}}},_skipff:function(){this._skipChapter(true)},_skiprw:function(){this._skipChapter(false)},_skipChapter:function(d){if(this.isBuffering||!this._isLoaded){log.write("===== Can't TrickPlay on Buffering or unloaded ===== ");return}this._exitLocateMode(d?"transportSkipFW":"transportSkipRW");var f=300000,g=0,e=false;if(this._currentStatus!=this.SKIPPING){g=(d)?f:0-f;if(this._isPositionInBound(this._currentTime+g)){this.skipTime=g;this.skipStartPosition=this._currentTime;e=true;log.write("_skipChapter: set first skip time: "+this.skipTime/1000)}}else{g=(d)?this.skipTime+f:this.skipTime-f;if(!g){g=(d)?f:0-f}if(this._isPositionInBound(this.skipStartPosition+g)){this.skipTime=g;e=true;log.write("_skipChapter: set cumulative skip time: "+this.skipTime/1000)}}if(e){if(this._currentStatus!=this.SKIPPING){this._currentStatus=this.SKIPPING;this._registerHideControls("skip");this.showControls();if(this.trickPlayCnt!=this._playIndex){this.trickPlayCnt=this._playIndex}}if(this.skipTime>0){this.setPlayStateDisplay("skipff","+"+this.skipTime/60000+"m")}else{if(this.skipTime<0){this.setPlayStateDisplay("skiprw",this.skipTime/60000+"m")}}this.setProgressBar((this._currentTime/this.totalTime*100),((this.skipStartPosition+this.skipTime)/this.totalTime*100));if(this.skipWatchTimer){clearTimeout(this.skipWatchTimer)}this.skipWatchTimer=setTimeout(function(){this.skipWatchTimer=null;if(this._currentStatus==this.SKIPPING){log.write("_skipChapter: skip chapter, skipTime("+this.skipTime/1000+"), new position("+(this.skipStartPosition+this.skipTime)/1000+")");Player.LocateToPosition(parseInt((this.skipStartPosition+this.skipTime)/1000));this.isBuffering=true;this.showLoading(true)}}.bind(this),1500)}},_handleTrickplay:function(d){this.showControls();if(d>1){this.setPlayStateDisplay("ff",d+"X")}else{if(d<0){this.setPlayStateDisplay("rw",Math.abs(d)+"X")}else{this.setPlayStateDisplay("play")}}},_StreamBitRates:function(){this._handleBitrateIndicatorNew(Player.GetQualityInfo())},_handleBitrateIndicatorNew:function(d){var g=d.PlaybackQualityLevels==4?this._totalbarSD:this._totalbarHD;var e=Math.floor(1+(g/d.PlaybackQualityLevels)*(d.PlaybackQualityLevel-1));log.write("_handleBitrateIndicatorNew: barNumber"+e);this.getCachedElement("VideoQuality").erase("class");if(d.PlaybackQualityLevels==4){this.getCachedElement("VideoQuality").addClass("qs"+e)}else{this.getCachedElement("VideoQuality").addClass("qh"+e)}if(this._isHd){this.getCachedElement("VideoQuality").addClass("hd")}var f=this._genMbpsStr(d.PlaybackQualityRate);this.getCachedElement("BitrateText").set("html",f)},_genMbpsStr:function(d){var e=(new Number(d/1000000)).toFixed(1);log.write("_genMbpsStr: Origin"+d+". after genMbps: "+e);return(e+" Mbps")},_handleBitrateIndicator:function(f){var g=parseInt(f)/(1000*1024);var d=4;var e="";if(this._currentStatus==this.PLAYING){if(!this._isHd){if(g<=0.8){d=1}else{if(g<1.1){d=2}else{if(g<=1.6){d=3}else{if(g<=2.1){d=4}else{d=4}}}}}else{if(g<4){d=2}else{if(g<4.2){d=2;if(g>=4){d=3}}else{if(g>=4.2){e="_hd";if(g<8){d=3}else{d=4}}}}}this.setQuality(d);log.write("Quality: "+f+"(bps), Quality key: "+g+", Quality IDX: "+d)}},_saveStatus:function(g,d){var f=this,k,h,l;if(!this.isTrailer){k=Math.floor(parseInt(this._currentTime,10)/1000);h=Math.floor(parseInt(this.totalTime,10)/1000);log.write("--- status seconds: "+k);if(k>30||this.resumeTime!=null){log.write("Saving Stream Status: "+g+", "+this._currentTime);if(k<$cn.config.EarliestResumeS||k>(h-30)){k=999001}try{l=$cn.utilities.showLoadingModal(0);$cn.methods.sendStopMessageForStream(f.persist.streamid,k,function(e){$cn.utilities.clearLoadingSpinner(l);log.write("Play Status Saved");if(d&&typeof d=="function"){d.call(this)}})}catch(j){d.call(this)}}else{d.call(this)}}else{d.call(this)}},_handleReturnKey:function(d){var f,e=this;this.hideLoading();if(!this.hasError){log.write("this.persist.passID: "+this.persist.passID);f={passID:this.persist.passID,stopPositionMins:(!this.hasError)?Math.floor((parseInt(this._currentTime)/1000)/60):0,stopPositionPercent:(!this.hasError)?parseInt(parseFloat(this._currentTime/this.totalTime)*100):0,bandwidthError:this.bandwidthError};if(d&&e._title.titleType=="TV_Episode"){log.write("$$$$$$$ NEXT EPISODE EXISTS $$$$$$$");f.setFocus="tdbuttonNextEpisode"}else{if(BrowseView.showingOtherModal){f.leaveFocusAlone=true;BrowseView.showingOtherModal=false}else{application.navigator.setFocus(this.lastFocus,true)}}BrowseView.TitleViewControl.update(f);device.setOnScreenSaver();log.write("Screen Saver Turned on while playback is stopped.");log.write("hiding player");log.write("LastFocus: "+this.lastFocus);BrowseView.currentState=(this.persist.passID)?"library-view":"titleview";$("TransportCenter").hide();application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"goback");application.events.unsubscribe(this,"select");application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"keyup");application.events.unsubscribe(this,"pointerclick");application.events.unsubscribe(this,"pointeractivated");application.events.unsubscribe(this,"pointerdeactivated");if(!this.persist.passID||this.persist.passID==""){log.write("SHOULD NOT FIRE");navigation.setFocus(this.lastFocus,true)}application.TempKeyBlock=true;application.TempKeyBlockDuration=2000;$("store").set("class","titleview");$("PlayerContainer").hide();Player.SetVisibility(false);$("uicontainer").removeClass("initPlayerBackground");BrowseView.showLogo();$("dock").show();$("mainstage").show()}else{log.write("handle return key error")}},getDisplayRatio:function(){var e=0,d=Player.GetVideoHeight(),f=Player.GetVideoWidth();if(d==0){e=0}else{e=Math.floor(f/d*100)/100}log.write("====== Video Size ========"+f+" X "+d);log.write("====== Video Ratio ========"+e);g_dRatio=e;return e},setVideoposAuto:function(){log.write("setVideoposAuto()");var k=0,j=0,l=960,g=540;var d=(Player.GetVideoWidth()==720)?640:Player.GetVideoWidth();var n=Player.GetVideoHeight();var r=1.78;var f=1.33;var e=this.getDisplayRatio();log.write("g_dRatio = "+e);if(e>f){var h=Math.floor((l*n)/d);var m=Math.floor((g-h)/2);log.write("x = "+k+" y = "+m+" width = "+l+" height = "+h);if(m<0){m=0}if(h>540){h=540}Player.SetDisplayArea(k,m,l,h)}else{var q=Math.floor((j*d)/n);var p=Math.floor((k-q)/2);log.write("x = "+p+" y = "+j+" width = "+q+" height = "+j);if(!isNaN(p)){Player.SetDisplayArea(p,j,q,j)}else{Player.SetDisplayArea(0,0,960,540)}}},_regKeyTimeout:function(d){if(this._currentStatus===this.PLAYING){setTimeout('BrowseView.PlayerControl.hideControls("'+BrowseView.PlayerControl._registerHideControls(d)+'")',3000)}},_registerHideControls:function(e){if(e==BrowseView.PlayerControl._hideCtrlId){BrowseView.PlayerControl.hideControls()}else{var d=Math.floor(Math.random()*new Date().getMilliseconds());BrowseView.PlayerControl._hideCtrlId=e+d}return BrowseView.PlayerControl._hideCtrlId},_OnStreamInfoReady:function(){if(BrowseView.currentState=="player-view"){log.write("Player.OnStreamInfoReady");var h=Player.GetDuration();var e=Player.GetVideoWidth();var d=Player.GetVideoHeight();if(Math.floor(h/1000)==this._startPos){log.write("EOF Detected at start this will not play a movie. Starting from beginning.");this._play(this.persist.url,0)}var f=parseInt(h,10);var g=Math.floor(f/1000);log.write("nTotTime: "+f);log.write("nTotSec: "+g);this.totalTime=h;this.setVideoposAuto();this._StreamBitRates();if(!this.isTrailer&&!this._isLoaded){this.setLoadingProgress(100);this.loadingTimer.Stop();this.loadingTimer.Interval=100;this.loadingTimer.Start()}if(!pointer.isPointerModeActive()&&!this.hasError){application.navigator.setFocus("transportPlayPause",true)}this._qualityCheck=setTimeout("BrowseView.PlayerControl._StreamBitRates()",10000)}else{this.stopPlayer();BrowseView.PlayerControl.hide()}},setRegisterBufferTimeout:function(){},msToSeconds:function(d){return d/1000},getCachedElement:function(e){var d=this.elementCache[e];if(!d){d=$(e);if(d){this.elementCache[e]=d}}return d},clearElementCache:function(){this.elementCache={}},onStutterStart:function(){if(!this.stutterTimer&&(this.stutterPosition!=this._currentTime)){var d=this;this.stutterTimer=setTimeout(function(){d.stutterTimer=null;if(d._currentStatus==d.PLAYING){log.write("PlayerControl.onStutterStart, pause player and rebuffer");d.stutterPosition=d._currentTime;Player.Pause();OnBufferingStart()}if(!d.hasError){setTimeout(function(){if(d._currentStatus==d.PLAYING){log.write("PlayerControl.onStutterStart, end rebuffer and continue play");Player.Resume()}},6000)}},2000)}},onStutterStop:function(){if(this.stutterTimer){log.write("PlayerControl.onStutterStop, clear stuter timer");clearTimeout(this.stutterTimer);this.stutterTimer=null}else{log.write("PlayerControl.onStutterStop, end rebuffer and clear loading");OnBufferingComplete()}},onSkipChapterEnd:function(){if(this._currentStatus==this.SKIPPING){log.write("onSkipChapterEnd, back to play state.");this._currentStatus=this.PLAYING;this._exitLocateMode();log.write("onSkipChapterEnd, clear buffering flag ("+this.isBuffering+")");this.isBuffering=false;this.hideLoading();this.setPlayStateDisplay("play");this._regKeyTimeout("resume")}},onScanToPlay:function(){if(this._currentStatus==this.TRICKPLAY){this._exitLocateMode("transportPlayPause");this.trickPlayCnt=this._playIndex;this.setPlayStateDisplay("play");this._currentStatus=this.PLAYING;this._regKeyTimeout("resume");this.playPauseKey="play";device.displayPlay()}},onLocateToPosition:function(){if(this.isBuffering||!this._isLoaded){log.write("===== Can't locate on Buffering or unloaded ===== ");return}var d=0;if(this.inLocateMode){d=parseFloat((this.skipStartPosition+this.skipTime)/1000);if(this._currentStatus===this.PLAYING){this._registerHideControls("skip")}}else{if(this._currentStatus==this.TRICKPLAY||this._currentStatus==this.PAUSED){d=this._currentTime/1000}}if(d){log.write("onLocateToPosition, play from: ("+d+")");this._currentStatus=this.SKIPPING;Player.LocateToPosition(d);this.isBuffering=true;this.showLoading(true)}},onStopped:function(){if(!this._swappedToSD){return}this._swappedToSD=false;var d=this,e;log.write("Current Bandwidth is too low or too many buffers. Switching to SD at: "+this._currentTime+" short buffer count: "+this._bufferCount+" long buffer count: "+this._longBufferCount);e=Math.floor(parseInt(this._currentTime)/1000);log.write("trying to restart sd at: "+e+" seconds.");$cn.methods.getStreamingAssetLocation(d.persist.passID,"STANDARD",function(g){var f=$cn.utilities.buildPlaybackURL(g.streamingAssetLocation,g.streamID,g.dRMServerURL,g.dRMACKServerURL,g.heartbeatURL,g.heartbeatPollInSeconds,false,g.customData);f=f+"HD_STREAM_ID="+d.persist.streamid+"|";d.load(d.persist.titleID,g.streamID,f,e,false,d.persist.passID,g.availableClosedCaptions,true)})},onTransportSkipRW:function(){if(BrowseView.currentState=="player-view"){var d={};application.events.publish("skipback",d)}},onTransportRW:function(){if(BrowseView.currentState=="player-view"){var d={};application.events.publish("rewind",d)}},onTransportPlayPause:function(){if(BrowseView.currentState=="player-view"){var d={};if(this._currentStatus===this.PLAYING){application.events.publish("pause",d)}else{application.events.publish("play",d)}}},onTransportStop:function(){if(BrowseView.currentState=="player-view"){var d={};application.events.publish("stop",d)}},onTransportFF:function(){if(BrowseView.currentState=="player-view"){var d={};application.events.publish("fastforward",d)}},onTransportSkipFF:function(){if(BrowseView.currentState=="player-view"){var d={};application.events.publish("skipforward",d)}},onClosedCaptionToggle:function(){if(BrowseView.currentState!="player-view"){return}var e=this.getCachedElement("CCState"),d=ccrender.isCCEnabled(),f=ccrender.isCCAvailable();if(f&&d){log.write("onClosedCaptionToggle  SetCCEnabled(false)");e.removeClass("CCOn");e.addClass("CCOff");Player.SetCCEnabled(false);ccrender.setCCEnabled(false)}if(f&&!d){log.write("onClosedCaptionToggle  SetCCEnabled(true)");e.removeClass("CCOff");e.addClass("CCOn");Player.SetCCEnabled(true);ccrender.setCCEnabled(true)}this._regKeyTimeout("navigate")},mouseMoveWakeupCtl:function(){var d;$("PlayerContainer").addEvent("mousemove",function(){if(this._isControlHidden()){this.showControls()}if(d){clearTimeout(d)}d=setTimeout(function(){this._regKeyTimeout("navigate")}.bind(this),2000)}.bind(this))},unbindeMouseMoveWakeupCtl:function(){$("PlayerContainer").removeEvents("mousemove")},_onPlayerClick:function(){if(BrowseView.currentState!="player-view"){return}if(this._currentStatus==this.PLAYING){if(application.isBusy||!this._isLoaded||this.isBuffering){log.write("===== No need to show PlayerControl bar when loading, buffering or application is busy =====");return}if(this._isControlHidden()){this.showControls()}this._regKeyTimeout("navigate")}}},PlayerControl=new Class(PlayerControlProperties);function OnRenderingComplete(){log.write("Player.OnRenderingComplete");$("PlayerTop","PlayerLocateBottom").style.display="none";setTimeout(function(){$("PlayerTop","PlayerLocateBottom").style.display=""},3000);log.write("Video Stopped while: "+BrowseView.PlayerControl._currentStatus);log.write("Playback Speed: "+BrowseView.PlayerControl._trickPlayArr[BrowseView.PlayerControl.trickPlayCnt]);if(BrowseView.PlayerControl._currentStatus==3&&BrowseView.PlayerControl._trickPlayArr[BrowseView.PlayerControl.trickPlayCnt]<0){BrowseView.PlayerControl.stopPlayer();setTimeout(function(){BrowseView.PlayerControl._isLoaded=false;BrowseView.PlayerControl._readyForTrick=false;BrowseView.PlayerControl.hideControls("",true);BrowseView.PlayerControl.trickPlayCnt=BrowseView.PlayerControl._playIndex;BrowseView.PlayerControl._play(BrowseView.PlayerControl.persist.url,0)},500)}else{BrowseView.PlayerControl._stop(true)}}function OnStreamInfoReady(){BrowseView.PlayerControl._OnStreamInfoReady()}function OnCurrentPlayTime(d){BrowseView.PlayerControl._OnTimeChanged(d)}function OnBufferingStart(){log.write("Player.OnBufferingStart =====================");var d=BrowseView.PlayerControl.isBuffering;BrowseView.PlayerControl.isBuffering=true;if(BrowseView.PlayerControl._isLoaded){BrowseView.PlayerControl.showLoading(true)}if(!d){log.write("$$$$$$$$$ about to call register buffer ================================");BrowseView.PlayerControl.registerBuffer()}else{log.write("%%%%%%%%% did not call register buffer, there is already another ongoing buffer event +++++++++++++++++++++++++++++++++")}log.write("_currentStatus from bottom of OnBufferingStart(): "+BrowseView.PlayerControl._currentStatus)}function OnBufferingProgress(d){log.write("Player.OnBufferingProgress: prog("+d+")")}function OnBufferingComplete(){log.write("Player.OnBufferingComplete");if(BrowseView.currentState!="player-view"){return}if(!BrowseView.PlayerControl._isLoaded){BrowseView.PlayerControl.hideLoading();BrowseView.PlayerControl.isBuffering=false;BrowseView.PlayerControl.listenForLoad();if(BrowseView.PlayerControl._currentTime>2000){BrowseView.PlayerControl._readyForTrick=true}BrowseView.PlayerControl._regKeyTimeout("play");if(BrowseView.PlayerControl.playerTimeout){clearTimeout(BrowseView.PlayerControl.playerTimeout);BrowseView.PlayerControl.playerTimeout=null}if(BrowseView.PlayerControl.bufferCheckTimeout){clearTimeout(BrowseView.PlayerControl.bufferCheckTimeout);BrowseView.PlayerControl.bufferCheckTimeout=null}BrowseView.PlayerControl.showControls()}else{BrowseView.PlayerControl.hideLoading();BrowseView.PlayerControl.isBuffering=false}}function OnNetworkDisconnected(){if(BrowseView.currentState!="player-view"){return}log.write("Player.OnNetworkDisconnected");BrowseView.PlayerControl._onError("OnNetworkDisconnected")}function OnAuthenticationFailed(){if(BrowseView.currentState!="player-view"){return}log.write("Player.OnAuthenticationFailed");BrowseView.PlayerControl._onError("OnAuthenticationFailed")}function OnConnectionFailed(){if(BrowseView.currentState!="player-view"){return}log.write("Player.OnConnectionFailed");BrowseView.PlayerControl._onError("OnConnectionFailed")}function OnRenderError(){if(BrowseView.currentState!="player-view"){return}log.write("Player.OnRenderError");BrowseView.PlayerControl._onError("OnRenderError")}function OnStreamNotFound(){if(BrowseView.currentState!="player-view"){return}log.write("Player.OnStreamNotFound");if(BrowseView.PlayerControl.isTrailer){BrowseView.PlayerControl._onError("OnStreamNotFound_trailer")}else{BrowseView.PlayerControl._onError("OnStreamNotFound")}}function OnCustomEvent(e){if(BrowseView.currentState!="player-view"){return}var d=String(e);log.write("Player.OnCustomEvent: "+e);BrowseView.PlayerControl._onError("OnWideVineError_"+d)}function OnPlaybackStutterStart(){if(BrowseView.currentState!="player-view"){return}log.write("OnPlaybackStutterStart");BrowseView.PlayerControl.onStutterStart()}function OnPlaybackStutterStop(){if(BrowseView.currentState!="player-view"){return}log.write("OnPlaybackStutterStop");BrowseView.PlayerControl.onStutterStop()}function OnPlaybackSkipChapterEnd(){if(BrowseView.currentState!="player-view"){return}log.write("OnPlaybackSkipChapterEnd");BrowseView.PlayerControl.onSkipChapterEnd()}function OnPlaybackStopped(){if(BrowseView.currentState!="player-view"){return}log.write("OnPlaybackStopped");BrowseView.PlayerControl.onStopped()}function OnPlaybackCCData(d){if(BrowseView.currentState!="player-view"){return}log.write("OnPlaybackCCData");if(BrowseView.PlayerControl._currentStatus==BrowseView.PlayerControl.STOPPED){ccrender.clean()}else{ccrender.renderCCXMLNodes(d)}}function OnUpdateCCState(d){if(BrowseView.currentState!="player-view"){return}log.write("OnUpdateCCState");BrowseView.PlayerControl.updateCCState(d)}function OnScanToPlay(){if(BrowseView.currentState!="player-view"){return}log.write("OnScanToPlay");BrowseView.PlayerControl.onScanToPlay()}var LibraryClass={id:"librarypanel",isInvalid:false,tplKey:null,tpl:null,_data:[],scroll:false,_timer:600,_periodical:"",_timerStarted:false,initialize:function(d){application.events.subscribe(this,"navigate",this.handleNavigate.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));this.id=d;this.tplKey=this.id;this.tpl=new ui.template(this.id,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile();log.write(this.id+".init()")},cleanUI:function(){if($(this.id).getChildren().length>0){$(this.id).getChildren().destroy()}},setFocus:function(){if($("librarypanel").getStyle("display")=="block"){if($("btnLibraryActivate").getStyle("display")=="block"){navigation.setFocus("btnLibraryActivate",true)}else{navigation.setFocus("btnLibraryBrowseStore",true)}}else{navigation.setFocus("selectedmaster",true)}},show:function(){var d=this;log.write("triggered show");$("mainstage").show();if($cn.data.AuthToken.length==0){BrowseView.hideExtras();$("librarypanel").show();$("librarytop").show();$("librarytop").getElement(".buttons").addClass("double");$$(".libraryActivate").show();this.setFocus();if(BrowseView.MessagePopup){BrowseView.MessagePopup.resetFocus()}}else{BrowseView.CurrentProcessLoaded=false;$cn.utilities.showSharedLoadingModal(0,application.resource.loading_enum.library);$cn.methods.getUserLibraryExt(function(e){$cn.utilities.clearSharedLoadingSpinner();if(e.items.length>0){$("librarypanel").hide();$("librarytop").hide();$("wheel").show();$("singlewheel").hide();if(!BrowseView.LibraryWheelControl){BrowseView.LibraryWheelControl=new LibraryWheelControl()}BrowseView.GridControl.cleanUI();BrowseView.LibraryWheelControl.activate();BrowseView.LibraryWheelControl.lastSlaveValue=false;BrowseView.LibraryWheelControl.loadLibraryMenu(e);navigation.setFocus("selectedmaster",true);if(BrowseView.MessagePopup){BrowseView.MessagePopup.resetFocus()}}else{BrowseView.hideExtras();$("librarytop").getElement(".buttons").removeClass("double");$("librarypanel").show();$("wheel").hide();$("singlewheel").hide();$("librarytop").show();$$(".libraryActivate").hide();navigation.setFocus("btnLibraryBrowseStore",true);application.currentView.layoutIsDirty=true;BrowseView.CurrentProcessLoaded=true}})}$("uicontainer").addClass("redbuttons")},handleNavigate:function(d){if(BrowseView.currentState=="library-view"){if(d.args[0].direction=="left"&&application.element.current=="btnLibraryBrowseStore"){d.preventDefault();if(document.getElementById("btnLibraryActivate")&&document.getElementById("btnLibraryActivate").style.display=="block"){navigation.setFocus("btnLibraryActivate",true)}else{navigation.setFocus("dock-library",true)}if(BrowseView.MessagePopup){BrowseView.MessagePopup.resetFocus()}}}},hide:function(){this.stopRefresh();$("librarypanel").hide()},startRefresh:function(){if(!this._timerStarted){log.write("**********start refresh: "+this._timerStarted);$clear(this._periodical);this._timerStarted=true;this._periodical=this.refresh.periodical(this._timer*1000)}},refresh:function(){if(BrowseView.currentState=="library-view"){log.write("**********refreshing library.....");BrowseView.Library.show()}else{BrowseView.Library.stopRefresh()}},stopRefresh:function(){log.write("**********stop refresh");$clear(BrowseView.Library._periodical);BrowseView.Library._timerStarted=false},loadData:function(f,d,e){this._data=[];this._data=f;this.draw()},onScroll:function(d,e){},draw:function(){var d=this;this.cleanUI();this.tpl.empty();this._data.each(function(e){log.write(e);d.tpl.append(e)});this.tpl.apply()},checkUVTermsOfService:function(){var d=this;if($cn.config.UVTOSEnabled){if($cn.data.UVTermsAcceptance=="accepted"){return true}else{$cn.methods.getUVTermsOfServiceAcceptance(function(e){$cn.data.UVTermsAcceptance=e;if(e!="accepted"){$cn.methods.getUVTermsOfService(d.showUVTermsOfService.bind(d))}else{if(e=="accepted"){return true}}})}}},showUVTermsOfService:function(d){this.Legal=new LegalPopup("uvtermsofservice");var e=application.resource.uv_messages.uvTermsOfService;this.Legal.loadData([{title:($cn.data.UVTermsAcceptance=="changed"?e.ChangedMessage:e.UnacceptedMessage),content:e.Content,text:d,OK:e.OK,Close:e.Close,AcceptAction:"BrowseView.Library.acceptUVTermsOfService(true)",CloseAction:"BrowseView.Library.Legal.hide()"}]);this.layoutIsDirty=true;this.Legal.firstFocus="LegalOK";this.Legal.show();$("SplashScreen").hide()},acceptUVTermsOfService:function(e){var d=this;$cn.methods.acceptUVTermsOfService(function(f){d.Legal.hide();d.Legal.hide();$("Overlay").setStyle("background-color","transparent");$cn.data.UVTermsAcceptance=f})},onActivate:function(){BrowseView.showActivate({callback:function(){this.show();navigation.setFocus("dock-library",true);if(BrowseView.MessagePopup){BrowseView.MessagePopup.resetFocus()}}.bind(this)})},onRestoreState:function(e){var d=e.args[0];if(d.store.currentState=="library-view"&&application.element.current=="selectedmaster"){d=d[this.id];$extend(this,d);if($cn.data.AuthToken!=""){this.show()}}}},Library=new Class(LibraryClass);var LibraryWheelControl=new Class({DEBUG:false,Extends:WheelControl,Implements:WheelControl,id:"LibraryWheelControl",currentMasterValue:"Movies",currentSlaveValue:"",masterWheelOptionList:[],libraryItems:{},MOVIE_GENRES:["Action","Adventure","Animation","Comedy","Drama","Family","Horror","Romance","Sci-Fi","Thriller","Westerns"],TV_GENRES:["Action","Adventure","Animation and Cartoons","Comedy","Drama","Family","Food and Leisure","Home and Garden","Horror","Music","Other","Reality and Game Shows","Romance","Sci-Fi","Sports","Thriller","Westerns"],MasterWheel_ORDER:["Movies","Movie_Rentals","HD_Movies","HD_TV_Shows","TV_Shows"],MOVIES_ORDER:["All","UltraViolet","Never_Watched","Unavailable","Action","Adventure","Animation","Comedy","Drama","Family","Horror","Romance","Sci-Fi","Thriller"],MOVIES_RENTALS_ORDER:["All","Never_Watched","Unavailable","Action","Adventure","Animation","Comedy","Drama","Family","Horror","Romance","Sci-Fi","Thriller","Expired","Expiring_Soon"],TV_ORDER:["All","Never_Watched","Unavailable","Action","Adventure","Animation and Cartoons","Comedy","Drama","Family","Food and Leisure","Home and Garden","Horror","Music","Other","Reality and Game Shows","Romance","Sci-Fi","Sports","Talk and Interview","Thriller","Westerns"],processRawData:function(d,f){var e;this.libraryItems={};this.UV=new $cn.utilities.UserUVManager();this.UV.checkUVAccount(function(p){for(var k=0;k<d.items.length;k++){var h=[];var g=[];e=d.items[k];if(!p&&$cn.utilities.isTrue(e.isPassUV)){continue}switch(e.titleClassification){case"Movie":if(h.indexOf("Movies")<0){h.push("Movies")}break;case"TV_Show":case"TV_Season":case"TV_Episode":if(h.indexOf("TV_Shows")<0){h.push("TV_Shows")}break;default:break}if(e.isHD==true&&h.indexOf("HD_Movies")<0&&e.titleClassification=="Movie"){h.push("HD_Movies")}if(e.isHD==true&&h.indexOf("HD_TV_Shows")<0&&e.titleClassification!="Movie"){h.push("HD_TV_Shows")}if(e.purchaseType=="rent"){if(h.indexOf("Movie_Rentals")<0){h.push("Movie_Rentals")}if(e.minutesToExpire>0&&e.minutesToExpire<7*24*60&&g.indexOf("Expiring_Soon")<0){g.push("Expiring_Soon")}}if(p&&$cn.utilities.isTrue(e.isPassUV)&&(-1===$cn.utilities.inArray("UltraViolet",g))){if(g.indexOf("UltraViolet")<0){g.push("UltraViolet")}}var q=false;switch(e.watchStatus){case"WatchNow":if(g.indexOf("All")<0){g.push("All")}break;case"ExpiredRental":if(g.indexOf("All")<0){g.push("All")}if(g.indexOf("Expired")<0){g.push("Expired")}break;default:if(g.indexOf("All")<0){g.push("All")}if(g.indexOf("Unavailable")<0){g.push("Unavailable")}this.configObject(h,g,e);q=true;break}if(q){continue}if($cn.utilities.getMeta("LicensesDelivered",e.metaValues)=="0"&&g.indexOf("Never_Watched")<0){g.push("Never_Watched")}if(e.genres){var n;var j=(e.titleClassification=="Movie")?this.MOVIE_GENRES:this.TV_GENRES;for(var l=0;l<e.genres.length;l++){n=e.genres[l];for(var m=0;m<j.length;m++){if(j[m]==n.name&&g.indexOf(n.name)<0){g.push(n.name);break}}}}this.configObject(h,g,e)}f(this)}.bind(this),true)},configObject:function(e,d,h){if(this.DEBUG){log.write("librarywheel.configObject Debug: Enter with "+e+", "+d+", "+h)}for(var g=0;g<e.length;g++){if(!this.libraryItems[e[g]]){this.libraryItems[e[g]]={}}for(var f=0;f<d.length;f++){if(e[g]=="Movie_Rentals"||(d[f]!="Expired"&&d[f]!="Expiring_Soon")){if(!this.libraryItems[e[g]][d[f]]){this.libraryItems[e[g]][d[f]]=[]}if(this.DEBUG){log.write("librarywheel.configObject Debug: About to push targetItem "+h+" into "+e[g]+", "+d[f])}this.libraryItems[e[g]][d[f]].push(h)}}}},getMasterWheelOptions:function(){var d=[];for(var f=0;f<this.MasterWheel_ORDER.length;f++){for(var e in this.libraryItems){if(e==this.MasterWheel_ORDER[f]){d.push(e);break}}}return d},getSlaveWheelOptionsbyMasterWheel:function(d){var l=[];switch(d){case"Movies":case"HD_Movies":l=this.MOVIES_ORDER;break;case"Movie_Rentals":l=this.MOVIES_RENTALS_ORDER;break;case"TV_Shows":case"HD_TV_Shows":l=this.TV_ORDER;break}var e=[];var h=[];for(var g in this.libraryItems[d]){for(var k=0;k<l.length;k++){if(g==l[k]){h[k]=true;break}}}for(var f=0;f<h.length;f++){if(h[f]){var j=application.resource.LibSlaveWheelOptions[l[f]];if(!j){j=l[f].replace("_","<br/>")}e.push({name:j,iD:l[f]})}}return e},getContentbyWheelOptions:function(d,e){return this.libraryItems[d][e]},loadLibraryMenu:function(d,e){this.processRawData(d,function(){var f=this.getMasterWheelOptions();var k=[],h=0;if($cn.config.EnableD2D&&$cn.config.DeviceD2DEnabled){f.push("D2D_Movies")}for(var g=0;g<f.length;++g){var j=f[g];log.write(f[g]);if(j==e){h=g}k.push({iD:j,name:application.resource.LibMasterWheelOptions[j]})}this.currentMasterValue=f[h];this.loadData(k,{},h);this.loadSlaveDataSource(this.currentMasterValue);navigation.setFocus("selectedmaster",true)}.bind(this))},handleWheelItemChange:function(j){if(j.context===ActiveWheel){var g=this,h=j.args[0],e=h.source[h.selectedidx].parentID,d=h.selectedvalue;if(h.sourceid.indexOf("master")>-1){e=h.selectedvalue;this.currentMasterValue=h.selectedvalue;$("slavedatasource").getElements("div").destroy();j.context.loadSlaveDataSource(this.currentMasterValue)}this.lastValue=d;BrowseView.CurrentWheelValue=e+":"+d;if(h.sourceid.indexOf("slave")>-1){e=j.context.currentMasterValue;this.lastSlaveValue=d;log.write("The slave wheel item has changed. Update results.");if(e=="D2D_Movies"&&d=="Info"){var f=[{title:application.resource.lib_d2d_info.title,step1:application.resource.lib_d2d_info.step1,step2:application.resource.lib_d2d_info.step2,step3:application.resource.lib_d2d_info.step3}];BrowseView.LastGridProcess="d2dinfo";application.events.publish("loadgrid",{grid:"disctodigitalgrid",gridProcess:"d2dinfo",data:f,columns:1,template:"disctodigitalgrid"})}else{if(g.lastValue&&(g.lastValue==e||g.lastValue==d)){application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:3});BrowseView.CurrentLibraryGenreID=this.lastValue;setTimeout(function(){if(g.lastValue&&(g.lastValue==e||g.lastValue==d)){g.loadSlaveGrid(h.source[h.selectedidx])}},1000)}}}}},loadSlaveDataCallback:function(e){this._slaveSource[e]=this.getSlaveWheelOptionsbyMasterWheel(e);var f=this._slaveSource[e].length;var d=0;if(this.lastSlaveValue){while(f--){if(this._slaveSource[e][f].iD==this.lastSlaveValue){d=f;log.write("FOuND IT at index"+f)}}}if(d===0){this.lastSlaveValue=false}this._renderWheel($("slavedatasource"),this._slaveSource[e],d);application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:3});this.loadSlaveGrid(this._slaveSource[e][d])},loadSlaveDataSource:function(g){var f=this,d=0;BrowseView.CurrentProcessLoaded=false;log.write("masterKey: "+g);this._slaveSource[g]=[];if(g=="D2D_Movies"){this._slaveSource[g].push({name:application.resource.LibSlaveWheelOptions.Info,iD:"Info"});var e=[{title:application.resource.lib_d2d_info.title,step1:application.resource.lib_d2d_info.step1,step2:application.resource.lib_d2d_info.step2,step3:application.resource.lib_d2d_info.step3}];this._renderWheel($("slavedatasource"),this._slaveSource[g],d);BrowseView.LastGridProcess="d2dinfo";application.events.publish("loadgrid",{grid:"disctodigitalgrid",gridProcess:"d2dinfo",data:e,columns:1,template:"disctodigitalgrid"})}else{f.loadSlaveDataCallback(g)}},loadSlaveGrid:function(d){BrowseView.LastGridProcess="librarylist";var e=this.getContentbyWheelOptions(this.currentMasterValue,d.iD);if(e.length>0){application.events.publish("loadgrid",{grid:"titlegrid",data:e,columns:3,gridProcess:"librarylist",template:"librarylist",cssClass:"library"})}else{application.events.publish("loadgrid",{grid:"titlegrid",data:null,template:"librarylist",gridProcess:"librarylist",cssClass:"library"})}BrowseView.CurrentProcessLoaded=true}});var ImagePopup=new Class({Extends:ModalControl,id:"imagepopup",currentIdx:0,initialize:function(){application.events.subscribe(this,"navigate",this.navigate.bind(this));this.parent(this.id,"ImageContent")},navigate:function(d){if(document.getElementById(application.element.current)!=null&&application.element.current=="closeImagePopup"){if(d.args[0].direction=="left"||d.args[0].direction=="right"){$("ImageContent").getChildren("div.imageholder")[this.currentIdx].hide();switch(d.args[0].direction){case"left":if(this.currentIdx>0){this.currentIdx=this.currentIdx-1}break;case"right":if(this.currentIdx+1<this._data.length){this.currentIdx=this.currentIdx+1}break}$("ImageContent").getChildren("div.imageholder")[this.currentIdx].show();this.setArrows()}}},setArrows:function(){$("rightArrow").hide();$("leftArrow").hide();if(this.currentIdx>0){$("leftArrow").show()}if(this._data.length>1&&this._data.length-1!=this.currentIdx){$("rightArrow").show()}},show:function(d){if(d){this.currentIdx=d}else{this.currentIdx=0}this.lastFocus=application.element.current;navigation.setFocus("closeImagePopup",true);BrowseView.hideLogo();$("dock").hide();$("uicontainer").setStyle("background","none");$("mainstage").hide();$("imagepopup").show();$("closeImagePopup").show();$("ImageContent").getChildren("div.imageholder")[this.currentIdx].show();this.setArrows()},hide:function(){navigation.setFocus(this.lastFocus,true);$("closeImagePopup").hide();$("imagepopup").hide();$("uicontainer").setStyle("background","#181818");BrowseView.showLogo();$("dock").show();$("ImageContent").getChildren("div.imageholder").hide();$("mainstage").show()},});var HelpPanelControl=new Class({id:"helppanel",persist:{},controls:{},layoutIsDirty:true,contentId:"helppanel",tpl:null,initialize:function(){$("helppanel").hide();log.write("helppanel.init()");application.events.subscribe(this,"wheelitemchanged",this.handleSettingWheelChange.bind(this));this.tpl=new ui.template(this.contentId,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile()},handleSettingWheelChange:function(e){var d=e.args[0];if(d.wheelinstance=="HelpWheelControl"){log.write("Help Panel (wheel changed)");log.write(d);$$("#helppanel .panel").each(function(f){f.hide()});log.write("selected: "+d.selectedvalue);if($(d.selectedvalue)){$(d.selectedvalue).show()}}},hideIfNoBaseline:function(d){var e="";if(!$cn.data.baselineEnable){e="hide"}return e},showIfNoBaseline:function(d){var e="";if($cn.data.baselineEnable){e="hide"}return e},hideIfNoJinni:function(d){var e="";if(!$cn.data.jinniEnable){e="hide"}return e},showIfNoJinni:function(d){var e="";if($cn.data.jinniEnable){e="hide"}return e},show:function(){$("helppanel").show();this.tpl.append({custom:""});this.tpl.apply()},hide:function(){$("helppanel").hide()},getAccountLinkUrl:function(){return $cn.data.AccountLinkUrl},tm:function(){return"&#0153;"}});var HelpWheelControl=new Class({Extends:WheelControl,id:"HelpWheelControl",container:"singlewheel",singleWheel:true,MetaData:[],masterSourceElement:"singlemasterdatasource",masterSelectedElement:"singleselectedmaster",handleWheelItemChange:function(e){log.write(e);if(e.context===ActiveWheel){var d=e.args[0];log.write("Search Wheel Item changed. Now fire custom method. "+e.args[0].wheelinstance);application.events.publish("wheelvaluechanged",{selectedvalue:d.selectedvalue,wheelinstance:this.id})}},loadHelpMenu:function(){application.currentView.layoutIsDirty=true;this.cleanUI();if($cn.config.EnableUV){this.loadData([{name:application.resource.HelpWheelOptionStrings.GettingStarted,iD:"GettingStarted",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.BrowsingStore,iD:"BrowsingStore",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.Searching,iD:"Searching",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.WishList,iD:"WishList",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.Library,iD:"Library",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.ParentalControls,iD:"ParentalControls",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.OnscreenControls,iD:"OnscreenControls",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.CustomerSupport,iD:"CustomerSupport",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.RentingBuying,iD:"RentingBuying",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.Ultraviolet,iD:"Ultraviolet",parentID:0,list:1}],[{}])}else{this.loadData([{name:application.resource.HelpWheelOptionStrings.GettingStarted,iD:"GettingStarted",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.BrowsingStore,iD:"BrowsingStore",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.Searching,iD:"Searching",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.WishList,iD:"WishList",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.Library,iD:"Library",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.ParentalControls,iD:"ParentalControls",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.OnscreenControls,iD:"OnscreenControls",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.CustomerSupport,iD:"CustomerSupport",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.RentingBuying,iD:"RentingBuying",parentID:0,list:1}],[{}])}application.events.publish("wheelvaluechanged",{selectedvalue:"GettingStarted",wheelinstance:this.id})}});var EpisodePanelControl=new Class({id:"episodepanel",title:null,initialize:function(){},show:function(){$("titlelist").innerHTML="";this.title=BrowseView.TitleViewControl.persist.title;this.title.show=$cn.utilities.ellipsis(this.title.show,30);BrowseView.GridControl.loadHeader("episode_header.tpl",this.title);if(!this.TvSeasonsWheelControl){this.TvSeasonsWheelControl=new TvSeasonsWheelControl()}this.TvSeasonsWheelControl.isLibrary=this.title.passID!=null;this.TvSeasonsWheelControl.isSeasonal=this.title.seasonal;if(this.title.passID!=null){if(this.title.seasonal){$cn.methods.getBundleListingPurchased(this.title.showTitleID,function(e){log.write(e.bundleItems.length);this.TvSeasonsWheelControl.activate();this.TvSeasonsWheelControl.loadData(e.bundleItems,this.title.seasonTitleID);BrowseView.shrinkTitleDetails("episode-panel",null)}.bind(this))}else{this.TvSeasonsWheelControl.activate();this.TvSeasonsWheelControl.loadData([{titleID:this.title.showTitleID}]);BrowseView.shrinkTitleDetails("episode-panel",null)}}else{var d=this.title.seasonal?"episodegrid":"episodegrid-wide";application.events.publish("gridloading",{grid:"titlegrid",message:"tvloading",className:d,cssClass:"tv"});$cn.methods.getBundleListing(this.title.showTitleID,function(e){log.write(e.bundleItems.length);application.currentView.layoutIsDirty=true;if(e.bundleItems.length==0){log.write("##### ERROR - Empty bundle listing ######");application.events.publish("error",{type:"system_error",method:"getBundleListing"});return}BrowseView.shrinkTitleDetails("episode-panel",null);if(!this.title.seasonal){$("titlegrid").show();BrowseView.LastGridProcess="episodelist";application.events.publish("loadgrid",{grid:"titlegrid",data:[],columns:1,template:"listgrid",gridProcess:"episodelist",className:"episodegrid-wide",returnFocus:application.element.current});navigation.setFocusElement($("titlelist").getElements("a")[0],true)}else{this.TvSeasonsWheelControl.activate();this.TvSeasonsWheelControl.loadData(e.bundleItems,this.title.seasonTitleID)}}.bind(this))}},hide:function(){},onItemSelected:function(d){if(this.TvSeasonsWheelControl.isLibrary){$cn.methods.lookupPurchaseDetailsForTitle(d,function(e){application.events.publish("loadtitleview",{id:d,passID:parseInt(e.passID),type:"library"})})}else{application.events.publish("loadtitleview",{id:d,checklibrary:true})}}});var WelcomeControlProperties={id:"welcomecontrol",persist:{},controls:{},buttons:[],layoutIsDirty:true,_data:[],lastFocus:null,firstFocus:null,contentControlId:"",contentId:"welcomecontrol",initialize:function(e,d){this.id=e},getStarted:function(){$("welcomeintro").hide();$("welcomebutton").hide();if($("welcomebuttonmask")){$("welcomebuttonmask").hide()}application.events.unsubscribe(this,"pointeractivated");$("welcomemessage").show();if($cn.config.EnableUV&&$("uvwelcomebenefit")){$("uvwelcomebenefit").removeClass("hidden")}application.navigator.setFocus("leftbutton",true)},startActivation:function(){BrowseView.ActivationPcView.activeFromWelcome=true;BrowseView.ActivationPcView.show()},explore:function(){this.hide()},init:function(f,e){log.write("merchcontrol.init()");var d=this;if(f){this.persist=f}},cleanUI:function(){},loadData:function(d){this._data=[];this._data=d},show:function(){log.write("Showing Welcome Page.");application.events.subscribe(this,"pointeractivated",this.onPointerActivated.bind(this));$("welcome").show()},onBack:function(d){log.write(d)},hide:function(d){if($cn.data.d2dPath){log.write("D2D LOAD TITLE");log.write("D2D LOAD TITLE");log.write("D2D LOAD TITLE");log.write("D2D LOAD TITLE");log.write("D2D LOAD TITLE");log.write("D2D LOAD TITLE");$("store").set("class","browse-view");application.events.publish("loadtitleview",{id:$cn.data.d2dTitleInfo.id,action:"checkout"});setTimeout(function(){if($("welcome")){$("welcome"