var WebSocketManager={socket:null,requestsSent:null,requestId:0,connecting:false,reconnecting:false,reconnectcount:0,retrytimeout:null,connected:false,shuttingDown:false,handlers:{},url:"",openSuccess:null,openError:null,onOpen:function(){log.write("WebSocketManager.onopen: connected!");var e=this;this.connecting=false;this.connected=true;var g=application.appSetting("CacheLimitMetadata");if(g==-1){g=2097152}var d=application.appSetting("CacheLimitClosedcaption");if(d==-1){d=2097152}var f={CNO_CACHE_LOCAL_PATH:"cache"};configuration.callReadAllSettings(null,function(){this.send("<RNOWebServiceCall>$$REQUESTID$$<NetworkSettings><ConnectTimeout>"+application.appSetting("NetworkConnectTimeout")+"</ConnectTimeout><SendTimeout>"+application.appSetting("NetworkSendTimeout")+"</SendTimeout><ReceiveTimeout>"+application.appSetting("NetworkReceiveTimeout")+"</ReceiveTimeout></NetworkSettings></RNOWebServiceCall>",e,function(j){if(!e.reconnecting){var h=f.CNO_CACHE_LOCAL_PATH;this.send("<RNOCacheCall>$$REQUESTID$$<CacheSettings><CachePath>"+h+'</CachePath><CacheLimit type="closedcaptions">'+d+'</CacheLimit><CacheLimit type="Metadata">'+g+"</CacheLimit></CacheSettings></RNOCacheCall>",e,function(k){if(!e.reconnecting){log.write("WebSocketManager.onopen: NetworkSettings response: "+k);this.openSuccess.call(this)}e.reconnecting=false;e.reconnectcount=0}.bind(e))}}.bind(e))}.bind(e),f)},onError:function(){if(this.connecting){log.write("WebSocketManager.onerror: error while connecting");this.connecting=false;if(!this.reconnecting){this.connecting=false;this.openError.call(this)}else{var d=this;this.reconnectcount++;this.retrytimeout=setTimeout(function(){log.write("WebSocketManager.onError: Retry number "+this.reconnectcount);this.reconnecting=true;this.connect()}.bind(d),500)}}else{if(this.connected&&!this.shuttingDown){log.write("WebSocketManager.onerror: error on send/response or out of the blue")}else{if(this.connected&&this.shuttingDown){log.write("WebSocketManager.onerror: error on close")}}}},onClose:function(){log.write("WebSocketManager.onclose: shuttingdown: "+this.shuttingDown);var f=false;if((this.connected||this.connecting)&&!this.shuttingDown){f=true}for(var d=this.requestsSent.getOldestIndex();d<this.requestsSent.getTotalSize();d++){var e=this.requestsSent.getElementAt(d);if(!e.responded){e.responded=true;this.respondSocketError(e)}}this.requestsSent.clear();this.connected=false;this.connecting=this.reconnecting;this.shuttingDown=false;if(f){this.reconnectcount++;this.reconnecting=true;log.write("WebSocketManager.onClose: reconnect attempt number "+this.reconnectcount);this.connect()}},onMessage:function(j){var d=-1;var l="";var h=null;d=this.getRequestId(j.data);if(d>-1){for(var f=this.requestsSent.getOldestIndex();f<this.requestsSent.getTotalSize();f++){h=this.requestsSent.getElementAt(f);if(h.id==d){h.responded=true;if(f==this.requestsSent.getOldestIndex()){while(this.requestsSent.getOldestElement()&&this.requestsSent.getOldestElement().responded){this.requestsSent.dequeue()}}h.callback.call(h.callback.context,j.data);break}}}else{var m;try{m=XML.rootFromString(j.data)}catch(k){log.write("WebSocketManager.onmessage: Error parsing XML from event data");m=null}if(m!==null){var g=m.firstChild;if(g.nodeName in this.handlers){this.handlers[g.nodeName].callback.call(this.handlers[g.nodeName].context,g)}else{log.write("WebSocketManager.onmessage: nodeName "+g.nodeName+" not in handlers :: "+XML.toString(m))}}else{log.write("WebSocketManager.onmessage: null dom")}}},initialize:function(e,f,d){this.openSuccess=f;this.openError=d;this.url=(e&&e.length>0)?e:"ws://localhost:31415/res";if(!this.requestsSent){this.requestsSent=new Queue()}this.connect()},connect:function(){log.write("WebSocketManager.connect: Connecting!");var d=this;this.connecting=true;this.socket=new WebSocket(this.url);this.socket.onopen=this.onOpen.bind(d);this.socket.onerror=this.onError.bind(d);this.socket.onclose=this.onClose.bind(d);this.socket.onmessage=this.onMessage.bind(d)},shutdown:function(){if(this.connected&&!this.shuttingDown){this.socket.close();this.shuttingDown=true}},send:function(d,f,h){var g={id:this.requestId++,responded:false,requestData:d,context:f,callback:h};if(this.connected&&!this.shuttingDown&&this.requestsSent!==null){var e=d.split("$$REQUESTID$$");if(e.length==2){d=e[0];d+='<UserData ID="'+g.id+'"></UserData>';d+=e[1]}else{log.write("WebSocketManager.send: $$REQUESTID$$ not found")}this.requestsSent.enqueue(g);this.socket.send(d)}else{this.respondSocketError(g)}},getRequestId:function(e){var h=XML.rootFromString(e);var d=h.getElementsByTagName("UserData");if(d&&d.length&&d[0].attributes&&d[0].attributes.length){var g=d[0].attributes;for(var f=0;f<g.length;f++){if(g[f].nodeName=="ID"){return new Number(g[f].nodeValue)}}}return -1},addHandler:function(d,e,f){this.handlers[d]={callback:f,context:e}},respondSocketError:function(e){var d="<Response>";if(e.requestData.split("$$REQUESTID$$").length==2){d+='<UserData ID="'+e.id+'"></UserData>'}d+="<SocketError>There was a socket connection error.</SocketError></Response>";e.callback.call(e.context,d)},clearContentCache:function(e){var d=this;this.send('<RNOCacheCall>$$REQUESTID$$<PurgeData tableType="metadata" cacheType="Metadata"/></RNOCacheCall>',d,function(f){e.call()}.bind(d))}};1;var helpers={extend:function(e,d){for(var f in (d||{})){e[f]=d[f]}return e}};helpers.extend(Element.prototype,{isParentOf:function(d){if(d.getParent()==this){return true}else{if(d.getParent()!=null){return this.isParentOf(d.getParent(),this)}}return false},intersects:function(d){if((this.offsetLeft==d.offsetLeft)||((this.offsetLeft>d.offsetLeft)&&this.offsetLeft+this.offsetWidth<=d.offsetLeft+d.offsetWidth)){return true}else{return false}}});Array.prototype.contains=function(e){var d=this.length;while(d--){if(this[d]==e){return true}}return false};helpers.extend(String.prototype,{reverse:function(){return String(Array.slice(this).reverse().join(""))},trim:function(){return this.replace(/^\s+|\s+$/g,"")},endsWith:function(d){var e=this.lastIndexOf(d);return(e!=-1)&&(e+d.length==this.length)},repeat:function(e){var f="";for(var d=0;d<e;d++){f+=this}return f},camelize:function(){return this.replace(/-\D/g,function(d){return d.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(d){return"-"+d.charAt(0).toLowerCase()})},capitalize:function(){return this.replace(/\b[a-z]/g,function(d){return d.toUpperCase()})},clean:function(){return this.trim(this.replace(/\s{2,}/g," "))},toElement:function(){return new Element("div",{html:this}).getFirst()},stripHTML:function(){var d=/<(?:.|\s)*?>/g;return this.replace(d,"")},first:function(e){var d=this;if(this.length>e){d=d.substring(0,e)}return d},firstWithEllips:function(e){var d=this;if(this.length>e){d=d.substring(0,e)+"..."}return d},visualLength:function(){var d=$("ruler");d.innerHTML=this;log.write("Ruler Width: "+d.offsetWidth);return d.offsetWidth},ellipsToPixels:function(e){var d=this;var f=this;if(d.visualLength()>e){f+="...";while(f.visualLength()>e){d=d.substring(0,d.length-1);f=d+"..."}}return f}});function $_(d){if(arguments.length<1){return widget.getLocalizedString(d)}else{return KONtx.utility.vsprintf(widget.getLocalizedString(d),arguments)}}var utility={vsprintf:function(n,j){var k=/%%|%(\d+\$)?([-+#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuidfegEG])/g;var l=j,h=0;var d=function(u,p,q,s){var r=(u.length>=p)?"":Array(1+p-u.length>>>0).join(q);return s?u+r:r+u};var e=function(s,r,v,p,q){var u=p-s.length;if(u>0){if(v||!q){s=d(s,p," ",v)}else{s=s.slice(0,r.length)+d("",u,"0",true)+s.slice(r.length)}}return s};var m=function(w,v,u,A,q,p,s){var r=w>>>0;u=u&&r&&{"2":"0b","8":"0","16":"0x"}[v]||"";w=u+d(r.toString(v),p||0,"0",false);return e(w,u,A,q,s)};var g=function(s,u,q,p,r){if(p!=null){s=s.slice(0,p)}return e(s,"",u,q,r)};var f=function(I,s,u,B,K,G,r){if(I=="%%"){return"%"}var C=false,v="",A=false,H=false;var w=u.length;for(var F=0;u&&F<w;F++){switch(u.charAt(F)){case" ":v=" ";break;case"+":v="+";break;case"-":C=true;break;case"0":A=true;break;case"#":H=true;break}}if(!B){B=0}else{if(B=="*"){B=+l[h++]}else{if(B.charAt(0)=="*"){B=+l[B.slice(1,-1)]}else{B=+B}}}if(B<0){B=-B;C=true}if(!isFinite(B)){throw new Error("sprintf: (minimum-)width must be finite")}if(!G){G="fFeE".indexOf(r)>-1?6:(r=="d")?0:void (0)}else{if(G=="*"){G=+l[h++]}else{if(G.charAt(0)=="*"){G=+l[G.slice(1,-1)]}else{G=+G}}}var D=s?l[s.slice(0,-1)]:l[h++];switch(r){case"s":return g(String(D),C,B,G,A);case"c":return g(String.fromCharCode(+D),C,B,G,A);case"b":return m(D,2,H,C,B,G,A);case"o":return m(D,8,H,C,B,G,A);case"x":return m(D,16,H,C,B,G,A);case"X":return m(D,16,H,C,B,G,A).toUpperCase();case"u":return m(D,10,H,C,B,G,A);case"i":case"d":var p=parseInt(+D);var E=p<0?"-":v;D=E+d(String(Math.abs(p)),G,"0",false);return e(D,E,C,B,A);case"e":case"E":case"f":case"F":case"g":case"G":var p=+D;var E=p<0?"-":v;var q=["toExponential","toFixed","toPrecision"]["efg".indexOf(r.toLowerCase())];var J=["toString","toUpperCase"]["eEfFgG".indexOf(r)%2];D=E+Math.abs(p)[q](G);return e(D,E,C,B,A)[J]();default:return I}};return n.replace(k,f)},timer:{setInterval:function(f,d){var e=new Timer();e.onTimerFired=f;e.interval=d/1000;e.ticking=true;return e},clearInterval:function(d){d.ticking=false;delete d},setTimeout:function(f,d){var e=new Timer();e.onTimerFired=function(){this.ticking=false;f()};e.interval=d/1000;e.ticking=true;return e},clearTimeout:function(d){d.ticking=false;delete d}},generate:{counter:0,id:function(d){if(d&&d.id&&!$empty(d.id)){return d.id}return"app-gen-"+application.utility.generate.counter++},randomNumber:function(d){return Math.floor(Math.random()*(d||1000))}}};if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());$cn.utilities.adjustDate=function(d,f){if(d.expirationMessage&&f){log.write("message is: "+d.expirationMessage);var h=new RegExp("([0-9]+)/([0-9]+)/([0-9]+)");var g=d.expirationMessage.toString().match(h);if(g!=null){d.expirationMessage=d.expirationMessage.toString().replace(g[0],$cn.utilities.formatDate(g[0],$cn.config.DateFormat))}}if(d.datePurchased){log.write("datePurchased is: "+d.datePurchased);var h=new RegExp("([0-9]+)-([0-9]+)-([0-9]+)");var e=d.datePurchased.toString().match(h);if(e!=null){d.datePurchased=e[0]}}};$cn.utilities.truncateText=function(f,g,d,j,e){if(j<e-1){var h=Math.floor((j+e)/2);application.putInnerHTML(f,g.substr(0,h));if(f.offsetHeight<=d){return this.truncateText(f,g,d,h,e)}else{return this.truncateText(f,g,d,j,h)}}else{return $cn.utilities.ellipsis(g,j)}};$cn.utilities.ellipsis=function(f,e){if(f.length>3&&f.length>e){var d=e-4;var g=f[d];while((g==" "||g==".")&&d>0){g=f[d];d--}f=f.substr(0,d+1)+"..."}if(f.indexOf("##")>-1){if(f.substring(f.length-3,3).indexOf("##")==-1){f=f+"##"}}return f};$cn.utilities.addEpisodeColons=function(d){if(isNaN(d)){return d}else{return d+":"}};$cn.utilities.highlightKeywordForTitlename=function(g,d){var h="";var f=' style="color:#FDCC4D;" ';var e=new RegExp("("+d+")","gi");h=g.replace(e,"<span "+f+">$1</span>");return h};$cn.utilities.safeSelect=function(d){return d.replace(/\'/g,"\\'")};$cn.utilities.highlightKeywordForSynopsis=function(k,g){if(k==null||k.length==0){return k}var l="";var e=k.length;var d=BrowseView.GridControl.getElipsisLength();if(g&&g.length>0){var j=' style="color:#FDCC4D;" ';var h=new RegExp("("+g+")","gi");var f=h.exec(k);if(f==null||f.index<0||BrowseView.currentState!="search-view"){l=k}else{if(f.index<30){l=k.replace(h,function(m,n,q,p){return"<span "+j+">"+n+"</span>"})}else{l="..."+k.substring(f.index-30,e).replace(h,function(m,n,q,p){return"<span "+j+">"+n+"</span>"})}}}else{l=k}log.write("highlighted string: "+l);return l};$cn.utilities.getMeta=function(d,f){var e="";f.each(function(g){if(g.keyName==d){e=g.keyValue}});return e};$cn.utilities.setMeta=function(d,e,f){f.each(function(g){if(g.keyName==d){g.keyValue=e}})};$cn.utilities.haveGenreId=function(f){var g=false,d=$cn.data.Navigation.genres.length,e;for(e=0;e<d;++e){if(""+$cn.data.Navigation.genres[e].iD===""+f){g=true;e=d}}return g};$cn.utilities.recommendedForYouGuess=function(d){var e;$cn.data.Navigation.genres.each(function(f){if(nav.parentId==0){e=f.iD}})};$cn.utilities.measure=function(d){return d.measure(function(){return this.getSize()})};$cn.utilities.isEqual=function(e,d){if(e&&d||(""===e&&""===d)){return e.toString().toLowerCase()===d.toString().toLowerCase()}else{return false}};$cn.utilities.isTrue=function(d){return($cn.utilities.isEqual("true",d)||$cn.utilities.isEqual("True",d))};$cn.utilities.getResponseCodeStatus=function(d){return application.resource.uv_responseCodes[d].status};$cn.utilities.addHiddenClass=function(d){if(document.getElementById(d)){$(d).addClass("hidden")}};$cn.utilities.removeHiddenClass=function(d){if(document.getElementById(d)){$(d).removeClass("hidden")}};$cn.utilities.inArray=function(g,d){var f,e;if(d){f=d.length;for(e=0;e<f;e++){if(e in d&&d[e]===g){return e}}}return -1};var Timer=function(){this.Interval=1000;this.Enable=new Boolean(false);this.Tick;this.isRunning=false;var d=0,e;this.Start=function(){this.Enable=new Boolean(true);e=this;if(e.Enable){e.timerId=setInterval(function(){e.isRunning=true;e.Tick()},e.Interval)}};this.Stop=function(){if(e){e.Enable=new Boolean(false);clearInterval(e.timerId);e.isRunning=false}}};function Queue(){var d=[];var e=0;this.getSize=function(){return d.length-e};this.isEmpty=function(){return(d.length==0)};this.enqueue=function(f){d.push(f)};this.clear=function(f){d=[];e=0};this.dequeue=function(){var f=undefined;if(d.length){f=d[e];if(++e*2>=d.length){d=d.slice(e);e=0}}return f};this.getOldestElement=function(){var f=undefined;if(d.length){f=d[e]}return f};this.getElementAt=function(f){var g=undefined;if(d.length){g=d[f]}return g};this.getOldestIndex=function(){return e};this.getTotalSize=function(){return d.length}}$cn.utilities.formatAsMoney=function(d){var e=d;e-=0;return(Math.round(e)/100).toFixed(2)};$cn.utilities.getNodeText=function(f){var e="";for(var d=0;d<f.childNodes.length;d++){e=e+f.childNodes[d].nodeValue}return e};function two(d){return((d>9)?"":"0")+d}function three(d){return((d>99)?"":"0")+((d>9)?"":"0")+d}$cn.utilities.convertMStoTime=function(d){var g=Math.floor(d/1000);var e=Math.floor(g/60);g=g%60;t=two(g);var f=Math.floor(e/60);e=e%60;t=two(e)+":"+t;if(f>0){t=f+":"+t}return t};$cn.utilities.buildPlaybackURL=function(f,l,j,g,h,e,k,m){var d=f+"|DEVICE_ID="+webservices.uniqueId+"|DEVICET_TYPE_ID="+webservices.destType+"|STREAM_ID="+l+"|IP_ADDR=|DRM_URL="+j+"|ACK_URL="+g+"|HEARTBEAT_URL="+h+"|HEARTBEAT_PERIOD="+e+"|I_SEEK=TIME|CUR_TIME=PTS|COMPONENT=WV|TITLE_PROFILE="+(k?"HD":"SD")+"|CUSTOM_DATA="+(m||"")+"|";log.write("playback url: "+d);return d};$cn.utilities.DateDiff=function(e,d){return e.getTime()-d.getTime()};$cn.utilities.purchaseText=function(h){var e="",d=false,g=false,f=false;h.availableProducts.each(function(j){switch(j.purchaseType){case"rent":f=true;break;case"buy":g=true;break;case"preorder":d=true;break}});if(d){e="Pre-order"}else{if(f&&g){e="Rent or Buy"}else{if(f){e="Rent"}else{if(g){e=$cn.utilities.getBuyTextForTitle(h)}}}}return e};$cn.utilities.getBuyTextForTitle=function(e){var d="Buy";if(e.titleType=="TV_Episode"){d+=" Episode"}return d};$cn.utilities.getPricingSummaryString=function(f,e,d){retString="";var g=$cn.data.TitleSummaryCache[f];if(!g){g=$cn.data.TitleDetailCache[f]}if(g){if(g.titleType=="TV_Show"||g.titleType=="TV_Season"||g.titleType=="TV_Episode"){e="Buy Episodes from"}if(g.rentAvail){retString+=d+' <span class="bluePrice">'+application.resource.currency_symbol+g.rentPrice+"</span>";if(!g.buyAvail&&g.titleType=="Movie"){retString+='<span class="dividerBar"> | </span>';retString+="Buy not available"}}if(g.buyAvail&&g.rentAvail){retString+='<span class="dividerBar"> | </span>'}if(g.buyAvail){retString+=e+' <span class="bluePrice">'+application.resource.currency_symbol+g.buyPrice+"</span>";if(!g.rentAvail&&g.titleType=="Movie"){retString+='<span class="dividerBar"> | </span>';retString+="Rent not available"}}}return retString};$cn.utilities.getPricingSummaryStringNewSpec=function(f,e,d){retString="";var g=$cn.data.TitleSummaryCache[f];if(!g){g=$cn.data.TitleDetailCache[f]}if(g){if(g.titleType=="TV_Show"||g.titleType=="TV_Season"||g.titleType=="TV_Episode"){e="Buy Episodes from"}if(g.rentAvail){retString+=d+' <span class="bluePrice">'+application.resource.currency_symbol+g.rentPrice+"</span>";if(!g.buyAvail&&g.titleType=="Movie"){retString+="<br />";retString+="Buy not available"}}if(g.buyAvail&&g.rentAvail){retString+="<br />"}if(g.buyAvail){retString+=e+' <span class="bluePrice">'+application.resource.currency_symbol+g.buyPrice+"</span>";if(!g.rentAvail&&g.titleType=="Movie"){retString+="<br />";retString+="Rent not available"}}}return retString};$cn.utilities.getPointsAndPricingString=function(k,h,f){var l=$cn.data.TitleSummaryCache[k]||$cn.data.TitleDetailCache[k],j="",e=$cn.utilities.getMeta("LoyaltyPointsForRent",l.metaValues),d="",g=$cn.utilities.getMeta("LoyaltyPointsForBuy",l.metaValues);if(!l){return""}e=(e===""||parseInt(e,10)<=0)?"":'<div class="redStar"></div>Earn <span class="bluePrice">'+e+"</span> pts";g=(g===""||parseInt(g,10)<=0)?"":'<div class="redStar"></div>Earn <span class="bluePrice">'+g+"</span> pts";if(l.rentAvail){j=f+' <span class="bluePrice">'+application.resource.currency_symbol+l.rentPrice+"</span>";if(!l.buyAvail&&l.titleType=="Movie"){d='<div style="text-align:center" class="notAvailable">'+application.resource.title_availability.buy_not_available+"</div>";g=""}}if(l.buyAvail){if(l.titleType=="TV_Show"||l.titleType=="TV_Season"||l.titleType=="TV_Episode"){h="Buy&nbsp;Episodes&nbsp;from"}d=h+' <span class="bluePrice">'+application.resource.currency_symbol+l.buyPrice+"</span>";if(!l.rentAvail&&l.titleType=="Movie"){j=h+' <span class="bluePrice">'+application.resource.currency_symbol+l.buyPrice+"</span>";e=g;d='<div style="text-align:center" class="notAvailable">'+application.resource.title_availability.rent_not_available+"</div>";g=""}}return'<div class="verticalDivider"></div><div class="rentalInfo"><div class="rentalPrice">'+j+'</div><div class="rentalPoints">'+e+'</div></div><div class="buyInfo"><div class="buyPrice">'+d+'</div><div class="buyPoints">'+g+"</div></div>"};$cn.utilities.testDuration=function(e,d){var j=new Date(e);var g=$cn.utilities.DateDiff(new Date(),j);var h=Math.floor(g/1000);var f=true;if(h<d){f=false}return f};$cn.utilities.formatDate=function(d,g){formatted="";if(d){switch(g){case"longDate":try{theDate=new Date().parse(d);formatted=theDate.format("%B %d, %Y")}catch(f){log.write("Called formatDate: error formatting date style: "+g)}break;case"shortEuropean":try{theDate=new Date().parse(d);formatted=theDate.format("%d/%m/%y")}catch(f){log.write("Called formatDate: error formatting date style: "+g)}break;case"short":try{theDate=new Date().parse(d);formatted=theDate.format("%m/%d/%y")}catch(f){log.write("Called formatDate: error formatting date style: "+g)}break;default:try{theDate=new Date().parse(d);formatted=theDate.format("%x")}catch(f){log.write("Called formatDate: error formatting date style: "+g)}}return formatted}};$cn.utilities.uniqueIdentifier=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};$cn.utilities.isHdTitle=function(f,g){var d=null,e=false;for(x=0;x<f.availableProducts.length;x++){if(f.availableProducts[x].skuID==g){d=f.availableProducts[x]}}if(d.skuType.indexOf("HD")>-1){e=true}return e};$cn.utilities.getPurchaseSkuProduct=function(e,f){var d=null;for(x=0;x<e.availableProducts.length;x++){if(e.availableProducts[x].skuID==f){d=e.availableProducts[x]}}return d};$cn.utilities.currentlyPlayingAudioProfile=function(e){var f="Stereo_Standard",d=$cn.utilities.getAudioProfileForPurchase(e);if(d[$cn.data.PreferredAudioType]){f=$cn.data.PreferredAudioType}return f};$cn.utilities.isSurroundSoundTitle=function(g,h){var d=null,f=false;for(x=0;x<g.availableProducts.length;x++){if(g.availableProducts[x].skuID==h){d=g.availableProducts[x]}}for(x=0;x<d.availableAssets.length;x++){for(y=0;y<d.availableAssets[x].availableAudioProfiles.length;y++){var e=d.availableAssets[x].availableAudioProfiles[y];for(z=0;z<$cn.data.AllowedAudioProfiles.length;z++){if($cn.data.AllowedAudioProfiles[z]==e.audioAssetProfile){f=true}}}}return f};$cn.utilities.getAudioProfileForTitle=function(h){var g={};g.Stereo_Standard=true;g.Dolby_Stereo_AC3=false;g.Dolby_Digital_Plus_Stereo=false;g.Dolby_Digital_Plus_51=false;g.DTS_Express_Stereo=false;g.DTS_Express_51=false;g.HDOnly=true;if(!$cn.data.TitlesAudioProfiles[h]){var j=$cn.data.TitleDetailCache[h];if(j){for(a=0;a<j.availableProducts.length;a++){for(b=0;b<j.availableProducts[a].availableAssets.length;b++){var f=j.availableProducts[a].availableAssets[b],e=(f.file_FileProfile=="HIGH_DEFINITION");for(c=0;c<f.availableAudioProfiles.length;c++){var d=f.availableAudioProfiles[c];for(x=0;x<$cn.data.AllowedAudioProfiles.length;x++){if($cn.data.AllowedAudioProfiles[x]==d.audioAssetProfile){g[$cn.data.AllowedAudioProfiles[x]]=true;if(!e){g.HDOnly=false}}}}}}$cn.data.TitlesAudioProfiles[h]=g}}else{g=$cn.data.TitlesAudioProfiles[h]}return g};$cn.utilities.getAudioProfileForPurchase=function(g){var f={};f.Stereo_Standard=true;f.Dolby_Stereo_AC3=false;f.Dolby_Digital_Plus_Stereo=false;f.Dolby_Digital_Plus_51=false;f.DTS_Express_Stereo=false;f.DTS_Express_51=false;if($cn.data.PurchaseAudioProfiles[g]){f=$cn.data.PurchaseAudioProfiles[g]}else{var h=$cn.data.PassCache[g];if(h){for(a=0;a<h.availableProducts.length;a++){for(b=0;b<h.availableProducts[a].availableAssets.length;b++){var e=h.availableProducts[a].availableAssets[b];for(c=0;c<e.availableAudioProfiles.length;c++){var d=e.availableAudioProfiles[c];for(x=0;x<$cn.data.AllowedAudioProfiles.length;x++){if($cn.data.AllowedAudioProfiles[x]==d.audioAssetProfile){f[$cn.data.AllowedAudioProfiles[x]]=true}}}}}$cn.data.PurchaseAudioProfiles[g]=f}}return f};$cn.utilities.getAudioProfileTypesForPurchase=function(f){var d=$cn.utilities.getAudioProfileForPurchase(f);var e=[];if(d.Dolby_Stereo_AC3||d.Dolby_Digital_Plus_Stereo||d.Dolby_Digital_Plus_51){e.push("Dolby")}if(d.DTS_Express_Stereo||d.DTS_Express_51){e.push("DTS")}return e};$cn.utilities.bandwidthCheckValid=function(e){var d=false;log.write("$cn.data.LastBandwidthCheck: "+$cn.data.LastBandwidthCheck);log.write("testDuration (should be false): "+$cn.utilities.testDuration($cn.data.LastBandwidthCheck,application.appSetting("BandwidthCheckTTL")));log.write("BandwidthCheckTTL:"+application.appSetting("BandwidthCheckTTL"));log.write("LastBandwidthSpeed: "+$cn.data.LastBandwidthSpeed);log.write("SDMinimumBandwidth: "+application.appSetting("SDMinimumBandwidth"));if($cn.data.LastBandwidthCheck&&!$cn.utilities.testDuration($cn.data.LastBandwidthCheck,application.appSetting("BandwidthCheckTTL"))){if(e&&$cn.data.LastBandwidthSpeed>application.appSetting("HDMinimumBandwidth")){d=true}else{if(!e&&$cn.data.LastBandwidthSpeed>application.appSetting("SDMinimumBandwidth")){d=true}}}return d};$cn.utilities.forceWrap=function(j,e,d){var h,f="",g;if(!j){return""}h=j.length>d?j.substring(0,d):j;for(g=0;g<h.length;g++){if(g>0&&g%e==0){f+="<br />"}f+=h.charAt(g)}return f};$cn.utilities.showLoadingModal=function(d,e){var f;if(!$cn.utilities.sharedModalShowing){e=e||application.resource.loading_enum.loadinggeneric;f=setTimeout(function(){BrowseView.showMessage("message_loading",{Message:e})},d)}else{log.write("Skipping showing of modal. Shared modal is already showing.")}return f};$cn.utilities.clearLoadingSpinner=function(d){if(d){clearTimeout(d);log.write("Clearing Spinner")}if(!$cn.utilities.sharedModalShowing){$cn.utilities.hideModalPopup()}};$cn.utilities.sharedModalShowing=false;$cn.utilities.sharedModalTimer=false;$cn.utilities.showSharedLoadingModal=function(d,e){if(!$cn.utilities.sharedModalShowing){$cn.utilities.sharedModalTimer=$cn.utilities.showLoadingModal(d,e);$cn.utilities.sharedModalShowing=true}else{log.write("Trying to show shared modal when one is already showing. Doing nothing.")}};$cn.utilities.clearSharedLoadingSpinner=function(){$cn.utilities.sharedModalShowing=false;$cn.utilities.clearLoadingSpinner($cn.utilities.sharedModalTimer)};$cn.utilities.hideModalPopup=function(){if(BrowseView&&BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}};$cn.utilities.tm=function(){return"&#0153;"};$cn.utilities.UserUVManager=new Class({empty:"",action:"",currentState:"",previousState:"",previousStatus:"",currentStatus:"",linkingAccount:{},initialize:function(d){this.action=d},deactivate:function(){this.currentStatus="";this.previousState="";this.currentState="UVDeviceInactive"},getAccountLinkState:function(){var d=this;log.write("Getting Account Link State");$cn.methods.getAccountLinkState(function(e){log.write("Link state is "+e.linkState);if(d.currentState===d.empty){d.currentState=e.linkState}else{d.previousState=d.currentState;d.currentState=e.linkState}if(d.currentState==$cn.data.uvLinkStatus.linkState.linked||d.currentState==$cn.data.uvLinkStatus.linkState.pending){d.getLinkingAccount()}else{d.currentStatus=d.empty;d.checkNextAction()}})},getLinkingAccount:function(){var d,e=this;log.write("Getting Linking Account");$cn.methods.getLinkingAccount(function(f){e.linkingAccount=f;d=(f.account)?f.account.status:$cn.utilities.getResponseCodeStatus(f.responseCode);if(e.currentStatus===e.empty){e.currentStatus=d}else{e.previousStatus=e.currentStatus;e.currentStatus=d}e.checkNextAction()})},checkNextAction:function(){var d=this.currentStatus;if(d==$cn.data.uvLinkingAccount.Status.active){if(this.action=="CheckoutPanel"){this.checkStatusChange()}else{log.write("We are active and not in checkout so proceed with callback");$cn.utilities.clearLoadingSpinner(this.timer);this.fireCallback(true)}}else{if(this.action=="CheckoutPanel"){log.write("We are in checkout and status was not active");this.showUVWarningModal()}else{if(this.action=="showPlay"){log.write("We are in show play and status was not active");this.showUVWarningModal()}else{log.write("status was not active so fire false");$cn.utilities.clearLoadingSpinner(this.timer);this.fireCallback(false)}}}},fireCallback:function(d){var e;e=this.callback;this.callback=false;e(d)},checkStatusChange:function(){var e=this.previousStatus,d=this.currentStatus,f=this.previousState;log.write("Check status Change called");log.write("current is "+d);log.write("Prev is "+e);if((e&&e!=d)||(!e&&d&&(this.previousState!==this.empty))){this.showSuccessfulChange()}else{$cn.utilities.clearLoadingSpinner(this.timer);this.fireCallback(true)}},showSuccessfulChange:function(){log.write("Show successul Change called");var d,g,f,e=this;switch(this.currentStatus){case"Archived":d="renewed";break;case"AcctNotAvailable":d="created";break;case"BlockedTOU":d="updated";break;default:d="linked"}g=application.resource.uv_messages.success;f={Message:g.Message.replace("##status##",d),Close:g.OK,callback:function(h){if(h){e.fireCallback(false)}}};$cn.utilities.clearLoadingSpinner(this.timer);BrowseView.showMessage("message_content_callback",f)},getTermsOfService:function(){log.write("Get terms of use called");var d=this;if($cn.config.UVTOSEnabled){$cn.methods.getUVTermsOfService(function(e){d.showTermsOfService(e.data)})}else{this.showUVWarningModal()}},showTermsOfService:function(e){var g=application.resource.uv_messages.uvTermsOfService,f=($cn.utilities.isEqual(this.action,"CheckoutPanel"))?"."+this.action:"",d=this;this.Legal=new LegalPopup("uvtermsofservice");this.Legal.loadData([{title:g.UnacceptedMessage,content:g.Content,text:e,OK:g.OK,Close:g.Close,CloseAction:"BrowseView"+f+".UV.Legal.hide()",AcceptAction:"BrowseView"+f+".UV.acceptUVTermsOfService(true)",callback:function(h){if(h){log.write("UV TOU Accepted");d.fireCallback(true)}}}]);this.layoutIsDirty=true;this.Legal.firstFocus="LegalOK";$cn.utilities.clearLoadingSpinner(this.timer);this.Legal.show();$("SplashScreen").hide()},showUVWarningModal:function(k){var e=this,d=(this.currentStatus)?this.currentStatus:this.currentState,h,j,g,f=(this.linkingAccount.user)?this.linkingAccount.user.email:"";this.callback=this.callback||k;switch(d){case"Pending":case"BlockedTOU":case"Expired":case"AcctNotAvailable":case"Server Error":case"Inactive":h="account_"+d;break;default:h="account_default"}j=application.resource.uv_messages[h];if(this.currentStatus==$cn.data.uvLinkingAccount.Status.pending){j.Content=j.Content.replace(/{email}/g,f)}g={Message:j.Message,Content:j.Content,OK:j.OK,Close:j.Cancel,uvMsg:"UV",callback:function(l){if(l){log.write("UV warning retry");e.checkUVAccount()}else{e.fireCallback(false)}}};$cn.utilities.clearLoadingSpinner(this.timer);BrowseView.showMessage("message_okcancel_vert",g)},checkUVAccount:function(e,d){if($cn.config.EnableUV){this.timer=$cn.utilities.showLoadingModal(2000,"Loading...");this.callback=this.callback||e;if(d){this.getAccountLinkState()}else{$cn.methods.verifyAuthToken(function(f){if(f){this.getAccountLinkState()}else{$cn.utilities.clearLoadingSpinner(this.timer);this.deactivate();this.fireCallback(false)}}.bind(this))}}else{if(typeof e==="function"){e(false)}}}});$cn.utilities.setParentalSettings=function(d){application.createActivationFile();$cn.data.AuthToken=d.authToken;$cn.data.AdultPinEnabled=d.adultPinEnabled;$cn.data.ParentPinEnabled=false;$cn.data.DeviceName=d.deviceFriendlyName;$cn.data.UserEmailAddress=d.emailAddress;$cn.data.PurchasePinEnabled=false;$cn.data.ParentalControlsConfigured=d.parentalControlsConfigured;$cn.data.CurrentRegion=$cn.data.Region;application.saveAuthToken()};$cn.data.bwTest={};$cn.data.bwTest.calls=1;$cn.data.bwTest.speedBytes=0;$cn.data.bwTest.bwCallback=null;$cn.data.bwTest.self=null;function OnComplete(d){if($cn.data.bwTest.bwCallback){$cn.data.bwTest.bwCallback(d)}}function $get(f,d){if(arguments.length<2){d=location.href}if(arguments.length>0&&f!=""){if(f=="#"){var g=new RegExp("[#]([^$]*)")}else{if(f=="?"){var g=new RegExp("[?]([^#$]*)")}else{var g=new RegExp("[?&]"+f+"=([^&#]*)")}}var e=g.exec(d);return(e==null)?"":e[1]}else{d=d.split("?");var e={};if(d.length>1){d=d[1].split("#");if(d.length>1){e.hash=d[1]}d[0].split("&").each(function(j,h){j=j.split("=");e[j[0]]=j[1]})}return e}}var $UrlQueryString=function(){var g={};var f=window.location.search.substring(1);var h=f.split("&");for(var e=0;e<h.length;e++){var j=h[e].split("=");if(typeof g[j[0]]==="undefined"){g[j[0]]=j[1]}else{if(typeof g[j[0]]==="string"){var d=[g[j[0]],j[1]];g[j[0]]=d}else{g[j[0]].push(j[1])}}}return g}();var XML={rootFromFile:function(e,f){if(!$cn.config.PrecompiledApplication){var d=new XMLHttpRequest();d.open("GET",e,true);d.send(null);d.onreadystatechange=function(){if(d.readyState==4){if((d.status&&d.status==200)||document.URL.substr(0,4)=="file"){var g=new DOMParser();var h=g.parseFromString(d.responseText,"text/xml");f.call(this,h)}}}}else{f.call(this,null)}},rootFromFileSync:function(e){var d=new XMLHttpRequest();d.open("GET",e,false);d.send(null);if(d.readyState==4){if(d.status&&d.status==200||document.URL.substr(0,4)=="file"){return d.responseXML}}return null},rootFromString:function(e){var d;if(Browser.Engine.trident){d=new ActiveXObject("Microsoft.XMLDOM");d.async=false;d.loadXML(e)}else{d=(new DOMParser()).parseFromString(e,"text/xml")}return d},rootToHashes:function(e){var f=[],h=e.childNodes,j=null,g=0,d;for(g=0,d=h.length;g<d;g++){j=XML.nodeToHash(h[g]);if(j){f.push(j)}}return f},nodeToHash:function(h){switch($type(h)){case"element":var d=h.attributes,k=d.length,f={},e=0,g;for(e=0;e<k;e++){g=d[e];if(g.nodeValue&&g.nodeValue!="inherit"){f[g.nodeName]=g.nodeValue}}return{tag:h.nodeName.toLowerCase(),attributes:f,children:XML.rootToHashes(h)};case"textnode":return{text:h.nodeValue};default:return null}},rootToJSONString:function(e){var j=[],h=e.childNodes,g="",f=0,d;for(f=0,d=h.length;f<d;f++){g=XML.nodeToJSONString(h[f]);if(g){j.push(g)}}return j},nodeToJSONString:function(h){var f=0;if($type(h)=="element"){var d=h.attributes,l=d.length,k="",e=0,g;if(l>0){for(e=0;e<l;e++){g=d[e];if(g.nodeValue&&g.nodeValue!="inherit"){if(!isNaN(Number(g.nodeValue))||g.nodeValue==="true"||g.nodeValue==="false"){k+='"'+g.nodeName+'":'+g.nodeValue+","}else{k+='"'+g.nodeName+'":"'+g.nodeValue+'",'}}}k=k.substring(0,k.length-1);if(h.childNodes.length>1){return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":['+XML.rootToJSONString(h)+"]"+k+"}"}else{if(h.childNodes.length<=1&&$type(h.firstChild)=="textnode"){if(!isNaN(Number(h.nodeValue))||h.nodeValue==="true"||h.nodeValue==="false"){return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":'+h.nodeValue+k+"}"}else{return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":"'+h.nodeValue+'"'+k+"}"}}}}else{if(h.childNodes.length>1){return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":['+XML.rootToJSONString(h)+"]}"}else{if(h.childNodes.length<=1&&$type(h.firstChild)=="textnode"){if(!isNaN(Number(h.childNodes[0].nodeValue))||h.childNodes[0].nodeValue==="true"||h.childNodes[0].nodeValue==="false"){return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":'+h.childNodes[0].nodeValue+"}"}else{return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":"'+h.childNodes[0].nodeValue+'"}'}}}}}},nodesToJSONString:function(e){var f=0;var d="{";for(f=0;f<e.length;f++){if($type(e[f])=="element"){var g=XML.nodeToJSONString(e[f]);if(e[f].childNodes.length<=1&&$type(e[f].firstChild)=="textnode"){g=g.substring(1,g.length-1)}d+=g+","}}d=d.substring(0,d.length-1);d+="}";return d},hashesToTree:function(g){var d=[],f,e;for(f=0,e=g.length;f<e;f++){d.push(XML.hashToElement(g[f]))}return d},hashToElement:function(f,d){var e;if(f.text){e=document.newTextNode(f.text)}else{e=document.newElement(d||f.tag,f.attributes).adopt(XML.hashesToTree(f.children))}return e},hashToHTML:function(j,l){var g=new Array(l||0).join("\t"),d=[""],h,e="",k="",f=null;if(j.text){return g+j.text}for(h in j.attributes){d.push(h+'="'+j.attributes[h]+'"')}d=d.join(" ");e=g+"<"+j.tag+d+">\n";k="\n"+g+"</"+j.tag+">";f=XML.hashesToHTML(j.children,l+1);return e+f+k},hashesToHTML:function(e,h){var g=[],f,d;for(f=0,d=e.length;f<d;f++){g.push(XML.hashToHTML(e[f],h))}return g.join("\n")},transform:function(k,g){k=(typeof k=="string")?XML.rootFromFile(k):k;g=(typeof g=="string")?XML.rootFromFile(g):g;var d,m,h,e=[],j,n=document.newElement("div"),f;d=new XSLTProcessor();d.importStylesheet(g);m=d.transformToFragment(k,document);n.appendChild(m);for(h=0,f=n.childNodes.length;h<f;h++){j=n.childNodes[h],type=$type(j);if(type=="element"||type=="textnode"){e.push(j)}}return e},toString:function(d){return(new XMLSerializer).serializeToString(d)},dumpDOM:function(f,j){var h="DOM: ";if(j){h+=j}else{j=""}h+="["+f.nodeName+"]: "+f.nodeValue;if(f.attributes&&f.attributes.length){h+=" - ";for(var e=0;e<f.attributes.length;e++){var d=f.attributes[e];h+="("+d.nodeName+":"+d.nodeValue+") "}}log.write(h);if(f.childNodes&&f.childNodes.length){for(var e=0;e<f.childNodes.length;e++){var g=f.childNodes[e];this.dumpDOM(g,j+"  ")}}}};var webservices={WSRObj:null,apiKey:"",destType:"",uniqueId:"",userAgent:"",RequestQueue:null,RequestInProgress:false,makeAsyncRequest:function(j,e,k,g,d,h,f){if(!this.RequestQueue){this.RequestQueue=new Queue()}this.RequestQueue.enqueue({endPoint:j,method:e,params:k,cb_context:g,callback:d,cacheKey:h,timeout:f});this.processAsyncQueueRequest()},killCurrentRequests:function(){var d;if(this.RequestQueue){for(d=0;d<this.RequestQueue.getSize();d++){var e=this.RequestQueue.dequeue();log.write("webservices.killCurrentRequests: Dequeuing requests...")}this.killCurrentRequest()}},processAsyncQueueRequest:function(){var n=this,d,g,f;if(!this.RequestInProgress){this.RequestInProgress=true;log.write("Item is 1st in line or called from the queue.");var m=this.RequestQueue.dequeue(),l=m.endPoint,e=m.method,h=m.params,p=m.cb_context,k=m.callback,j=m.timeout;d=application.apiUrl+"/"+l;g={id:++nextRequestId+"_"+e,method:e,params:h};f=JSON.stringify(g);this.killCurrentRequest();this.WSRObj=new WSRequest();if(!j){j=application.appSetting("WSRequestTimeout")}if(j>=0){this.WSRObj.setTimeout(function(){n.WSRObj.abort();n.RequestInProgress=false;log.write("webservices.makeAsyncRequest: Web Service Timeout Error.");if(application.isLoaded){application.events.publish("error",{type:"timeout_error",endPoint:l,method:e,params:h,callback:k})}else{application.ui.init(function(){application.events.publish("error",{type:"timeout_error",recoverable:false,endPoint:l,method:e,params:h,callback:k})})}},j*1000)}if(application.logSupported||application.appSetting("Debug")){log.write("\nwebservices.makeAsyncRequest\nAbout to send request: "+f+" to "+d);log.write("x-json-rpc: "+e+",APIKey: "+this.apiKey+",DestinationTypeID: "+this.destType+",DestinationUniqueID: "+this.uniqueId+",User_Agent: "+this.userAgent+",SessionID: "+$cn.data.SessionId+",AuthToken"+$cn.data.AuthToken+",$cn.data.IsParent:"+$cn.data.IsParent)}this.WSRObj.setTarget("POST",d);this.WSRObj.setCacheKey(m.cacheKey);this.WSRObj.addHeader("Content-Type","text/plain; charset=utf-8");this.WSRObj.addHeader("Accept","*/*");this.WSRObj.addHeader("Accept-Language","en-us");if(application.authSupported){this.WSRObj.addHeader("x-json-rpc",e);this.WSRObj.addHeader("Connection","Keep-Alive");this.WSRObj.addHeader("Pragma","no-cache");this.WSRObj.addHeader("AuthToken",$cn.data.AuthToken);this.WSRObj.addHeader("APIKey",this.apiKey);this.WSRObj.addHeader("DestinationTypeID",this.destType);this.WSRObj.addHeader("DestinationUniqueID",this.uniqueId);this.WSRObj.addHeader("User-Agent",this.userAgent);this.WSRObj.addHeader("FileFilter","streamonly");this.WSRObj.addHeader("AccountType",($cn.data.IsParent)?"Parent":"Child");this.WSRObj.addHeader("SessionID",$cn.data.SessionId)}this.WSRObj.setOnComplete(function(){n.RequestInProgress=false;var q={err:true,text:"",data:{}};application.isConnected=true;if(n.WSRObj.status&&n.WSRObj.status!=200){q.text="webservices.makeAsyncRequest: call failed\nStatus: "+n.WSRObj.status;q.err=true;if(n.WSRObj.status=="502"||n.WSRObj.status=="1007"||n.WSRObj.status=="1013"){application.events.publish("error",{type:"no_internet",endPoint:l,method:e,params:h,callback:k})}else{if(n.WSRObj.status=="2013"){application.events.publish("error",{type:"socket_error",endPoint:l,method:e,params:h,callback:k,status:n.WSRObj.status})}else{application.events.publish("error",{type:"system_error",endPoint:l,method:e,params:h,callback:k,status:n.WSRObj.status})}}}else{if(device.logSupported||application.appSetting("Debug")){log.write("webservices.makeAsyncRequest: status: "+n.WSRObj.status+" Request successful: "+n.WSRObj.responseText)}try{if(n.WSRObj.responseText&&n.WSRObj.responseText.length>0){q.err=false;q.text="CinemaNOW request successful";q.data=JSON.parse(n.WSRObj.responseText);if(application.authSupported&&q.data&&q.data.result&&q.data.result.responseCode==31&&e!="pollForToken"&&e!="lookupPurchaseDetailsForTitle"&&e!="calcOrderTax"&&e!="getBillingInfo"){application.events.publish("badauthtoken",{endPoint:l,method:e,params:h,callback:k})}else{k.call(p,q);if(q.data.result&&q.data.result.responseCode&&!q.data.result.errorHandled){n.handleResponseError(q.data,{type:"",endPoint:l,method:e,params:h,callback:k})}}}else{if((n.WSRObj.requestRunTime>=(application.appSetting("WSRequestTimeout")*1000))&&!doNotTriggerTimeouts){application.events.publish("error",{type:"timeout_error",endPoint:l,method:e,params:h,callback:k})}}}catch(r){log.write("webservices.makeAsyncRequest EXCEPTION "+r);log.write("webservices.makeAsyncRequest Setting system_error!");log.write(log.dump(r,8));application.events.publish("error",{type:"system_error",endPoint:l,method:e,params:h,callback:k})}}if(n.RequestQueue.getSize()>0){log.write("webservices.processAsyncQueueRequest: Another item is in the queue. Call it.");n.processAsyncQueueRequest()}});this.WSRObj.send(f)}},makeXMLAsyncRequest:function(p,h,k,s,l,n,g,f){var m,r=this,e,j;if(!this.RequestQueue){this.RequestQueue=new Queue()}if(n&&!g){for(m=0;m<this.RequestQueue.getSize();m++){var q=this.RequestQueue.dequeue();log.write("webservices.makeXMLAsyncRequest: Override passed in. Dequeuing requests...")}this.killCurrentRequest()}if(!g){this.RequestQueue.enqueue({endPoint:p,method:h,params:k,cb_context:s,callback:l})}if(!this.RequestInProgress){this.RequestInProgress=true;log.write("Item is 1st in line or called from the queue.");var q=this.RequestQueue.dequeue();p=q.endPoint;h=q.method;k=q.params;s=q.cb_context;l=q.callback;e=application.apiUrl+"/"+p;j="";if(typeof(k.TagStart)!="undefined"){j+=k.TagStart}if(application.authSupported){j+="<APIKey>"+this.apiKey+"</APIKey>";j+="<DeviceUniqueID>"+this.uniqueId+"</DeviceUniqueID>";j+="<DeviceTypeID>"+this.destType+"</DeviceTypeID>";j+="<AuthToken>"+$cn.data.AuthToken+"</AuthToken>"}for(var d in k){if(d!="TagStart"&&d!="TagEnd"){j+="<"+d+">"+k[d].toString()+"</"+d+">"}}if(typeof(k.TagEnd)!="undefined"){j+=k.TagEnd}j=j.split("&").join("&amp;").split('"').join("&quot;").split("'").join("&apos;").split(">").join("&gt;").split("<").join("&lt;");this.killCurrentRequest();this.WSRObj=new WSRequest();if(!f){this.WSRObj.setTimeout(function(){r.WSRObj.abort();r.RequestInProgress=false;log.write("webservices.makeXMLAsyncRequest: Web Service Timeout Error.");if(application.isLoaded){application.events.publish("error",{type:"timeout_error",endPoint:p,method:h,params:k,callback:l})}else{application.ui.init(function(){application.events.publish("error",{type:"timeout_error",recoverable:false,endPoint:p,method:h,params:k,callback:l})})}},(application.appSetting("WSRequestTimeout")*1000))}if(application.logSupported||application.appSetting("Debug")){log.write("\nwebservices.makeXMLAsyncRequest\n "+h+"About to send request: "+j+" to "+e);log.write("APIKey: "+this.apiKey+",DestinationTypeID: "+this.destType+",DestinationUniqueID: "+this.uniqueId+",User_Agent: "+this.userAgent+",SessionID: "+$cn.data.SessionId+",AuthToken"+$cn.data.AuthToken+",$cn.data.IsParent:"+$cn.data.IsParent)}this.WSRObj.setTarget("POST",e);this.WSRObj.addHeader("Content-Type","text/xml");this.WSRObj.setOnComplete(function(){r.RequestInProgress=false;var u={err:true,text:"",data:{}};application.isConnected=true;if(r.WSRObj.status&&r.WSRObj.status!=200){u.text="webservices.makeXMLAsyncRequest: call failed\nStatus: "+r.WSRObj.status;u.err=true;if(r.WSRObj.status=="502"||r.WSRObj.status=="1007"||r.WSRObj.status=="1013"){application.events.publish("error",{type:"no_internet",endPoint:p,method:h,params:k,callback:l})}else{if(r.WSRObj.status=="2013"){application.events.publish("error",{type:"socket_error",endPoint:p,method:h,params:k,callback:l,status:r.WSRObj.status})}else{application.events.publish("error",{type:"system_error",endPoint:p,method:h,params:k,callback:l,status:r.WSRObj.status})}}}else{if(device.logSupported||application.appSetting("Debug")){log.write("webservices.makeXMLAsyncRequest: status: "+r.WSRObj.status+" Request successful: "+r.WSRObj.responseText)}try{if(r.WSRObj.responseText&&r.WSRObj.responseText.length>0){u.err=false;u.text="CinemaNOW request successful";var v=XML.rootFromString(r.WSRObj.responseText);u.data.id=h;u.data.result=XML.nodesToJSONString(v.firstChild.childNodes);u.data.result=JSON.parse(u.data.result);if(application.authSupported&&u.data&&u.data.result&&u.data.result.responseCode==31&&h!="pollForToken"&&h!="lookupPurchaseDetailsForTitle"&&h!="calcOrderTax"&&h!="getBillingInfo"){application.events.publish("badauthtoken",{endPoint:p,method:h,params:k,callback:l})}else{l.call(s,u);if(u.data.result&&u.data.result.responseCode&&!u.data.result.errorHandled){r.handleResponseError(u.data,{type:"",endPoint:p,method:h,params:k,callback:l})}}}else{if((r.WSRObj.requestRunTime>=(application.appSetting("WSRequestTimeout")*1000))&&!f){application.events.publish("error",{type:"timeout_error",endPoint:p,method:h,params:k,callback:l})}}}catch(w){log.write("webservices.makeXMLAsyncRequest EXCEPTION "+w);log.write("webservices.makeXMLAsyncRequest Setting system_error!");log.write(log.dump(w,8));application.events.publish("error",{type:"system_error",endPoint:p,method:h,params:k,callback:l})}}if(r.RequestQueue.getSize()>0){log.write("webservices.makeXMLAsyncRequest Another item is in the queue. Call it.");r.makeXMLAsyncRequest("","","","","",false,true,false)}});this.WSRObj.send(j)}},makeAsyncRequestExt:function(n,s,j,m,h,w,q,g,r,f){if(!this.RequestQueue){this.RequestQueue=new Queue()}if(r&&!f){for(x=0;x<this.RequestQueue.getSize();x++){var v=this.RequestQueue.dequeue();log.write("webservices.makeAsyncRequestExt: Override passed in. Dequeuing requests...")}}if(!f){this.RequestQueue.enqueue({host:n,endPoint:s,method:j,params:m,cb_context:w,callback:q,errorcb:g})}if(!this.RequestInProgress){this.RequestInProgress=true;var v=this.RequestQueue.dequeue();n=v.host;s=v.endPoint;j=v.method;m=v.params;w=v.cb_context;q=v.callback;g=v.errorcb;if(n==null){n=application.apiUrl}var d=n+"/"+s;var l={id:++nextRequestId+"_"+j,method:j,params:m};var k=JSON.stringify(l);var u=this;this.killCurrentRequest();this.WSRObj=new WSRequest();this.WSRObj.setTimeout(function(){log.write("webservices.makeAsyncRequestExt: timeout function");u.RequestInProgress=false;u.WSRObj.abort();if(h){application.events.publish("error",{type:"timeout_error",endPoint:d,method:j,params:{},callback:g})}else{g.call(w)}},(application.appSetting("WSRequestTimeout")*1000));try{this.WSRObj.setTarget("POST",d);this.WSRObj.addHeader("Content-Type","text/plain; charset=utf-8");this.WSRObj.addHeader("Accept","*/*");this.WSRObj.addHeader("Accept-Language","en-us");if(application.authSupported){this.WSRObj.addHeader("x-json-rpc",j);this.WSRObj.addHeader("Connection","Keep-Alive");this.WSRObj.addHeader("Pragma","no-cache");this.WSRObj.addHeader("AuthToken",$cn.data.AuthToken);this.WSRObj.addHeader("APIKey",this.apiKey);this.WSRObj.addHeader("DestinationTypeID",this.destType);this.WSRObj.addHeader("DestinationUniqueID",this.uniqueId);this.WSRObj.addHeader("User-Agent",this.userAgent);this.WSRObj.addHeader("FileFilter","streamonly");this.WSRObj.addHeader("AccountType",($cn.data.IsParent)?"Parent":"Child");this.WSRObj.addHeader("SessionID",$cn.data.SessionId)}this.WSRObj.setOnComplete(function(){u.RequestInProgress=false;var A={err:true,text:"",data:{}};if(u.WSRObj.status!=null&&u.WSRObj.status!=200){A.text="webservices.makeAsyncRequestExt: call failed\nStatus: "+u.WSRObj.status;A.err=true;log.write(A.text);if(h){if(u.WSRObj.status=="502"||u.WSRObj.status=="1007"||u.WSRObj.status=="1013"){application.events.publish("error",{type:"no_internet",endPoint:d,method:j,params:{},callback:g})}else{if(u.WSRObj.status=="2013"){application.events.publish("error",{type:"socket_error",endPoint:d,method:j,params:{},callback:g})}else{application.events.publish("error",{type:"system_error",endPoint:d,method:j,params:{},callback:g})}}}else{g.call(w)}}else{try{A.err=false;A.text="CinemaNOW request successful";A.data=JSON.parse(u.WSRObj.responseText);if(application.authSupported&&A.data&&A.data.result&&A.data.result.responseCode==31&&j!="pollForToken"&&j!="lookupPurchaseDetailsForTitle"&&j!="calcOrderTax"&&j!="getBillingInfo"){application.events.publish("badauthtoken",{endPoint:s,method:j,params:m,callback:a_cb})}else{q.call(w,A);if(A.data.result&&A.data.result.responseCode&&!A.data.result.errorHandled&&h){u.handleResponseError(A.data,{type:"",endPoint:s,method:j,params:m,callback:a_cb})}}}catch(B){log.write("Callback exception!   "+B);if(h){application.events.publish("error",{type:"system_error",endPoint:d,method:j,params:{},callback:g})}else{g.call(w)}}}if(u.RequestQueue.getSize()>0){log.write("Another item is in the queue. Call it.");u.processAsyncQueueRequest()}});this.WSRObj.send(k)}catch(p){log.write(p);this.RequestInProgress=false;u.WSRObj.abort();if(h){application.events.publish("error",{type:"system_error",endPoint:d,method:j,params:{},callback:g})}else{g.call(w)}}}else{application.apiUrl=application.appSetting("ApiUrl");$cn.data.apiUrl=application.apiUrl;q.call(this,application.apiUrl)}},makeRestRequest:function(j,h,d){var g=j;var f=this;this.killCurrentRequest();this.WSRObj=new WSRequest();this.WSRObj.setTimeout(function(){f.WSRObj.abort();f.RequestInProgress=false;log.write("Web Service Timeout Error.");if(application.isLoaded){application.events.publish("error",{type:"timeout_error",endPoint:g,method:a_method,params:a_params,callback:d})}else{application.ui.init(function(){application.events.publish("error",{type:"timeout_error",recoverable:false,endPoint:g,method:a_method,params:a_params,callback:d})})}},(application.appSetting("WSRequestTimeout")*1000));try{this.WSRObj.setTarget("GET",g);this.WSRObj.addHeader("Content-Type","text/plain; charset=utf-8");this.WSRObj.addHeader("Accept","*/*");this.WSRObj.addHeader("Accept-Language","en-us");if(application.authSupported){this.WSRObj.addHeader("Connection","Keep-Alive");this.WSRObj.addHeader("Pragma","no-cache");this.WSRObj.addHeader("APIKey",this.apiKey);this.WSRObj.addHeader("DestinationTypeID",this.destType);this.WSRObj.addHeader("DestinationUniqueID",this.uniqueId);this.WSRObj.addHeader("User-Agent",this.userAgent);this.WSRObj.addHeader("FileFilter","streamonly");this.WSRObj.addHeader("SessionID",$cn.data.SessionId)}this.WSRObj.setOnComplete(function(){var l={err:true,text:"",data:{}};if(f.WSRObj.status&&f.WSRObj.status!=200){l.text="WSRequest: call failed\nStatus: "+f.WSRObj.status;l.err=true;log.write(l.text);if(f.WSRObj.status=="502"||f.WSRObj.status=="1007"||f.WSRObj.status=="1013"){application.events.publish("error",{type:"no_internet",endPoint:g,method:a_method,params:a_params,callback:d})}else{if(f.WSRObj.status=="2013"){application.events.publish("error",{type:"socket_error",endPoint:g,method:a_method,params:a_params,callback:d})}else{application.events.publish("error",{type:"system_error",endPoint:g,method:a_method,params:a_params,callback:d})}}}else{log.write("WSRequest: call successful to: "+g);try{l.err=false;l.text="RES request successful";l.data=JSON.parse(f.WSRObj.responseText);if(application.authSupported&&l.data&&l.data.result&&l.data.result.responseCode==31&&a_method!="pollForToken"&&a_method!="lookupPurchaseDetailsForTitle"&&a_method!="calcOrderTax"&&a_method!="getBillingInfo"){application.events.publish("badauthtoken",{endPoint:j,method:a_method,params:a_params,callback:d})}else{d.call(h,l);if(l.data.result&&l.data.result.responseCode&&!l.data.result.errorHandled){f.handleResponseError(l.data,{type:"",endPoint:j,method:a_method,params:a_params,callback:d})}}}catch(m){log.write(log.dump(m,8));application.events.publish("error",{type:"system_error",endPoint:g,method:a_method,params:a_params,callback:d})}}});this.WSRObj.send({})}catch(k){log.write(log.dump(k,8));this.RequestInProgress=false;this.WSRObj.abort();application.events.publish("error",{type:"system_error",endPoint:g,method:a_method,params:a_params,callback:d})}},makeLogRequest:function(j,g,m){var f="http://swelogs.stage1.outcoursing.com/capture.ashx";var l=new Date();var e=this;var k={id:++nextRequestId+"_makeLogRequest",deviceid:this.uniqueId,devicename:$cn.data.DeviceName,useragent:this.userAgent,devicetype:this.destType,apikey:this.apiKey,platform:"v2",version:$cn.data.SoftwareVersion,log:j};var h=JSON.stringify(k);killCurrentRequest();this.WSRObj=new WSRequest();j.write("*******************\n\nAbout to send logging request: "+h+" to "+f);j.debug("*******************\n\nAbout to send logging request: "+h+" to "+f);this.WSRObj.setTarget("POST",f);this.WSRObj.addHeader("Content-Type","text/plain; charset=utf-8");this.WSRObj.addHeader("Accept","*/*");this.WSRObj.addHeader("Accept-Language","en-us");this.WSRObj.setOnComplete(function(){j.write("Logging Output to server: [status]: "+e.WSRObj.status+", [Response]: "+e.WSRObj.responseText);m.call(g,"")});this.WSRObj.send(h)},killCurrentRequest:function(){if(this.WSRObj!=null){try{this.WSRObj.abort();if(this.WSRObj.destroy){this.WSRObj.destroy()}this.WSRObj=null}catch(d){log.write("Error thrown:");log.write(d)}this.RequestInProgress=false}},killRequests:function(){killCurrentRequest();if(this.RequestQueue){this.RequestQueue.clear()}},handleResponseError:function(g,m){if(!this.nonCheckMethods){this.nonCheckMethods=["verifyCode","applyGiftCode","getGenesByWheelOptionPlural","pollForToken","doPurchase","addItemToWishList","getAccountLinkState","getLinkingAccount"]}var f=this.nonCheckMethods.length;for(var j=0;j<f;j++){if(m.method==this.nonCheckMethods[j]){return}}if(g&&g.result&&g.result.responseCode){var n=g.result.responseCode,q=g.result.responseMessage,l=false,k=null,e="",h=null,p=m.callback,d=m.method;log.write("webservices.handleResponseError: method("+d+"), response code("+n+")");if(n==550){application.events.publish("error",{type:"system_error",endPoint:m.endPoint,method:d,params:m.params,callback:p})}else{if(n==2012){application.events.publish("error",{type:"timeout_error",endPoint:m.endPoint,method:d,params:m.params,callback:p})}else{switch(n){case 1:k=application.resource.checkout_messages.Title_ID_Not_Found;break;case 2:k=application.resource.checkout_messages.Invalid_User_ID;break;case 3:k=application.resource.checkout_messages.User_Address_Is_Invalid;break;case 4:k=application.resource.checkout_messages.User_Credit_Card_Security_Code_Is_Invalid;break;case 5:k=application.resource.checkout_messages.User_Credit_Card_Number_Is_Invalid;break;case 6:k=application.resource.checkout_messages.User_Credit_Card_Is_Expired;break;case 7:k=application.resource.checkout_messages.Credit_Card_Declined;break;case 8:k=application.resource.checkout_messages.Daily_Spending_Limit_Reached;break;case 11:k=application.resource.checkout_messages.User_Credit_Card_Not_On_File;break;case 12:k=application.resource.checkout_messages.User_Credit_Card_Not_On_File_And_User_Does_Not_Have_Sufficient_Prepaid_Funds_For_This_Transaction;break;case 551:k=application.resource.uv_messages.account_Server_Error;k.Message=q;break;default:break}if(n>=120&&n<=400){l=true,k=application.resource.checkout_messages.uv_error;k.Message=q}if(k){if(!e){e=k.MessageType||"message_okcancel"}if(!k.OK&&e=="message_okcancel"){e="message_content"}h={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,Path:k,callback:p};if(h.Footer&&!l){h.Footer=h.Footer.replace("{m}",BrowseView.resolveMethodCode(d))}log.write("webservices.handleResponseError: method("+d+"), response code("+n+") popup.");BrowseView.errorCleanup();BrowseView.showMessage(e,h)}else{log.write("webservices.handleResponseError: method("+d+"), response code("+n+") unknown, system error popup.");application.events.publish("error",{type:"system_error",endPoint:m.endPoint,method:d,params:m.params,callback:p})}}}}},clearContentCache:function(e){var d=new WSRequest();d.clearContentCache(e)}};var configuration={DEBUG:false,inited:false,settings:{},configrwfile:null,newconfigrwfile:null,callback:null,initialize:function(e){if(!this.inited){this.inited=true;var d=function(){this.loadCredentialsFile();if(this.DEBUG){log.write("Configuration: websocket: Properties of configuration object: ");for(prop in this){if($type(this[prop])!="function"){log.write("        ["+prop+"]("+$type(this[prop])+"): "+this[prop])}}log.write("Configuration: wesbsocket: Properties of credentials object: ");for(prop in this.credentials_values){if($type(this.credentials_values[prop])!="function"){log.write("        ["+prop+"]("+$type(this.credentials_values[prop])+"): "+this.credentials_values[prop])}}log.write("Configuration: websocket: Properties of settings object: ");for(prop in this.settings){if($type(this.settings[prop])!="function"){log.write("        ["+prop+"]("+$type(this.settings[prop])+"): "+this.settings[prop])}}}var g=this.readValue("DestinationUniqueID");if(g){if(this.DEBUG){log.write("Configuration websocket: Skipping callGetDestinationUniqueID")}webservices.uniqueId=g;$cn.data.DeviceID=g;e.call()}else{var f=this.readValue("DeviceID");if(f==null||f==""||f=="auto"){if(this.DEBUG){log.write("Configuration websocket: Invoking callGetDestinationUniqueID")}this.callGetDestinationUniqueID(e)}else{if(this.DEBUG){log.write("Configuration websocket: Using DeviceID = uniqueId = "+f)}webservices.uniqueId=$cn.data.DeviceID=f;e.call()}}};if(this.DEBUG){log.write("Configuration websocket: About to call ws.ReadAllSettings using :environment: store key.")}this.callReadAllSettings(":environment:",function(){if(this.DEBUG){log.write("Configuration websocket: Callback from :environment ReadAllSettings received")}if(this.newconfigrwfile){this.configrwfile=this.newconfigrwfile}else{this.configrwfile=this.settings.CNWS_PREFERENCE_FILE}if(this.DEBUG){log.write("Configuration websocket: Set configrwfile to "+this.configrwfile)}if(this.configrwfile!=undefined&&this.configrwfile!=null&&this.configrwfile!=""){if(this.DEBUG){log.write("Configuration websocket: Setting store")}this.callSetStores(this.configrwfile,null,function(){if(this.DEBUG){log.write("Configuration websocket: Invoking callReadAllSettings w/o store value")}this.callReadAllSettings(null,d.bind(this))}.bind(this))}else{this.callReadAllSettings(null,d.bind(this))}}.bind(this))}},readValue:function(f){var d=null;if(this.settings[f]!=undefined&&this.settings[f]!=""){if(this.DEBUG){log.write("Configuration: websocket: readValue: r/w: key="+f+", value="+this.settings[f])}try{d=JSON.parse(this.settings[f])}catch(g){d=this.settings[f]}}else{if(this.credentials_values[f]!=undefined&&this.credentials_values[f]!=""){if(this.DEBUG){log.write("Configuration: websocket: readValue: creds: key="+f+", value="+this.credentials_values[f])}d=this.credentials_values[f]}else{if(this[f]!=undefined&&this[f]!=""){if(this.DEBUG){log.write("Configuration: websocket: readValue: r/o: key="+f+", value="+this[f])}d=this[f]}else{if($cn.config[f]!=undefined&&$cn.config[f]!=""){if(this.DEBUG){log.write("Configuration: websocket: readValue: $cn.config: key="+f+", value="+$cn.config[f])}d=$cn.config[f]}else{if(this.DEBUG){log.write("Configuration: websocket: readValue: key "+f+" not found")}}}}}return d},writeValue:function(d,e){if(this.DEBUG){log.write("Configuration: websocket: writeValue: key="+d+", value="+e)}this.settings[d]=e;if(e==undefined||e==null){WebSocketManager.send('<RNOConfigurationCall>$$REQUESTID$$<DeleteSetting key="'+d+'"/></RNOConfigurationCall>',this,function(f){if(this.DEBUG){log.write("Configuration websocket: writeValue.DeleteSetting: Message is received: \n"+f)}})}else{WebSocketManager.send('<RNOConfigurationCall>$$REQUESTID$$<WriteSetting key="'+d+'">'+e+"</WriteSetting></RNOConfigurationCall>",this,function(f){if(this.DEBUG){log.write("Configuration websocket: writeValue.WriteSetting: Message is received: \n"+f)}})}},clearValue:function(d){if(this.DEBUG){log.write("Configuration: websocket: clearValue: "+d)}this.writeValue(d,null)},callSetStores:function(f,j,k){var g=this;var e="";var h="";if(f!=undefined&&f!=null&&f!=""){h="<Store>"+f+"</Store>"}if(j!=undefined&&j!=null&&j!=""){e='<Store readonly="true">'+j+"</Store>"}if(e!=""||h!=""){var d=h+e;log.write("Configuration.callSetStores: About to call WS.SetStores with "+d);WebSocketManager.send("<RNOConfigurationCall>$$REQUESTID$$<SetStores>"+d+"</SetStores></RNOConfigurationCall>",this,function(l){if(g.DEBUG){log.write("Configuration.callSetStores: Message is received: \n"+l)}k.call()})}else{k.call()}},getConfigPathElements:function(){var e=this.settings.CNWS_PREFERENCE_FILE.split("\\").join("/").split("/");for(var d=0;d<e.length;d++){while(e[d]==""&&d<e.length){e.splice(d,1)}}return e},changeSettingsFile:function(k,g){var j=this.getConfigPathElements();if(j){var e=this._parseCredentialCodes(j[j.length-2]);if(e){if(!k){k=e.cid}if(!g){g=e.rid}var d=k.toString()+"_";d+=g.toString();j[j.length-2]=d;var h=e.cid.toString()+"_"+e.rid.toString();var f=this.settings.CNWS_PREFERENCE_FILE.replace(h,d);this.newconfigrwfile=f}}},switchToSettingsFile:function(d){this.changeSettingsFile(d);this.configrwfile=this.newconfigrwfile;this.callSetStores(this.configrwfile,null,function(){this.callReadAllSettings(null,function(){log.write("switchToSettingsFile callback: After setting new file")})}.bind(this))},callReadAllSettings:function(e,h,f){if(this.DEBUG){log.write("Configuration websocket: About to call ws.ReadAllSettings.")}var d=this;var g="";if(e!=undefined&&e!=null&&e!=""){g=' store="'+e+'"'}if(f==undefined||f==null){f=this.settings}WebSocketManager.send("<RNOConfigurationCall"+g+">$$REQUESTID$$<ReadAllSettings></ReadAllSettings></RNOConfigurationCall>",this,function(j){if(d.DEBUG){log.write("Configuration websocket: Message is received: \n"+j)}var k=d.processConfigurationCallSettingsResponse(j,f);if(k!=0){log.write("Configuration websocket: Warning: processConfigurationCallSettingsResponse for ReadAllSettings returned non-zero "+k)}h.call()})},processConfigurationCallSettingsResponse:function(v,h){var d=0;if(this.DEBUG){log.write("Configuration.processConfigurationCallSettingsResponse: Message is received: \n"+v)}try{var q=XML.rootFromString(v);if(q.firstChild.nodeName=="RNOConfigurationCall_Response"){var g=q.firstChild.childNodes;for(var p=0;p<g.length;p++){if(g[p].nodeName=="ReadAllSettings_Response"){var n=g[p].attributes;if(n[0].name=="error"){var s=n[0].value;if(s==0){var f=g[p].childNodes;for(var m=0;m<f.length;m++){if(f[m].nodeName=="Setting"){if(f[m].attributes&&f[m].attributes.length>0){for(var l=0;l<f[m].attributes.length;l+=1){if(f[m].attributes[l]&&f[m].attributes[l].name=="key"){var u=f[m].attributes[l].value;h[u]=$cn.utilities.getNodeText(f[m]);if(this.DEBUG){log.write("Configuration.processConfigurationCallSettingsResponse: Key:("+u+"), Value("+h[u]+")")}}}}}}}else{log.write("Configuration.processConfigurationCallSettingsResponse: Warning: ReadAllSettings returned errorCpde "+s);d=s}}break}}}else{log.write("Configuration.processConfigurationCallSettingsResponse: Warning: received unexpected message.");d=-1}}catch(r){log.write("Configuration.processConfigurationCallSettingsResponse: Warning: exception parsing and processing response: "+r);d=-1}return d},callGetDestinationUniqueID:function(e){if(this.DEBUG){log.write("Configuration.callGetDestinationUniqueID: About to call ws.GetDestinationUniqueID.")}var d=this;WebSocketManager.send("<RNOWebServiceCall>$$REQUESTID$$<GetDestinationUniqueID></GetDestinationUniqueID></RNOWebServiceCall>",this,function(f){if(d.DEBUG){log.write("Configuration.callGetDestinationUniqueID: Response is received: \n"+f)}var g=d.processGetDestinationUniqueIDResponse(f);if(g!=0){log.write("Configuration.callGetDestinationUniqueID: Warning: processGetDestinationUniqueIDResponse for GetDestinationUniqueID returned non-zero "+g)}e.call()})},processGetDestinationUniqueIDResponse:function(g){var d=0;if(this.DEBUG){log.write("Configuration.processGetDestinationUniqueIDResponse: response passed is: \n"+g)}try{var k=XML.rootFromString(g);if(k.firstChild.nodeName=="RNOWebServiceCall_Response"){var f=k.firstChild.childNodes;for(var j=0;j<f.length;j++){if(f[j].nodeName=="GetDestinationUniqueID_Response"){var h=f[j].attributes;if(h[0].name=="error"){var n=h[0].value;if(n==0){var m=$cn.utilities.getNodeText(f[j]);if(m&&m!=""){if(this.DEBUG){log.write("Configuration.processGetDestinationUniqueIDResponse: Setting webservices.uniqueId and $cn.data.DeviceID ")}webservices.uniqueId=m;$cn.data.DeviceID=m;this.writeValue("DestinationUniqueID",m)}}else{log.write("Configuration.processGetDestinationUniqueIDResponse: Warning: GetDestinationUniqueID returned errorCpde "+n);d=n}}break}}}else{log.write("Configuration.processGetDestinationUniqueIDResponse: Warning: received unexpected response.");d=-1}}catch(l){log.write("Configuration.processGetDestinationUniqueIDResponse: Warning: exception parsing and processing response: "+l);d=-1}return d}};var device={logSupported:true,logToDisplay:false,backupIPConnectionSupported:true,realmodelid:"RES-BD",initialize:function(){log.write("device.initialize: stub version enter. $cn.data.DeviceID, webservices.uniqueId are "+$cn.data.DeviceID+", "+webservices.uniqueId);if(application.authSupported){if(webservices.uniqueId==""){$cn.data.DeviceID=webservices.uniqueId="BDE029102EBD";log.write("device.initialize: stub version: Setting fixed uniqueId "+webservices.uniqueId)}else{log.write("device.initialize: stub version: Leaving uniqueId, DeviceID as "+webservices.uniqueId+", "+$cn.data.DeviceID)}$cn.data.FirmwareVersion=$UrlQueryString.FirmwareVersion||$cn.data.FirmwareVersion;this.realmodelid=$UrlQueryString.Model||this.realmodelid;webservices.userAgent="CNSDK:"+$cn.data.FirmwareVersion+"|"+configuration.readValue("version")+"."+configuration.readValue("build")+" CNMODEL:"+this.realmodelid}log.write("device.initialize: Set User Agent to "+webservices.userAgent)},showBanner:function(){log.write("device.showBanner: stub version enter")},getFirmwareVersion:function(){return $cn.data.FirmwareVersion},getFirmwareYear:function(){return"2012"},getDeviceType:function(){return"RES"},getDeviceSoc:function(){return"BD"},setDeviceSoc:function(d){log.write("device.setDeviceSoc: stub version enter")},displayTime:function(d){log.write("device.displayTime: stub version enter with ms "+d)},displayPlay:function(){log.write("device.displayPlay: stub version enter")},displayPause:function(){log.write("device.displayPause: stub version enter")},displayStop:function(){log.write("device.displayStop: stub version enter")},initPlayer:function(){log.write("device.initPlayer: stub version enter")},initAudioPlugin:function(){log.write("device.initAudioPlugin: stub version enter")},setDocumentClassName:function(){if(this.isWebkit()){document.getElementsByTagName("body")[0].className="twothousandtwelve"}else{document.getElementsByTagName("body")[0].className="twothousandeleven"}return true},createActivationFile:function(){log.write("device.createActivationFile: stub version enter")},deleteActivationFile:function(){log.write("device.deleteActivationFile: stub version enter")},exit:function(){log.write("device.exit: stub version enter")},sendReturnEvent:function(){log.write("device.sendReturnEvent: stub version enter")},unload:function(){log.write("device.unload: stub version enter")},addLogSessionActivity:function(d,f,e){log.write("device.addLogSessionActivity: stub version enter")},uploadLogSession:function(){log.write("device.uploadLogSession: stub version enter")},play:function(g,e,d,f){e=e.replace(/&amp;/g,"&");log.write("device.play: stub version. Player url = "+e);if(d){Player.ResumePlay(e,d,f)}else{Player.Play(e,f)}},setOffScreenSaver:function(){log.write("device.setOffScreenSaver: stub version enter")},setOnScreenSaver:function(){log.write("device.setOnScreenSaver: stub version enter")},setOffFullScreen:function(){log.write("device.setOffFullScreen: stub version enter")},setOnFullScreen:function(){log.write("device.setOnFullScreen: stub version enter")},sourceChange:function(){log.write("device.sourceChange: stub version enter")},sourceChange_ori:function(){log.write("device.sourceChange_ori: stub version enter")},isWebkit:function(){return(navigator.userAgent.toLowerCase().indexOf("webkit")>-1)}};var BandwidthCheck={inited:false,callbackParms:null,callbackType:"",callback:null,successCondition:0,lastRan:0,lastProgressUpdateTime:"",lastProgressupdateValue:0,initialize:function(){if(!this.inited){log.write("BandwidthCheck.initialize: websocket version: Setting up unsolicited response handler");WebSocketManager.addHandler("DownloadFile_Progress",this,this.sdkProgressHandler);this.inited=true}},playerBandwidthCheck:function(e,h,g,d,j){log.write("BandwidthCheck.playerBandwidthCheck: websocket version enter");this.initialize();this.callbackParams={url:e,resume:(g<$cn.config.EarliestResumeS-$cn.config.RewindUponResumeS)?0:d};this.callbackType="player";this.lastRan=new Date();this.successCondition=(h)?application.appSetting("HDMinimumBandwidth"):application.appSetting("SDMinimumBandwidth");this.callback=j;var f=this.createRequest();WebSocketManager.send(f,this,this.sdkResponseHandler)},purchaseBandwidthCheck:function(f,l,k,h,j){log.write("BandwidthCheck.purchaseBandwidthCheck: websocket version enter");try{this.initialize();this.callbackParams={titleid:f,skuid:l,couponcode:k,pinValidated:true,bandwidthValidated:true};this.callbackType="purchase";this.lastRan=new Date();this.successCondition=(h)?application.appSetting("HDMinimumBandwidth"):application.appSetting("SDMinimumBandwidth");this.callback=j;var d=this.createRequest();WebSocketManager.send(d,this,this.sdkResponseHandler)}catch(g){log.write("BandwidthCheck.purchaseBandwidthCheck: websocket version. download control not supported")}},popupBandwidthCheck:function(d,k,h){log.write("BandwidthCheck.popupBandwidthCheck: websocket version enter");var f=0;try{this.initialize();$cn.data.bwTest.bwCallback=k;$cn.data.bwTest.self=d;d.startTime=new Date();this.callback=k;var g=this.createRequest();WebSocketManager.send(g,this,this.sdkResponseHandler)}catch(j){if(h){f=Number(setInterval(k,2000))}log.write("BandwidthCheck.popupBandwidthCheck: websocket version. download control not supported")}return f},createRequest:function(){var d="<RNOWebServiceCall>$$REQUESTID$$<DownloadFile";d+=' url="'+$cn.data.BandwithCheckURL+'"';d+=' targetFile=":null:"';d+=' maxDownloadTime="8000"';d+=' skippedTime="3000"';d+=' maxDownloadSize="'+$cn.data.BandwithCheckURLSize+'"';d+=' progressid="bandwidthTest"/></RNOWebServiceCall>';return d},sdkResponseHandler:function(j){log.write("BandwidthCheck.sdkResponseHandler: response: "+j);var n;try{n=XML.rootFromString(j).firstChild}catch(l){log.write("WSRequest (WebSocket): parsing error: "+l);throw (l)}var h=0;var q=0;var g=0;var m=0;var f=n.getElementsByTagName("DownloadFile_Response");if(f&&f.length){var p=f[0].attributes;for(var k=0;k<p.length;k++){var d=p[k].nodeName;if(d=="contentLength"){q=new Number(p[k].nodeValue)}else{if(d=="contentTime"){g=new Number(p[k].nodeValue)}else{if(d=="error"){m=new Number(p[k].nodeValue);if(m==0){m=1}}}}}}BandwidthCheck.lastProgressUpdate="";if(q>0&&g>0){h=parseInt((q*1000/g));BandwidthCheck.callback("SpeedUpdate?"+h)}else{BandwidthCheck.callback("SpeedUpdate?0")}BandwidthCheck.callback("ProgressUpdate?100");BandwidthCheck.callback("Complete?"+m)},sdkProgressHandler:function(n){if(n){var d=0;var k=1;var p="";var g=null;if(n.nodeName=="DownloadFile_Progress"){g=[n]}else{g=n.getElementsByTagName("DownloadFile_Progress")}if(g&&g.length){var q=g[0].attributes;for(var m=0;m<q.length;m++){var f=q[m].nodeName;if(f=="denominator"){k=new Number(q[m].nodeValue)}else{if(f=="numerator"){d=new Number(q[m].nodeValue)}else{if(f=="type"){p=q[m].nodeValue}}}}if(p=="ContentProgress"&&k>1){BandwidthCheck.callback("ProgressUpdate?"+parseInt(100*d/k));var j=new Date();if(BandwidthCheck.lastProgressUpdateTime!=""){var e=$cn.utilities.DateDiff(j,BandwidthCheck.lastProgressUpdateTime);if(e>=1000&&$cn.data.BandwithCheckURLSize==k){var l=$cn.data.BandwithCheckURLSize*((d/k)-BandwidthCheck.lastProgressUpdateValue);var h=parseInt(l*1000/e);BandwidthCheck.callback("SpeedUpdate?"+h);BandwidthCheck.lastProgressUpdateValue=d/k;BandwidthCheck.lastProgressUpdateTime=j}}else{BandwidthCheck.lastProgressUpdateValue=d/k;BandwidthCheck.lastProgressUpdateTime=j}}}}}};var Player={initialized:false,isPlay:false,isStopping:false,isHD:false,isStutter:false,isSkipping:false,playbackTime:0,playbackSpeed:1,playbackState:"Stopped",duration:0,videoWidth:960,videoHeight:540,bitrate:0,playbackQualityLevels:4,playbackQualityLevel:1,playbackQualityType:"SD",playbackQualityRate:0,ccData:null,scanWatchTimer:null,Initialize:function(){log.write("Player.Initialize(websocket version)");var d=false;if("WebSocketManager" in window){application.playbackSupported=true;d=true}return d},Shutdown:function(){log.write("Player.Shutdown(websocket version)");this.Stop();this._releasePlayer()},Play:function(e,g){log.write("Player.Play(websocket version): url("+e+")");if(this.initialized){log.write("Player.Play(websocket version): already initialized!");return}this.ccData=g;var f=this._generateCreatePlayerRequest(e),d=this;WebSocketManager.send(f,this,function(j){var k=d._getResponseNode(j,"CreatePlayer_Response");if(k){var h=k.attributes;if(h.length>0&&h[0].name=="error"){if(h[0].value==0){log.write("Player.Play(websocket version): create player success!");d.initialized=true;d._registerEventHandler()}else{d._handleError(h[0].value)}}}});return 1},ResumePlay:function(f,e,h){log.write("Player.ResumePlay(websocket version): url("+f+"), resumePosition("+e+")");if(this.initialized){log.write("Player.ResumePlay(websocket version): already initialized!");return}this.ccData=h;var g=this._generateCreatePlayerRequest(f),d=this;WebSocketManager.send(g,this,function(k){var l=d._getResponseNode(k,"CreatePlayer_Response");if(l){var j=l.attributes;if(j.length>0&&j[0].name=="error"){if(j[0].value==0){log.write("Player.ResumePlay(websocket version): create player success!");d.initialized=true;d.playbackTime=e;d._registerEventHandler()}else{d._handleError(j[0].value)}}}});return 1},Pause:function(){log.write("Player.Pause(websocket version)");if(!this.isPlay){log.write("Player.Pause(websocket version): not played!");return}var e="<RNOPlayerCall>$$REQUESTID$$<Pause/></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"Pause_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value!=0){d._handleError(f[0].value)}else{log.write("Player.Pause(websocket version): pause player success!")}}}});return 1},Resume:function(){log.write("Player.Resume(websocket version)");if(!this.isPlay){log.write("Player.Resume(websocket version): not played!");return}this._requestPlay();return 1},Stop:function(){log.write("Player.Stop(websocket version)");if(!this.initialized){log.write("Player.Stop(websocket version): not initialized!");return}this.isStopping=true;var e="<RNOPlayerCall>$$REQUESTID$$<Stop/></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"Stop_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value==0){log.write("Player.Stop(websocket version), stop player success!");d.isPlay=false}else{log.write("Player.Stop(websocket version), stop player error("+f[0].value+")!")}d._releasePlayer()}}})},JumpForward:function(d){log.write("Player.JumpForward(websocket version)");if(!this.isPlay){log.write("Player.JumpForward(websocket version): not played!");return}if(this.playbackTime+d<this.duration){this.isSkipping=true;this._requestPlay(this.playbackTime+d)}},JumpBackward:function(d){log.write("Player.JumpBackward(websocket version)");if(!this.isPlay){log.write("Player.JumpBackward(websocket version): not played!");return}if(this.playbackTime-d>0){this.isSkipping=true;this._requestPlay(this.playbackTime-d)}},LocateToPosition:function(d){log.write("Player.LocateToPosition(websocket version): postion("+d+")");if(!this.isPlay){log.write("Player.LocateToPosition(websocket version): not played!");return}if(0<d&&d<this.duration){this.isSkipping=true;this._requestPlay(d)}return 1},SetPlaybackSpeed:function(d){log.write("Player.SetPlaybackSpeed(websocket version): speed("+d+")");if(!this.isPlay){log.write("Player.SetPlaybackSpeed(websocket version): not played!");return}this._requestPlay(this.playbackTime,d);return 1},SetVisibility:function(d){log.write("Player.SetVisibility(websocket version)")},SetDisplayArea:function(e,g,f,d){log.write("Player.SetDisplayArea(websocket version)")},SetInitialTimeOut:function(d){log.write("Player.SetInitialTimeOut(websocket version)")},GetDuration:function(){log.write("Player.GetDuration(websocket version), duration("+this.duration+")");return this.duration*1000},GetCurrentBitrates:function(){log.write("Player.GetCurrentBitrates(websocket version), bitrate("+this.playbackQualityRate+")");return this.playbackQualityRate},GetQualityInfo:function(){log.write("Player.GetQualityInfo(websocket version), qualityType("+this.playbackQualityType+"), Level("+this.playbackQualityLevel+"), TotalLevel("+this.playbackQualityLevels+"), qualityRate("+this.playbackQualityRate+")");return{PlaybackQualityType:this.playbackQualityType,PlaybackQualityLevel:this.playbackQualityLevel,PlaybackQualityLevels:this.playbackQualityLevels,PlaybackQualityRate:this.playbackQualityRate}},GetVideoHeight:function(){log.write("Player.GetVideoHeight(websocket version)");return this.videoHeight},GetVideoWidth:function(){log.write("Player.GetVideoWidth(websocket version)");return this.videoWidth},SetCCLanguage:function(f){log.write("Player.SetCCLanguage(websocket version): language("+f+")");var e="<RNOPlayerCall>$$REQUESTID$$<SetCCLanguage>"+f+"</SetCCLanguage></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(h){var j=d._getResponseNode(h,"SetCCLanguage_Response");if(j){var g=j.attributes;if(g.length>0&&g[0].name=="error"){if(g[0].value!=0){d._handleError(g[0].value)}else{log.write("Player.SetCCLanguage(websocket version): SetCCLanguage success!")}}}});return 1},SetCCEnabled:function(e){log.write("Player.SetCCEnabled(websocket version): ccEnable("+e+")");var f="<RNOPlayerCall>$$REQUESTID$$<SetCCEnabled>"+e+"</SetCCEnabled></RNOPlayerCall>",d=this;WebSocketManager.send(f,this,function(h){var j=d._getResponseNode(h,"SetCCEnabled_Response");if(j){var g=j.attributes;if(g.length>0&&g[0].name=="error"){if(g[0].value!=0){d._handleError(g[0].value)}else{log.write("Player.SetCCEnabled(websocket version): SetCCEnabled success!")}}}});return 1},GetCCEnabled:function(g,e){log.write("Player.GetCCEnabled(websocket version)");var f="<RNOPlayerCall>$$REQUESTID$$<GetCCEnabled></GetCCEnabled></RNOPlayerCall>",d=this;WebSocketManager.send(f,this,function(k){var l=d._getResponseNode(k,"GetCCEnabled_Response"),j=false;if(l){var h=l.attributes;if(h.length>0&&h[0].name=="error"){if(h[0].value==0){if(l.firstChild.nodeValue&&l.firstChild.nodeValue=="true"){j=true}else{j=false}log.write("Player.GetCCEnabled(websocket version): get ccEnable("+j+")");if(typeof g==="function"){g.call(e,j)}}else{d._handleError(h[0].value)}}}})},SetCCCache:function(){log.write("Player.SetCCCache(websocket version)");var e='<RNOPlayerCall>$$REQUESTID$$<SetCCCache type="closedcaptions"/></RNOPlayerCall>',d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"SetCCCache_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value!=0){d._handleError(f[0].value)}else{log.write("Player.SetCCCache(websocket version): SetCCCache success!")}}}});return 1},SetCCData:function(g,e){log.write("Player.SetCCData(websocket version): language("+g+") url ("+e+")");var f='<RNOPlayerCall>$$REQUESTID$$<SetCCData language="'+g+'" url="'+e+'"/></RNOPlayerCall>',d=this;WebSocketManager.send(f,this,function(j){var k=d._getResponseNode(j,"SetCCData_Response");if(k){var h=k.attributes;if(h.length>0&&h[0].name=="error"){if(h[0].value!=0){d._handleError(h[0].value)}else{log.write("Player.SetCCData(websocket version): SetCCData success!")}}}});return 1},InitClosedCaption:function(){if(!this.ccData||!this.ccData.length){log.write("Player.InitClosedCaption(websocket version), CC data invalid, just return!");return}var e=ccrender.isCCEnabled(),f="<RNOPlayerCall>$$REQUESTID$$<SetCCLanguage>"+this.ccData[0].language+"</SetCCLanguage><SetCCEnabled>"+e+'</SetCCEnabled><SetCCCache type="closedcaptions"/><SetCCData language="'+this.ccData[0].language+'" url="'+this.ccData[0].closedCaptionAssetLocation+'"/></RNOPlayerCall>',d=this;log.write("Player.InitClosedCaption(websocket version): "+f);WebSocketManager.send(f,this,function(h){var j=d._getResponseNode(h,"SetCCData_Response");if(j){var g=j.attributes;if(g.length>0&&g[0].name=="error"){if(g[0].value!=0){d._handleError(g[0].value)}else{log.write("Player.InitClosedCaption(websocket version): SetCCData success!")}}}});return 1},GetCCStreams:function(){log.write("Player.GetCCStreams(websocket version)");var e='<RNOPlayerCall>$$REQUESTID$$<GetStreams streamType="closedcaption"/></RNOPlayerCall>',d=this;WebSocketManager.send(e,this,function(h){var j=d._getResponseNode(h,"GetStreams_Response");if(j){var g=j.attributes;if(g.length>0&&g[0].name=="error"){if(g[0].value!=0){d._handleError(g[0].value)}else{var f=j.firstChild.firstChild.textContent,k=(f==="Playing"||f==="Ready");OnUpdateCCState(k)}}}});return 1},_getResponseNode:function(d,k){try{var j=d.replace(/\r|\n/g,"").replace(/\s*</g,"<"),g=XML.rootFromString(j).firstChild,f;if(g.nodeName==="RNOPlayerCall_Response"&&g.childNodes&&g.childNodes.length){for(f=1;f<g.childNodes.length;f++){if(g.childNodes[f].nodeName===k){return g.childNodes[f]}}}return null}catch(h){log.write("Player._getResponseNode(websocket version): parsing response error: "+h);throw (h)}},_generateCreatePlayerRequest:function(f){f="TITLE_URL="+f;var e={titleURL:"TITLE_URL=",deviceID:"|DEVICE_ID=",deviceTypeID:"|DEVICET_TYPE_ID=",streamID:"|STREAM_ID=",clientIP:"|IP_ADDR=",drmServerURL:"|DRM_URL=",drmAckServerURL:"|ACK_URL=",heartbeatURL:"|HEARTBEAT_URL=",heartbeatPeriod:"|HEARTBEAT_PERIOD=",titleProfile:"|TITLE_PROFILE=",customData:"|CUSTOM_DATA=",hdStreamID:"|HD_STREAM_ID="};var m=0,l=0,q;for(q in e){m=f.indexOf(e[q]);if(m>-1){l=f.indexOf("|",m+1);if(l>-1){if(m+e[q].length<l){e[q]=f.substring(m+e[q].length,l)}else{e[q]=""}}}else{e[q]=""}}e.deviceID=e.deviceID+"|"+e.deviceTypeID;this.isHD=(e.titleProfile=="HD");var g=configuration.readValue("PreferredDRMProvider"),n=configuration.readValue("DPSProvisionBlob"),d=configuration.readValue("DPSContentID");var p="",h="";if(this.isHD){h=(g==="DIVX")?e.customData:e.streamID}else{p=(g==="DIVX")?e.customData:e.streamID;if(e.hdStreamID){h=e.hdStreamID}}var k="<RNOPlayerCall>$$REQUESTID$$<CreatePlayer><PlayerSettings><SDTitle>"+(this.isHD?"":e.titleURL)+"</SDTitle><HDTitle>"+(this.isHD?e.titleURL:"")+"</HDTitle><DRMProvider>"+(g||"")+"</DRMProvider><Credentials>"+(n||"")+"</Credentials><SD2HDThreshold>4200</SD2HDThreshold><HD2SDThreshold>2800</HD2SDThreshold><ContentID>"+(d||"")+"</ContentID><StreamingCredentials><DeviceID>"+e.deviceID+"</DeviceID><SDStreamID>"+p+"</SDStreamID><HDStreamID>"+h+"</HDStreamID><ClientIP>"+e.clientIP+"</ClientIP><DRMServerURL>"+e.drmServerURL+"</DRMServerURL><DRMAckServerURL>"+e.drmAckServerURL+"</DRMAckServerURL><HeartbeatURL>"+e.heartbeatURL+"</HeartbeatURL><HeartbeatPeriod>"+e.heartbeatPeriod+"</HeartbeatPeriod><TestURL/><BandwidthInterval/><ProxySettingsEnable>false</ProxySettingsEnable><ProxySettingsIPAddr/><ProxySettingsIPPort>0</ProxySettingsIPPort><ProxySettingsUserID/><ProxySettingsPassword/></StreamingCredentials></PlayerSettings></CreatePlayer></RNOPlayerCall>";log.write("Player._generateCreatePlayerRequest(websocket version), request string: "+k);return k},_requestPlay:function(h,j){log.write("Player._requestPlay(websocket version), playbackTime("+h+"), playbackSpeed("+j+")");if(!this.initialized){log.write("Player._requestPlay(websocket version): not initialized!");return}var g=h||0;var f=j||1;this.playbackSpeed=j;var e='<RNOPlayerCall>$$REQUESTID$$<Play><PlaybackTime type="seconds">'+g+"</PlaybackTime><PlaybackSpeed>"+f+"</PlaybackSpeed></Play></RNOPlayerCall>";var d=this;WebSocketManager.send(e,this,function(l){var m=d._getResponseNode(l,"Play_Response");if(m){var k=m.attributes;if(k.length>0&&k[0].name=="error"){if(k[0].value==0){log.write("Player._requestPlay(websocket version): player play success!");if(!d.isPlay&&!d.isStopping){d.isPlay=true;d._getDuration()}}else{d._handleError(k[0].value)}}}})},_releasePlayer:function(){log.write("Player._releasePlayer(websocket version)");if(!this.initialized){log.write("Player._releasePlayer(websocket version): not initialized!");return}var e="<RNOPlayerCall>$$REQUESTID$$<ReleasePlayer/></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"ReleasePlayer_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value==0){log.write("Player._releasePlayer(websocket version), release player success!");d.initialized=false;d.isPlay=false;d.isStopping=false;d.isHD=false;d.isStutter=false;d.isSkipping=false;d.playbackTime=0;d.playbackSpeed=1;d.playbackState="Stopped";d.duration=0;d.bitrates=0;d.playbackQualityLevels=4;d.playbackQualityLevel=1;d.playbackQualityType="SD";d.playbackQualityRate=0;d.ccData=null;OnPlaybackStopped()}else{log.write("Player._releasePlayer(websocket version), release player error("+f[0].value+")!")}}}})},_getDuration:function(){log.write("Player._getDuration(websocket version)");if(!this.isPlay){log.write("Player._getDuration(websocket version): not played!");return}var e="<RNOPlayerCall>$$REQUESTID$$<GetDuration/></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"GetDuration_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value==0){if(h.firstChild.nodeName=="PlaybackTime"){f=h.firstChild.attributes;d.duration=Number(h.firstChild.firstChild.nodeValue);if(f&&f.length&&f[0].name.toLowerCase()==="type"&&f[0].value.toLowerCase()==="frames"){d.duration=d.duration/25}log.write("Player._getDuration(websocket version): get duration("+d.duration+")");OnStreamInfoReady()}}else{d._handleError(f[0].value)}}}})},_getStreamAttributes:function(){log.write("Player._getStreamAttributes(websocket version)");if(!this.isPlay){log.write("Player._getStreamAttributes(websocket version): not played!");return}var g='<RNOPlayerCall>$$REQUESTID$$<GetStreamAttributes stream="0"/></RNOPlayerCall>',d=this,f=0,e=0;WebSocketManager.send(g,this,function(j){var k=d._getResponseNode(j,"GetStreamAttributes_Response");if(k){var h=k.attributes;if(h.length>0&&h[0].name=="error"){if(h[0].value==0){var m=k.childNodes;for(f=0;f<m.length;f++){if(m[f].nodeName=="VideoStreamAttributes"){var l=m[f].childNodes;for(e=0;e<l.length;e++){if(l[e].nodeName=="Width"){d.videoWidth=l[e].firstChild.nodeValue}else{if(l[e].nodeName=="Height"){d.videoHeight=l[e].firstChild.nodeValue}else{if(l[e].nodeName=="BitRate"){d.bitrates=l[e].firstChild.nodeValue}}}}break}}if(d.duration>0&&d.videoWidth>0&&d.videoHeight>0){OnStreamInfoReady()}}else{d._handleError(h[0].value)}}}})},_registerEventHandler:function(){log.write("Player._registerEventHandler(websocket version)");if(!this.initialized){log.write("Player._registerEventHandler(websocket version): not initialized!");return}var e="<RNOPlayerCall>$$REQUESTID$$<RegisterEventHandler/></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"RegisterEventHandler_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value==0){WebSocketManager.addHandler("RNOPlayerCall_Notify",d,d.EventNotification);if(d.ccData&&d.ccData.length){d.InitClosedCaption()}else{d._requestPlay(d.playbackTime)}}else{d._handleError(f[0].value)}}}})},EventNotification:function(d){var g=0;try{if(d.nodeName=="RNOPlayerCall_Notify"){if(d.firstChild.nodeName=="PlaybackStateEvent"){var l=d.firstChild.childNodes;for(g=0;g<l.length;g++){if(l[g].nodeName=="PlaybackState"){log.write("Player.EventNotification(websocket version), playbackSate("+l[g].firstChild.nodeValue+")");this._playbackStateChanged(l[g].firstChild.nodeValue)}else{if(l[g].nodeName=="PlaybackTime"){var m=Number(l[g].firstChild.nodeValue);this._checkForReverseScanEnd(m);this.playbackTime=m;log.write("Player.EventNotification(websocket version), playbackTime("+this.playbackTime+")");OnCurrentPlayTime(this.playbackTime*1000)}else{if(l[g].nodeName=="PlaybackQualityLevels"){log.write("Player.EventNotification(websocket version), PlaybackQualityLevels("+l[g].firstChild.nodeValue+")");this.playbackQualityLevels=l[g].firstChild.nodeValue}else{if(l[g].nodeName=="PlaybackQualityLevel"){log.write("Player.EventNotification(websocket version), PlaybackQualityLevel("+l[g].firstChild.nodeValue+")");this.playbackQualityLevel=l[g].firstChild.nodeValue;this._getCurrentBitrate(Number(this.playbackQualityLevel))}else{if(l[g].nodeName=="PlaybackQualityType"){log.write("Player.EventNotification(websocket version), PlaybackQualityType("+l[g].firstChild.nodeValue+")");this.playbackQualityType=l[g].firstChild.nodeValue}else{if(l[g].nodeName=="PlaybackQualityRate"){log.write("Player.EventNotification(websocket version), PlaybackQualityRate("+l[g].firstChild.nodeValue+")");this.playbackQualityRate=l[g].firstChild.nodeValue}}}}}}}}else{if(d.firstChild.nodeName=="ClosedCaptionEvent"){OnPlaybackCCData(d.firstChild.childNodes)}else{if(d.firstChild.nodeName=="PlaybackStreamChange"){if(d.firstChild.firstElementChild.nodeName=="ClosedCaptionStreamAttributes"){var j=d.firstChild.firstElementChild.childNodes,h;if(j&&j.length){for(g=0;g<j.length;g++){if(j[g].nodeName==="StreamState"){h=j[g].firstChild.nodeValue;log.write("Player.EventNotification(websocket version), ClosedCaptionStream state: "+h);break}}}if(h==="Downloaded"||h==="Error"){if(!this.isPlay){this._requestPlay(this.playbackTime)}if(h==="Error"){OnUpdateCCState(false)}}}}else{if(d.firstChild.nodeName=="PlaybackEndOfStreamEvent"){log.write("Player.EventNotification(websocket version), end of stream!");OnRenderingComplete()}else{if(d.firstChild.nodeName=="PlaybackStutterStartEvent"){log.write("Player.EventNotification(websocket version), stutter start event!");this.isStutter=true;OnPlaybackStutterStart()}else{if(d.firstChild.nodeName=="PlaybackStutterStopEvent"){log.write("Player.EventNotification(websocket version), Stutter stop event!");this.isStutter=false;OnPlaybackStutterStop()}else{if(d.firstChild.nodeName=="PlaybackUnderflowEvent"){log.write("Player.EventNotification(websocket version), playback underflow!")}else{if(d.firstChild.nodeName=="PlaybackSeekEvent"){log.write("Player.EventNotification(websocket version), seek finished!")}else{if(d.firstChild.nodeName=="PlaybackErrorEvent"){var f=d.firstChild.firstChild.nodeValue;log.write("Player.EventNotification(websocket version), error("+f+") occured!");this._handleError(f)}}}}}}}}}}}catch(k){log.write("Player.EventNotification(websocket version): parsing notification error: "+k);throw (k)}},_getCurrentBitrate:function(d){var e=1;switch(d){case 1:e=this.isHD?1:0.7;break;case 2:e=this.isHD?2:1;break;case 3:e=this.isHD?4:1.5;break;case 4:e=this.isHD?8:2;break}this.bitrate=e*1000*1024},_playbackStateChanged:function(d){if(this.playbackState!=d){log.write("Player._playbackStateChanged(websocket version), state("+this.playbackState+" => "+d+")");switch(this.playbackState){case"Stopped":if(d=="Playing"){OnBufferingComplete()}break;case"Paused":if(d=="Playing"&&this.isStutter){this.isStutter=false;OnPlaybackStutterStop()}break;case"Scanning":if(d=="Playing"){this.playbackSpeed=1;OnScanToPlay()}break;default:break}this.playbackState=d}if(this.isSkipping&&d=="Playing"){this.isSkipping=false;OnPlaybackSkipChapterEnd()}},_checkForReverseScanEnd:function(e){var d=this;if(this.playbackState==="Scanning"&&this.playbackSpeed<1){if(this.playbackTime<=2&&this.playbackTime-e<=0){log.write("PlayerInternal._checkForReverseScanEnd: the beginning is reached, will go to normal play after 5s, current time: "+this.playbackTime);if(!this.scanWatchTimer){this.scanWatchTimer=setTimeout(function(){d.scanWatchTimer=null;if(d.playbackState==="Scanning"&&d.playbackSpeed<1&&d.playbackTime<=2&&!d.isStopping){log.write("PlayerInternal._checkForReverseScanEnd: go to normal play as it is stuck in scanning!");d._requestPlay(d.playbackTime);OnScanToPlay()}},5000)}}}},_handleError:function(e){log.write("Player._handleError(websocket version), error("+e+")");var g=0;if(e.charAt(0)==="-"){g=Number(e)}else{g=parseInt(e,16)}log.write("Player._handleError(websocket version), errorCode(0x"+g.toString(16)+")");g&=2147483647;var h=false;if(1310720<=g&&g<1376256){switch(g){case 1310721:case 1310722:application.events.publish("error",{type:"no_internet"});break;default:h=true;break}}else{if(1376256<=g&&g<1441792){var d=g-1376256,f=d-10000;log.write("Player._handleError(websocket version), SDKError("+d+"), playerError("+f+")");if(f==113){return}switch(f){case 463:case 2004:OnNetworkDisconnected();break;case 401:OnAuthenticationFailed();break;case 400:case 408:case 462:case 500:case 503:case 504:OnConnectionFailed();break;case 404:case 454:OnStreamNotFound();break;case 513:case 514:case 515:case 516:case 517:case 520:case 521:case 522:case 523:case 524:case 525:case 550:case 570:OnCustomEvent(f);break;case 2000:case 2001:case 2002:case 2003:break;default:h=true;break}}else{h=true}}if(h){log.write("Player._handleError(websocket version), unknown error("+e+"), call OnRenderError()");OnRenderError()}}};function WSRequest(){this.headers={};this.action="GET";this.url="";this.timeoutTimer=null;this.startTime=-1;this.endTime=-1;this.requestRunTime=-1;this.cacheKey=""}WSRequest.prototype.setTarget=function(e,d){this.action=e;this.url=d};WSRequest.prototype.addHeader=function(e,d){this.headers[e]=d};WSRequest.prototype.setTimeout=function(e,d){this.timeoutTimer=setTimeout(e,d)};WSRequest.prototype.setOnComplete=function(d){this.onCompleteCallback=d};WSRequest.prototype.setCacheKey=function(d){if(d){this.cacheKey=d}};WSRequest.prototype.abort=function(){log.write("WSRequest (WebSocket): abort");clearTimeout(this.timeoutTimer);this.timeoutTimer=null;this.onCompleteCallback=undefined};WSRequest.prototype.send=function(e){var d=this;var f='<RNOWebServiceCall>$$REQUESTID$$<HTTPCall url="'+this.url+'" method="'+this.action+'" cacheKey="'+this.cacheKey+'">';for(header in this.headers){f+='<Header field="'+header+'">'+this.headers[header]+"</Header>"}f+="<Body>"+e+"</Body></HTTPCall></RNOWebServiceCall>";this.startTime=new Date();WebSocketManager.send(f,this,function(j){d.endTime=new Date();d.requestRunTime=$cn.utilities.DateDiff(d.endTime,d.startTime);log.write("WSRequest (WebSocket) response ["+d.startTime+" - "+d.endTime+"] ["+d.requestRunTime+"ms]");clearTimeout(d.timeoutTimer);d.timeoutTimer=null;var m;try{m=XML.rootFromString(j).firstChild}catch(n){log.write("WSRequest (WebSocket): parsing error: "+n);throw (n)}var h=m.getElementsByTagName("HTTPCall_Response");if(h&&h.length){var l=h[0].attributes;for(var k=0;k<l.length;k++){var g=l[k];if(g.nodeName=="error"){d.error=new Number(g.nodeValue);if(d.error!=0){log.write("WSRequest (WebSocket) HTTPCall_Response self.error set to non-zero: "+d.error)}else{}}else{if(g.nodeName=="statusCode"){d.status=new Number(g.nodeValue)}else{if(g.nodeName=="reasonPhrase"){d.statusText=g.nodeValue}}}}d.responseText=j.substring(j.indexOf("<Body>")+6,j.indexOf("</Body>"));d.responseText=d.responseText.split("&quot;").join('"').split("&apos;").join("'").split("&gt;").join(">").split("&lt;").join("<").split("&amp;").join("&");if(configuration.readValue("PreferredDRMProvider")!="DIVX"&&(!d.responseText||!d.responseText.length||(d.responseText.indexOf('"responseCode":')<0&&d.responseText.indexOf('"result":')<0))){log.write("WSRequest (WebSocket): no result or responseCode member in responseText, forcing to system error status");log.write("WSRequest (WebSocket) response: "+j);if(d.error&&d.error==80140001){d.status=502}else{d.status=500}}}else{log.write("WSRequest (WebSocket): no HTTPCall_Response node?");XML.dumpDOM(m);var h=m.getElementsByTagName("SocketError");if(h&&h.length){log.write("WSRequest (WebSocket): SOCKET ERROR");d.status=2013}else{d.status=500}}if(d.onCompleteCallback){d.onCompleteCallback.call(d)}})};WSRequest.prototype.clearContentCache=function(d){WebSocketManager.clearContentCache(d)};var Notifications={callbacks:[],initialized:false,initialize:function(){var d=this;if("WebSocketManager" in window){WebSocketManager.addHandler("Notification",this,function(f){log.write("Notifications: websocketmanager notice: dom: "+XML.toString(f));for(var h=0;h<d.callbacks.length;h++){var e=d.callbacks[h];log.write("Notifications: websocketmanager notice: cb object token: "+e.token);var g=f.getElementsByTagName(e.token);if(g.length==1){log.write("Notifications: websocketmanager notice: sending token node ["+e.token+"] to handler");e.callback.call(e.context,g[0])}}});this.initialized=true}},registerCallback:function(e,d,f){if(!this.initialized){this.initialize();if(!this.initialized){return}}log.write("Notifications.registerCallback: token: "+e);this.callbacks.push({token:e,context:d,callback:f})},sendNotification:function(e){if("WebSocketManager" in window){var d="<RNONotificationCall>$$REQUESTID$$<Notification>"+e+"</Notification></RNONotificationCall>";WebSocketManager.send(d,this,function(f){log.write("Notifications.sendNotification: response: "+f)})}}};configuration.credentialsPath="";configuration.credentials_values={};configuration.credentials_saved_config_values={};configuration.credentials_loaded=false;configuration._getPathElements=function(){var e=this.credentialsPath.split("\\").join("/").split("/");for(var d=0;d<e.length;d++){while(e[d]==""&&d<e.length){e.splice(d,1)}}return e};configuration._parseCredentialCodes=function(h,g){var f=h.split("_");if(f.length!=2){log.write("Configuration Base: _parseCredentialCodes: No _ found in second to last element!");return null}var e=new Number(f[0]);var j=new String(f[1]);if(isNaN(e)){log.write("Configuration Base: _parseCredentialCodes: CID: "+e+"   RID: "+j+"   One is not a number, so erroring");return null}var d="";if(g){d=g.slice(0,g.indexOf("configuration"))}return{cid:e,rid:j,theme:d}};configuration.getCredentialsCountryID=function(){if(this.credentialsPath!=undefined&&this.credentialsPath!=""){var e=this._getPathElements();var d=this._parseCredentialCodes(e[e.length-2]);if(d){return d.cid}else{return -1}}else{log.write("Configuration Base: getCredentialsCountryID: no credentialsPath set");return -1}};configuration.changeCredentials=function(k,g){var j=true;if(this.credentialsPath!=undefined&&this.credentialsPath!=""){var h=this._getPathElements();if(h){var e=this._parseCredentialCodes(h[h.length-2]);if(e){if(!k){k=e.cid}if(!g){g=e.rid}if(e.cid!=k||e.rid!=g){log.write("Configuration Base: changeCredentials: from: "+this.credentialsPath);var d=k.toString()+"_";d+=g.toString();h[h.length-2]=d;var f=h.join("/");log.write("Configuration Base: changeCredentials: to: "+f);if(this.checkCredentialsFile(f)){this.credentialsPath=f;this.loadCredentialsFile()}else{j=false;log.write("Configuration Base: changeCredentials: Could not load new credentials file ("+f+")")}}}}}return j};configuration.checkCredentialsFile=function(h){log.write("Configuration Base: checkCredentialsFile: "+h);try{var f=XML.rootFromFileSync(h);if(f){var d=f.getElementsByTagName("Value");var g=d[0].attributes.getNamedItem("Key").nodeValue;if(g=="XMLVersion"){var k=new Number($cn.utilities.getNodeText(d[0]));if(!isNaN(k)&&k>=2){log.write("Configuration Base: checkCredentialsFile: Success.");return true}}}}catch(j){log.write("Configuration Base: checkCredentialsFile: load exception! "+j)}log.write("Configuration Base: checkCredentialsFile: failed!");return false};configuration.loadCredentialsFile=function(){if(this.credentialsPath!=undefined&&this.credentialsPath!=""){log.write("Configuration Base: loading credential file: "+this.credentialsPath);var e=XML.rootFromFileSync(this.credentialsPath);if(e){var d=e.getElementsByTagName("Value");for(var g=0;g<d.length;g++){var f=d[g].attributes.getNamedItem("Key").nodeValue;var h=$cn.utilities.getNodeText(d[g]);if(!isNaN(new Number(h))){h=new Number(h)}else{if(h.toLowerCase()==="true"||h.toLowerCase()==="false"){h=((h.toLowerCase()==="true")?true:false)}}if(g==0){if(f=="XMLVersion"&&h>=2){log.write("Credential file in spec (version "+h+")");if(this.credentials_loaded){for(oldkey in this.credentials_saved_config_values){log.write("Configuration base: restoring prior $cn.config["+oldkey+"] from: "+$cn.config[oldkey]+", to be: "+this.credentials_saved_config_values[oldkey]);$cn.config[oldkey]=this.credentials_saved_config_values[oldkey]}this.credentials_saved_config_values={};this.credentials_values={}}this.credentials_loaded=true;continue}else{log.write("credential file not in spec");break;throw (-1)}}this.credentials_values[f]=h;if($cn.config[f]&&($cn.config[f]!=h)){log.write("Configuration Base: overwriting $cn.config["+f+"] from: "+$cn.config[f]+", to be: "+h);this.credentials_saved_config_values[f]=$cn.config[f];$cn.config[f]=h}}}}};configuration.loadConfigFile=function(e){log.write("Configuration Base: Loading config file: "+e);var f=XML.rootFromFileSync(e);if(f){var d=f.childNodes[0].childNodes;for(var g=0;g<d.length;g++){if(d[g].nodeName.toLowerCase()=="ver"&&(this.version==""||this.version==undefined)){this.version=$cn.utilities.getNodeText(d[g])}else{if(d[g].nodeName.toLowerCase()=="build"&&(this.build==""||this.build==undefined)){this.build=$cn.utilities.getNodeText(d[g])}}}}};configuration.setCredentialsFile=function(d){if(d){configuration.credentialsPath=d}};configuration.getPrefixedSettingKey=function(d){return configuration.getCredentialsCountryID()+"_"+d};var navigation={buildNavigation:function(h){h.sort(navigation.sortElemByY);var g=[],j=-1,d=0,l=-1,e=0,k,f;h.each(function(m){if(m.offsetHeight){if(m.offsetTop>l){l=m.offsetTop+m.offsetHeight;g[++j]=[]}g[j].push(m)}});g.each(function(m){m.sort(navigation.sortElemByX);for(e=m.length-2;e>=1;--e){m[e].setProperties({left:m[e].hasAttribute("left")?m[e].getAttribute("left"):m[e-1].id,right:m[e].hasAttribute("right")?m[e].getAttribute("right"):m[e+1].id})}if(m.length>1){m[0].setProperty("right",m[1].id);m[m.length-1].setProperty("left",m[m.length-2].id)}});for(j=0;j<g.length;++j){k=g[j-1];f=g[j+1];g[j].each(function(m){if(k){for(d=0;d<k.length;++d){if(m.intersects(k[d])&&(!m.hasAttribute("up")||m.hasAttribute("data-builtUp"))){log.write(m.id+" BUILT UP");m.setProperty("up",k[d].id);m.setProperty("data-builtUp","true")}}}if(f){for(d=0;d<f.length;++d){if(m.intersects(f[d])&&(!m.hasAttribute("down")||m.hasAttribute("data-builtDown"))){log.write(m.id+" BUILT Down");m.setProperty("down",f[d].id);m.setProperty("data-builtDown","true")}}}})}log.write("buildNavigation - exit")},setFirstFocusableElement:function(){log.write("No element has focus yet. Try to set initial focus.");application.element.buildPositions();application.currentView.controls.sort(this.sortByX);if(application.currentView.controls[0]&&application.currentView.controls[0].elemid){application.element.current=application.currentView.controls[0].elemid;var d=$(application.element.current);log.write("Current focused element is: "+application.currentView.controls[0].elemid);if(typeof d.setFocus=="function"){if(pointer.isPointerModeActive()){pointer.lastFocusId=application.currentView.controls[0].elemid;this.setFocus(null)}else{d.setFocus({});d.addClass("hover")}}else{log.write("ERROR: first element on this view has a focusable attribute")}}else{log.write(application.currentView.controls)}},up:function(j){log.write("Navigate Up");if((application.element.current==null||application.element.current=="")||(application.element.current!=""&&!document.getElementById(application.element.current))){this.setFirstFocusableElement()}var l=null,h=$(application.element.current).attributes.up,g=[],f=null,e=null,d=0,k=0;if(h!=null){l=$(h.value)}if(!l){f=$(application.element.current).getPosition();application.element.buildPositions();application.currentView.controls.sort(this.sortByYDesc);for(d=0;d<application.currentView.controls.length;d++){if(this.isVisible(application.currentView.controls[d])){if(application.currentView.controls[d].x==f.x){if(f.y-4>application.currentView.controls[d].y){e=$(application.currentView.controls[d].elemid);g[g.length]=application.currentView.controls[d];l=e;break}}}}if(!l){g.sort(this.sortByXDesc);for(k=0;k<g.length;k++){e=$(g[k].elemid);if(typeof e.setFocus=="function"){l=e;break}}}}if(l){this.setFocusElement(l)}},down:function(l){log.write("Navigate Down");if((application.element.current==null||application.element.current=="")||(application.element.current!=""&&!document.getElementById(application.element.current))){application.setFirstFocusableElement()}var h=null,d=$(application.element.current).attributes.down,f=[],g=null,m=null,e=null,k=0,j=0;if(d!=null){h=$(d.value)}if(!h){g=$(application.element.current).getPosition();m=$(application.element.current).getSize();application.element.buildPositions();application.currentView.controls.sort(this.sortByY);for(k=0;k<application.currentView.controls.length;k++){if(this.isVisible(application.currentView.controls[k])){if(application.currentView.controls[k].y+5>=(g.y+m.y)){f[f.length]=application.currentView.controls[k];if(application.currentView.controls[k].x==g.x){e=$(application.currentView.controls[k].elemid);h=e;break}}}}if(!h){f.sort(this.sortByX);for(j=0;j<f.length;j++){e=$(f[j].elemid);h=e;break}}}if(h){this.setFocusElement(h)}},right:function(l){log.write("Navigate Right");if((application.element.current==null||application.element.current=="")||(application.element.current!=""&&!document.getElementById(application.element.current))){application.setFirstFocusableElement()}var h=null,d=$(application.element.current).attributes.right,f=[],g=null,m=null,e=null,k=0,j=0;if(d!=null){h=$(d.value)}if(!h){g=$(application.element.current).getPosition();m=$(application.element.current).getSize();application.element.buildPositions();application.currentView.controls.sort(this.sortByX);for(k=0;k<application.currentView.controls.length;k++){if(this.isVisible(application.currentView.controls[k])){if(application.currentView.controls[k].x>=(g.x+m.x)){f[f.length]=application.currentView.controls[k];if(application.currentView.controls[k].y>g.y-3&&application.currentView.controls[k].y<g.y+3){if(application.currentView.controls[k].x-(g.x+m.x)<200){e=$(application.currentView.controls[k].elemid);h=e;log.write("Focused element: "+h.id);break}}}}}if(!h){for(j=0;j<f.length;j++){e=$(f[j].elemid);h=e;log.write("Focused element: "+h.id);break}}}if(h){this.setFocusElement(h)}},left:function(l){log.write("Navigate Left");if((application.element.current==null||application.element.current=="")||(application.element.current!=""&&!document.getElementById(application.element.current))){application.setFirstFocusableElement()}var h=null,d=$(application.element.current).attributes.left,f=[],g=null,m=null,e=null,k=0,j=0;if(d!=null){h=$(d.value)}if(!h){g=$(application.element.current).getPosition();m=$(application.element.current).getSize();application.element.buildPositions();application.currentView.controls.sort(this.sortByXDesc);for(k=0;k<application.currentView.controls.length;k++){if(this.isVisible(application.currentView.controls[k])){if(application.currentView.controls[k].x<g.x){f[f.length]=application.currentView.controls[k];if(application.currentView.controls[k].y>g.y-3&&application.currentView.controls[k].y<g.y+3){e=$(application.currentView.controls[k].elemid);h=e;break}}}}if(!h){for(j=0;j<f.length;j++){e=$(f[j].elemid);h=e;break}}}if(h){this.setFocusElement(h)}},setFocus:function(e,d){this.setFocusElement($(e),d)},setFocusElement:function(focusedElement,isDefaultFocus){if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){var elem=$(application.element.current);if(elem.get("blur")){eval("("+elem.get("blur")+")")}application.events.publish("elementblur",{bluredelem:application.element.current,nextFocus:focusedElement});elem.removeClass("hover");log.write("Lose Focus: "+application.element.current)}application.element.current=(focusedElement)?focusedElement.id:null;if(focusedElement){if(pointer.isPointerModeActive()&&isDefaultFocus){pointer.lastFocusId=application.element.current||pointer.lastFocusId;log.write("Set Defualt Focus: "+pointer.lastFocusId)}else{var elem=$(application.element.current);if(elem.get("focus")){eval("("+elem.get("focus")+")")}application.events.publish("elementfocus",{focusedelem:application.element.current});elem.addClass("hover");log.write("Get Focus: "+application.element.current)}}},isVisible:function(d){var f=$(d.elemid);if(f&&f.offsetWidth){return this.isInBounds(d)}return false},isInBounds:function(e){var d=true;if(e.x<0||e.x>960||e.y<0||e.y>540||$(e.elemid).getStyle("display")=="none"){d=false}return d},sortByX:function(f,e){var d=f.x,g=e.x;return((d<g)?-1:((d>g)?1:0))},sortByXDesc:function(f,e){var d=f.x,g=e.x;return((d>g)?-1:((d<g)?1:0))},sortByY:function(f,e){var d=f.y,g=e.y;return((d<g)?-1:((d>g)?1:0))},sortByYDesc:function(f,e){var d=f.y,g=e.y;return((d>g)?-1:((d<g)?1:0))},sortElemByX:function(f,e){var d=f.offsetLeft,g=e.offsetLeft;return((d<g)?-1:((d>g)?1:0))},sortElemByY:function(f,e){var d=f.offsetTop,g=e.offsetTop;return((d<g)?-1:((d>g)?1:0))}};$cn.data.mockUserAccount="";$cn.data.mockUserAccountState="";$cn.data.RuntimeId=Math.round(new Date().getTime()/1000);$cn.data.ApiUrl="";$cn.data.Navigation=null;$cn.data.History={};$cn.data.BonusAssetCache={};$cn.data.StreamAssetCache={};$cn.data.TitlesByGenre={};$cn.data.Merch={};$cn.data.TitlesByGenrePages={};$cn.data.TitlesByCast={};$cn.data.TitlesBySimilar={};$cn.data.TitlesAudioProfiles={};$cn.data.PurchaseAudioProfiles={};$cn.data.TitleCache={};$cn.data.TitleSummaryCache={};$cn.data.TitleDetailCache={};$cn.data.TitleCastDetailCache={};$cn.data.TitleCastBiosCache={};$cn.data.TitleCastBioCache={};$cn.data.TitleCreditsCache={};$cn.data.TitleImagesCache={};$cn.data.TitleReviewsCache={};$cn.data.TitleRecommendations={};$cn.data.TitleTechnicalDetailsCache={};$cn.data.d2dTitleInfo={};$cn.data.d2dTitleOffers={};$cn.data.d2dPath=false;$cn.data.EpisodeCache={};$cn.data.EpisodeListCache={};$cn.data.purchTypeFilter="any";$cn.data.PassCache={};$cn.data.isPassUVCache={};$cn.data.SearchResults={};$cn.data.AuthToken="";$cn.data.CurrentRegion="";$cn.data.SoftwareVersion="";$cn.data.DeviceName="";$cn.data.UserEmailAddress="";$cn.data.EnableAdult="";$cn.data.ContentIsFiltered=false;$cn.data.EnableTv=false;$cn.data.EnableSite=false;$cn.data.EnableMerchPage=false;$cn.data.DeviceID="";$cn.data.PendingWishlistItem="";$cn.data.MyVideos=[];$cn.data.lastViewed=null;$cn.data.lastBrowsed=null;$cn.data.speedchecked=false;$cn.data.freshPurchase=false;$cn.data.brokenImages={};$cn.data.masterWheel={};$cn.data.slaveWheel={};$cn.data.getBundleListing={};$cn.data.TitlePersonCache={};$cn.data.TitleSearchCache={};$cn.data.EulaText="";$cn.data.SessionId="";$cn.data.IsParent=false;$cn.data.isConnected=true;$cn.data.completedSpeedTest=false;$cn.data.InitialLoad=true;$cn.data.CurrentPromotion="";$cn.data.CurrentSku="";$cn.data.ImageLoadTest="";$cn.data.PurchasePinEnabled=false;$cn.data.ParentalControlsConfigured=false;$cn.data.ParentPinEnabledOnStartup=false;$cn.data.ParentPinEnabled=false;$cn.data.AdultPinEnabled=false;$cn.data.LastCacheLoadTimeUTC=null;$cn.data.ShouldUpdateCache=false;$cn.data.CountryID=-1;$cn.data.SelectedCountryID=-1;$cn.data.Region="";$cn.data.RegionCheckEnabled=true;$cn.data.AllowedRegions=[];$cn.data.ActivationURL="";$cn.data.DisplayEula=false;$cn.data.ShouldEnableTvNode=false;$cn.data.LastBandwidthCheck=null;$cn.data.LastBandwidthSpeed=0;$cn.data.BandwithCheckURL="";$cn.data.BandwithCheckURLSize=0;$cn.data.AuthTokenActive=false;$cn.data.SystemOffline=false;$cn.data.SystemUnavailableMessage="";$cn.data.SessionLimitRows=-1;$cn.data.SessionLimitMinutes=-1;$cn.data.AllowAdult=false;$cn.data.AllowPlayboy=false;$cn.data.AffId="Not Set";$cn.data.EnableAccountLink=false;$cn.data.AccountLinkUrl="";$cn.data.RootMoodGenreID="";$cn.data.TVRootMoodGenreID="";$cn.data.RecomendedGenreIds="";$cn.data.LibraryWheelItems={};$cn.data.LibraryWheelItemsLastLoaded=new Date();$cn.data.LoadTitleID="";$cn.data.libraryMasterWheel=[{iD:"0",name:"Movies",ptype:10954,ttype:"Movies",status:"Undefined"},{iD:"1",name:"Movie Rentals",ptype:10954,ttype:"Movie_Rentals",status:"Undefined"},{iD:"2",name:"HD Movies",ptype:10954,ttype:"HD_Movies",status:"Undefined"},{iD:"3",name:"HD TV Shows",ptype:11062,ttype:"HD_TV_Shows",status:"Undefined"},{iD:"4",name:"TV Shows",ptype:11062,ttype:"TV_Shows",status:"Undefined"},{iD:"5",name:"My UltraViolet",ptype:10954,ttype:"UV_Movies",status:"Undefined"},{iD:"6",name:"Disc to Digital",ptype:10954,ttype:"D2D_Movies",status:"Undefined"}];$cn.data.librarySlaveWheel="";$cn.data.jinniEnable=false;$cn.data.flixsterEnable=false;$cn.data.baselineEnable=false;$cn.data.recommendedGenres=[];$cn.data.FirmwareVersion="Not Set";$cn.data.PreferredAudioType="";$cn.data.PreferredAudioTypeSet=false;$cn.data.AllowedAudioProfiles=[];$cn.data.DTS51Enable=false;$cn.data.Dolby51Enable=false;$cn.data.DTSStereoEnable=false;$cn.data.DolbyStereoEnable=false;$cn.data.ShowWelcomeScreen=true;$cn.data.sysTestResults=[];$cn.data.UVTermsText="";$cn.data.UVTermsAcceptance=null;$cn.data.uvLinkingAccount={Status:{active:"Active",deleted:"Deleted",forceDelete:"ForceDelete",suspended:"Suspended",blocked:"Blocked",blockedTOU:"BlockedTOU",blockedCLG:"BlockedCLG",pending:"Pending",archived:"Archived",other:"Other"}};$cn.data.uvLinkStatus={linkState:{notAvailable:"AcctNotAvailable",unlinking:"Unlinking",pending:"Pending",linked:"Linked"}};$cn.data.CCTextColor="auto";$cn.data.CCTextOpacity="auto";$cn.data.CCTextSize="auto";$cn.data.CCFont="auto";$cn.data.CCBackgroundColor="auto";$cn.data.CCBackgroundOpacity="auto";$cn.data.CCTextEdge="auto";$cn.data.CCWindowColor="auto";$cn.data.CCWindowOpacity="auto";$cn.data.CCLanguage="auto";var ui={_rootLayout:null,_controlCollection:[],_viewCollection:[],_styleCollection:[],_tplCollection:[],sprite:null,spriteCustom:null,spriteVideo:null,spriteVideoBlue:null,wasInitialized:false,init:function(d,f){var e=this;log.write("=== initializing ui ===");log.write("cancelReady is: "+f);e.wasInitialized=true;XML.rootFromFile("theme/"+$cn.config.CurrentTheme+"/template.xml",function(g){updateSplash(95);currPerc=(currPerc<95?95:currPerc);e._rootLayout=g;e.initUI();if(f){d();return}e.sprite=new Image();e.sprite.onload=function(){e.spriteVideo=new Image();e.spriteVideo.onload=function(){log.write("Player sprite loaded.");e.spriteCustom=new Image();e.spriteCustom.onload=function(){e.spriteButtons=new Image();e.spriteButtons.onload=function(){e.spriteBackgrounds=new Image();e.spriteBackgrounds.onload=function(){currPerc=100;setTimeout(function(){updateSplash(100)},400);log.write("Extras sprite loaded.");application.loadView(BrowseView);log.write("Publish ready event.");application.events.publish("ready");if(d){d.call(this)}};e.spriteBackgrounds.src="theme/"+$cn.config.CurrentTheme+"/Orbit960_backgrounds.png"};e.spriteButtons.src="theme/"+$cn.config.CurrentTheme+"/Orbit960_buttons.png"};e.spriteCustom.src="theme/"+$cn.config.CurrentTheme+"/Orbit960_extras.png";e.spriteCustom.onerror=function(h){log.write(h)}};e.spriteVideo.src="theme/"+$cn.config.CurrentTheme+"/Orbit960RedVideo.png"};e.sprite.src="theme/"+$cn.config.CurrentTheme+"/Orbit960.png";e.sprite.onerror=function(h){log.write(h)}})},initUI:function(){var k,j,h;if(!$cn.config.PrecompiledApplication){var m=this._rootLayout.childNodes[0].childNodes;var f=null;for(k=0;k<m.length;k++){if(m[k].nodeName.toLowerCase()=="views"||m[k].nodeName.toLowerCase()=="controls"){var n=m[k].childNodes;for(j=0;j<n.length;j++){if(n[j].nodeName.toLowerCase()=="view"||n[j].nodeName.toLowerCase()=="control"){var l=(n[j].nodeName.toLowerCase()=="control")?"control":"";var d=n[j].childNodes;for(h=0;h<d.length;h++){if(d[h].nodeName.toLowerCase()=="layout"){var e=XML.nodeToHash(d[h]);var g=XML.hashToElement(e,"div");if(n[j].nodeName.toLowerCase()=="control"){this._controlCollection[n[j].attributes.id.nodeValue.toLowerCase()]=g}else{this._viewCollection[n[j].attributes.id.nodeValue.toLowerCase()]=g}}}}}}}}},destroyLayout:function(){if(!$cn.config.PrecompiledApplication){var d=document.getElementById("uicontainer");d.parentNode.removeChild(d);var e=document.createElement("div");e.setAttribute("id","uicontainer");document.getElementById("detention").appendChild(e)}},loadLayout:function(e){var k,q,d,l,n,m;if(!$cn.config.PrecompiledApplication){if(this._viewCollection[e.toLowerCase()]){k=this._viewCollection[e.toLowerCase()];k.setAttribute("id",e.toLowerCase());application.putInnerHTML("uicontainer","");q=document.getElementById("uicontainer");d=q.parentNode;d.removeChild(q);l=document.createElement("div");l.setAttribute("id","uicontainer");l.appendChild(k);d.appendChild(l)}n=$("uicontainer").getElements("control");for(m=0;m<n.length;m++){var h=this._controlCollection[n[m].id.toLowerCase()];if(h){h.setAttribute("id",n[m].id.toLowerCase());var l=document.getElementById(n[m].id.toLowerCase());l.parentNode.replaceChild(h,l)}}var j=$("uicontainer").getElements("tpl");this._tplCollection=[];for(m=0;m<j.length;m++){var f=new Element("div");f.set("id",j[m].getFirst().get("id"));f.set("class",j[m].getFirst().get("class"));j[m].getFirst().inject(f);var g=f.get("html");this._tplCollection[j[m].get("id").toLowerCase()]=f.get("html")}j.destroy()}},loadTpl:function(d){return String(this._tplCollection[d])}};ui.template=function(h,f){var g=this,d=arguments,j=null,e=[];this.re=/\{([\w-]+)\}/g,this.refunction=/\@@([^@]+)\@@/g,this.refunctioninput=/\##([^#]*)\##/g,g.html=f;g.elemid=h;if(g.compiled){g.compile()}};ui.template.prototype={applyTemplate:function(d){var e=this;return e.compiled?e.compiled(d):e.html.replace(e.re,function(f,g){return d[g]!==undefined?d[g]:""}).replace(e.refunction,function(f,g){return d[g]!==undefined?d[g]:""})},set:function(d,f){var e=this;e.html=d;e.compiled=null;return f?e.compile():e},compile:function(){var me=this,sep=",";function fn(m,name){name="values['"+name+"']";return"'"+sep+"("+name+" == undefined ? '' : "+name+")"+sep+"'"}function fninput(i){var x=i.replace(/"/g,'\\"').replace(/####/g,"").replace(/##/g,"").replace(/'/g,"\\'");return x}function fnscript(m,name){var html="";var input=name.replace(/&quot;/g,'"');try{html=eval("("+input+")")}catch(e){log.write(e);log.write(input);log.write(name)}return html}eval("this.compiled = function(values){  var html = ['"+me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace("%7B","{").replace("%7D","}").replace("%28","(").replace("%29",")").replace(this.re,fn)+"'].join('');   html = html.replace(this.refunctioninput, fninput).replace(this.refunction, fnscript); return html;};");return me},prepend:function(d){var g=document.getElementById(this.elemid).childNodes;var f=this.applyTemplate(d);var e=f.toElement();if(e){if(g.length>0){document.getElementById(this.elemid).insertBefore(e,document.getElementById(this.elemid).childNodes[0]);if(e.getElement("a")){application.currentView.layoutIsDirty=true}}else{this.append(d)}}else{log.write("Cannot append el: "+el+" to tpl. TPL does not exist.")}},insertAt:function(f,e){var j=document.getElementById(this.elemid).childNodes,h=this.applyTemplate(f),g=h.toElement(),d;if(g){for(d=0;d<j.length;d++){if(e==d){document.getElementById(this.elemid).insertBefore(g,document.getElementById(this.elemid).childNodes[d]);if(g.getElement("a")){application.currentView.layoutIsDirty=true}break}}}else{log.write("Cannot append el: "+el+" to tpl. TPL does not exist.")}},empty:function(){var d=$(this.elemid);if(d){if(application.element.current!=null&&document.getElementById(application.element.current)&&d.isParentOf($(application.element.current))){navigation.setFocusElement(null)}if(d&&d.getElement("a")){application.currentView.layoutIsDirty=true}application.putInnerHTML(document.getElementById(this.elemid),"")}},emptyAndAppend:function(d){var f=this.applyTemplate(d);var e=f.toElement();if(e){document.getElementById(this.elemid).innerHTML=f;if(e.getElement("a")){application.currentView.layoutIsDirty=true}}else{log.write("Cannot append el: "+e+" to tpl. TPL does not exist.")}},append:function(d){var f=this.applyTemplate(d);var e=f.toElement();if(e){if(document.getElementById(this.elemid)){document.getElementById(this.elemid).appendChild(e);if(e.getElement("a")){application.currentView.layoutIsDirty=true}}}else{log.write("Cannot append el: "+e+" to tpl. TPL does not exist.")}},apply:function(){if(document.getElementById(this.elemid)){application.element.bindActions(this.elemid,true);var h=$(this.elemid).getElements(".ellipsis");for(var g=0;g<h.length;++g){var f=h[g];var d=f.offsetHeight;var e=f.style.height;log.write("Ellipsis element: ");log.write(f);f.setStyle("height","auto");f.addClass("hid");log.write("height: "+d+" : "+f.offsetHeight);if(f.offsetHeight>d){application.putInnerHTML(f,$cn.utilities.truncateText(f,f.innerHTML,d,0,f.innerHTML.length))}else{f.style.height=e}f.removeClass("hid")}}}};var log={write:function(f){var d,e="alert() : ";application.remotelog+=String(f)+"\n";if($cn.config.Debug){d=$cn.data.RuntimeId+" ROVI "+$cn.config.CurrentTheme+" : "+f;try{if(device.logToDisplay){alert(d);this.debug(f)}else{console.log(e+d)}}catch(g){alert("Caught")}}},debug:function(d){if($cn.config.Debug){if($("debugger").getStyle("display")=="block"){$("debugger").innerHTML=d+"<br />"+$("debugger").innerHTML}}},session:{_doc:"",lastSync:null,sessionLimitMinutes:null,sessionLimitRows:5,currentRows:0,checkinTimer:new Timer(),addActivity:function(e,d){device.addLogSessionActivity(this,e,d)},sync:function(d){if(d.length<3024){webservices.makeLogRequest(d,this,function(f){application.remotelog=""})}else{var e=d.substring(0,3024);webservices.makeLogRequest(e,this,function(f){application.remotelog=d.substring(3024,d.length);log.session.sync(application.remotelog)})}},upload:function(){device.uploadLogSession()}},dump:function(n,C,f){var m=null,B=$type(n),g=["array","object"];var D,u,j=[];var r=($type(f)=="number")?(f?true:false):(($type(f)=="boolean")?f:true),q=$empty(C)?2:C,k=3,h=($type(f)=="boolean")?1:(f||1);var p=",",v=" => ",s=r?"\n":"",e={pre:(r?(" ".repeat(k*h)):""),post:(r?(" ".repeat(k*(h-1))):"")},l={pre:((B=="array")?"[":"{"),post:((B=="array")?"]":"}")},d={"function":"function(){...}",array:"[...]",object:"{...}"};var w=function(F,E){switch(E){case"function":F=F.toString();return F.substring(0,(F.indexOf(")")+1))+" {...}"}return F};switch(B){case false:return B;case"date":case"element":case"regexp":return n}if(g.indexOf(B)!=-1){j.push(l.pre+s);for(D in n){try{u=n[D];m=$type(u);j.push(e.pre+D+v);if(g.indexOf(m)!=-1){if(q>1){j.push(log.dump(u,(q-1),(r?(h+1):r)))}else{j.push(d[m])}}else{j.push(w(u,m))}j.push(p+s)}catch(A){}}if(j.length>1){j.pop()}j.push(s+e.post+l.post)}else{j.push(w(n,B))}return j.join("")},dumpObj:function(d,l){var k="";if(!l){l=0}var h="";for(var e=0;e<l+1;e++){h+="    "}if(typeof(d)=="object"){for(var f in d){var g=d[f];if(typeof(g)=="object"){k+=h+"'"+f+"' ... "}else{k+=h+"'"+f+"' => \""+g+", "}}}else{k="===>"+d+"<===("+typeof(d)+")"}return k},getStackTrace:function(){try{intentionally.causing.an.exception.to.occur()}catch(f){var d=f.stack.trim().split("\n");d.shift();return d}},repeat:function(e){var f="";for(var d=0;d<e;d++){f+=this}return f}};var element={_spatial:[],current:null,registeredControls:[],buildPositions:function(){if(application.currentView.layoutIsDirty){log.write("Building screen positions of elements");delete application.currentView.controls;application.currentView.controls=[];var e=$(application.currentView.id).getElements("a"),f=null,d=null;x;for(x=0;x<e.length;x++){d=e[x];if(d){f=d.getPosition();if(d.offsetWidth){application.currentView.controls[application.currentView.controls.length]={elemid:d.id,x:f.x,y:f.y}}}}application.currentView.layoutIsDirty=false;e=null;f=null;d=null}},bindActions:function(f,g){log.write(f);if(document.getElementById(f)){var e=document.getElementById(f).getElementsByTagName("a");for(var d=0;d<e.length;d++){if(!e[d].id){e[d].id=application.utility.generate.id(e[d])}}}},registerControl:function(d){this.registeredControls.push(d)}};var application={DEBUG:false,_methodMap:{},_views:{},id:"application",currentView:null,keys:null,navigator:navigation,utility:utility,ui:ui,playbackSupported:false,authSupported:false,element:element,apiUrl:"",endPointServer:"",isBusy:false,isLoaded:false,isConnected:true,DataDirectory:"",EndPoints:{},Environments:[],CurrentEnvironment:"",LastKeyDown:new Date(),RepeatKeyBlock:false,RepeatKeyBlockDuration:300,TempKeyBlock:false,TempKeyBlockDuration:1000,TempKeyBlockEnter:false,firmwareIsValid:true,request:$get(),regionError:null,debugMode:false,doNotRestoreSettings:false,remotelog:"",blockWidgetAccess:false,cachedUserAgent:null,appSetting:function(d){var e=-1;if($cn.config){if(d in $cn.config){e=$cn.config[d]}}return e},setupApiKeys:function(f){log.write("setupApiKeys: called with cid of "+f);if(!f){f=$UrlQueryString.CountryID||$cn.config.DefaultSelectedCountry}var d=configuration.getCredentialsCountryID();log.write("setupApiKeys: credentials country id: "+d);if(d===-1){application.ApplicationError={type:application.resource.system_messages.application_error.MessageType,Message:application.resource.system_messages.application_error.Message,Close:application.resource.system_messages.application_error.Close,callback:function(){application.exit()}}}if(d!=f){log.write("setupApiKeys: attempt load of alternate credentials");var e=configuration.changeCredentials(f);if(!e){configuration.changeCredentials($UrlQueryString.CountryID||$cn.config.DefaultSelectedCountry)}}log.write("setupApiKeys: CID "+f+" credentials loaded.");webservices.apiKey=configuration.readValue("APIKey");webservices.destType=configuration.readValue("DestinationTypeID");log.write("setupApiKeys: APIKey: ["+webservices.apiKey+"]  DesinationTypeID: ["+webservices.destType+"]")},init:function(){var l,e,m,h,d,n=this,k;log.write("application.init: Enter");this.keys=new Common.API.TVKeyValue();$cn.data.partnerOfferID=this.request.partnerOfferID||"";$cn.data.partnerOfferAction=this.request.partnerOfferAction||"";log.write("parentOfferID: "+$cn.data.partnerOfferID+", partnerOfferAction: "+$cn.data.partnerOfferAction);this.exception.categories["browse-view"]="store_messages";this.exception.categories["search-view"]="system_messages";this.exception.categories["wishlist-view"]="system_messages";this.exception.categories["library-view"]="system_messages";this.exception.categories["settings-view"]="system_messages";this.exception.categories.titleview="system_messages";this.exception.categories["help-view"]="system_messages";this.exception.categories["player-view"]="player_messages";this.exception.categories["checkout-view"]="checkout_messages";$cn.data.SoftwareVersion=configuration.readValue("version");if($cn.config.OnScreenDebugLog){$("debugger").show()}device.initPlayer();if(application.authSupported){var p=null;var g=null;if(configuration.readValue("RegionCheckEnabled")==false){$cn.data.RegionCheckEnabled=false}p=configuration.readValue(configuration.getPrefixedSettingKey("auth"));if(p!==null){$cn.data.SelectedCountryID=configuration.readValue("SelectedCountryID")}else{$cn.data.SelectedCountryID=configuration.readValue("LastCountryID")}application.setupApiKeys($cn.data.SelectedCountryID);if(!$cn.data.RegionCheckEnabled){application.setupApiKeys($UrlQueryString.CountryID||$cn.config.DefaultSelectedCountry)}$cn.data.ShowWelcomeScreen=configuration.readValue(configuration.getPrefixedSettingKey("welcome"))||false;$cn.data.DeviceID=webservices.uniqueId=(configuration.readValue("DestinationUniqueID")||$cn.config.DeviceID);g=configuration.readValue("AuthToken");if(p!==null){$cn.data.AuthToken=p.authToken;$cn.data.DeviceName=p.deviceName;$cn.data.UserEmailAddress=p.emailAddress;$cn.data.AdultPinEnabled=$cn.utilities.isTrue(p.adultPinEnabled);$cn.data.ParentPinEnabled=$cn.utilities.isTrue(p.parentPinEnabled);$cn.data.PurchasePinEnabled=$cn.utilities.isTrue(p.purchasePinEnabled);$cn.data.ParentalControlsConfigured=$cn.utilities.isTrue(p.parentalControlsConfigured);if($cn.utilities.isTrue(p.parentPinEnabledOnStartup)){$cn.data.ParentPinEnabledOnStartup=$cn.utilities.isTrue(p.parentPinEnabledOnStartup)}$cn.data.PreferredAudioType=configuration.readValue(configuration.getPrefixedSettin