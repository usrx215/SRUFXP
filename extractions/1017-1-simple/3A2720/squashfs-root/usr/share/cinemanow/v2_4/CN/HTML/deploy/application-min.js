var WebSocketManager={socket:null,requestsSent:null,requestId:0,connecting:false,reconnecting:false,reconnectcount:0,retrytimeout:null,connected:false,shuttingDown:false,handlers:{},url:"",openSuccess:null,openError:null,onOpen:function(){log.write("WebSocketManager.onopen: connected!");var e=this;this.connecting=false;this.connected=true;var g=application.appSetting("CacheLimitMetadata");if(g==-1){g=2097152}var d=application.appSetting("CacheLimitClosedcaption");if(d==-1){d=2097152}var f={CNO_CACHE_LOCAL_PATH:"cache"};configuration.callReadAllSettings(null,function(){this.send("<RNOWebServiceCall>$$REQUESTID$$<NetworkSettings><ConnectTimeout>"+application.appSetting("NetworkConnectTimeout")+"</ConnectTimeout><SendTimeout>"+application.appSetting("NetworkSendTimeout")+"</SendTimeout><ReceiveTimeout>"+application.appSetting("NetworkReceiveTimeout")+"</ReceiveTimeout></NetworkSettings></RNOWebServiceCall>",e,function(j){if(!e.reconnecting){var h=f.CNO_CACHE_LOCAL_PATH;this.send("<RNOCacheCall>$$REQUESTID$$<CacheSettings><CachePath>"+h+'</CachePath><CacheLimit type="closedcaptions">'+d+'</CacheLimit><CacheLimit type="Metadata">'+g+"</CacheLimit></CacheSettings></RNOCacheCall>",e,function(k){if(!e.reconnecting){log.write("WebSocketManager.onopen: NetworkSettings response: "+k);this.openSuccess.call(this)}e.reconnecting=false;e.reconnectcount=0}.bind(e))}}.bind(e))}.bind(e),f)},onError:function(){if(this.connecting){log.write("WebSocketManager.onerror: error while connecting");this.connecting=false;if(!this.reconnecting){this.connecting=false;this.openError.call(this)}else{var d=this;this.reconnectcount++;this.retrytimeout=setTimeout(function(){log.write("WebSocketManager.onError: Retry number "+this.reconnectcount);this.reconnecting=true;this.connect()}.bind(d),500)}}else{if(this.connected&&!this.shuttingDown){log.write("WebSocketManager.onerror: error on send/response or out of the blue")}else{if(this.connected&&this.shuttingDown){log.write("WebSocketManager.onerror: error on close")}}}},onClose:function(){log.write("WebSocketManager.onclose: shuttingdown: "+this.shuttingDown);var f=false;if((this.connected||this.connecting)&&!this.shuttingDown){f=true}for(var d=this.requestsSent.getOldestIndex();d<this.requestsSent.getTotalSize();d++){var e=this.requestsSent.getElementAt(d);if(!e.responded){e.responded=true;this.respondSocketError(e)}}this.requestsSent.clear();this.connected=false;this.connecting=this.reconnecting;this.shuttingDown=false;if(f){this.reconnectcount++;this.reconnecting=true;log.write("WebSocketManager.onClose: reconnect attempt number "+this.reconnectcount);this.connect()}},onMessage:function(j){var d=-1;var l="";var h=null;d=this.getRequestId(j.data);if(d>-1){for(var f=this.requestsSent.getOldestIndex();f<this.requestsSent.getTotalSize();f++){h=this.requestsSent.getElementAt(f);if(h.id==d){h.responded=true;if(f==this.requestsSent.getOldestIndex()){while(this.requestsSent.getOldestElement()&&this.requestsSent.getOldestElement().responded){this.requestsSent.dequeue()}}h.callback.call(h.callback.context,j.data);break}}}else{var m;try{m=XML.rootFromString(j.data)}catch(k){log.write("WebSocketManager.onmessage: Error parsing XML from event data");m=null}if(m!==null){var g=m.firstChild;if(g.nodeName in this.handlers){this.handlers[g.nodeName].callback.call(this.handlers[g.nodeName].context,g)}else{log.write("WebSocketManager.onmessage: nodeName "+g.nodeName+" not in handlers :: "+XML.toString(m))}}else{log.write("WebSocketManager.onmessage: null dom")}}},initialize:function(e,f,d){this.openSuccess=f;this.openError=d;this.url=(e&&e.length>0)?e:"ws://localhost:31415/res";if(!this.requestsSent){this.requestsSent=new Queue()}this.connect()},connect:function(){log.write("WebSocketManager.connect: Connecting!");var d=this;this.connecting=true;this.socket=new WebSocket(this.url);this.socket.onopen=this.onOpen.bind(d);this.socket.onerror=this.onError.bind(d);this.socket.onclose=this.onClose.bind(d);this.socket.onmessage=this.onMessage.bind(d)},shutdown:function(){if(this.connected&&!this.shuttingDown){this.socket.close();this.shuttingDown=true}},send:function(d,f,h){var g={id:this.requestId++,responded:false,requestData:d,context:f,callback:h};if(this.connected&&!this.shuttingDown&&this.requestsSent!==null){var e=d.split("$$REQUESTID$$");if(e.length==2){d=e[0];d+='<UserData ID="'+g.id+'"></UserData>';d+=e[1]}else{log.write("WebSocketManager.send: $$REQUESTID$$ not found")}this.requestsSent.enqueue(g);this.socket.send(d)}else{this.respondSocketError(g)}},getRequestId:function(e){var h=XML.rootFromString(e);var d=h.getElementsByTagName("UserData");if(d&&d.length&&d[0].attributes&&d[0].attributes.length){var g=d[0].attributes;for(var f=0;f<g.length;f++){if(g[f].nodeName=="ID"){return new Number(g[f].nodeValue)}}}return -1},addHandler:function(d,e,f){this.handlers[d]={callback:f,context:e}},respondSocketError:function(e){var d="<Response>";if(e.requestData.split("$$REQUESTID$$").length==2){d+='<UserData ID="'+e.id+'"></UserData>'}d+="<SocketError>There was a socket connection error.</SocketError></Response>";e.callback.call(e.context,d)},clearContentCache:function(e){var d=this;this.send('<RNOCacheCall>$$REQUESTID$$<PurgeData tableType="metadata" cacheType="Metadata"/></RNOCacheCall>',d,function(f){e.call()}.bind(d))}};1;var helpers={extend:function(e,d){for(var f in (d||{})){e[f]=d[f]}return e}};helpers.extend(Element.prototype,{isParentOf:function(d){if(d.getParent()==this){return true}else{if(d.getParent()!=null){return this.isParentOf(d.getParent(),this)}}return false},intersects:function(d){if((this.offsetLeft==d.offsetLeft)||((this.offsetLeft>d.offsetLeft)&&this.offsetLeft+this.offsetWidth<=d.offsetLeft+d.offsetWidth)){return true}else{return false}}});Array.prototype.contains=function(e){var d=this.length;while(d--){if(this[d]==e){return true}}return false};helpers.extend(String.prototype,{reverse:function(){return String(Array.slice(this).reverse().join(""))},trim:function(){return this.replace(/^\s+|\s+$/g,"")},endsWith:function(d){var e=this.lastIndexOf(d);return(e!=-1)&&(e+d.length==this.length)},repeat:function(e){var f="";for(var d=0;d<e;d++){f+=this}return f},camelize:function(){return this.replace(/-\D/g,function(d){return d.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(d){return"-"+d.charAt(0).toLowerCase()})},capitalize:function(){return this.replace(/\b[a-z]/g,function(d){return d.toUpperCase()})},clean:function(){return this.trim(this.replace(/\s{2,}/g," "))},toElement:function(){return new Element("div",{html:this}).getFirst()},stripHTML:function(){var d=/<(?:.|\s)*?>/g;return this.replace(d,"")},first:function(e){var d=this;if(this.length>e){d=d.substring(0,e)}return d},firstWithEllips:function(e){var d=this;if(this.length>e){d=d.substring(0,e)+"..."}return d},visualLength:function(){var d=$("ruler");d.innerHTML=this;log.write("Ruler Width: "+d.offsetWidth);return d.offsetWidth},ellipsToPixels:function(e){var d=this;var f=this;if(d.visualLength()>e){f+="...";while(f.visualLength()>e){d=d.substring(0,d.length-1);f=d+"..."}}return f}});function $_(d){if(arguments.length<1){return widget.getLocalizedString(d)}else{return KONtx.utility.vsprintf(widget.getLocalizedString(d),arguments)}}var utility={vsprintf:function(n,j){var k=/%%|%(\d+\$)?([-+#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuidfegEG])/g;var l=j,h=0;var d=function(u,p,q,s){var r=(u.length>=p)?"":Array(1+p-u.length>>>0).join(q);return s?u+r:r+u};var e=function(s,r,v,p,q){var u=p-s.length;if(u>0){if(v||!q){s=d(s,p," ",v)}else{s=s.slice(0,r.length)+d("",u,"0",true)+s.slice(r.length)}}return s};var m=function(w,v,u,A,q,p,s){var r=w>>>0;u=u&&r&&{"2":"0b","8":"0","16":"0x"}[v]||"";w=u+d(r.toString(v),p||0,"0",false);return e(w,u,A,q,s)};var g=function(s,u,q,p,r){if(p!=null){s=s.slice(0,p)}return e(s,"",u,q,r)};var f=function(I,s,u,B,K,G,r){if(I=="%%"){return"%"}var C=false,v="",A=false,H=false;var w=u.length;for(var F=0;u&&F<w;F++){switch(u.charAt(F)){case" ":v=" ";break;case"+":v="+";break;case"-":C=true;break;case"0":A=true;break;case"#":H=true;break}}if(!B){B=0}else{if(B=="*"){B=+l[h++]}else{if(B.charAt(0)=="*"){B=+l[B.slice(1,-1)]}else{B=+B}}}if(B<0){B=-B;C=true}if(!isFinite(B)){throw new Error("sprintf: (minimum-)width must be finite")}if(!G){G="fFeE".indexOf(r)>-1?6:(r=="d")?0:void (0)}else{if(G=="*"){G=+l[h++]}else{if(G.charAt(0)=="*"){G=+l[G.slice(1,-1)]}else{G=+G}}}var D=s?l[s.slice(0,-1)]:l[h++];switch(r){case"s":return g(String(D),C,B,G,A);case"c":return g(String.fromCharCode(+D),C,B,G,A);case"b":return m(D,2,H,C,B,G,A);case"o":return m(D,8,H,C,B,G,A);case"x":return m(D,16,H,C,B,G,A);case"X":return m(D,16,H,C,B,G,A).toUpperCase();case"u":return m(D,10,H,C,B,G,A);case"i":case"d":var p=parseInt(+D);var E=p<0?"-":v;D=E+d(String(Math.abs(p)),G,"0",false);return e(D,E,C,B,A);case"e":case"E":case"f":case"F":case"g":case"G":var p=+D;var E=p<0?"-":v;var q=["toExponential","toFixed","toPrecision"]["efg".indexOf(r.toLowerCase())];var J=["toString","toUpperCase"]["eEfFgG".indexOf(r)%2];D=E+Math.abs(p)[q](G);return e(D,E,C,B,A)[J]();default:return I}};return n.replace(k,f)},timer:{setInterval:function(f,d){var e=new Timer();e.onTimerFired=f;e.interval=d/1000;e.ticking=true;return e},clearInterval:function(d){d.ticking=false;delete d},setTimeout:function(f,d){var e=new Timer();e.onTimerFired=function(){this.ticking=false;f()};e.interval=d/1000;e.ticking=true;return e},clearTimeout:function(d){d.ticking=false;delete d}},generate:{counter:0,id:function(d){if(d&&d.id&&!$empty(d.id)){return d.id}return"app-gen-"+application.utility.generate.counter++},randomNumber:function(d){return Math.floor(Math.random()*(d||1000))}}};if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());$cn.utilities.adjustDate=function(d,f){if(d.expirationMessage&&f){log.write("message is: "+d.expirationMessage);var h=new RegExp("([0-9]+)/([0-9]+)/([0-9]+)");var g=d.expirationMessage.toString().match(h);if(g!=null){d.expirationMessage=d.expirationMessage.toString().replace(g[0],$cn.utilities.formatDate(g[0],$cn.config.DateFormat))}}if(d.datePurchased){log.write("datePurchased is: "+d.datePurchased);var h=new RegExp("([0-9]+)-([0-9]+)-([0-9]+)");var e=d.datePurchased.toString().match(h);if(e!=null){d.datePurchased=e[0]}}};$cn.utilities.truncateText=function(f,g,d,j,e){if(j<e-1){var h=Math.floor((j+e)/2);application.putInnerHTML(f,g.substr(0,h));if(f.offsetHeight<=d){return this.truncateText(f,g,d,h,e)}else{return this.truncateText(f,g,d,j,h)}}else{return $cn.utilities.ellipsis(g,j)}};$cn.utilities.ellipsis=function(f,e){if(f.length>3&&f.length>e){var d=e-4;var g=f[d];while((g==" "||g==".")&&d>0){g=f[d];d--}f=f.substr(0,d+1)+"..."}if(f.indexOf("##")>-1){if(f.substring(f.length-3,3).indexOf("##")==-1){f=f+"##"}}return f};$cn.utilities.addEpisodeColons=function(d){if(isNaN(d)){return d}else{return d+":"}};$cn.utilities.highlightKeywordForTitlename=function(g,d){var h="";var f=' style="color:#FDCC4D;" ';var e=new RegExp("("+d+")","gi");h=g.replace(e,"<span "+f+">$1</span>");return h};$cn.utilities.safeSelect=function(d){return d.replace(/\'/g,"\\'")};$cn.utilities.highlightKeywordForSynopsis=function(k,g){if(k==null||k.length==0){return k}var l="";var e=k.length;var d=BrowseView.GridControl.getElipsisLength();if(g&&g.length>0){var j=' style="color:#FDCC4D;" ';var h=new RegExp("("+g+")","gi");var f=h.exec(k);if(f==null||f.index<0||BrowseView.currentState!="search-view"){l=k}else{if(f.index<30){l=k.replace(h,function(m,n,q,p){return"<span "+j+">"+n+"</span>"})}else{l="..."+k.substring(f.index-30,e).replace(h,function(m,n,q,p){return"<span "+j+">"+n+"</span>"})}}}else{l=k}log.write("highlighted string: "+l);return l};$cn.utilities.getMeta=function(d,f){var e="";f.each(function(g){if(g.keyName==d){e=g.keyValue}});return e};$cn.utilities.setMeta=function(d,e,f){f.each(function(g){if(g.keyName==d){g.keyValue=e}})};$cn.utilities.haveGenreId=function(f){var g=false,d=$cn.data.Navigation.genres.length,e;for(e=0;e<d;++e){if(""+$cn.data.Navigation.genres[e].iD===""+f){g=true;e=d}}return g};$cn.utilities.recommendedForYouGuess=function(d){var e;$cn.data.Navigation.genres.each(function(f){if(nav.parentId==0){e=f.iD}})};$cn.utilities.measure=function(d){return d.measure(function(){return this.getSize()})};$cn.utilities.isEqual=function(e,d){if(e&&d||(""===e&&""===d)){return e.toString().toLowerCase()===d.toString().toLowerCase()}else{return false}};$cn.utilities.isTrue=function(d){return($cn.utilities.isEqual("true",d)||$cn.utilities.isEqual("True",d))};$cn.utilities.getResponseCodeStatus=function(d){return application.resource.uv_responseCodes[d].status};$cn.utilities.addHiddenClass=function(d){if(document.getElementById(d)){$(d).addClass("hidden")}};$cn.utilities.removeHiddenClass=function(d){if(document.getElementById(d)){$(d).removeClass("hidden")}};$cn.utilities.inArray=function(g,d){var f,e;if(d){f=d.length;for(e=0;e<f;e++){if(e in d&&d[e]===g){return e}}}return -1};var Timer=function(){this.Interval=1000;this.Enable=new Boolean(false);this.Tick;this.isRunning=false;var d=0,e;this.Start=function(){this.Enable=new Boolean(true);e=this;if(e.Enable){e.timerId=setInterval(function(){e.isRunning=true;e.Tick()},e.Interval)}};this.Stop=function(){if(e){e.Enable=new Boolean(false);clearInterval(e.timerId);e.isRunning=false}}};function Queue(){var d=[];var e=0;this.getSize=function(){return d.length-e};this.isEmpty=function(){return(d.length==0)};this.enqueue=function(f){d.push(f)};this.clear=function(f){d=[];e=0};this.dequeue=function(){var f=undefined;if(d.length){f=d[e];if(++e*2>=d.length){d=d.slice(e);e=0}}return f};this.getOldestElement=function(){var f=undefined;if(d.length){f=d[e]}return f};this.getElementAt=function(f){var g=undefined;if(d.length){g=d[f]}return g};this.getOldestIndex=function(){return e};this.getTotalSize=function(){return d.length}}$cn.utilities.formatAsMoney=function(d){var e=d;e-=0;return(Math.round(e)/100).toFixed(2)};$cn.utilities.getNodeText=function(f){var e="";for(var d=0;d<f.childNodes.length;d++){e=e+f.childNodes[d].nodeValue}return e};function two(d){return((d>9)?"":"0")+d}function three(d){return((d>99)?"":"0")+((d>9)?"":"0")+d}$cn.utilities.convertMStoTime=function(d){var g=Math.floor(d/1000);var e=Math.floor(g/60);g=g%60;t=two(g);var f=Math.floor(e/60);e=e%60;t=two(e)+":"+t;if(f>0){t=f+":"+t}return t};$cn.utilities.buildPlaybackURL=function(f,l,j,g,h,e,k,m){var d=f+"|DEVICE_ID="+webservices.uniqueId+"|DEVICET_TYPE_ID="+webservices.destType+"|STREAM_ID="+l+"|IP_ADDR=|DRM_URL="+j+"|ACK_URL="+g+"|HEARTBEAT_URL="+h+"|HEARTBEAT_PERIOD="+e+"|I_SEEK=TIME|CUR_TIME=PTS|COMPONENT=WV|TITLE_PROFILE="+(k?"HD":"SD")+"|CUSTOM_DATA="+(m||"")+"|";log.write("playback url: "+d);return d};$cn.utilities.DateDiff=function(e,d){return e.getTime()-d.getTime()};$cn.utilities.purchaseText=function(h){var e="",d=false,g=false,f=false;h.availableProducts.each(function(j){switch(j.purchaseType){case"rent":f=true;break;case"buy":g=true;break;case"preorder":d=true;break}});if(d){e="Pre-order"}else{if(f&&g){e="Rent or Buy"}else{if(f){e="Rent"}else{if(g){e=$cn.utilities.getBuyTextForTitle(h)}}}}return e};$cn.utilities.getBuyTextForTitle=function(e){var d="Buy";if(e.titleType=="TV_Episode"){d+=" Episode"}return d};$cn.utilities.getPricingSummaryString=function(f,e,d){retString="";var g=$cn.data.TitleSummaryCache[f];if(!g){g=$cn.data.TitleDetailCache[f]}if(g){if(g.titleType=="TV_Show"||g.titleType=="TV_Season"||g.titleType=="TV_Episode"){e="Buy Episodes from"}if(g.rentAvail){retString+=d+' <span class="bluePrice">'+application.resource.currency_symbol+g.rentPrice+"</span>";if(!g.buyAvail&&g.titleType=="Movie"){retString+='<span class="dividerBar"> | </span>';retString+="Buy not available"}}if(g.buyAvail&&g.rentAvail){retString+='<span class="dividerBar"> | </span>'}if(g.buyAvail){retString+=e+' <span class="bluePrice">'+application.resource.currency_symbol+g.buyPrice+"</span>";if(!g.rentAvail&&g.titleType=="Movie"){retString+='<span class="dividerBar"> | </span>';retString+="Rent not available"}}}return retString};$cn.utilities.getPricingSummaryStringNewSpec=function(f,e,d){retString="";var g=$cn.data.TitleSummaryCache[f];if(!g){g=$cn.data.TitleDetailCache[f]}if(g){if(g.titleType=="TV_Show"||g.titleType=="TV_Season"||g.titleType=="TV_Episode"){e="Buy Episodes from"}if(g.rentAvail){retString+=d+' <span class="bluePrice">'+application.resource.currency_symbol+g.rentPrice+"</span>";if(!g.buyAvail&&g.titleType=="Movie"){retString+="<br />";retString+="Buy not available"}}if(g.buyAvail&&g.rentAvail){retString+="<br />"}if(g.buyAvail){retString+=e+' <span class="bluePrice">'+application.resource.currency_symbol+g.buyPrice+"</span>";if(!g.rentAvail&&g.titleType=="Movie"){retString+="<br />";retString+="Rent not available"}}}return retString};$cn.utilities.getPointsAndPricingString=function(k,h,f){var l=$cn.data.TitleSummaryCache[k]||$cn.data.TitleDetailCache[k],j="",e=$cn.utilities.getMeta("LoyaltyPointsForRent",l.metaValues),d="",g=$cn.utilities.getMeta("LoyaltyPointsForBuy",l.metaValues);if(!l){return""}e=(e===""||parseInt(e,10)<=0)?"":'<div class="redStar"></div>Earn <span class="bluePrice">'+e+"</span> pts";g=(g===""||parseInt(g,10)<=0)?"":'<div class="redStar"></div>Earn <span class="bluePrice">'+g+"</span> pts";if(l.rentAvail){j=f+' <span class="bluePrice">'+application.resource.currency_symbol+l.rentPrice+"</span>";if(!l.buyAvail&&l.titleType=="Movie"){d='<div style="text-align:center" class="notAvailable">'+application.resource.title_availability.buy_not_available+"</div>";g=""}}if(l.buyAvail){if(l.titleType=="TV_Show"||l.titleType=="TV_Season"||l.titleType=="TV_Episode"){h="Buy&nbsp;Episodes&nbsp;from"}d=h+' <span class="bluePrice">'+application.resource.currency_symbol+l.buyPrice+"</span>";if(!l.rentAvail&&l.titleType=="Movie"){j=h+' <span class="bluePrice">'+application.resource.currency_symbol+l.buyPrice+"</span>";e=g;d='<div style="text-align:center" class="notAvailable">'+application.resource.title_availability.rent_not_available+"</div>";g=""}}return'<div class="verticalDivider"></div><div class="rentalInfo"><div class="rentalPrice">'+j+'</div><div class="rentalPoints">'+e+'</div></div><div class="buyInfo"><div class="buyPrice">'+d+'</div><div class="buyPoints">'+g+"</div></div>"};$cn.utilities.testDuration=function(e,d){var j=new Date(e);var g=$cn.utilities.DateDiff(new Date(),j);var h=Math.floor(g/1000);var f=true;if(h<d){f=false}return f};$cn.utilities.formatDate=function(d,g){formatted="";if(d){switch(g){case"longDate":try{theDate=new Date().parse(d);formatted=theDate.format("%B %d, %Y")}catch(f){log.write("Called formatDate: error formatting date style: "+g)}break;case"shortEuropean":try{theDate=new Date().parse(d);formatted=theDate.format("%d/%m/%y")}catch(f){log.write("Called formatDate: error formatting date style: "+g)}break;case"short":try{theDate=new Date().parse(d);formatted=theDate.format("%m/%d/%y")}catch(f){log.write("Called formatDate: error formatting date style: "+g)}break;default:try{theDate=new Date().parse(d);formatted=theDate.format("%x")}catch(f){log.write("Called formatDate: error formatting date style: "+g)}}return formatted}};$cn.utilities.uniqueIdentifier=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};$cn.utilities.isHdTitle=function(f,g){var d=null,e=false;for(x=0;x<f.availableProducts.length;x++){if(f.availableProducts[x].skuID==g){d=f.availableProducts[x]}}if(d.skuType.indexOf("HD")>-1){e=true}return e};$cn.utilities.getPurchaseSkuProduct=function(e,f){var d=null;for(x=0;x<e.availableProducts.length;x++){if(e.availableProducts[x].skuID==f){d=e.availableProducts[x]}}return d};$cn.utilities.currentlyPlayingAudioProfile=function(e){var f="Stereo_Standard",d=$cn.utilities.getAudioProfileForPurchase(e);if(d[$cn.data.PreferredAudioType]){f=$cn.data.PreferredAudioType}return f};$cn.utilities.isSurroundSoundTitle=function(g,h){var d=null,f=false;for(x=0;x<g.availableProducts.length;x++){if(g.availableProducts[x].skuID==h){d=g.availableProducts[x]}}for(x=0;x<d.availableAssets.length;x++){for(y=0;y<d.availableAssets[x].availableAudioProfiles.length;y++){var e=d.availableAssets[x].availableAudioProfiles[y];for(z=0;z<$cn.data.AllowedAudioProfiles.length;z++){if($cn.data.AllowedAudioProfiles[z]==e.audioAssetProfile){f=true}}}}return f};$cn.utilities.getAudioProfileForTitle=function(h){var g={};g.Stereo_Standard=true;g.Dolby_Stereo_AC3=false;g.Dolby_Digital_Plus_Stereo=false;g.Dolby_Digital_Plus_51=false;g.DTS_Express_Stereo=false;g.DTS_Express_51=false;g.HDOnly=true;if(!$cn.data.TitlesAudioProfiles[h]){var j=$cn.data.TitleDetailCache[h];if(j){for(a=0;a<j.availableProducts.length;a++){for(b=0;b<j.availableProducts[a].availableAssets.length;b++){var f=j.availableProducts[a].availableAssets[b],e=(f.file_FileProfile=="HIGH_DEFINITION");for(c=0;c<f.availableAudioProfiles.length;c++){var d=f.availableAudioProfiles[c];for(x=0;x<$cn.data.AllowedAudioProfiles.length;x++){if($cn.data.AllowedAudioProfiles[x]==d.audioAssetProfile){g[$cn.data.AllowedAudioProfiles[x]]=true;if(!e){g.HDOnly=false}}}}}}$cn.data.TitlesAudioProfiles[h]=g}}else{g=$cn.data.TitlesAudioProfiles[h]}return g};$cn.utilities.getAudioProfileForPurchase=function(g){var f={};f.Stereo_Standard=true;f.Dolby_Stereo_AC3=false;f.Dolby_Digital_Plus_Stereo=false;f.Dolby_Digital_Plus_51=false;f.DTS_Express_Stereo=false;f.DTS_Express_51=false;if($cn.data.PurchaseAudioProfiles[g]){f=$cn.data.PurchaseAudioProfiles[g]}else{var h=$cn.data.PassCache[g];if(h){for(a=0;a<h.availableProducts.length;a++){for(b=0;b<h.availableProducts[a].availableAssets.length;b++){var e=h.availableProducts[a].availableAssets[b];for(c=0;c<e.availableAudioProfiles.length;c++){var d=e.availableAudioProfiles[c];for(x=0;x<$cn.data.AllowedAudioProfiles.length;x++){if($cn.data.AllowedAudioProfiles[x]==d.audioAssetProfile){f[$cn.data.AllowedAudioProfiles[x]]=true}}}}}$cn.data.PurchaseAudioProfiles[g]=f}}return f};$cn.utilities.getAudioProfileTypesForPurchase=function(f){var d=$cn.utilities.getAudioProfileForPurchase(f);var e=[];if(d.Dolby_Stereo_AC3||d.Dolby_Digital_Plus_Stereo||d.Dolby_Digital_Plus_51){e.push("Dolby")}if(d.DTS_Express_Stereo||d.DTS_Express_51){e.push("DTS")}return e};$cn.utilities.bandwidthCheckValid=function(e){var d=false;log.write("$cn.data.LastBandwidthCheck: "+$cn.data.LastBandwidthCheck);log.write("testDuration (should be false): "+$cn.utilities.testDuration($cn.data.LastBandwidthCheck,application.appSetting("BandwidthCheckTTL")));log.write("BandwidthCheckTTL:"+application.appSetting("BandwidthCheckTTL"));log.write("LastBandwidthSpeed: "+$cn.data.LastBandwidthSpeed);log.write("SDMinimumBandwidth: "+application.appSetting("SDMinimumBandwidth"));if($cn.data.LastBandwidthCheck&&!$cn.utilities.testDuration($cn.data.LastBandwidthCheck,application.appSetting("BandwidthCheckTTL"))){if(e&&$cn.data.LastBandwidthSpeed>application.appSetting("HDMinimumBandwidth")){d=true}else{if(!e&&$cn.data.LastBandwidthSpeed>application.appSetting("SDMinimumBandwidth")){d=true}}}return d};$cn.utilities.forceWrap=function(j,e,d){var h,f="",g;if(!j){return""}h=j.length>d?j.substring(0,d):j;for(g=0;g<h.length;g++){if(g>0&&g%e==0){f+="<br />"}f+=h.charAt(g)}return f};$cn.utilities.showLoadingModal=function(d,e){var f;if(!$cn.utilities.sharedModalShowing){e=e||application.resource.loading_enum.loadinggeneric;f=setTimeout(function(){BrowseView.showMessage("message_loading",{Message:e})},d)}else{log.write("Skipping showing of modal. Shared modal is already showing.")}return f};$cn.utilities.clearLoadingSpinner=function(d){if(d){clearTimeout(d);log.write("Clearing Spinner")}if(!$cn.utilities.sharedModalShowing){$cn.utilities.hideModalPopup()}};$cn.utilities.sharedModalShowing=false;$cn.utilities.sharedModalTimer=false;$cn.utilities.showSharedLoadingModal=function(d,e){if(!$cn.utilities.sharedModalShowing){$cn.utilities.sharedModalTimer=$cn.utilities.showLoadingModal(d,e);$cn.utilities.sharedModalShowing=true}else{log.write("Trying to show shared modal when one is already showing. Doing nothing.")}};$cn.utilities.clearSharedLoadingSpinner=function(){$cn.utilities.sharedModalShowing=false;$cn.utilities.clearLoadingSpinner($cn.utilities.sharedModalTimer)};$cn.utilities.hideModalPopup=function(){if(BrowseView&&BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}};$cn.utilities.tm=function(){return"&#0153;"};$cn.utilities.UserUVManager=new Class({empty:"",action:"",currentState:"",previousState:"",previousStatus:"",currentStatus:"",linkingAccount:{},initialize:function(d){this.action=d},deactivate:function(){this.currentStatus="";this.previousState="";this.currentState="UVDeviceInactive"},getAccountLinkState:function(){var d=this;log.write("Getting Account Link State");$cn.methods.getAccountLinkState(function(e){log.write("Link state is "+e.linkState);if(d.currentState===d.empty){d.currentState=e.linkState}else{d.previousState=d.currentState;d.currentState=e.linkState}if(d.currentState==$cn.data.uvLinkStatus.linkState.linked||d.currentState==$cn.data.uvLinkStatus.linkState.pending){d.getLinkingAccount()}else{d.currentStatus=d.empty;d.checkNextAction()}})},getLinkingAccount:function(){var d,e=this;log.write("Getting Linking Account");$cn.methods.getLinkingAccount(function(f){e.linkingAccount=f;d=(f.account)?f.account.status:$cn.utilities.getResponseCodeStatus(f.responseCode);if(e.currentStatus===e.empty){e.currentStatus=d}else{e.previousStatus=e.currentStatus;e.currentStatus=d}e.checkNextAction()})},checkNextAction:function(){var d=this.currentStatus;if(d==$cn.data.uvLinkingAccount.Status.active){if(this.action=="CheckoutPanel"){this.checkStatusChange()}else{log.write("We are active and not in checkout so proceed with callback");$cn.utilities.clearLoadingSpinner(this.timer);this.fireCallback(true)}}else{if(this.action=="CheckoutPanel"){log.write("We are in checkout and status was not active");this.showUVWarningModal()}else{if(this.action=="showPlay"){log.write("We are in show play and status was not active");this.showUVWarningModal()}else{log.write("status was not active so fire false");$cn.utilities.clearLoadingSpinner(this.timer);this.fireCallback(false)}}}},fireCallback:function(d){var e;e=this.callback;this.callback=false;e(d)},checkStatusChange:function(){var e=this.previousStatus,d=this.currentStatus,f=this.previousState;log.write("Check status Change called");log.write("current is "+d);log.write("Prev is "+e);if((e&&e!=d)||(!e&&d&&(this.previousState!==this.empty))){this.showSuccessfulChange()}else{$cn.utilities.clearLoadingSpinner(this.timer);this.fireCallback(true)}},showSuccessfulChange:function(){log.write("Show successul Change called");var d,g,f,e=this;switch(this.currentStatus){case"Archived":d="renewed";break;case"AcctNotAvailable":d="created";break;case"BlockedTOU":d="updated";break;default:d="linked"}g=application.resource.uv_messages.success;f={Message:g.Message.replace("##status##",d),Close:g.OK,callback:function(h){if(h){e.fireCallback(false)}}};$cn.utilities.clearLoadingSpinner(this.timer);BrowseView.showMessage("message_content_callback",f)},getTermsOfService:function(){log.write("Get terms of use called");var d=this;if($cn.config.UVTOSEnabled){$cn.methods.getUVTermsOfService(function(e){d.showTermsOfService(e.data)})}else{this.showUVWarningModal()}},showTermsOfService:function(e){var g=application.resource.uv_messages.uvTermsOfService,f=($cn.utilities.isEqual(this.action,"CheckoutPanel"))?"."+this.action:"",d=this;this.Legal=new LegalPopup("uvtermsofservice");this.Legal.loadData([{title:g.UnacceptedMessage,content:g.Content,text:e,OK:g.OK,Close:g.Close,CloseAction:"BrowseView"+f+".UV.Legal.hide()",AcceptAction:"BrowseView"+f+".UV.acceptUVTermsOfService(true)",callback:function(h){if(h){log.write("UV TOU Accepted");d.fireCallback(true)}}}]);this.layoutIsDirty=true;this.Legal.firstFocus="LegalOK";$cn.utilities.clearLoadingSpinner(this.timer);this.Legal.show();$("SplashScreen").hide()},showUVWarningModal:function(k){var e=this,d=(this.currentStatus)?this.currentStatus:this.currentState,h,j,g,f=(this.linkingAccount.user)?this.linkingAccount.user.email:"";this.callback=this.callback||k;switch(d){case"Pending":case"BlockedTOU":case"Expired":case"AcctNotAvailable":case"Server Error":case"Inactive":h="account_"+d;break;default:h="account_default"}j=application.resource.uv_messages[h];if(this.currentStatus==$cn.data.uvLinkingAccount.Status.pending){j.Content=j.Content.replace(/{email}/g,f)}g={Message:j.Message,Content:j.Content,OK:j.OK,Close:j.Cancel,uvMsg:"UV",callback:function(l){if(l){log.write("UV warning retry");e.checkUVAccount()}else{e.fireCallback(false)}}};$cn.utilities.clearLoadingSpinner(this.timer);BrowseView.showMessage("message_okcancel_vert",g)},checkUVAccount:function(e,d){if($cn.config.EnableUV){this.timer=$cn.utilities.showLoadingModal(2000,"Loading...");this.callback=this.callback||e;if(d){this.getAccountLinkState()}else{$cn.methods.verifyAuthToken(function(f){if(f){this.getAccountLinkState()}else{$cn.utilities.clearLoadingSpinner(this.timer);this.deactivate();this.fireCallback(false)}}.bind(this))}}else{if(typeof e==="function"){e(false)}}}});$cn.utilities.setParentalSettings=function(d){application.createActivationFile();$cn.data.AuthToken=d.authToken;$cn.data.AdultPinEnabled=d.adultPinEnabled;$cn.data.ParentPinEnabled=false;$cn.data.DeviceName=d.deviceFriendlyName;$cn.data.UserEmailAddress=d.emailAddress;$cn.data.PurchasePinEnabled=false;$cn.data.ParentalControlsConfigured=d.parentalControlsConfigured;$cn.data.CurrentRegion=$cn.data.Region;application.saveAuthToken()};$cn.data.bwTest={};$cn.data.bwTest.calls=1;$cn.data.bwTest.speedBytes=0;$cn.data.bwTest.bwCallback=null;$cn.data.bwTest.self=null;function OnComplete(d){if($cn.data.bwTest.bwCallback){$cn.data.bwTest.bwCallback(d)}}function $get(f,d){if(arguments.length<2){d=location.href}if(arguments.length>0&&f!=""){if(f=="#"){var g=new RegExp("[#]([^$]*)")}else{if(f=="?"){var g=new RegExp("[?]([^#$]*)")}else{var g=new RegExp("[?&]"+f+"=([^&#]*)")}}var e=g.exec(d);return(e==null)?"":e[1]}else{d=d.split("?");var e={};if(d.length>1){d=d[1].split("#");if(d.length>1){e.hash=d[1]}d[0].split("&").each(function(j,h){j=j.split("=");e[j[0]]=j[1]})}return e}}var $UrlQueryString=function(){var g={};var f=window.location.search.substring(1);var h=f.split("&");for(var e=0;e<h.length;e++){var j=h[e].split("=");if(typeof g[j[0]]==="undefined"){g[j[0]]=j[1]}else{if(typeof g[j[0]]==="string"){var d=[g[j[0]],j[1]];g[j[0]]=d}else{g[j[0]].push(j[1])}}}return g}();var XML={rootFromFile:function(e,f){if(!$cn.config.PrecompiledApplication){var d=new XMLHttpRequest();d.open("GET",e,true);d.send(null);d.onreadystatechange=function(){if(d.readyState==4){if((d.status&&d.status==200)||document.URL.substr(0,4)=="file"){var g=new DOMParser();var h=g.parseFromString(d.responseText,"text/xml");f.call(this,h)}}}}else{f.call(this,null)}},rootFromFileSync:function(e){var d=new XMLHttpRequest();d.open("GET",e,false);d.send(null);if(d.readyState==4){if(d.status&&d.status==200||document.URL.substr(0,4)=="file"){return d.responseXML}}return null},rootFromString:function(e){var d;if(Browser.Engine.trident){d=new ActiveXObject("Microsoft.XMLDOM");d.async=false;d.loadXML(e)}else{d=(new DOMParser()).parseFromString(e,"text/xml")}return d},rootToHashes:function(e){var f=[],h=e.childNodes,j=null,g=0,d;for(g=0,d=h.length;g<d;g++){j=XML.nodeToHash(h[g]);if(j){f.push(j)}}return f},nodeToHash:function(h){switch($type(h)){case"element":var d=h.attributes,k=d.length,f={},e=0,g;for(e=0;e<k;e++){g=d[e];if(g.nodeValue&&g.nodeValue!="inherit"){f[g.nodeName]=g.nodeValue}}return{tag:h.nodeName.toLowerCase(),attributes:f,children:XML.rootToHashes(h)};case"textnode":return{text:h.nodeValue};default:return null}},rootToJSONString:function(e){var j=[],h=e.childNodes,g="",f=0,d;for(f=0,d=h.length;f<d;f++){g=XML.nodeToJSONString(h[f]);if(g){j.push(g)}}return j},nodeToJSONString:function(h){var f=0;if($type(h)=="element"){var d=h.attributes,l=d.length,k="",e=0,g;if(l>0){for(e=0;e<l;e++){g=d[e];if(g.nodeValue&&g.nodeValue!="inherit"){if(!isNaN(Number(g.nodeValue))||g.nodeValue==="true"||g.nodeValue==="false"){k+='"'+g.nodeName+'":'+g.nodeValue+","}else{k+='"'+g.nodeName+'":"'+g.nodeValue+'",'}}}k=k.substring(0,k.length-1);if(h.childNodes.length>1){return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":['+XML.rootToJSONString(h)+"]"+k+"}"}else{if(h.childNodes.length<=1&&$type(h.firstChild)=="textnode"){if(!isNaN(Number(h.nodeValue))||h.nodeValue==="true"||h.nodeValue==="false"){return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":'+h.nodeValue+k+"}"}else{return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":"'+h.nodeValue+'"'+k+"}"}}}}else{if(h.childNodes.length>1){return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":['+XML.rootToJSONString(h)+"]}"}else{if(h.childNodes.length<=1&&$type(h.firstChild)=="textnode"){if(!isNaN(Number(h.childNodes[0].nodeValue))||h.childNodes[0].nodeValue==="true"||h.childNodes[0].nodeValue==="false"){return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":'+h.childNodes[0].nodeValue+"}"}else{return'{"'+h.nodeName.substring(0,1).toLowerCase()+h.nodeName.substring(1)+'":"'+h.childNodes[0].nodeValue+'"}'}}}}}},nodesToJSONString:function(e){var f=0;var d="{";for(f=0;f<e.length;f++){if($type(e[f])=="element"){var g=XML.nodeToJSONString(e[f]);if(e[f].childNodes.length<=1&&$type(e[f].firstChild)=="textnode"){g=g.substring(1,g.length-1)}d+=g+","}}d=d.substring(0,d.length-1);d+="}";return d},hashesToTree:function(g){var d=[],f,e;for(f=0,e=g.length;f<e;f++){d.push(XML.hashToElement(g[f]))}return d},hashToElement:function(f,d){var e;if(f.text){e=document.newTextNode(f.text)}else{e=document.newElement(d||f.tag,f.attributes).adopt(XML.hashesToTree(f.children))}return e},hashToHTML:function(j,l){var g=new Array(l||0).join("\t"),d=[""],h,e="",k="",f=null;if(j.text){return g+j.text}for(h in j.attributes){d.push(h+'="'+j.attributes[h]+'"')}d=d.join(" ");e=g+"<"+j.tag+d+">\n";k="\n"+g+"</"+j.tag+">";f=XML.hashesToHTML(j.children,l+1);return e+f+k},hashesToHTML:function(e,h){var g=[],f,d;for(f=0,d=e.length;f<d;f++){g.push(XML.hashToHTML(e[f],h))}return g.join("\n")},transform:function(k,g){k=(typeof k=="string")?XML.rootFromFile(k):k;g=(typeof g=="string")?XML.rootFromFile(g):g;var d,m,h,e=[],j,n=document.newElement("div"),f;d=new XSLTProcessor();d.importStylesheet(g);m=d.transformToFragment(k,document);n.appendChild(m);for(h=0,f=n.childNodes.length;h<f;h++){j=n.childNodes[h],type=$type(j);if(type=="element"||type=="textnode"){e.push(j)}}return e},toString:function(d){return(new XMLSerializer).serializeToString(d)},dumpDOM:function(f,j){var h="DOM: ";if(j){h+=j}else{j=""}h+="["+f.nodeName+"]: "+f.nodeValue;if(f.attributes&&f.attributes.length){h+=" - ";for(var e=0;e<f.attributes.length;e++){var d=f.attributes[e];h+="("+d.nodeName+":"+d.nodeValue+") "}}log.write(h);if(f.childNodes&&f.childNodes.length){for(var e=0;e<f.childNodes.length;e++){var g=f.childNodes[e];this.dumpDOM(g,j+"  ")}}}};var webservices={WSRObj:null,apiKey:"",destType:"",uniqueId:"",userAgent:"",RequestQueue:null,RequestInProgress:false,makeAsyncRequest:function(j,e,k,g,d,h,f){if(!this.RequestQueue){this.RequestQueue=new Queue()}this.RequestQueue.enqueue({endPoint:j,method:e,params:k,cb_context:g,callback:d,cacheKey:h,timeout:f});this.processAsyncQueueRequest()},killCurrentRequests:function(){var d;if(this.RequestQueue){for(d=0;d<this.RequestQueue.getSize();d++){var e=this.RequestQueue.dequeue();log.write("webservices.killCurrentRequests: Dequeuing requests...")}this.killCurrentRequest()}},processAsyncQueueRequest:function(){var n=this,d,g,f;if(!this.RequestInProgress){this.RequestInProgress=true;log.write("Item is 1st in line or called from the queue.");var m=this.RequestQueue.dequeue(),l=m.endPoint,e=m.method,h=m.params,p=m.cb_context,k=m.callback,j=m.timeout;d=application.apiUrl+"/"+l;g={id:++nextRequestId+"_"+e,method:e,params:h};f=JSON.stringify(g);this.killCurrentRequest();this.WSRObj=new WSRequest();if(!j){j=application.appSetting("WSRequestTimeout")}if(j>=0){this.WSRObj.setTimeout(function(){n.WSRObj.abort();n.RequestInProgress=false;log.write("webservices.makeAsyncRequest: Web Service Timeout Error.");if(application.isLoaded){application.events.publish("error",{type:"timeout_error",endPoint:l,method:e,params:h,callback:k})}else{application.ui.init(function(){application.events.publish("error",{type:"timeout_error",recoverable:false,endPoint:l,method:e,params:h,callback:k})})}},j*1000)}if(application.logSupported||application.appSetting("Debug")){log.write("\nwebservices.makeAsyncRequest\nAbout to send request: "+f+" to "+d);log.write("x-json-rpc: "+e+",APIKey: "+this.apiKey+",DestinationTypeID: "+this.destType+",DestinationUniqueID: "+this.uniqueId+",User_Agent: "+this.userAgent+",SessionID: "+$cn.data.SessionId+",AuthToken"+$cn.data.AuthToken+",$cn.data.IsParent:"+$cn.data.IsParent)}this.WSRObj.setTarget("POST",d);this.WSRObj.setCacheKey(m.cacheKey);this.WSRObj.addHeader("Content-Type","text/plain; charset=utf-8");this.WSRObj.addHeader("Accept","*/*");this.WSRObj.addHeader("Accept-Language","en-us");if(application.authSupported){this.WSRObj.addHeader("x-json-rpc",e);this.WSRObj.addHeader("Connection","Keep-Alive");this.WSRObj.addHeader("Pragma","no-cache");this.WSRObj.addHeader("AuthToken",$cn.data.AuthToken);this.WSRObj.addHeader("APIKey",this.apiKey);this.WSRObj.addHeader("DestinationTypeID",this.destType);this.WSRObj.addHeader("DestinationUniqueID",this.uniqueId);this.WSRObj.addHeader("User-Agent",this.userAgent);this.WSRObj.addHeader("FileFilter","streamonly");this.WSRObj.addHeader("AccountType",($cn.data.IsParent)?"Parent":"Child");this.WSRObj.addHeader("SessionID",$cn.data.SessionId)}this.WSRObj.setOnComplete(function(){n.RequestInProgress=false;var q={err:true,text:"",data:{}};application.isConnected=true;if(n.WSRObj.status&&n.WSRObj.status!=200){q.text="webservices.makeAsyncRequest: call failed\nStatus: "+n.WSRObj.status;q.err=true;if(n.WSRObj.status=="502"||n.WSRObj.status=="1007"||n.WSRObj.status=="1013"){application.events.publish("error",{type:"no_internet",endPoint:l,method:e,params:h,callback:k})}else{if(n.WSRObj.status=="2013"){application.events.publish("error",{type:"socket_error",endPoint:l,method:e,params:h,callback:k,status:n.WSRObj.status})}else{application.events.publish("error",{type:"system_error",endPoint:l,method:e,params:h,callback:k,status:n.WSRObj.status})}}}else{if(device.logSupported||application.appSetting("Debug")){log.write("webservices.makeAsyncRequest: status: "+n.WSRObj.status+" Request successful: "+n.WSRObj.responseText)}try{if(n.WSRObj.responseText&&n.WSRObj.responseText.length>0){q.err=false;q.text="CinemaNOW request successful";q.data=JSON.parse(n.WSRObj.responseText);if(application.authSupported&&q.data&&q.data.result&&q.data.result.responseCode==31&&e!="pollForToken"&&e!="lookupPurchaseDetailsForTitle"&&e!="calcOrderTax"&&e!="getBillingInfo"){application.events.publish("badauthtoken",{endPoint:l,method:e,params:h,callback:k})}else{k.call(p,q);if(q.data.result&&q.data.result.responseCode&&!q.data.result.errorHandled){n.handleResponseError(q.data,{type:"",endPoint:l,method:e,params:h,callback:k})}}}else{if((n.WSRObj.requestRunTime>=(application.appSetting("WSRequestTimeout")*1000))&&!doNotTriggerTimeouts){application.events.publish("error",{type:"timeout_error",endPoint:l,method:e,params:h,callback:k})}}}catch(r){log.write("webservices.makeAsyncRequest EXCEPTION "+r);log.write("webservices.makeAsyncRequest Setting system_error!");log.write(log.dump(r,8));application.events.publish("error",{type:"system_error",endPoint:l,method:e,params:h,callback:k})}}if(n.RequestQueue.getSize()>0){log.write("webservices.processAsyncQueueRequest: Another item is in the queue. Call it.");n.processAsyncQueueRequest()}});this.WSRObj.send(f)}},makeXMLAsyncRequest:function(p,h,k,s,l,n,g,f){var m,r=this,e,j;if(!this.RequestQueue){this.RequestQueue=new Queue()}if(n&&!g){for(m=0;m<this.RequestQueue.getSize();m++){var q=this.RequestQueue.dequeue();log.write("webservices.makeXMLAsyncRequest: Override passed in. Dequeuing requests...")}this.killCurrentRequest()}if(!g){this.RequestQueue.enqueue({endPoint:p,method:h,params:k,cb_context:s,callback:l})}if(!this.RequestInProgress){this.RequestInProgress=true;log.write("Item is 1st in line or called from the queue.");var q=this.RequestQueue.dequeue();p=q.endPoint;h=q.method;k=q.params;s=q.cb_context;l=q.callback;e=application.apiUrl+"/"+p;j="";if(typeof(k.TagStart)!="undefined"){j+=k.TagStart}if(application.authSupported){j+="<APIKey>"+this.apiKey+"</APIKey>";j+="<DeviceUniqueID>"+this.uniqueId+"</DeviceUniqueID>";j+="<DeviceTypeID>"+this.destType+"</DeviceTypeID>";j+="<AuthToken>"+$cn.data.AuthToken+"</AuthToken>"}for(var d in k){if(d!="TagStart"&&d!="TagEnd"){j+="<"+d+">"+k[d].toString()+"</"+d+">"}}if(typeof(k.TagEnd)!="undefined"){j+=k.TagEnd}j=j.split("&").join("&amp;").split('"').join("&quot;").split("'").join("&apos;").split(">").join("&gt;").split("<").join("&lt;");this.killCurrentRequest();this.WSRObj=new WSRequest();if(!f){this.WSRObj.setTimeout(function(){r.WSRObj.abort();r.RequestInProgress=false;log.write("webservices.makeXMLAsyncRequest: Web Service Timeout Error.");if(application.isLoaded){application.events.publish("error",{type:"timeout_error",endPoint:p,method:h,params:k,callback:l})}else{application.ui.init(function(){application.events.publish("error",{type:"timeout_error",recoverable:false,endPoint:p,method:h,params:k,callback:l})})}},(application.appSetting("WSRequestTimeout")*1000))}if(application.logSupported||application.appSetting("Debug")){log.write("\nwebservices.makeXMLAsyncRequest\n "+h+"About to send request: "+j+" to "+e);log.write("APIKey: "+this.apiKey+",DestinationTypeID: "+this.destType+",DestinationUniqueID: "+this.uniqueId+",User_Agent: "+this.userAgent+",SessionID: "+$cn.data.SessionId+",AuthToken"+$cn.data.AuthToken+",$cn.data.IsParent:"+$cn.data.IsParent)}this.WSRObj.setTarget("POST",e);this.WSRObj.addHeader("Content-Type","text/xml");this.WSRObj.setOnComplete(function(){r.RequestInProgress=false;var u={err:true,text:"",data:{}};application.isConnected=true;if(r.WSRObj.status&&r.WSRObj.status!=200){u.text="webservices.makeXMLAsyncRequest: call failed\nStatus: "+r.WSRObj.status;u.err=true;if(r.WSRObj.status=="502"||r.WSRObj.status=="1007"||r.WSRObj.status=="1013"){application.events.publish("error",{type:"no_internet",endPoint:p,method:h,params:k,callback:l})}else{if(r.WSRObj.status=="2013"){application.events.publish("error",{type:"socket_error",endPoint:p,method:h,params:k,callback:l,status:r.WSRObj.status})}else{application.events.publish("error",{type:"system_error",endPoint:p,method:h,params:k,callback:l,status:r.WSRObj.status})}}}else{if(device.logSupported||application.appSetting("Debug")){log.write("webservices.makeXMLAsyncRequest: status: "+r.WSRObj.status+" Request successful: "+r.WSRObj.responseText)}try{if(r.WSRObj.responseText&&r.WSRObj.responseText.length>0){u.err=false;u.text="CinemaNOW request successful";var v=XML.rootFromString(r.WSRObj.responseText);u.data.id=h;u.data.result=XML.nodesToJSONString(v.firstChild.childNodes);u.data.result=JSON.parse(u.data.result);if(application.authSupported&&u.data&&u.data.result&&u.data.result.responseCode==31&&h!="pollForToken"&&h!="lookupPurchaseDetailsForTitle"&&h!="calcOrderTax"&&h!="getBillingInfo"){application.events.publish("badauthtoken",{endPoint:p,method:h,params:k,callback:l})}else{l.call(s,u);if(u.data.result&&u.data.result.responseCode&&!u.data.result.errorHandled){r.handleResponseError(u.data,{type:"",endPoint:p,method:h,params:k,callback:l})}}}else{if((r.WSRObj.requestRunTime>=(application.appSetting("WSRequestTimeout")*1000))&&!f){application.events.publish("error",{type:"timeout_error",endPoint:p,method:h,params:k,callback:l})}}}catch(w){log.write("webservices.makeXMLAsyncRequest EXCEPTION "+w);log.write("webservices.makeXMLAsyncRequest Setting system_error!");log.write(log.dump(w,8));application.events.publish("error",{type:"system_error",endPoint:p,method:h,params:k,callback:l})}}if(r.RequestQueue.getSize()>0){log.write("webservices.makeXMLAsyncRequest Another item is in the queue. Call it.");r.makeXMLAsyncRequest("","","","","",false,true,false)}});this.WSRObj.send(j)}},makeAsyncRequestExt:function(n,s,j,m,h,w,q,g,r,f){if(!this.RequestQueue){this.RequestQueue=new Queue()}if(r&&!f){for(x=0;x<this.RequestQueue.getSize();x++){var v=this.RequestQueue.dequeue();log.write("webservices.makeAsyncRequestExt: Override passed in. Dequeuing requests...")}}if(!f){this.RequestQueue.enqueue({host:n,endPoint:s,method:j,params:m,cb_context:w,callback:q,errorcb:g})}if(!this.RequestInProgress){this.RequestInProgress=true;var v=this.RequestQueue.dequeue();n=v.host;s=v.endPoint;j=v.method;m=v.params;w=v.cb_context;q=v.callback;g=v.errorcb;if(n==null){n=application.apiUrl}var d=n+"/"+s;var l={id:++nextRequestId+"_"+j,method:j,params:m};var k=JSON.stringify(l);var u=this;this.killCurrentRequest();this.WSRObj=new WSRequest();this.WSRObj.setTimeout(function(){log.write("webservices.makeAsyncRequestExt: timeout function");u.RequestInProgress=false;u.WSRObj.abort();if(h){application.events.publish("error",{type:"timeout_error",endPoint:d,method:j,params:{},callback:g})}else{g.call(w)}},(application.appSetting("WSRequestTimeout")*1000));try{this.WSRObj.setTarget("POST",d);this.WSRObj.addHeader("Content-Type","text/plain; charset=utf-8");this.WSRObj.addHeader("Accept","*/*");this.WSRObj.addHeader("Accept-Language","en-us");if(application.authSupported){this.WSRObj.addHeader("x-json-rpc",j);this.WSRObj.addHeader("Connection","Keep-Alive");this.WSRObj.addHeader("Pragma","no-cache");this.WSRObj.addHeader("AuthToken",$cn.data.AuthToken);this.WSRObj.addHeader("APIKey",this.apiKey);this.WSRObj.addHeader("DestinationTypeID",this.destType);this.WSRObj.addHeader("DestinationUniqueID",this.uniqueId);this.WSRObj.addHeader("User-Agent",this.userAgent);this.WSRObj.addHeader("FileFilter","streamonly");this.WSRObj.addHeader("AccountType",($cn.data.IsParent)?"Parent":"Child");this.WSRObj.addHeader("SessionID",$cn.data.SessionId)}this.WSRObj.setOnComplete(function(){u.RequestInProgress=false;var A={err:true,text:"",data:{}};if(u.WSRObj.status!=null&&u.WSRObj.status!=200){A.text="webservices.makeAsyncRequestExt: call failed\nStatus: "+u.WSRObj.status;A.err=true;log.write(A.text);if(h){if(u.WSRObj.status=="502"||u.WSRObj.status=="1007"||u.WSRObj.status=="1013"){application.events.publish("error",{type:"no_internet",endPoint:d,method:j,params:{},callback:g})}else{if(u.WSRObj.status=="2013"){application.events.publish("error",{type:"socket_error",endPoint:d,method:j,params:{},callback:g})}else{application.events.publish("error",{type:"system_error",endPoint:d,method:j,params:{},callback:g})}}}else{g.call(w)}}else{try{A.err=false;A.text="CinemaNOW request successful";A.data=JSON.parse(u.WSRObj.responseText);if(application.authSupported&&A.data&&A.data.result&&A.data.result.responseCode==31&&j!="pollForToken"&&j!="lookupPurchaseDetailsForTitle"&&j!="calcOrderTax"&&j!="getBillingInfo"){application.events.publish("badauthtoken",{endPoint:s,method:j,params:m,callback:a_cb})}else{q.call(w,A);if(A.data.result&&A.data.result.responseCode&&!A.data.result.errorHandled&&h){u.handleResponseError(A.data,{type:"",endPoint:s,method:j,params:m,callback:a_cb})}}}catch(B){log.write("Callback exception!   "+B);if(h){application.events.publish("error",{type:"system_error",endPoint:d,method:j,params:{},callback:g})}else{g.call(w)}}}if(u.RequestQueue.getSize()>0){log.write("Another item is in the queue. Call it.");u.processAsyncQueueRequest()}});this.WSRObj.send(k)}catch(p){log.write(p);this.RequestInProgress=false;u.WSRObj.abort();if(h){application.events.publish("error",{type:"system_error",endPoint:d,method:j,params:{},callback:g})}else{g.call(w)}}}else{application.apiUrl=application.appSetting("ApiUrl");$cn.data.apiUrl=application.apiUrl;q.call(this,application.apiUrl)}},makeRestRequest:function(j,h,d){var g=j;var f=this;this.killCurrentRequest();this.WSRObj=new WSRequest();this.WSRObj.setTimeout(function(){f.WSRObj.abort();f.RequestInProgress=false;log.write("Web Service Timeout Error.");if(application.isLoaded){application.events.publish("error",{type:"timeout_error",endPoint:g,method:a_method,params:a_params,callback:d})}else{application.ui.init(function(){application.events.publish("error",{type:"timeout_error",recoverable:false,endPoint:g,method:a_method,params:a_params,callback:d})})}},(application.appSetting("WSRequestTimeout")*1000));try{this.WSRObj.setTarget("GET",g);this.WSRObj.addHeader("Content-Type","text/plain; charset=utf-8");this.WSRObj.addHeader("Accept","*/*");this.WSRObj.addHeader("Accept-Language","en-us");if(application.authSupported){this.WSRObj.addHeader("Connection","Keep-Alive");this.WSRObj.addHeader("Pragma","no-cache");this.WSRObj.addHeader("APIKey",this.apiKey);this.WSRObj.addHeader("DestinationTypeID",this.destType);this.WSRObj.addHeader("DestinationUniqueID",this.uniqueId);this.WSRObj.addHeader("User-Agent",this.userAgent);this.WSRObj.addHeader("FileFilter","streamonly");this.WSRObj.addHeader("SessionID",$cn.data.SessionId)}this.WSRObj.setOnComplete(function(){var l={err:true,text:"",data:{}};if(f.WSRObj.status&&f.WSRObj.status!=200){l.text="WSRequest: call failed\nStatus: "+f.WSRObj.status;l.err=true;log.write(l.text);if(f.WSRObj.status=="502"||f.WSRObj.status=="1007"||f.WSRObj.status=="1013"){application.events.publish("error",{type:"no_internet",endPoint:g,method:a_method,params:a_params,callback:d})}else{if(f.WSRObj.status=="2013"){application.events.publish("error",{type:"socket_error",endPoint:g,method:a_method,params:a_params,callback:d})}else{application.events.publish("error",{type:"system_error",endPoint:g,method:a_method,params:a_params,callback:d})}}}else{log.write("WSRequest: call successful to: "+g);try{l.err=false;l.text="RES request successful";l.data=JSON.parse(f.WSRObj.responseText);if(application.authSupported&&l.data&&l.data.result&&l.data.result.responseCode==31&&a_method!="pollForToken"&&a_method!="lookupPurchaseDetailsForTitle"&&a_method!="calcOrderTax"&&a_method!="getBillingInfo"){application.events.publish("badauthtoken",{endPoint:j,method:a_method,params:a_params,callback:d})}else{d.call(h,l);if(l.data.result&&l.data.result.responseCode&&!l.data.result.errorHandled){f.handleResponseError(l.data,{type:"",endPoint:j,method:a_method,params:a_params,callback:d})}}}catch(m){log.write(log.dump(m,8));application.events.publish("error",{type:"system_error",endPoint:g,method:a_method,params:a_params,callback:d})}}});this.WSRObj.send({})}catch(k){log.write(log.dump(k,8));this.RequestInProgress=false;this.WSRObj.abort();application.events.publish("error",{type:"system_error",endPoint:g,method:a_method,params:a_params,callback:d})}},makeLogRequest:function(j,g,m){var f="http://swelogs.stage1.outcoursing.com/capture.ashx";var l=new Date();var e=this;var k={id:++nextRequestId+"_makeLogRequest",deviceid:this.uniqueId,devicename:$cn.data.DeviceName,useragent:this.userAgent,devicetype:this.destType,apikey:this.apiKey,platform:"v2",version:$cn.data.SoftwareVersion,log:j};var h=JSON.stringify(k);killCurrentRequest();this.WSRObj=new WSRequest();j.write("*******************\n\nAbout to send logging request: "+h+" to "+f);j.debug("*******************\n\nAbout to send logging request: "+h+" to "+f);this.WSRObj.setTarget("POST",f);this.WSRObj.addHeader("Content-Type","text/plain; charset=utf-8");this.WSRObj.addHeader("Accept","*/*");this.WSRObj.addHeader("Accept-Language","en-us");this.WSRObj.setOnComplete(function(){j.write("Logging Output to server: [status]: "+e.WSRObj.status+", [Response]: "+e.WSRObj.responseText);m.call(g,"")});this.WSRObj.send(h)},killCurrentRequest:function(){if(this.WSRObj!=null){try{this.WSRObj.abort();if(this.WSRObj.destroy){this.WSRObj.destroy()}this.WSRObj=null}catch(d){log.write("Error thrown:");log.write(d)}this.RequestInProgress=false}},killRequests:function(){killCurrentRequest();if(this.RequestQueue){this.RequestQueue.clear()}},handleResponseError:function(g,m){if(!this.nonCheckMethods){this.nonCheckMethods=["verifyCode","applyGiftCode","getGenesByWheelOptionPlural","pollForToken","doPurchase","addItemToWishList","getAccountLinkState","getLinkingAccount"]}var f=this.nonCheckMethods.length;for(var j=0;j<f;j++){if(m.method==this.nonCheckMethods[j]){return}}if(g&&g.result&&g.result.responseCode){var n=g.result.responseCode,q=g.result.responseMessage,l=false,k=null,e="",h=null,p=m.callback,d=m.method;log.write("webservices.handleResponseError: method("+d+"), response code("+n+")");if(n==550){application.events.publish("error",{type:"system_error",endPoint:m.endPoint,method:d,params:m.params,callback:p})}else{if(n==2012){application.events.publish("error",{type:"timeout_error",endPoint:m.endPoint,method:d,params:m.params,callback:p})}else{switch(n){case 1:k=application.resource.checkout_messages.Title_ID_Not_Found;break;case 2:k=application.resource.checkout_messages.Invalid_User_ID;break;case 3:k=application.resource.checkout_messages.User_Address_Is_Invalid;break;case 4:k=application.resource.checkout_messages.User_Credit_Card_Security_Code_Is_Invalid;break;case 5:k=application.resource.checkout_messages.User_Credit_Card_Number_Is_Invalid;break;case 6:k=application.resource.checkout_messages.User_Credit_Card_Is_Expired;break;case 7:k=application.resource.checkout_messages.Credit_Card_Declined;break;case 8:k=application.resource.checkout_messages.Daily_Spending_Limit_Reached;break;case 11:k=application.resource.checkout_messages.User_Credit_Card_Not_On_File;break;case 12:k=application.resource.checkout_messages.User_Credit_Card_Not_On_File_And_User_Does_Not_Have_Sufficient_Prepaid_Funds_For_This_Transaction;break;case 551:k=application.resource.uv_messages.account_Server_Error;k.Message=q;break;default:break}if(n>=120&&n<=400){l=true,k=application.resource.checkout_messages.uv_error;k.Message=q}if(k){if(!e){e=k.MessageType||"message_okcancel"}if(!k.OK&&e=="message_okcancel"){e="message_content"}h={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,Path:k,callback:p};if(h.Footer&&!l){h.Footer=h.Footer.replace("{m}",BrowseView.resolveMethodCode(d))}log.write("webservices.handleResponseError: method("+d+"), response code("+n+") popup.");BrowseView.errorCleanup();BrowseView.showMessage(e,h)}else{log.write("webservices.handleResponseError: method("+d+"), response code("+n+") unknown, system error popup.");application.events.publish("error",{type:"system_error",endPoint:m.endPoint,method:d,params:m.params,callback:p})}}}}},clearContentCache:function(e){var d=new WSRequest();d.clearContentCache(e)}};var configuration={DEBUG:false,inited:false,settings:{},configrwfile:null,newconfigrwfile:null,callback:null,initialize:function(e){if(!this.inited){this.inited=true;var d=function(){this.loadCredentialsFile();if(this.DEBUG){log.write("Configuration: websocket: Properties of configuration object: ");for(prop in this){if($type(this[prop])!="function"){log.write("        ["+prop+"]("+$type(this[prop])+"): "+this[prop])}}log.write("Configuration: wesbsocket: Properties of credentials object: ");for(prop in this.credentials_values){if($type(this.credentials_values[prop])!="function"){log.write("        ["+prop+"]("+$type(this.credentials_values[prop])+"): "+this.credentials_values[prop])}}log.write("Configuration: websocket: Properties of settings object: ");for(prop in this.settings){if($type(this.settings[prop])!="function"){log.write("        ["+prop+"]("+$type(this.settings[prop])+"): "+this.settings[prop])}}}var g=this.readValue("DestinationUniqueID");if(g){if(this.DEBUG){log.write("Configuration websocket: Skipping callGetDestinationUniqueID")}webservices.uniqueId=g;$cn.data.DeviceID=g;e.call()}else{var f=this.readValue("DeviceID");if(f==null||f==""||f=="auto"){if(this.DEBUG){log.write("Configuration websocket: Invoking callGetDestinationUniqueID")}this.callGetDestinationUniqueID(e)}else{if(this.DEBUG){log.write("Configuration websocket: Using DeviceID = uniqueId = "+f)}webservices.uniqueId=$cn.data.DeviceID=f;e.call()}}};if(this.DEBUG){log.write("Configuration websocket: About to call ws.ReadAllSettings using :environment: store key.")}this.callReadAllSettings(":environment:",function(){if(this.DEBUG){log.write("Configuration websocket: Callback from :environment ReadAllSettings received")}if(this.newconfigrwfile){this.configrwfile=this.newconfigrwfile}else{this.configrwfile=this.settings.CNWS_PREFERENCE_FILE}if(this.DEBUG){log.write("Configuration websocket: Set configrwfile to "+this.configrwfile)}if(this.configrwfile!=undefined&&this.configrwfile!=null&&this.configrwfile!=""){if(this.DEBUG){log.write("Configuration websocket: Setting store")}this.callSetStores(this.configrwfile,null,function(){if(this.DEBUG){log.write("Configuration websocket: Invoking callReadAllSettings w/o store value")}this.callReadAllSettings(null,d.bind(this))}.bind(this))}else{this.callReadAllSettings(null,d.bind(this))}}.bind(this))}},readValue:function(f){var d=null;if(this.settings[f]!=undefined&&this.settings[f]!=""){if(this.DEBUG){log.write("Configuration: websocket: readValue: r/w: key="+f+", value="+this.settings[f])}try{d=JSON.parse(this.settings[f])}catch(g){d=this.settings[f]}}else{if(this.credentials_values[f]!=undefined&&this.credentials_values[f]!=""){if(this.DEBUG){log.write("Configuration: websocket: readValue: creds: key="+f+", value="+this.credentials_values[f])}d=this.credentials_values[f]}else{if(this[f]!=undefined&&this[f]!=""){if(this.DEBUG){log.write("Configuration: websocket: readValue: r/o: key="+f+", value="+this[f])}d=this[f]}else{if($cn.config[f]!=undefined&&$cn.config[f]!=""){if(this.DEBUG){log.write("Configuration: websocket: readValue: $cn.config: key="+f+", value="+$cn.config[f])}d=$cn.config[f]}else{if(this.DEBUG){log.write("Configuration: websocket: readValue: key "+f+" not found")}}}}}return d},writeValue:function(d,e){if(this.DEBUG){log.write("Configuration: websocket: writeValue: key="+d+", value="+e)}this.settings[d]=e;if(e==undefined||e==null){WebSocketManager.send('<RNOConfigurationCall>$$REQUESTID$$<DeleteSetting key="'+d+'"/></RNOConfigurationCall>',this,function(f){if(this.DEBUG){log.write("Configuration websocket: writeValue.DeleteSetting: Message is received: \n"+f)}})}else{WebSocketManager.send('<RNOConfigurationCall>$$REQUESTID$$<WriteSetting key="'+d+'">'+e+"</WriteSetting></RNOConfigurationCall>",this,function(f){if(this.DEBUG){log.write("Configuration websocket: writeValue.WriteSetting: Message is received: \n"+f)}})}},clearValue:function(d){if(this.DEBUG){log.write("Configuration: websocket: clearValue: "+d)}this.writeValue(d,null)},callSetStores:function(f,j,k){var g=this;var e="";var h="";if(f!=undefined&&f!=null&&f!=""){h="<Store>"+f+"</Store>"}if(j!=undefined&&j!=null&&j!=""){e='<Store readonly="true">'+j+"</Store>"}if(e!=""||h!=""){var d=h+e;log.write("Configuration.callSetStores: About to call WS.SetStores with "+d);WebSocketManager.send("<RNOConfigurationCall>$$REQUESTID$$<SetStores>"+d+"</SetStores></RNOConfigurationCall>",this,function(l){if(g.DEBUG){log.write("Configuration.callSetStores: Message is received: \n"+l)}k.call()})}else{k.call()}},getConfigPathElements:function(){var e=this.settings.CNWS_PREFERENCE_FILE.split("\\").join("/").split("/");for(var d=0;d<e.length;d++){while(e[d]==""&&d<e.length){e.splice(d,1)}}return e},changeSettingsFile:function(k,g){var j=this.getConfigPathElements();if(j){var e=this._parseCredentialCodes(j[j.length-2]);if(e){if(!k){k=e.cid}if(!g){g=e.rid}var d=k.toString()+"_";d+=g.toString();j[j.length-2]=d;var h=e.cid.toString()+"_"+e.rid.toString();var f=this.settings.CNWS_PREFERENCE_FILE.replace(h,d);this.newconfigrwfile=f}}},switchToSettingsFile:function(d){this.changeSettingsFile(d);this.configrwfile=this.newconfigrwfile;this.callSetStores(this.configrwfile,null,function(){this.callReadAllSettings(null,function(){log.write("switchToSettingsFile callback: After setting new file")})}.bind(this))},callReadAllSettings:function(e,h,f){if(this.DEBUG){log.write("Configuration websocket: About to call ws.ReadAllSettings.")}var d=this;var g="";if(e!=undefined&&e!=null&&e!=""){g=' store="'+e+'"'}if(f==undefined||f==null){f=this.settings}WebSocketManager.send("<RNOConfigurationCall"+g+">$$REQUESTID$$<ReadAllSettings></ReadAllSettings></RNOConfigurationCall>",this,function(j){if(d.DEBUG){log.write("Configuration websocket: Message is received: \n"+j)}var k=d.processConfigurationCallSettingsResponse(j,f);if(k!=0){log.write("Configuration websocket: Warning: processConfigurationCallSettingsResponse for ReadAllSettings returned non-zero "+k)}h.call()})},processConfigurationCallSettingsResponse:function(v,h){var d=0;if(this.DEBUG){log.write("Configuration.processConfigurationCallSettingsResponse: Message is received: \n"+v)}try{var q=XML.rootFromString(v);if(q.firstChild.nodeName=="RNOConfigurationCall_Response"){var g=q.firstChild.childNodes;for(var p=0;p<g.length;p++){if(g[p].nodeName=="ReadAllSettings_Response"){var n=g[p].attributes;if(n[0].name=="error"){var s=n[0].value;if(s==0){var f=g[p].childNodes;for(var m=0;m<f.length;m++){if(f[m].nodeName=="Setting"){if(f[m].attributes&&f[m].attributes.length>0){for(var l=0;l<f[m].attributes.length;l+=1){if(f[m].attributes[l]&&f[m].attributes[l].name=="key"){var u=f[m].attributes[l].value;h[u]=$cn.utilities.getNodeText(f[m]);if(this.DEBUG){log.write("Configuration.processConfigurationCallSettingsResponse: Key:("+u+"), Value("+h[u]+")")}}}}}}}else{log.write("Configuration.processConfigurationCallSettingsResponse: Warning: ReadAllSettings returned errorCpde "+s);d=s}}break}}}else{log.write("Configuration.processConfigurationCallSettingsResponse: Warning: received unexpected message.");d=-1}}catch(r){log.write("Configuration.processConfigurationCallSettingsResponse: Warning: exception parsing and processing response: "+r);d=-1}return d},callGetDestinationUniqueID:function(e){if(this.DEBUG){log.write("Configuration.callGetDestinationUniqueID: About to call ws.GetDestinationUniqueID.")}var d=this;WebSocketManager.send("<RNOWebServiceCall>$$REQUESTID$$<GetDestinationUniqueID></GetDestinationUniqueID></RNOWebServiceCall>",this,function(f){if(d.DEBUG){log.write("Configuration.callGetDestinationUniqueID: Response is received: \n"+f)}var g=d.processGetDestinationUniqueIDResponse(f);if(g!=0){log.write("Configuration.callGetDestinationUniqueID: Warning: processGetDestinationUniqueIDResponse for GetDestinationUniqueID returned non-zero "+g)}e.call()})},processGetDestinationUniqueIDResponse:function(g){var d=0;if(this.DEBUG){log.write("Configuration.processGetDestinationUniqueIDResponse: response passed is: \n"+g)}try{var k=XML.rootFromString(g);if(k.firstChild.nodeName=="RNOWebServiceCall_Response"){var f=k.firstChild.childNodes;for(var j=0;j<f.length;j++){if(f[j].nodeName=="GetDestinationUniqueID_Response"){var h=f[j].attributes;if(h[0].name=="error"){var n=h[0].value;if(n==0){var m=$cn.utilities.getNodeText(f[j]);if(m&&m!=""){if(this.DEBUG){log.write("Configuration.processGetDestinationUniqueIDResponse: Setting webservices.uniqueId and $cn.data.DeviceID ")}webservices.uniqueId=m;$cn.data.DeviceID=m;this.writeValue("DestinationUniqueID",m)}}else{log.write("Configuration.processGetDestinationUniqueIDResponse: Warning: GetDestinationUniqueID returned errorCpde "+n);d=n}}break}}}else{log.write("Configuration.processGetDestinationUniqueIDResponse: Warning: received unexpected response.");d=-1}}catch(l){log.write("Configuration.processGetDestinationUniqueIDResponse: Warning: exception parsing and processing response: "+l);d=-1}return d}};var device={logSupported:true,logToDisplay:false,backupIPConnectionSupported:true,realmodelid:"RES-BD",initialize:function(){log.write("device.initialize: stub version enter. $cn.data.DeviceID, webservices.uniqueId are "+$cn.data.DeviceID+", "+webservices.uniqueId);if(application.authSupported){if(webservices.uniqueId==""){$cn.data.DeviceID=webservices.uniqueId="BDE029102EBD";log.write("device.initialize: stub version: Setting fixed uniqueId "+webservices.uniqueId)}else{log.write("device.initialize: stub version: Leaving uniqueId, DeviceID as "+webservices.uniqueId+", "+$cn.data.DeviceID)}$cn.data.FirmwareVersion=$UrlQueryString.FirmwareVersion||$cn.data.FirmwareVersion;this.realmodelid=$UrlQueryString.Model||this.realmodelid;webservices.userAgent="CNSDK:"+$cn.data.FirmwareVersion+"|"+configuration.readValue("version")+"."+configuration.readValue("build")+" CNMODEL:"+this.realmodelid}log.write("device.initialize: Set User Agent to "+webservices.userAgent)},showBanner:function(){log.write("device.showBanner: stub version enter")},getFirmwareVersion:function(){return $cn.data.FirmwareVersion},getFirmwareYear:function(){return"2012"},getDeviceType:function(){return"RES"},getDeviceSoc:function(){return"BD"},setDeviceSoc:function(d){log.write("device.setDeviceSoc: stub version enter")},displayTime:function(d){log.write("device.displayTime: stub version enter with ms "+d)},displayPlay:function(){log.write("device.displayPlay: stub version enter")},displayPause:function(){log.write("device.displayPause: stub version enter")},displayStop:function(){log.write("device.displayStop: stub version enter")},initPlayer:function(){log.write("device.initPlayer: stub version enter")},initAudioPlugin:function(){log.write("device.initAudioPlugin: stub version enter")},setDocumentClassName:function(){if(this.isWebkit()){document.getElementsByTagName("body")[0].className="twothousandtwelve"}else{document.getElementsByTagName("body")[0].className="twothousandeleven"}return true},createActivationFile:function(){log.write("device.createActivationFile: stub version enter")},deleteActivationFile:function(){log.write("device.deleteActivationFile: stub version enter")},exit:function(){log.write("device.exit: stub version enter")},sendReturnEvent:function(){log.write("device.sendReturnEvent: stub version enter")},unload:function(){log.write("device.unload: stub version enter")},addLogSessionActivity:function(d,f,e){log.write("device.addLogSessionActivity: stub version enter")},uploadLogSession:function(){log.write("device.uploadLogSession: stub version enter")},play:function(g,e,d,f){e=e.replace(/&amp;/g,"&");log.write("device.play: stub version. Player url = "+e);if(d){Player.ResumePlay(e,d,f)}else{Player.Play(e,f)}},setOffScreenSaver:function(){log.write("device.setOffScreenSaver: stub version enter")},setOnScreenSaver:function(){log.write("device.setOnScreenSaver: stub version enter")},setOffFullScreen:function(){log.write("device.setOffFullScreen: stub version enter")},setOnFullScreen:function(){log.write("device.setOnFullScreen: stub version enter")},sourceChange:function(){log.write("device.sourceChange: stub version enter")},sourceChange_ori:function(){log.write("device.sourceChange_ori: stub version enter")},isWebkit:function(){return(navigator.userAgent.toLowerCase().indexOf("webkit")>-1)}};var BandwidthCheck={inited:false,callbackParms:null,callbackType:"",callback:null,successCondition:0,lastRan:0,lastProgressUpdateTime:"",lastProgressupdateValue:0,initialize:function(){if(!this.inited){log.write("BandwidthCheck.initialize: websocket version: Setting up unsolicited response handler");WebSocketManager.addHandler("DownloadFile_Progress",this,this.sdkProgressHandler);this.inited=true}},playerBandwidthCheck:function(e,h,g,d,j){log.write("BandwidthCheck.playerBandwidthCheck: websocket version enter");this.initialize();this.callbackParams={url:e,resume:(g<$cn.config.EarliestResumeS-$cn.config.RewindUponResumeS)?0:d};this.callbackType="player";this.lastRan=new Date();this.successCondition=(h)?application.appSetting("HDMinimumBandwidth"):application.appSetting("SDMinimumBandwidth");this.callback=j;var f=this.createRequest();WebSocketManager.send(f,this,this.sdkResponseHandler)},purchaseBandwidthCheck:function(f,l,k,h,j){log.write("BandwidthCheck.purchaseBandwidthCheck: websocket version enter");try{this.initialize();this.callbackParams={titleid:f,skuid:l,couponcode:k,pinValidated:true,bandwidthValidated:true};this.callbackType="purchase";this.lastRan=new Date();this.successCondition=(h)?application.appSetting("HDMinimumBandwidth"):application.appSetting("SDMinimumBandwidth");this.callback=j;var d=this.createRequest();WebSocketManager.send(d,this,this.sdkResponseHandler)}catch(g){log.write("BandwidthCheck.purchaseBandwidthCheck: websocket version. download control not supported")}},popupBandwidthCheck:function(d,k,h){log.write("BandwidthCheck.popupBandwidthCheck: websocket version enter");var f=0;try{this.initialize();$cn.data.bwTest.bwCallback=k;$cn.data.bwTest.self=d;d.startTime=new Date();this.callback=k;var g=this.createRequest();WebSocketManager.send(g,this,this.sdkResponseHandler)}catch(j){if(h){f=Number(setInterval(k,2000))}log.write("BandwidthCheck.popupBandwidthCheck: websocket version. download control not supported")}return f},createRequest:function(){var d="<RNOWebServiceCall>$$REQUESTID$$<DownloadFile";d+=' url="'+$cn.data.BandwithCheckURL+'"';d+=' targetFile=":null:"';d+=' maxDownloadTime="8000"';d+=' skippedTime="3000"';d+=' maxDownloadSize="'+$cn.data.BandwithCheckURLSize+'"';d+=' progressid="bandwidthTest"/></RNOWebServiceCall>';return d},sdkResponseHandler:function(j){log.write("BandwidthCheck.sdkResponseHandler: response: "+j);var n;try{n=XML.rootFromString(j).firstChild}catch(l){log.write("WSRequest (WebSocket): parsing error: "+l);throw (l)}var h=0;var q=0;var g=0;var m=0;var f=n.getElementsByTagName("DownloadFile_Response");if(f&&f.length){var p=f[0].attributes;for(var k=0;k<p.length;k++){var d=p[k].nodeName;if(d=="contentLength"){q=new Number(p[k].nodeValue)}else{if(d=="contentTime"){g=new Number(p[k].nodeValue)}else{if(d=="error"){m=new Number(p[k].nodeValue);if(m==0){m=1}}}}}}BandwidthCheck.lastProgressUpdate="";if(q>0&&g>0){h=parseInt((q*1000/g));BandwidthCheck.callback("SpeedUpdate?"+h)}else{BandwidthCheck.callback("SpeedUpdate?0")}BandwidthCheck.callback("ProgressUpdate?100");BandwidthCheck.callback("Complete?"+m)},sdkProgressHandler:function(n){if(n){var d=0;var k=1;var p="";var g=null;if(n.nodeName=="DownloadFile_Progress"){g=[n]}else{g=n.getElementsByTagName("DownloadFile_Progress")}if(g&&g.length){var q=g[0].attributes;for(var m=0;m<q.length;m++){var f=q[m].nodeName;if(f=="denominator"){k=new Number(q[m].nodeValue)}else{if(f=="numerator"){d=new Number(q[m].nodeValue)}else{if(f=="type"){p=q[m].nodeValue}}}}if(p=="ContentProgress"&&k>1){BandwidthCheck.callback("ProgressUpdate?"+parseInt(100*d/k));var j=new Date();if(BandwidthCheck.lastProgressUpdateTime!=""){var e=$cn.utilities.DateDiff(j,BandwidthCheck.lastProgressUpdateTime);if(e>=1000&&$cn.data.BandwithCheckURLSize==k){var l=$cn.data.BandwithCheckURLSize*((d/k)-BandwidthCheck.lastProgressUpdateValue);var h=parseInt(l*1000/e);BandwidthCheck.callback("SpeedUpdate?"+h);BandwidthCheck.lastProgressUpdateValue=d/k;BandwidthCheck.lastProgressUpdateTime=j}}else{BandwidthCheck.lastProgressUpdateValue=d/k;BandwidthCheck.lastProgressUpdateTime=j}}}}}};var Player={initialized:false,isPlay:false,isStopping:false,isHD:false,isStutter:false,isSkipping:false,playbackTime:0,playbackSpeed:1,playbackState:"Stopped",duration:0,videoWidth:960,videoHeight:540,bitrate:0,playbackQualityLevels:4,playbackQualityLevel:1,playbackQualityType:"SD",playbackQualityRate:0,ccData:null,scanWatchTimer:null,Initialize:function(){log.write("Player.Initialize(websocket version)");var d=false;if("WebSocketManager" in window){application.playbackSupported=true;d=true}return d},Shutdown:function(){log.write("Player.Shutdown(websocket version)");this.Stop();this._releasePlayer()},Play:function(e,g){log.write("Player.Play(websocket version): url("+e+")");if(this.initialized){log.write("Player.Play(websocket version): already initialized!");return}this.ccData=g;var f=this._generateCreatePlayerRequest(e),d=this;WebSocketManager.send(f,this,function(j){var k=d._getResponseNode(j,"CreatePlayer_Response");if(k){var h=k.attributes;if(h.length>0&&h[0].name=="error"){if(h[0].value==0){log.write("Player.Play(websocket version): create player success!");d.initialized=true;d._registerEventHandler()}else{d._handleError(h[0].value)}}}});return 1},ResumePlay:function(f,e,h){log.write("Player.ResumePlay(websocket version): url("+f+"), resumePosition("+e+")");if(this.initialized){log.write("Player.ResumePlay(websocket version): already initialized!");return}this.ccData=h;var g=this._generateCreatePlayerRequest(f),d=this;WebSocketManager.send(g,this,function(k){var l=d._getResponseNode(k,"CreatePlayer_Response");if(l){var j=l.attributes;if(j.length>0&&j[0].name=="error"){if(j[0].value==0){log.write("Player.ResumePlay(websocket version): create player success!");d.initialized=true;d.playbackTime=e;d._registerEventHandler()}else{d._handleError(j[0].value)}}}});return 1},Pause:function(){log.write("Player.Pause(websocket version)");if(!this.isPlay){log.write("Player.Pause(websocket version): not played!");return}var e="<RNOPlayerCall>$$REQUESTID$$<Pause/></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"Pause_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value!=0){d._handleError(f[0].value)}else{log.write("Player.Pause(websocket version): pause player success!")}}}});return 1},Resume:function(){log.write("Player.Resume(websocket version)");if(!this.isPlay){log.write("Player.Resume(websocket version): not played!");return}this._requestPlay();return 1},Stop:function(){log.write("Player.Stop(websocket version)");if(!this.initialized){log.write("Player.Stop(websocket version): not initialized!");return}this.isStopping=true;var e="<RNOPlayerCall>$$REQUESTID$$<Stop/></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"Stop_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value==0){log.write("Player.Stop(websocket version), stop player success!");d.isPlay=false}else{log.write("Player.Stop(websocket version), stop player error("+f[0].value+")!")}d._releasePlayer()}}})},JumpForward:function(d){log.write("Player.JumpForward(websocket version)");if(!this.isPlay){log.write("Player.JumpForward(websocket version): not played!");return}if(this.playbackTime+d<this.duration){this.isSkipping=true;this._requestPlay(this.playbackTime+d)}},JumpBackward:function(d){log.write("Player.JumpBackward(websocket version)");if(!this.isPlay){log.write("Player.JumpBackward(websocket version): not played!");return}if(this.playbackTime-d>0){this.isSkipping=true;this._requestPlay(this.playbackTime-d)}},LocateToPosition:function(d){log.write("Player.LocateToPosition(websocket version): postion("+d+")");if(!this.isPlay){log.write("Player.LocateToPosition(websocket version): not played!");return}if(0<d&&d<this.duration){this.isSkipping=true;this._requestPlay(d)}return 1},SetPlaybackSpeed:function(d){log.write("Player.SetPlaybackSpeed(websocket version): speed("+d+")");if(!this.isPlay){log.write("Player.SetPlaybackSpeed(websocket version): not played!");return}this._requestPlay(this.playbackTime,d);return 1},SetVisibility:function(d){log.write("Player.SetVisibility(websocket version)")},SetDisplayArea:function(e,g,f,d){log.write("Player.SetDisplayArea(websocket version)")},SetInitialTimeOut:function(d){log.write("Player.SetInitialTimeOut(websocket version)")},GetDuration:function(){log.write("Player.GetDuration(websocket version), duration("+this.duration+")");return this.duration*1000},GetCurrentBitrates:function(){log.write("Player.GetCurrentBitrates(websocket version), bitrate("+this.playbackQualityRate+")");return this.playbackQualityRate},GetQualityInfo:function(){log.write("Player.GetQualityInfo(websocket version), qualityType("+this.playbackQualityType+"), Level("+this.playbackQualityLevel+"), TotalLevel("+this.playbackQualityLevels+"), qualityRate("+this.playbackQualityRate+")");return{PlaybackQualityType:this.playbackQualityType,PlaybackQualityLevel:this.playbackQualityLevel,PlaybackQualityLevels:this.playbackQualityLevels,PlaybackQualityRate:this.playbackQualityRate}},GetVideoHeight:function(){log.write("Player.GetVideoHeight(websocket version)");return this.videoHeight},GetVideoWidth:function(){log.write("Player.GetVideoWidth(websocket version)");return this.videoWidth},SetCCLanguage:function(f){log.write("Player.SetCCLanguage(websocket version): language("+f+")");var e="<RNOPlayerCall>$$REQUESTID$$<SetCCLanguage>"+f+"</SetCCLanguage></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(h){var j=d._getResponseNode(h,"SetCCLanguage_Response");if(j){var g=j.attributes;if(g.length>0&&g[0].name=="error"){if(g[0].value!=0){d._handleError(g[0].value)}else{log.write("Player.SetCCLanguage(websocket version): SetCCLanguage success!")}}}});return 1},SetCCEnabled:function(e){log.write("Player.SetCCEnabled(websocket version): ccEnable("+e+")");var f="<RNOPlayerCall>$$REQUESTID$$<SetCCEnabled>"+e+"</SetCCEnabled></RNOPlayerCall>",d=this;WebSocketManager.send(f,this,function(h){var j=d._getResponseNode(h,"SetCCEnabled_Response");if(j){var g=j.attributes;if(g.length>0&&g[0].name=="error"){if(g[0].value!=0){d._handleError(g[0].value)}else{log.write("Player.SetCCEnabled(websocket version): SetCCEnabled success!")}}}});return 1},GetCCEnabled:function(g,e){log.write("Player.GetCCEnabled(websocket version)");var f="<RNOPlayerCall>$$REQUESTID$$<GetCCEnabled></GetCCEnabled></RNOPlayerCall>",d=this;WebSocketManager.send(f,this,function(k){var l=d._getResponseNode(k,"GetCCEnabled_Response"),j=false;if(l){var h=l.attributes;if(h.length>0&&h[0].name=="error"){if(h[0].value==0){if(l.firstChild.nodeValue&&l.firstChild.nodeValue=="true"){j=true}else{j=false}log.write("Player.GetCCEnabled(websocket version): get ccEnable("+j+")");if(typeof g==="function"){g.call(e,j)}}else{d._handleError(h[0].value)}}}})},SetCCCache:function(){log.write("Player.SetCCCache(websocket version)");var e='<RNOPlayerCall>$$REQUESTID$$<SetCCCache type="closedcaptions"/></RNOPlayerCall>',d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"SetCCCache_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value!=0){d._handleError(f[0].value)}else{log.write("Player.SetCCCache(websocket version): SetCCCache success!")}}}});return 1},SetCCData:function(g,e){log.write("Player.SetCCData(websocket version): language("+g+") url ("+e+")");var f='<RNOPlayerCall>$$REQUESTID$$<SetCCData language="'+g+'" url="'+e+'"/></RNOPlayerCall>',d=this;WebSocketManager.send(f,this,function(j){var k=d._getResponseNode(j,"SetCCData_Response");if(k){var h=k.attributes;if(h.length>0&&h[0].name=="error"){if(h[0].value!=0){d._handleError(h[0].value)}else{log.write("Player.SetCCData(websocket version): SetCCData success!")}}}});return 1},InitClosedCaption:function(){if(!this.ccData||!this.ccData.length){log.write("Player.InitClosedCaption(websocket version), CC data invalid, just return!");return}var e=ccrender.isCCEnabled(),f="<RNOPlayerCall>$$REQUESTID$$<SetCCLanguage>"+this.ccData[0].language+"</SetCCLanguage><SetCCEnabled>"+e+'</SetCCEnabled><SetCCCache type="closedcaptions"/><SetCCData language="'+this.ccData[0].language+'" url="'+this.ccData[0].closedCaptionAssetLocation+'"/></RNOPlayerCall>',d=this;log.write("Player.InitClosedCaption(websocket version): "+f);WebSocketManager.send(f,this,function(h){var j=d._getResponseNode(h,"SetCCData_Response");if(j){var g=j.attributes;if(g.length>0&&g[0].name=="error"){if(g[0].value!=0){d._handleError(g[0].value)}else{log.write("Player.InitClosedCaption(websocket version): SetCCData success!")}}}});return 1},GetCCStreams:function(){log.write("Player.GetCCStreams(websocket version)");var e='<RNOPlayerCall>$$REQUESTID$$<GetStreams streamType="closedcaption"/></RNOPlayerCall>',d=this;WebSocketManager.send(e,this,function(h){var j=d._getResponseNode(h,"GetStreams_Response");if(j){var g=j.attributes;if(g.length>0&&g[0].name=="error"){if(g[0].value!=0){d._handleError(g[0].value)}else{var f=j.firstChild.firstChild.textContent,k=(f==="Playing"||f==="Ready");OnUpdateCCState(k)}}}});return 1},_getResponseNode:function(d,k){try{var j=d.replace(/\r|\n/g,"").replace(/\s*</g,"<"),g=XML.rootFromString(j).firstChild,f;if(g.nodeName==="RNOPlayerCall_Response"&&g.childNodes&&g.childNodes.length){for(f=1;f<g.childNodes.length;f++){if(g.childNodes[f].nodeName===k){return g.childNodes[f]}}}return null}catch(h){log.write("Player._getResponseNode(websocket version): parsing response error: "+h);throw (h)}},_generateCreatePlayerRequest:function(f){f="TITLE_URL="+f;var e={titleURL:"TITLE_URL=",deviceID:"|DEVICE_ID=",deviceTypeID:"|DEVICET_TYPE_ID=",streamID:"|STREAM_ID=",clientIP:"|IP_ADDR=",drmServerURL:"|DRM_URL=",drmAckServerURL:"|ACK_URL=",heartbeatURL:"|HEARTBEAT_URL=",heartbeatPeriod:"|HEARTBEAT_PERIOD=",titleProfile:"|TITLE_PROFILE=",customData:"|CUSTOM_DATA=",hdStreamID:"|HD_STREAM_ID="};var m=0,l=0,q;for(q in e){m=f.indexOf(e[q]);if(m>-1){l=f.indexOf("|",m+1);if(l>-1){if(m+e[q].length<l){e[q]=f.substring(m+e[q].length,l)}else{e[q]=""}}}else{e[q]=""}}e.deviceID=e.deviceID+"|"+e.deviceTypeID;this.isHD=(e.titleProfile=="HD");var g=configuration.readValue("PreferredDRMProvider"),n=configuration.readValue("DPSProvisionBlob"),d=configuration.readValue("DPSContentID");var p="",h="";if(this.isHD){h=(g==="DIVX")?e.customData:e.streamID}else{p=(g==="DIVX")?e.customData:e.streamID;if(e.hdStreamID){h=e.hdStreamID}}var k="<RNOPlayerCall>$$REQUESTID$$<CreatePlayer><PlayerSettings><SDTitle>"+(this.isHD?"":e.titleURL)+"</SDTitle><HDTitle>"+(this.isHD?e.titleURL:"")+"</HDTitle><DRMProvider>"+(g||"")+"</DRMProvider><Credentials>"+(n||"")+"</Credentials><SD2HDThreshold>4200</SD2HDThreshold><HD2SDThreshold>2800</HD2SDThreshold><ContentID>"+(d||"")+"</ContentID><StreamingCredentials><DeviceID>"+e.deviceID+"</DeviceID><SDStreamID>"+p+"</SDStreamID><HDStreamID>"+h+"</HDStreamID><ClientIP>"+e.clientIP+"</ClientIP><DRMServerURL>"+e.drmServerURL+"</DRMServerURL><DRMAckServerURL>"+e.drmAckServerURL+"</DRMAckServerURL><HeartbeatURL>"+e.heartbeatURL+"</HeartbeatURL><HeartbeatPeriod>"+e.heartbeatPeriod+"</HeartbeatPeriod><TestURL/><BandwidthInterval/><ProxySettingsEnable>false</ProxySettingsEnable><ProxySettingsIPAddr/><ProxySettingsIPPort>0</ProxySettingsIPPort><ProxySettingsUserID/><ProxySettingsPassword/></StreamingCredentials></PlayerSettings></CreatePlayer></RNOPlayerCall>";log.write("Player._generateCreatePlayerRequest(websocket version), request string: "+k);return k},_requestPlay:function(h,j){log.write("Player._requestPlay(websocket version), playbackTime("+h+"), playbackSpeed("+j+")");if(!this.initialized){log.write("Player._requestPlay(websocket version): not initialized!");return}var g=h||0;var f=j||1;this.playbackSpeed=j;var e='<RNOPlayerCall>$$REQUESTID$$<Play><PlaybackTime type="seconds">'+g+"</PlaybackTime><PlaybackSpeed>"+f+"</PlaybackSpeed></Play></RNOPlayerCall>";var d=this;WebSocketManager.send(e,this,function(l){var m=d._getResponseNode(l,"Play_Response");if(m){var k=m.attributes;if(k.length>0&&k[0].name=="error"){if(k[0].value==0){log.write("Player._requestPlay(websocket version): player play success!");if(!d.isPlay&&!d.isStopping){d.isPlay=true;d._getDuration()}}else{d._handleError(k[0].value)}}}})},_releasePlayer:function(){log.write("Player._releasePlayer(websocket version)");if(!this.initialized){log.write("Player._releasePlayer(websocket version): not initialized!");return}var e="<RNOPlayerCall>$$REQUESTID$$<ReleasePlayer/></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"ReleasePlayer_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value==0){log.write("Player._releasePlayer(websocket version), release player success!");d.initialized=false;d.isPlay=false;d.isStopping=false;d.isHD=false;d.isStutter=false;d.isSkipping=false;d.playbackTime=0;d.playbackSpeed=1;d.playbackState="Stopped";d.duration=0;d.bitrates=0;d.playbackQualityLevels=4;d.playbackQualityLevel=1;d.playbackQualityType="SD";d.playbackQualityRate=0;d.ccData=null;OnPlaybackStopped()}else{log.write("Player._releasePlayer(websocket version), release player error("+f[0].value+")!")}}}})},_getDuration:function(){log.write("Player._getDuration(websocket version)");if(!this.isPlay){log.write("Player._getDuration(websocket version): not played!");return}var e="<RNOPlayerCall>$$REQUESTID$$<GetDuration/></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"GetDuration_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value==0){if(h.firstChild.nodeName=="PlaybackTime"){f=h.firstChild.attributes;d.duration=Number(h.firstChild.firstChild.nodeValue);if(f&&f.length&&f[0].name.toLowerCase()==="type"&&f[0].value.toLowerCase()==="frames"){d.duration=d.duration/25}log.write("Player._getDuration(websocket version): get duration("+d.duration+")");OnStreamInfoReady()}}else{d._handleError(f[0].value)}}}})},_getStreamAttributes:function(){log.write("Player._getStreamAttributes(websocket version)");if(!this.isPlay){log.write("Player._getStreamAttributes(websocket version): not played!");return}var g='<RNOPlayerCall>$$REQUESTID$$<GetStreamAttributes stream="0"/></RNOPlayerCall>',d=this,f=0,e=0;WebSocketManager.send(g,this,function(j){var k=d._getResponseNode(j,"GetStreamAttributes_Response");if(k){var h=k.attributes;if(h.length>0&&h[0].name=="error"){if(h[0].value==0){var m=k.childNodes;for(f=0;f<m.length;f++){if(m[f].nodeName=="VideoStreamAttributes"){var l=m[f].childNodes;for(e=0;e<l.length;e++){if(l[e].nodeName=="Width"){d.videoWidth=l[e].firstChild.nodeValue}else{if(l[e].nodeName=="Height"){d.videoHeight=l[e].firstChild.nodeValue}else{if(l[e].nodeName=="BitRate"){d.bitrates=l[e].firstChild.nodeValue}}}}break}}if(d.duration>0&&d.videoWidth>0&&d.videoHeight>0){OnStreamInfoReady()}}else{d._handleError(h[0].value)}}}})},_registerEventHandler:function(){log.write("Player._registerEventHandler(websocket version)");if(!this.initialized){log.write("Player._registerEventHandler(websocket version): not initialized!");return}var e="<RNOPlayerCall>$$REQUESTID$$<RegisterEventHandler/></RNOPlayerCall>",d=this;WebSocketManager.send(e,this,function(g){var h=d._getResponseNode(g,"RegisterEventHandler_Response");if(h){var f=h.attributes;if(f.length>0&&f[0].name=="error"){if(f[0].value==0){WebSocketManager.addHandler("RNOPlayerCall_Notify",d,d.EventNotification);if(d.ccData&&d.ccData.length){d.InitClosedCaption()}else{d._requestPlay(d.playbackTime)}}else{d._handleError(f[0].value)}}}})},EventNotification:function(d){var g=0;try{if(d.nodeName=="RNOPlayerCall_Notify"){if(d.firstChild.nodeName=="PlaybackStateEvent"){var l=d.firstChild.childNodes;for(g=0;g<l.length;g++){if(l[g].nodeName=="PlaybackState"){log.write("Player.EventNotification(websocket version), playbackSate("+l[g].firstChild.nodeValue+")");this._playbackStateChanged(l[g].firstChild.nodeValue)}else{if(l[g].nodeName=="PlaybackTime"){var m=Number(l[g].firstChild.nodeValue);this._checkForReverseScanEnd(m);this.playbackTime=m;log.write("Player.EventNotification(websocket version), playbackTime("+this.playbackTime+")");OnCurrentPlayTime(this.playbackTime*1000)}else{if(l[g].nodeName=="PlaybackQualityLevels"){log.write("Player.EventNotification(websocket version), PlaybackQualityLevels("+l[g].firstChild.nodeValue+")");this.playbackQualityLevels=l[g].firstChild.nodeValue}else{if(l[g].nodeName=="PlaybackQualityLevel"){log.write("Player.EventNotification(websocket version), PlaybackQualityLevel("+l[g].firstChild.nodeValue+")");this.playbackQualityLevel=l[g].firstChild.nodeValue;this._getCurrentBitrate(Number(this.playbackQualityLevel))}else{if(l[g].nodeName=="PlaybackQualityType"){log.write("Player.EventNotification(websocket version), PlaybackQualityType("+l[g].firstChild.nodeValue+")");this.playbackQualityType=l[g].firstChild.nodeValue}else{if(l[g].nodeName=="PlaybackQualityRate"){log.write("Player.EventNotification(websocket version), PlaybackQualityRate("+l[g].firstChild.nodeValue+")");this.playbackQualityRate=l[g].firstChild.nodeValue}}}}}}}}else{if(d.firstChild.nodeName=="ClosedCaptionEvent"){OnPlaybackCCData(d.firstChild.childNodes)}else{if(d.firstChild.nodeName=="PlaybackStreamChange"){if(d.firstChild.firstElementChild.nodeName=="ClosedCaptionStreamAttributes"){var j=d.firstChild.firstElementChild.childNodes,h;if(j&&j.length){for(g=0;g<j.length;g++){if(j[g].nodeName==="StreamState"){h=j[g].firstChild.nodeValue;log.write("Player.EventNotification(websocket version), ClosedCaptionStream state: "+h);break}}}if(h==="Downloaded"||h==="Error"){if(!this.isPlay){this._requestPlay(this.playbackTime)}if(h==="Error"){OnUpdateCCState(false)}}}}else{if(d.firstChild.nodeName=="PlaybackEndOfStreamEvent"){log.write("Player.EventNotification(websocket version), end of stream!");OnRenderingComplete()}else{if(d.firstChild.nodeName=="PlaybackStutterStartEvent"){log.write("Player.EventNotification(websocket version), stutter start event!");this.isStutter=true;OnPlaybackStutterStart()}else{if(d.firstChild.nodeName=="PlaybackStutterStopEvent"){log.write("Player.EventNotification(websocket version), Stutter stop event!");this.isStutter=false;OnPlaybackStutterStop()}else{if(d.firstChild.nodeName=="PlaybackUnderflowEvent"){log.write("Player.EventNotification(websocket version), playback underflow!")}else{if(d.firstChild.nodeName=="PlaybackSeekEvent"){log.write("Player.EventNotification(websocket version), seek finished!")}else{if(d.firstChild.nodeName=="PlaybackErrorEvent"){var f=d.firstChild.firstChild.nodeValue;log.write("Player.EventNotification(websocket version), error("+f+") occured!");this._handleError(f)}}}}}}}}}}}catch(k){log.write("Player.EventNotification(websocket version): parsing notification error: "+k);throw (k)}},_getCurrentBitrate:function(d){var e=1;switch(d){case 1:e=this.isHD?1:0.7;break;case 2:e=this.isHD?2:1;break;case 3:e=this.isHD?4:1.5;break;case 4:e=this.isHD?8:2;break}this.bitrate=e*1000*1024},_playbackStateChanged:function(d){if(this.playbackState!=d){log.write("Player._playbackStateChanged(websocket version), state("+this.playbackState+" => "+d+")");switch(this.playbackState){case"Stopped":if(d=="Playing"){OnBufferingComplete()}break;case"Paused":if(d=="Playing"&&this.isStutter){this.isStutter=false;OnPlaybackStutterStop()}break;case"Scanning":if(d=="Playing"){this.playbackSpeed=1;OnScanToPlay()}break;default:break}this.playbackState=d}if(this.isSkipping&&d=="Playing"){this.isSkipping=false;OnPlaybackSkipChapterEnd()}},_checkForReverseScanEnd:function(e){var d=this;if(this.playbackState==="Scanning"&&this.playbackSpeed<1){if(this.playbackTime<=2&&this.playbackTime-e<=0){log.write("PlayerInternal._checkForReverseScanEnd: the beginning is reached, will go to normal play after 5s, current time: "+this.playbackTime);if(!this.scanWatchTimer){this.scanWatchTimer=setTimeout(function(){d.scanWatchTimer=null;if(d.playbackState==="Scanning"&&d.playbackSpeed<1&&d.playbackTime<=2&&!d.isStopping){log.write("PlayerInternal._checkForReverseScanEnd: go to normal play as it is stuck in scanning!");d._requestPlay(d.playbackTime);OnScanToPlay()}},5000)}}}},_handleError:function(e){log.write("Player._handleError(websocket version), error("+e+")");var g=0;if(e.charAt(0)==="-"){g=Number(e)}else{g=parseInt(e,16)}log.write("Player._handleError(websocket version), errorCode(0x"+g.toString(16)+")");g&=2147483647;var h=false;if(1310720<=g&&g<1376256){switch(g){case 1310721:case 1310722:application.events.publish("error",{type:"no_internet"});break;default:h=true;break}}else{if(1376256<=g&&g<1441792){var d=g-1376256,f=d-10000;log.write("Player._handleError(websocket version), SDKError("+d+"), playerError("+f+")");if(f==113){return}switch(f){case 463:case 2004:OnNetworkDisconnected();break;case 401:OnAuthenticationFailed();break;case 400:case 408:case 462:case 500:case 503:case 504:OnConnectionFailed();break;case 404:case 454:OnStreamNotFound();break;case 513:case 514:case 515:case 516:case 517:case 520:case 521:case 522:case 523:case 524:case 525:case 550:case 570:OnCustomEvent(f);break;case 2000:case 2001:case 2002:case 2003:break;default:h=true;break}}else{h=true}}if(h){log.write("Player._handleError(websocket version), unknown error("+e+"), call OnRenderError()");OnRenderError()}}};function WSRequest(){this.headers={};this.action="GET";this.url="";this.timeoutTimer=null;this.startTime=-1;this.endTime=-1;this.requestRunTime=-1;this.cacheKey=""}WSRequest.prototype.setTarget=function(e,d){this.action=e;this.url=d};WSRequest.prototype.addHeader=function(e,d){this.headers[e]=d};WSRequest.prototype.setTimeout=function(e,d){this.timeoutTimer=setTimeout(e,d)};WSRequest.prototype.setOnComplete=function(d){this.onCompleteCallback=d};WSRequest.prototype.setCacheKey=function(d){if(d){this.cacheKey=d}};WSRequest.prototype.abort=function(){log.write("WSRequest (WebSocket): abort");clearTimeout(this.timeoutTimer);this.timeoutTimer=null;this.onCompleteCallback=undefined};WSRequest.prototype.send=function(e){var d=this;var f='<RNOWebServiceCall>$$REQUESTID$$<HTTPCall url="'+this.url+'" method="'+this.action+'" cacheKey="'+this.cacheKey+'">';for(header in this.headers){f+='<Header field="'+header+'">'+this.headers[header]+"</Header>"}f+="<Body>"+e+"</Body></HTTPCall></RNOWebServiceCall>";this.startTime=new Date();WebSocketManager.send(f,this,function(j){d.endTime=new Date();d.requestRunTime=$cn.utilities.DateDiff(d.endTime,d.startTime);log.write("WSRequest (WebSocket) response ["+d.startTime+" - "+d.endTime+"] ["+d.requestRunTime+"ms]");clearTimeout(d.timeoutTimer);d.timeoutTimer=null;var m;try{m=XML.rootFromString(j).firstChild}catch(n){log.write("WSRequest (WebSocket): parsing error: "+n);throw (n)}var h=m.getElementsByTagName("HTTPCall_Response");if(h&&h.length){var l=h[0].attributes;for(var k=0;k<l.length;k++){var g=l[k];if(g.nodeName=="error"){d.error=new Number(g.nodeValue);if(d.error!=0){log.write("WSRequest (WebSocket) HTTPCall_Response self.error set to non-zero: "+d.error)}else{}}else{if(g.nodeName=="statusCode"){d.status=new Number(g.nodeValue)}else{if(g.nodeName=="reasonPhrase"){d.statusText=g.nodeValue}}}}d.responseText=j.substring(j.indexOf("<Body>")+6,j.indexOf("</Body>"));d.responseText=d.responseText.split("&quot;").join('"').split("&apos;").join("'").split("&gt;").join(">").split("&lt;").join("<").split("&amp;").join("&");if(configuration.readValue("PreferredDRMProvider")!="DIVX"&&(!d.responseText||!d.responseText.length||(d.responseText.indexOf('"responseCode":')<0&&d.responseText.indexOf('"result":')<0))){log.write("WSRequest (WebSocket): no result or responseCode member in responseText, forcing to system error status");log.write("WSRequest (WebSocket) response: "+j);if(d.error&&d.error==80140001){d.status=502}else{d.status=500}}}else{log.write("WSRequest (WebSocket): no HTTPCall_Response node?");XML.dumpDOM(m);var h=m.getElementsByTagName("SocketError");if(h&&h.length){log.write("WSRequest (WebSocket): SOCKET ERROR");d.status=2013}else{d.status=500}}if(d.onCompleteCallback){d.onCompleteCallback.call(d)}})};WSRequest.prototype.clearContentCache=function(d){WebSocketManager.clearContentCache(d)};var Notifications={callbacks:[],initialized:false,initialize:function(){var d=this;if("WebSocketManager" in window){WebSocketManager.addHandler("Notification",this,function(f){log.write("Notifications: websocketmanager notice: dom: "+XML.toString(f));for(var h=0;h<d.callbacks.length;h++){var e=d.callbacks[h];log.write("Notifications: websocketmanager notice: cb object token: "+e.token);var g=f.getElementsByTagName(e.token);if(g.length==1){log.write("Notifications: websocketmanager notice: sending token node ["+e.token+"] to handler");e.callback.call(e.context,g[0])}}});this.initialized=true}},registerCallback:function(e,d,f){if(!this.initialized){this.initialize();if(!this.initialized){return}}log.write("Notifications.registerCallback: token: "+e);this.callbacks.push({token:e,context:d,callback:f})},sendNotification:function(e){if("WebSocketManager" in window){var d="<RNONotificationCall>$$REQUESTID$$<Notification>"+e+"</Notification></RNONotificationCall>";WebSocketManager.send(d,this,function(f){log.write("Notifications.sendNotification: response: "+f)})}}};configuration.credentialsPath="";configuration.credentials_values={};configuration.credentials_saved_config_values={};configuration.credentials_loaded=false;configuration._getPathElements=function(){var e=this.credentialsPath.split("\\").join("/").split("/");for(var d=0;d<e.length;d++){while(e[d]==""&&d<e.length){e.splice(d,1)}}return e};configuration._parseCredentialCodes=function(h,g){var f=h.split("_");if(f.length!=2){log.write("Configuration Base: _parseCredentialCodes: No _ found in second to last element!");return null}var e=new Number(f[0]);var j=new String(f[1]);if(isNaN(e)){log.write("Configuration Base: _parseCredentialCodes: CID: "+e+"   RID: "+j+"   One is not a number, so erroring");return null}var d="";if(g){d=g.slice(0,g.indexOf("configuration"))}return{cid:e,rid:j,theme:d}};configuration.getCredentialsCountryID=function(){if(this.credentialsPath!=undefined&&this.credentialsPath!=""){var e=this._getPathElements();var d=this._parseCredentialCodes(e[e.length-2]);if(d){return d.cid}else{return -1}}else{log.write("Configuration Base: getCredentialsCountryID: no credentialsPath set");return -1}};configuration.changeCredentials=function(k,g){var j=true;if(this.credentialsPath!=undefined&&this.credentialsPath!=""){var h=this._getPathElements();if(h){var e=this._parseCredentialCodes(h[h.length-2]);if(e){if(!k){k=e.cid}if(!g){g=e.rid}if(e.cid!=k||e.rid!=g){log.write("Configuration Base: changeCredentials: from: "+this.credentialsPath);var d=k.toString()+"_";d+=g.toString();h[h.length-2]=d;var f=h.join("/");log.write("Configuration Base: changeCredentials: to: "+f);if(this.checkCredentialsFile(f)){this.credentialsPath=f;this.loadCredentialsFile()}else{j=false;log.write("Configuration Base: changeCredentials: Could not load new credentials file ("+f+")")}}}}}return j};configuration.checkCredentialsFile=function(h){log.write("Configuration Base: checkCredentialsFile: "+h);try{var f=XML.rootFromFileSync(h);if(f){var d=f.getElementsByTagName("Value");var g=d[0].attributes.getNamedItem("Key").nodeValue;if(g=="XMLVersion"){var k=new Number($cn.utilities.getNodeText(d[0]));if(!isNaN(k)&&k>=2){log.write("Configuration Base: checkCredentialsFile: Success.");return true}}}}catch(j){log.write("Configuration Base: checkCredentialsFile: load exception! "+j)}log.write("Configuration Base: checkCredentialsFile: failed!");return false};configuration.loadCredentialsFile=function(){if(this.credentialsPath!=undefined&&this.credentialsPath!=""){log.write("Configuration Base: loading credential file: "+this.credentialsPath);var e=XML.rootFromFileSync(this.credentialsPath);if(e){var d=e.getElementsByTagName("Value");for(var g=0;g<d.length;g++){var f=d[g].attributes.getNamedItem("Key").nodeValue;var h=$cn.utilities.getNodeText(d[g]);if(!isNaN(new Number(h))){h=new Number(h)}else{if(h.toLowerCase()==="true"||h.toLowerCase()==="false"){h=((h.toLowerCase()==="true")?true:false)}}if(g==0){if(f=="XMLVersion"&&h>=2){log.write("Credential file in spec (version "+h+")");if(this.credentials_loaded){for(oldkey in this.credentials_saved_config_values){log.write("Configuration base: restoring prior $cn.config["+oldkey+"] from: "+$cn.config[oldkey]+", to be: "+this.credentials_saved_config_values[oldkey]);$cn.config[oldkey]=this.credentials_saved_config_values[oldkey]}this.credentials_saved_config_values={};this.credentials_values={}}this.credentials_loaded=true;continue}else{log.write("credential file not in spec");break;throw (-1)}}this.credentials_values[f]=h;if($cn.config[f]&&($cn.config[f]!=h)){log.write("Configuration Base: overwriting $cn.config["+f+"] from: "+$cn.config[f]+", to be: "+h);this.credentials_saved_config_values[f]=$cn.config[f];$cn.config[f]=h}}}}};configuration.loadConfigFile=function(e){log.write("Configuration Base: Loading config file: "+e);var f=XML.rootFromFileSync(e);if(f){var d=f.childNodes[0].childNodes;for(var g=0;g<d.length;g++){if(d[g].nodeName.toLowerCase()=="ver"&&(this.version==""||this.version==undefined)){this.version=$cn.utilities.getNodeText(d[g])}else{if(d[g].nodeName.toLowerCase()=="build"&&(this.build==""||this.build==undefined)){this.build=$cn.utilities.getNodeText(d[g])}}}}};configuration.setCredentialsFile=function(d){if(d){configuration.credentialsPath=d}};configuration.getPrefixedSettingKey=function(d){return configuration.getCredentialsCountryID()+"_"+d};var navigation={buildNavigation:function(h){h.sort(navigation.sortElemByY);var g=[],j=-1,d=0,l=-1,e=0,k,f;h.each(function(m){if(m.offsetHeight){if(m.offsetTop>l){l=m.offsetTop+m.offsetHeight;g[++j]=[]}g[j].push(m)}});g.each(function(m){m.sort(navigation.sortElemByX);for(e=m.length-2;e>=1;--e){m[e].setProperties({left:m[e].hasAttribute("left")?m[e].getAttribute("left"):m[e-1].id,right:m[e].hasAttribute("right")?m[e].getAttribute("right"):m[e+1].id})}if(m.length>1){m[0].setProperty("right",m[1].id);m[m.length-1].setProperty("left",m[m.length-2].id)}});for(j=0;j<g.length;++j){k=g[j-1];f=g[j+1];g[j].each(function(m){if(k){for(d=0;d<k.length;++d){if(m.intersects(k[d])&&(!m.hasAttribute("up")||m.hasAttribute("data-builtUp"))){log.write(m.id+" BUILT UP");m.setProperty("up",k[d].id);m.setProperty("data-builtUp","true")}}}if(f){for(d=0;d<f.length;++d){if(m.intersects(f[d])&&(!m.hasAttribute("down")||m.hasAttribute("data-builtDown"))){log.write(m.id+" BUILT Down");m.setProperty("down",f[d].id);m.setProperty("data-builtDown","true")}}}})}log.write("buildNavigation - exit")},setFirstFocusableElement:function(){log.write("No element has focus yet. Try to set initial focus.");application.element.buildPositions();application.currentView.controls.sort(this.sortByX);if(application.currentView.controls[0]&&application.currentView.controls[0].elemid){application.element.current=application.currentView.controls[0].elemid;var d=$(application.element.current);log.write("Current focused element is: "+application.currentView.controls[0].elemid);if(typeof d.setFocus=="function"){if(pointer.isPointerModeActive()){pointer.lastFocusId=application.currentView.controls[0].elemid;this.setFocus(null)}else{d.setFocus({});d.addClass("hover")}}else{log.write("ERROR: first element on this view has a focusable attribute")}}else{log.write(application.currentView.controls)}},up:function(j){log.write("Navigate Up");if((application.element.current==null||application.element.current=="")||(application.element.current!=""&&!document.getElementById(application.element.current))){this.setFirstFocusableElement()}var l=null,h=$(application.element.current).attributes.up,g=[],f=null,e=null,d=0,k=0;if(h!=null){l=$(h.value)}if(!l){f=$(application.element.current).getPosition();application.element.buildPositions();application.currentView.controls.sort(this.sortByYDesc);for(d=0;d<application.currentView.controls.length;d++){if(this.isVisible(application.currentView.controls[d])){if(application.currentView.controls[d].x==f.x){if(f.y-4>application.currentView.controls[d].y){e=$(application.currentView.controls[d].elemid);g[g.length]=application.currentView.controls[d];l=e;break}}}}if(!l){g.sort(this.sortByXDesc);for(k=0;k<g.length;k++){e=$(g[k].elemid);if(typeof e.setFocus=="function"){l=e;break}}}}if(l){this.setFocusElement(l)}},down:function(l){log.write("Navigate Down");if((application.element.current==null||application.element.current=="")||(application.element.current!=""&&!document.getElementById(application.element.current))){application.setFirstFocusableElement()}var h=null,d=$(application.element.current).attributes.down,f=[],g=null,m=null,e=null,k=0,j=0;if(d!=null){h=$(d.value)}if(!h){g=$(application.element.current).getPosition();m=$(application.element.current).getSize();application.element.buildPositions();application.currentView.controls.sort(this.sortByY);for(k=0;k<application.currentView.controls.length;k++){if(this.isVisible(application.currentView.controls[k])){if(application.currentView.controls[k].y+5>=(g.y+m.y)){f[f.length]=application.currentView.controls[k];if(application.currentView.controls[k].x==g.x){e=$(application.currentView.controls[k].elemid);h=e;break}}}}if(!h){f.sort(this.sortByX);for(j=0;j<f.length;j++){e=$(f[j].elemid);h=e;break}}}if(h){this.setFocusElement(h)}},right:function(l){log.write("Navigate Right");if((application.element.current==null||application.element.current=="")||(application.element.current!=""&&!document.getElementById(application.element.current))){application.setFirstFocusableElement()}var h=null,d=$(application.element.current).attributes.right,f=[],g=null,m=null,e=null,k=0,j=0;if(d!=null){h=$(d.value)}if(!h){g=$(application.element.current).getPosition();m=$(application.element.current).getSize();application.element.buildPositions();application.currentView.controls.sort(this.sortByX);for(k=0;k<application.currentView.controls.length;k++){if(this.isVisible(application.currentView.controls[k])){if(application.currentView.controls[k].x>=(g.x+m.x)){f[f.length]=application.currentView.controls[k];if(application.currentView.controls[k].y>g.y-3&&application.currentView.controls[k].y<g.y+3){if(application.currentView.controls[k].x-(g.x+m.x)<200){e=$(application.currentView.controls[k].elemid);h=e;log.write("Focused element: "+h.id);break}}}}}if(!h){for(j=0;j<f.length;j++){e=$(f[j].elemid);h=e;log.write("Focused element: "+h.id);break}}}if(h){this.setFocusElement(h)}},left:function(l){log.write("Navigate Left");if((application.element.current==null||application.element.current=="")||(application.element.current!=""&&!document.getElementById(application.element.current))){application.setFirstFocusableElement()}var h=null,d=$(application.element.current).attributes.left,f=[],g=null,m=null,e=null,k=0,j=0;if(d!=null){h=$(d.value)}if(!h){g=$(application.element.current).getPosition();m=$(application.element.current).getSize();application.element.buildPositions();application.currentView.controls.sort(this.sortByXDesc);for(k=0;k<application.currentView.controls.length;k++){if(this.isVisible(application.currentView.controls[k])){if(application.currentView.controls[k].x<g.x){f[f.length]=application.currentView.controls[k];if(application.currentView.controls[k].y>g.y-3&&application.currentView.controls[k].y<g.y+3){e=$(application.currentView.controls[k].elemid);h=e;break}}}}if(!h){for(j=0;j<f.length;j++){e=$(f[j].elemid);h=e;break}}}if(h){this.setFocusElement(h)}},setFocus:function(e,d){this.setFocusElement($(e),d)},setFocusElement:function(focusedElement,isDefaultFocus){if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){var elem=$(application.element.current);if(elem.get("blur")){eval("("+elem.get("blur")+")")}application.events.publish("elementblur",{bluredelem:application.element.current,nextFocus:focusedElement});elem.removeClass("hover");log.write("Lose Focus: "+application.element.current)}application.element.current=(focusedElement)?focusedElement.id:null;if(focusedElement){if(pointer.isPointerModeActive()&&isDefaultFocus){pointer.lastFocusId=application.element.current||pointer.lastFocusId;log.write("Set Defualt Focus: "+pointer.lastFocusId)}else{var elem=$(application.element.current);if(elem.get("focus")){eval("("+elem.get("focus")+")")}application.events.publish("elementfocus",{focusedelem:application.element.current});elem.addClass("hover");log.write("Get Focus: "+application.element.current)}}},isVisible:function(d){var f=$(d.elemid);if(f&&f.offsetWidth){return this.isInBounds(d)}return false},isInBounds:function(e){var d=true;if(e.x<0||e.x>960||e.y<0||e.y>540||$(e.elemid).getStyle("display")=="none"){d=false}return d},sortByX:function(f,e){var d=f.x,g=e.x;return((d<g)?-1:((d>g)?1:0))},sortByXDesc:function(f,e){var d=f.x,g=e.x;return((d>g)?-1:((d<g)?1:0))},sortByY:function(f,e){var d=f.y,g=e.y;return((d<g)?-1:((d>g)?1:0))},sortByYDesc:function(f,e){var d=f.y,g=e.y;return((d>g)?-1:((d<g)?1:0))},sortElemByX:function(f,e){var d=f.offsetLeft,g=e.offsetLeft;return((d<g)?-1:((d>g)?1:0))},sortElemByY:function(f,e){var d=f.offsetTop,g=e.offsetTop;return((d<g)?-1:((d>g)?1:0))}};$cn.data.mockUserAccount="";$cn.data.mockUserAccountState="";$cn.data.RuntimeId=Math.round(new Date().getTime()/1000);$cn.data.ApiUrl="";$cn.data.Navigation=null;$cn.data.History={};$cn.data.BonusAssetCache={};$cn.data.StreamAssetCache={};$cn.data.TitlesByGenre={};$cn.data.Merch={};$cn.data.TitlesByGenrePages={};$cn.data.TitlesByCast={};$cn.data.TitlesBySimilar={};$cn.data.TitlesAudioProfiles={};$cn.data.PurchaseAudioProfiles={};$cn.data.TitleCache={};$cn.data.TitleSummaryCache={};$cn.data.TitleDetailCache={};$cn.data.TitleCastDetailCache={};$cn.data.TitleCastBiosCache={};$cn.data.TitleCastBioCache={};$cn.data.TitleCreditsCache={};$cn.data.TitleImagesCache={};$cn.data.TitleReviewsCache={};$cn.data.TitleRecommendations={};$cn.data.TitleTechnicalDetailsCache={};$cn.data.d2dTitleInfo={};$cn.data.d2dTitleOffers={};$cn.data.d2dPath=false;$cn.data.EpisodeCache={};$cn.data.EpisodeListCache={};$cn.data.purchTypeFilter="any";$cn.data.PassCache={};$cn.data.isPassUVCache={};$cn.data.SearchResults={};$cn.data.AuthToken="";$cn.data.CurrentRegion="";$cn.data.SoftwareVersion="";$cn.data.DeviceName="";$cn.data.UserEmailAddress="";$cn.data.EnableAdult="";$cn.data.ContentIsFiltered=false;$cn.data.EnableTv=false;$cn.data.EnableSite=false;$cn.data.EnableMerchPage=false;$cn.data.DeviceID="";$cn.data.PendingWishlistItem="";$cn.data.MyVideos=[];$cn.data.lastViewed=null;$cn.data.lastBrowsed=null;$cn.data.speedchecked=false;$cn.data.freshPurchase=false;$cn.data.brokenImages={};$cn.data.masterWheel={};$cn.data.slaveWheel={};$cn.data.getBundleListing={};$cn.data.TitlePersonCache={};$cn.data.TitleSearchCache={};$cn.data.EulaText="";$cn.data.SessionId="";$cn.data.IsParent=false;$cn.data.isConnected=true;$cn.data.completedSpeedTest=false;$cn.data.InitialLoad=true;$cn.data.CurrentPromotion="";$cn.data.CurrentSku="";$cn.data.ImageLoadTest="";$cn.data.PurchasePinEnabled=false;$cn.data.ParentalControlsConfigured=false;$cn.data.ParentPinEnabledOnStartup=false;$cn.data.ParentPinEnabled=false;$cn.data.AdultPinEnabled=false;$cn.data.LastCacheLoadTimeUTC=null;$cn.data.ShouldUpdateCache=false;$cn.data.CountryID=-1;$cn.data.SelectedCountryID=-1;$cn.data.Region="";$cn.data.RegionCheckEnabled=true;$cn.data.AllowedRegions=[];$cn.data.ActivationURL="";$cn.data.DisplayEula=false;$cn.data.ShouldEnableTvNode=false;$cn.data.LastBandwidthCheck=null;$cn.data.LastBandwidthSpeed=0;$cn.data.BandwithCheckURL="";$cn.data.BandwithCheckURLSize=0;$cn.data.AuthTokenActive=false;$cn.data.SystemOffline=false;$cn.data.SystemUnavailableMessage="";$cn.data.SessionLimitRows=-1;$cn.data.SessionLimitMinutes=-1;$cn.data.AllowAdult=false;$cn.data.AllowPlayboy=false;$cn.data.AffId="Not Set";$cn.data.EnableAccountLink=false;$cn.data.AccountLinkUrl="";$cn.data.RootMoodGenreID="";$cn.data.TVRootMoodGenreID="";$cn.data.RecomendedGenreIds="";$cn.data.LibraryWheelItems={};$cn.data.LibraryWheelItemsLastLoaded=new Date();$cn.data.LoadTitleID="";$cn.data.libraryMasterWheel=[{iD:"0",name:"Movies",ptype:10954,ttype:"Movies",status:"Undefined"},{iD:"1",name:"Movie Rentals",ptype:10954,ttype:"Movie_Rentals",status:"Undefined"},{iD:"2",name:"HD Movies",ptype:10954,ttype:"HD_Movies",status:"Undefined"},{iD:"3",name:"HD TV Shows",ptype:11062,ttype:"HD_TV_Shows",status:"Undefined"},{iD:"4",name:"TV Shows",ptype:11062,ttype:"TV_Shows",status:"Undefined"},{iD:"5",name:"My UltraViolet",ptype:10954,ttype:"UV_Movies",status:"Undefined"},{iD:"6",name:"Disc to Digital",ptype:10954,ttype:"D2D_Movies",status:"Undefined"}];$cn.data.librarySlaveWheel="";$cn.data.jinniEnable=false;$cn.data.flixsterEnable=false;$cn.data.baselineEnable=false;$cn.data.recommendedGenres=[];$cn.data.FirmwareVersion="Not Set";$cn.data.PreferredAudioType="";$cn.data.PreferredAudioTypeSet=false;$cn.data.AllowedAudioProfiles=[];$cn.data.DTS51Enable=false;$cn.data.Dolby51Enable=false;$cn.data.DTSStereoEnable=false;$cn.data.DolbyStereoEnable=false;$cn.data.ShowWelcomeScreen=true;$cn.data.sysTestResults=[];$cn.data.UVTermsText="";$cn.data.UVTermsAcceptance=null;$cn.data.uvLinkingAccount={Status:{active:"Active",deleted:"Deleted",forceDelete:"ForceDelete",suspended:"Suspended",blocked:"Blocked",blockedTOU:"BlockedTOU",blockedCLG:"BlockedCLG",pending:"Pending",archived:"Archived",other:"Other"}};$cn.data.uvLinkStatus={linkState:{notAvailable:"AcctNotAvailable",unlinking:"Unlinking",pending:"Pending",linked:"Linked"}};$cn.data.CCTextColor="auto";$cn.data.CCTextOpacity="auto";$cn.data.CCTextSize="auto";$cn.data.CCFont="auto";$cn.data.CCBackgroundColor="auto";$cn.data.CCBackgroundOpacity="auto";$cn.data.CCTextEdge="auto";$cn.data.CCWindowColor="auto";$cn.data.CCWindowOpacity="auto";$cn.data.CCLanguage="auto";var ui={_rootLayout:null,_controlCollection:[],_viewCollection:[],_styleCollection:[],_tplCollection:[],sprite:null,spriteCustom:null,spriteVideo:null,spriteVideoBlue:null,wasInitialized:false,init:function(d,f){var e=this;log.write("=== initializing ui ===");log.write("cancelReady is: "+f);e.wasInitialized=true;XML.rootFromFile("theme/"+$cn.config.CurrentTheme+"/template.xml",function(g){updateSplash(95);currPerc=(currPerc<95?95:currPerc);e._rootLayout=g;e.initUI();if(f){d();return}e.sprite=new Image();e.sprite.onload=function(){e.spriteVideo=new Image();e.spriteVideo.onload=function(){log.write("Player sprite loaded.");e.spriteCustom=new Image();e.spriteCustom.onload=function(){e.spriteButtons=new Image();e.spriteButtons.onload=function(){e.spriteBackgrounds=new Image();e.spriteBackgrounds.onload=function(){currPerc=100;setTimeout(function(){updateSplash(100)},400);log.write("Extras sprite loaded.");application.loadView(BrowseView);log.write("Publish ready event.");application.events.publish("ready");if(d){d.call(this)}};e.spriteBackgrounds.src="theme/"+$cn.config.CurrentTheme+"/Orbit960_backgrounds.png"};e.spriteButtons.src="theme/"+$cn.config.CurrentTheme+"/Orbit960_buttons.png"};e.spriteCustom.src="theme/"+$cn.config.CurrentTheme+"/Orbit960_extras.png";e.spriteCustom.onerror=function(h){log.write(h)}};e.spriteVideo.src="theme/"+$cn.config.CurrentTheme+"/Orbit960RedVideo.png"};e.sprite.src="theme/"+$cn.config.CurrentTheme+"/Orbit960.png";e.sprite.onerror=function(h){log.write(h)}})},initUI:function(){var k,j,h;if(!$cn.config.PrecompiledApplication){var m=this._rootLayout.childNodes[0].childNodes;var f=null;for(k=0;k<m.length;k++){if(m[k].nodeName.toLowerCase()=="views"||m[k].nodeName.toLowerCase()=="controls"){var n=m[k].childNodes;for(j=0;j<n.length;j++){if(n[j].nodeName.toLowerCase()=="view"||n[j].nodeName.toLowerCase()=="control"){var l=(n[j].nodeName.toLowerCase()=="control")?"control":"";var d=n[j].childNodes;for(h=0;h<d.length;h++){if(d[h].nodeName.toLowerCase()=="layout"){var e=XML.nodeToHash(d[h]);var g=XML.hashToElement(e,"div");if(n[j].nodeName.toLowerCase()=="control"){this._controlCollection[n[j].attributes.id.nodeValue.toLowerCase()]=g}else{this._viewCollection[n[j].attributes.id.nodeValue.toLowerCase()]=g}}}}}}}}},destroyLayout:function(){if(!$cn.config.PrecompiledApplication){var d=document.getElementById("uicontainer");d.parentNode.removeChild(d);var e=document.createElement("div");e.setAttribute("id","uicontainer");document.getElementById("detention").appendChild(e)}},loadLayout:function(e){var k,q,d,l,n,m;if(!$cn.config.PrecompiledApplication){if(this._viewCollection[e.toLowerCase()]){k=this._viewCollection[e.toLowerCase()];k.setAttribute("id",e.toLowerCase());application.putInnerHTML("uicontainer","");q=document.getElementById("uicontainer");d=q.parentNode;d.removeChild(q);l=document.createElement("div");l.setAttribute("id","uicontainer");l.appendChild(k);d.appendChild(l)}n=$("uicontainer").getElements("control");for(m=0;m<n.length;m++){var h=this._controlCollection[n[m].id.toLowerCase()];if(h){h.setAttribute("id",n[m].id.toLowerCase());var l=document.getElementById(n[m].id.toLowerCase());l.parentNode.replaceChild(h,l)}}var j=$("uicontainer").getElements("tpl");this._tplCollection=[];for(m=0;m<j.length;m++){var f=new Element("div");f.set("id",j[m].getFirst().get("id"));f.set("class",j[m].getFirst().get("class"));j[m].getFirst().inject(f);var g=f.get("html");this._tplCollection[j[m].get("id").toLowerCase()]=f.get("html")}j.destroy()}},loadTpl:function(d){return String(this._tplCollection[d])}};ui.template=function(h,f){var g=this,d=arguments,j=null,e=[];this.re=/\{([\w-]+)\}/g,this.refunction=/\@@([^@]+)\@@/g,this.refunctioninput=/\##([^#]*)\##/g,g.html=f;g.elemid=h;if(g.compiled){g.compile()}};ui.template.prototype={applyTemplate:function(d){var e=this;return e.compiled?e.compiled(d):e.html.replace(e.re,function(f,g){return d[g]!==undefined?d[g]:""}).replace(e.refunction,function(f,g){return d[g]!==undefined?d[g]:""})},set:function(d,f){var e=this;e.html=d;e.compiled=null;return f?e.compile():e},compile:function(){var me=this,sep=",";function fn(m,name){name="values['"+name+"']";return"'"+sep+"("+name+" == undefined ? '' : "+name+")"+sep+"'"}function fninput(i){var x=i.replace(/"/g,'\\"').replace(/####/g,"").replace(/##/g,"").replace(/'/g,"\\'");return x}function fnscript(m,name){var html="";var input=name.replace(/&quot;/g,'"');try{html=eval("("+input+")")}catch(e){log.write(e);log.write(input);log.write(name)}return html}eval("this.compiled = function(values){  var html = ['"+me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace("%7B","{").replace("%7D","}").replace("%28","(").replace("%29",")").replace(this.re,fn)+"'].join('');   html = html.replace(this.refunctioninput, fninput).replace(this.refunction, fnscript); return html;};");return me},prepend:function(d){var g=document.getElementById(this.elemid).childNodes;var f=this.applyTemplate(d);var e=f.toElement();if(e){if(g.length>0){document.getElementById(this.elemid).insertBefore(e,document.getElementById(this.elemid).childNodes[0]);if(e.getElement("a")){application.currentView.layoutIsDirty=true}}else{this.append(d)}}else{log.write("Cannot append el: "+el+" to tpl. TPL does not exist.")}},insertAt:function(f,e){var j=document.getElementById(this.elemid).childNodes,h=this.applyTemplate(f),g=h.toElement(),d;if(g){for(d=0;d<j.length;d++){if(e==d){document.getElementById(this.elemid).insertBefore(g,document.getElementById(this.elemid).childNodes[d]);if(g.getElement("a")){application.currentView.layoutIsDirty=true}break}}}else{log.write("Cannot append el: "+el+" to tpl. TPL does not exist.")}},empty:function(){var d=$(this.elemid);if(d){if(application.element.current!=null&&document.getElementById(application.element.current)&&d.isParentOf($(application.element.current))){navigation.setFocusElement(null)}if(d&&d.getElement("a")){application.currentView.layoutIsDirty=true}application.putInnerHTML(document.getElementById(this.elemid),"")}},emptyAndAppend:function(d){var f=this.applyTemplate(d);var e=f.toElement();if(e){document.getElementById(this.elemid).innerHTML=f;if(e.getElement("a")){application.currentView.layoutIsDirty=true}}else{log.write("Cannot append el: "+e+" to tpl. TPL does not exist.")}},append:function(d){var f=this.applyTemplate(d);var e=f.toElement();if(e){if(document.getElementById(this.elemid)){document.getElementById(this.elemid).appendChild(e);if(e.getElement("a")){application.currentView.layoutIsDirty=true}}}else{log.write("Cannot append el: "+e+" to tpl. TPL does not exist.")}},apply:function(){if(document.getElementById(this.elemid)){application.element.bindActions(this.elemid,true);var h=$(this.elemid).getElements(".ellipsis");for(var g=0;g<h.length;++g){var f=h[g];var d=f.offsetHeight;var e=f.style.height;log.write("Ellipsis element: ");log.write(f);f.setStyle("height","auto");f.addClass("hid");log.write("height: "+d+" : "+f.offsetHeight);if(f.offsetHeight>d){application.putInnerHTML(f,$cn.utilities.truncateText(f,f.innerHTML,d,0,f.innerHTML.length))}else{f.style.height=e}f.removeClass("hid")}}}};var log={write:function(f){var d,e="alert() : ";application.remotelog+=String(f)+"\n";if($cn.config.Debug){d=$cn.data.RuntimeId+" ROVI "+$cn.config.CurrentTheme+" : "+f;try{if(device.logToDisplay){alert(d);this.debug(f)}else{console.log(e+d)}}catch(g){alert("Caught")}}},debug:function(d){if($cn.config.Debug){if($("debugger").getStyle("display")=="block"){$("debugger").innerHTML=d+"<br />"+$("debugger").innerHTML}}},session:{_doc:"",lastSync:null,sessionLimitMinutes:null,sessionLimitRows:5,currentRows:0,checkinTimer:new Timer(),addActivity:function(e,d){device.addLogSessionActivity(this,e,d)},sync:function(d){if(d.length<3024){webservices.makeLogRequest(d,this,function(f){application.remotelog=""})}else{var e=d.substring(0,3024);webservices.makeLogRequest(e,this,function(f){application.remotelog=d.substring(3024,d.length);log.session.sync(application.remotelog)})}},upload:function(){device.uploadLogSession()}},dump:function(n,C,f){var m=null,B=$type(n),g=["array","object"];var D,u,j=[];var r=($type(f)=="number")?(f?true:false):(($type(f)=="boolean")?f:true),q=$empty(C)?2:C,k=3,h=($type(f)=="boolean")?1:(f||1);var p=",",v=" => ",s=r?"\n":"",e={pre:(r?(" ".repeat(k*h)):""),post:(r?(" ".repeat(k*(h-1))):"")},l={pre:((B=="array")?"[":"{"),post:((B=="array")?"]":"}")},d={"function":"function(){...}",array:"[...]",object:"{...}"};var w=function(F,E){switch(E){case"function":F=F.toString();return F.substring(0,(F.indexOf(")")+1))+" {...}"}return F};switch(B){case false:return B;case"date":case"element":case"regexp":return n}if(g.indexOf(B)!=-1){j.push(l.pre+s);for(D in n){try{u=n[D];m=$type(u);j.push(e.pre+D+v);if(g.indexOf(m)!=-1){if(q>1){j.push(log.dump(u,(q-1),(r?(h+1):r)))}else{j.push(d[m])}}else{j.push(w(u,m))}j.push(p+s)}catch(A){}}if(j.length>1){j.pop()}j.push(s+e.post+l.post)}else{j.push(w(n,B))}return j.join("")},dumpObj:function(d,l){var k="";if(!l){l=0}var h="";for(var e=0;e<l+1;e++){h+="    "}if(typeof(d)=="object"){for(var f in d){var g=d[f];if(typeof(g)=="object"){k+=h+"'"+f+"' ... "}else{k+=h+"'"+f+"' => \""+g+", "}}}else{k="===>"+d+"<===("+typeof(d)+")"}return k},getStackTrace:function(){try{intentionally.causing.an.exception.to.occur()}catch(f){var d=f.stack.trim().split("\n");d.shift();return d}},repeat:function(e){var f="";for(var d=0;d<e;d++){f+=this}return f}};var element={_spatial:[],current:null,registeredControls:[],buildPositions:function(){if(application.currentView.layoutIsDirty){log.write("Building screen positions of elements");delete application.currentView.controls;application.currentView.controls=[];var e=$(application.currentView.id).getElements("a"),f=null,d=null;x;for(x=0;x<e.length;x++){d=e[x];if(d){f=d.getPosition();if(d.offsetWidth){application.currentView.controls[application.currentView.controls.length]={elemid:d.id,x:f.x,y:f.y}}}}application.currentView.layoutIsDirty=false;e=null;f=null;d=null}},bindActions:function(f,g){log.write(f);if(document.getElementById(f)){var e=document.getElementById(f).getElementsByTagName("a");for(var d=0;d<e.length;d++){if(!e[d].id){e[d].id=application.utility.generate.id(e[d])}}}},registerControl:function(d){this.registeredControls.push(d)}};var application={DEBUG:false,_methodMap:{},_views:{},id:"application",currentView:null,keys:null,navigator:navigation,utility:utility,ui:ui,playbackSupported:false,authSupported:false,element:element,apiUrl:"",endPointServer:"",isBusy:false,isLoaded:false,isConnected:true,DataDirectory:"",EndPoints:{},Environments:[],CurrentEnvironment:"",LastKeyDown:new Date(),RepeatKeyBlock:false,RepeatKeyBlockDuration:300,TempKeyBlock:false,TempKeyBlockDuration:1000,TempKeyBlockEnter:false,firmwareIsValid:true,request:$get(),regionError:null,debugMode:false,doNotRestoreSettings:false,remotelog:"",blockWidgetAccess:false,cachedUserAgent:null,appSetting:function(d){var e=-1;if($cn.config){if(d in $cn.config){e=$cn.config[d]}}return e},setupApiKeys:function(f){log.write("setupApiKeys: called with cid of "+f);if(!f){f=$UrlQueryString.CountryID||$cn.config.DefaultSelectedCountry}var d=configuration.getCredentialsCountryID();log.write("setupApiKeys: credentials country id: "+d);if(d===-1){application.ApplicationError={type:application.resource.system_messages.application_error.MessageType,Message:application.resource.system_messages.application_error.Message,Close:application.resource.system_messages.application_error.Close,callback:function(){application.exit()}}}if(d!=f){log.write("setupApiKeys: attempt load of alternate credentials");var e=configuration.changeCredentials(f);if(!e){configuration.changeCredentials($UrlQueryString.CountryID||$cn.config.DefaultSelectedCountry)}}log.write("setupApiKeys: CID "+f+" credentials loaded.");webservices.apiKey=configuration.readValue("APIKey");webservices.destType=configuration.readValue("DestinationTypeID");log.write("setupApiKeys: APIKey: ["+webservices.apiKey+"]  DesinationTypeID: ["+webservices.destType+"]")},init:function(){var l,e,m,h,d,n=this,k;log.write("application.init: Enter");this.keys=new Common.API.TVKeyValue();$cn.data.partnerOfferID=this.request.partnerOfferID||"";$cn.data.partnerOfferAction=this.request.partnerOfferAction||"";log.write("parentOfferID: "+$cn.data.partnerOfferID+", partnerOfferAction: "+$cn.data.partnerOfferAction);this.exception.categories["browse-view"]="store_messages";this.exception.categories["search-view"]="system_messages";this.exception.categories["wishlist-view"]="system_messages";this.exception.categories["library-view"]="system_messages";this.exception.categories["settings-view"]="system_messages";this.exception.categories.titleview="system_messages";this.exception.categories["help-view"]="system_messages";this.exception.categories["player-view"]="player_messages";this.exception.categories["checkout-view"]="checkout_messages";$cn.data.SoftwareVersion=configuration.readValue("version");if($cn.config.OnScreenDebugLog){$("debugger").show()}device.initPlayer();if(application.authSupported){var p=null;var g=null;if(configuration.readValue("RegionCheckEnabled")==false){$cn.data.RegionCheckEnabled=false}p=configuration.readValue(configuration.getPrefixedSettingKey("auth"));if(p!==null){$cn.data.SelectedCountryID=configuration.readValue("SelectedCountryID")}else{$cn.data.SelectedCountryID=configuration.readValue("LastCountryID")}application.setupApiKeys($cn.data.SelectedCountryID);if(!$cn.data.RegionCheckEnabled){application.setupApiKeys($UrlQueryString.CountryID||$cn.config.DefaultSelectedCountry)}$cn.data.ShowWelcomeScreen=configuration.readValue(configuration.getPrefixedSettingKey("welcome"))||false;$cn.data.DeviceID=webservices.uniqueId=(configuration.readValue("DestinationUniqueID")||$cn.config.DeviceID);g=configuration.readValue("AuthToken");if(p!==null){$cn.data.AuthToken=p.authToken;$cn.data.DeviceName=p.deviceName;$cn.data.UserEmailAddress=p.emailAddress;$cn.data.AdultPinEnabled=$cn.utilities.isTrue(p.adultPinEnabled);$cn.data.ParentPinEnabled=$cn.utilities.isTrue(p.parentPinEnabled);$cn.data.PurchasePinEnabled=$cn.utilities.isTrue(p.purchasePinEnabled);$cn.data.ParentalControlsConfigured=$cn.utilities.isTrue(p.parentalControlsConfigured);if($cn.utilities.isTrue(p.parentPinEnabledOnStartup)){$cn.data.ParentPinEnabledOnStartup=$cn.utilities.isTrue(p.parentPinEnabledOnStartup)}$cn.data.PreferredAudioType=configuration.readValue(configuration.getPrefixedSettingKey("PreferredAudioType"))||$cn.data.PreferredAudioType;$cn.data.PreferredAudioTypeSet=$cn.utilities.isTrue(configuration.readValue(configuration.getPrefixedSettingKey("PreferredAudioTypeSet")));if(this.DEBUG){log.write("application.init: AuthToken: "+p.authToken)}if(this.DEBUG){log.write("application.init: DeviceName: "+p.deviceName)}if(this.DEBUG){log.write("application.init: DeviceID: "+p.deviceId)}if(this.DEBUG){log.write("application.init: UserEmailAddress: "+p.emailAddress)}if(this.DEBUG){log.write("application.init: AdultPinEnabled: "+p.adultPinEnabled)}if(this.DEBUG){log.write("application.init: ParentPinEnabled: "+p.parentPinEnabled)}if(this.DEBUG){log.write("application.init: PurchasePinEnabled: "+p.purchasePinEnabled)}if(this.DEBUG){log.write("application.init: ParentalControlsConfigured: "+p.parentalControlsConfigured)}if(this.DEBUG){log.write("application.init: ParentPinEnabledOnStartup: "+p.parentPinEnabledOnStartup)}configuration.clearValue(configuration.getPrefixedSettingKey("auth"));configuration.clearValue("-1_auth");configuration.clearValue("SelectedCountryID");configuration.clearValue(configuration.getPrefixedSettingKey("PreferredAudioType"));configuration.clearValue(configuration.getPrefixedSettingKey("PreferredAudioTypeSet"));application.saveAuthToken()}else{if(g!=null){$cn.data.AuthToken=configuration.readValue("AuthToken");$cn.data.ParentPinEnabled=$cn.utilities.isTrue(configuration.readValue("EnableParentControl"));$cn.data.PurchasePinEnabled=$cn.utilities.isTrue(configuration.readValue("EnablePurchasePIN"));$cn.data.ParentalControlsConfigured=$cn.utilities.isTrue(configuration.readValue("ParentalControlsConfigured"));$cn.data.ParentPinEnabledOnStartup=$cn.utilities.isTrue(configuration.readValue("EnableParentPinOnLaunch"));$cn.data.PreferredAudioType=configuration.readValue("DefaultAudioFormat");$cn.data.PreferredAudioTypeSet=configuration.readValue("AudioSetupDisplayed");$cn.data.CCTextColor=configuration.readValue("CCTextColor");$cn.data.CCTextOpacity=configuration.readValue("CCTextOpacity");$cn.data.CCTextSize=configuration.readValue("CCTextSize");$cn.data.CCFont=configuration.readValue("CCFont");$cn.data.CCBackgroundColor=configuration.readValue("CCBackgroundColor");$cn.data.CCBackgroundOpacity=configuration.readValue("CCBackgroundOpacity");$cn.data.CCTextEdge=configuration.readValue("CCTextEdge");$cn.data.CCWindowColor=configuration.readValue("CCWindowColor");$cn.data.CCWindowOpacity=configuration.readValue("CCWindowOpacity");$cn.data.CCLanguage=configuration.readValue("CCLanguage");if(this.DEBUG){log.write("application.init: AuthToken: "+$cn.data.AuthToken)}if(this.DEBUG){log.write("application.init: ParentPinEnabled: "+$cn.data.ParentPinEnabled)}if(this.DEBUG){log.write("application.init: PurchasePinEnabled: "+$cn.data.PurchasePinEnabled)}if(this.DEBUG){log.write("application.init: ParentalControlsConfigured: "+$cn.data.ParentalControlsConfigured)}if(this.DEBUG){log.write("application.init: ParentPinEnabledOnStartup: "+$cn.data.ParentPinEnabledOnStartup)}if(this.DEBUG){log.write("application.init: PreferredAudioType: "+$cn.data.PreferredAudioType)}if(this.DEBUG){log.write("application.init: PreferredAudioTypeSet: "+$cn.data.PreferredAudioTypeSet)}var j=null;j=configuration.readValue("ApplicationRevision");if(j!=null){configuration.clearValue("LastRegionCode");configuration.clearValue("ApplicationRevision")}}}}n.resolveEnv(n.firstResolveEnvCallback.bind(n))},firstResolveEnvCallback:function(g){var e=this;log.write("Resolving environment...");var d=g.data.result;e.CurrentEnvironment=configuration.readValue("Environment")||configuration.readValue("CustomEndPoint")||e.appSetting("CustomEndPoint")||d.defaultKey;e.endPointServer=e.CurrentEnvironment+".cinemanow.com";for(var f=0;f<d.enviroSelectable.length;f++){if(d.enviroSelectable[f].keyName==e.CurrentEnvironment){e.apiUrl=d.enviroSelectable[f].keyUrl}}if(!e.apiUrl){e.apiUrl="https://"+e.CurrentEnvironment+".cinemanow.com"}$cn.data.apiUrl=e.apiUrl;log.write("Current API URL: "+e.apiUrl);envs=0;e.Environments=[];d.enviroSelectable.each(function(j){e.Environments[envs]={key:j.keyName,name:j.keyValue,url:j.keyUrl};envs++});d.endPoints.each(function(j){e.EndPoints[j.keyName]=j.keyValue});log.write("Setting up device...");var h=configuration.readValue("LastCacheTime");if(h===null){h=""}$cn.methods.setupDevice(h,true,function(m){var k=m.data.result,j,l;e.checkRegion(k);$cn.methods.setupDevice(h,false,function(q){log.write(" Token is "+($cn.utilities.getMeta("AuthTokenActive",k.configValues)=="True"));var p;if(q&&q.data&&q.data.result){e.setSetupData(q.data.result);application.firmwareIsValid=device.setDocumentClassName();if(application.firmwareIsValid){if(!$cn.data.SystemOffline){var n=function(){if($cn.data.AuthToken.length>0&&!$cn.data.AuthTokenActive&&application.authSupported){e.clearAuthToken()}if($cn.data.RegionCheckEnabled){var r=configuration.changeCredentials($cn.data.CountryID);if(!r&&!e.regionError){e.regionError={type:application.resource.system_messages.region_moved_notallowed.MessageType,Message:application.resource.system_messages.region_moved_notallowed.Message,Content:application.resource.system_messages.region_moved_notallowed.Content,Close:application.resource.system_messages.region_moved_notallowed.Close,callback:function(){application.exit()}}}}if(e.regionError){application.ui.init()}else{if(!e.regionError||application.appSetting("IsCesDemo")){e.buildInitialNav()}else{$("SplashProgressContainer").hide();$("loadingerrormsg").innerHTML=regionError;$("loadingerror").show();navigation.setFocus("exitbtn",true)}}};if($cn.data.ShouldUpdateCache){webservices.clearContentCache(n)}else{n.call()}}else{$("SplashProgressContainer").hide();$("loadingerrormsg").innerHTML=$cn.data.SystemUnavailableMessage;$("loadingerror").show();navigation.setFocus("exitbtn",true)}}else{$("SplashProgressContainer").hide();$("loadingerrormsg").innerHTML="Please update software in order to enjoy some of our new and exciting features or Apps.<br /><br />Simply go to MENU, SUPPORT, and SOFTWARE UPGRADE.";$("loadingerror").show();navigation.setFocus("exitbtn",true)}}else{application.events.publish("error",{type:"system_error"})}})});if(application.request.data&&$cn.config.EnableD2D&&$cn.config.DeviceD2DEnabled){$cn.data.d2dPath=true;d2dTitle=application.request.data.split("|");$cn.data.d2dTitleInfo.id=d2dTitle[0];$cn.data.d2dTitleInfo.validDisc=d2dTitle[1];$cn.data.d2dTitleInfo.rental=d2dTitle[2];$cn.methods.getUpgradeOffers(d2dTitle[0],function(j){log.debug(JSON.stringify(j));if(j.responseMessage==="success"&&j.products.length>0){$cn.data.d2dTitleOffers={availableOffers:j.products}}else{$cn.data.d2dTitleInfo.error=true}log.write($cn.data.d2dTitleInfo.id);log.write($cn.data.d2dTitleInfo.id);log.write($cn.data.d2dTitleInfo.id);log.write($cn.data.d2dTitleInfo.id);log.write("GET UPGRADE OFFERS RETURNED. Proceeding with setup");log.write(JSON.stringify($cn.data.d2dTitleOffers));e.navigationSetup()})}else{log.write("NO d2d info. Proceeding with setup");this.navigationSetup()}},checkRegion:function(e){var d=$UrlQueryString.CountryID||$cn.config.DefaultSelectedCountry;$cn.data.SelectedCountryID=configuration.readValue("SelectedCountryID")||configuration.readValue("LastCountryID");var g=$cn.utilities.getMeta("CountryID",e.configValues);if($cn.data.RegionCheckEnabled){if(!$cn.data.SelectedCountryID){if(g!=d){var f=configuration.changeCredentials(g);if(f){log.write("application.firstResolveEnvCallback: region_notdefault");application.regionError={type:application.resource.system_messages.region_notdefault.MessageType,Message:application.resource.system_messages.region_notdefault.Message,Content:application.resource.system_messages.region_notdefault.Content,OK:application.resource.system_messages.region_notdefault.OK,Close:application.resource.system_messages.region_notdefault.Close,callback:function(h){if(h){application.exit()}else{configuration.writeValue("LastCountryID",g);configuration.switchToSettingsFile(g);configuration.writeValue("LastCountryID",g);location.reload(true)}}}}else{log.write("application.firstResolveEnvCallback: region_error");application.regionError={type:application.resource.system_messages.region_error.MessageType,Message:application.resource.system_messages.region_error.Message,Close:application.resource.system_messages.region_error.Close,callback:function(h){application.exit()}}}}else{configuration.writeValue("LastCountryID",g)}}else{if(g!=$cn.data.SelectedCountryID){var f=configuration.changeCredentials(g);if(f){application.regionError={type:application.resource.system_messages.region_moved.MessageType,Message:application.resource.system_messages.region_moved.Message,Content:application.resource.system_messages.region_moved.Content,OK:application.resource.system_messages.region_moved.OK,Close:application.resource.system_messages.region_moved.Close,callback:function(h){if(h){application.exit()}else{configuration.writeValue("LastCountryID",g);configuration.switchToSettingsFile(g);configuration.writeValue("LastCountryID",g);location.reload(true)}}}}else{log.write("application.firstResolveEnvCallback: region_error");application.regionError={type:application.resource.system_messages.region_error.MessageType,Message:application.resource.system_messages.region_error.Message,Close:application.resource.system_messages.region_error.Close,callback:function(h){application.exit()}}}}else{configuration.writeValue("LastCountryID",g)}}}else{configuration.writeValue("LastCountryID",g)}},buildInitialNav:function(){$cn.methods.getNav(function(g){var f,e,d;if(g&&g.data&&g.data.result){$cn.data.Navigation=g.data.result;$cn.data.slaveWheel={};$cn.data.masterWheel=[];f=e=d=0;$cn.data.recommendedGenres=[];g.data.result.genres.each(function(h){if(h.visible){if(!$cn.data.jinniEnable&&(h.name=="Recommended For You"||h.name=="Movies by Mood"||h.name=="TV Shows By Mood")){return}if(h.parentId==0){f=h.iD}if(h.parentId==f){$cn.data.masterWheel[$cn.data.masterWheel.length]=h;if(e==0){e=h.iD}}else{if(!$cn.data.slaveWheel[h.parentId]){$cn.data.slaveWheel[h.parentId]=[]}$cn.data.slaveWheel[h.parentId].push(h);$cn.data.RecomendedGenreIds.each(function(j){if(j==h.iD){$cn.data.masterWheel.each(function(k){if(k.iD==h.parentId){$cn.data.recommendedGenres[$cn.data.recommendedGenres.length]={id:k.iD,parentname:k.name,name:h.name,genreid:j}}})}});if(d==0&&e>0&&e==h.parentId){d=h.iD}}}})}$cn.methods.getTitlesByGenreId($cn.data.slaveWheel[$cn.data.masterWheel[0].iD][0].iD,1,function(){var h;log.debug("Merch config: "+$cn.data.EnableMerchPage);if($cn.config.EnableMerch){$cn.methods.getMerchandize(function(j){var k,l=[];if(j){log.debug("Merch valid?"+$cn.data.Merch.newMovies.length+", "+$cn.data.Merch.newTVShows.length+", "+$cn.data.Merch.featuredPromotion.titleID);if($cn.data.Merch.newMovies.length>0&&$cn.data.Merch.newTVShows.length>0&&$cn.data.Merch.newCollections&&$cn.data.Merch.featuredPromotion.titleID&&$cn.data.Merch.featuredPromotion.titleID>0&&$cn.data.Merch.featuredPromotion.boxartPrefix&&$cn.data.Merch.featuredPromotion.name){k=[];if($cn.data.Merch.newCollections.genreID){k[0]=$cn.data.Merch.newCollections.genreID}else{for(h=0;h<$cn.data.Merch.newCollections.length;++h){k[h]=$cn.data.Merch.newCollections[h].genreID}}$cn.data.EnableMerchPage=true}else{log.write("=== getMerchandize data is incomplete - Cannot show Merch Page ===");$cn.data.EnableMerchPage=false}}else{log.write("=== No getMerchandize Result returned - Cannot show Merch Page ===");$cn.data.EnableMerchPage=false}application.ui.init()})}else{$cn.data.EnableMerchPage=false;application.ui.init()}})})},setSetupData:function(d){$cn.data.SessionId=d.sessionID;$cn.data.jinniEnable=($cn.utilities.getMeta("JinniEnable",d.configValues)=="True");log.write("setupDevice return: jinniEnable: "+$cn.data.jinniEnable);$cn.data.flixsterEnable=($cn.utilities.getMeta("FlixsterEnable",d.configValues)=="True");log.write("setupDevice return: flixsterEnable: "+$cn.data.flixsterEnable);$cn.data.baselineEnable=($cn.utilities.getMeta("BaselineEnable",d.configValues)=="True");log.write("setupDevice return: baselineEnable: "+$cn.data.baselineEnable);$cn.data.ImageLoadTest=$cn.utilities.getMeta("ImageLoadTest",d.configValues);$cn.data.ParentalControlsConfigured=($cn.utilities.getMeta("ParentalControlsConfigured",d.configValues)=="True");$cn.data.AdultPinEnabled=($cn.utilities.getMeta("AdultPinEnabled",d.configValues)=="True");$cn.data.LastCacheLoadTimeUTC=$cn.utilities.getMeta("LastCacheLoadTimeUTC",d.configValues);configuration.writeValue("LastCacheTime",$cn.data.LastCacheLoadTimeUTC);$cn.data.ShouldUpdateCache=($cn.utilities.getMeta("ShouldUpdateCache",d.configValues)=="True");$cn.data.CountryID=$cn.utilities.getMeta("CountryID",d.configValues);$cn.data.Region=$cn.utilities.getMeta("RegionCode",d.configValues);$cn.data.AllowedRegions=$cn.utilities.getMeta("AllowedRegions",d.configValues).split(",");$cn.data.AffId=$cn.utilities.getMeta("AffId",d.configValues);$cn.data.EnableAccountLink=$cn.utilities.getMeta("EnableAccountLink",d.configValues);$cn.data.AccountLinkUrl=$cn.utilities.getMeta("Account_Link_URL",d.configValues);$cn.data.ActivationURL=$cn.config.ActivationURL||$cn.utilities.getMeta("ActivationURL",d.configValues);$cn.data.DisplayEula=($cn.utilities.getMeta("DisplayEula",d.configValues)=="True");$cn.data.ShouldEnableTvNode=($cn.utilities.getMeta("ShouldEnableTvNode",d.configValues)=="True");$cn.data.BandwithCheckURL=$cn.utilities.getMeta("BandwithCheckURL",d.configValues);$cn.data.BandwithCheckURLSize=$cn.utilities.getMeta("BandwithCheckURLSize",d.configValues);$cn.data.AuthTokenActive=($cn.utilities.getMeta("AuthTokenActive",d.configValues)=="True");$cn.data.SystemOffline=($cn.utilities.getMeta("SystemOffline",d.configValues)=="True");$cn.data.SystemUnavailableMessage=$cn.utilities.getMeta("SystemUnavailableMessage",d.configValues);$cn.data.SessionLimitRows=$cn.utilities.getMeta("SessionLimitRows",d.configValues);$cn.data.SessionLimitMinutes=$cn.utilities.getMeta("SessionLimitMinutes",d.configValues);$cn.data.AllowAdult=($cn.utilities.getMeta("AllowAdult",d.configValues)=="True");$cn.data.AllowPlayboy=($cn.utilities.getMeta("AllowPlayboy",d.configValues)=="True");$cn.data.RootMoodGenreID=$cn.utilities.getMeta("RootMoodGenreID",d.configValues);$cn.data.TVRootMoodGenreID=$cn.utilities.getMeta("TVRootMoodGenreID",d.configValues);$cn.data.RecomendedGenreIds=$cn.utilities.getMeta("RecomendedGenreIds",d.configValues).split(",");$cn.config.EnableUV=$cn.utilities.isTrue($cn.utilities.getMeta("UVEnabled",d.configValues));if($cn.utilities.isTrue($cn.utilities.getMeta("DolbyEnable",d.configValues))){$cn.data.AllowedAudioProfiles[$cn.data.AllowedAudioProfiles.length]="Dolby_Digital_Plus_51";$cn.data.Dolby51Enable=true}if($cn.utilities.isTrue($cn.utilities.getMeta("DolbyStereoEnable",d.configValues))){$cn.data.AllowedAudioProfiles[$cn.data.AllowedAudioProfiles.length]="Dolby_Digital_Plus_Stereo";$cn.data.DolbyStereoEnable=true}if(($cn.data.PreferredAudioType==null)||($cn.data.PreferredAudioType=="")){var f=$cn.data.Dolby51Enable||$cn.data.DolbyStereoEnable;var e=$cn.data.DTS51Enable||$cn.data.DTSStereoEnable;$cn.data.PreferredAudioType="Stereo_Standard";if(f&&!e){if($cn.data.Dolby51Enable){$cn.data.PreferredAudioType="Dolby_Digital_Plus_51"}else{$cn.data.PreferredAudioType="Dolby_Digital_Plus_Stereo"}}if(e&&!f){if($cn.data.DTS51Enable){$cn.data.PreferredAudioType="DTS_Express_51"}else{$cn.data.PreferredAudioType="DTS_Express_Stereo"}}}if($cn.config.EnableJinni!==null&&$cn.config.EnableJinni!="auto"){log.write("Overwrite EnableJinni setting: "+$cn.config.EnableJinni);$cn.data.jinniEnable=$cn.config.EnableJinni}if($cn.config.EnableFlixster!==null&&$cn.config.EnableFlixster!="auto"){log.write("Overwrite EnableFlixster setting: "+$cn.config.EnableFlixster);$cn.data.flixsterEnable=$cn.config.EnableFlixster}if($cn.config.EnableBaseline!==null&&$cn.config.EnableBaseline!="auto"){log.write("Overwrite EnableBaseline setting: "+$cn.config.EnableBaseline);$cn.data.baselineEnable=$cn.config.EnableBaseline}if($cn.config.AllowedRegionOverride!==null&&$cn.config.AllowedRegionOverride!="auto"){$cn.data.AllowedRegions=$cn.config.AllowedRegionOverride}log.write("$cn.data.ParentPinEnabledOnStartup: "+$cn.data.ParentPinEnabledOnStartup);if($cn.data.ParentalControlsConfigured&&$cn.data.ParentPinEnabledOnStartup){$cn.data.ParentPinEnabled=true;$cn.data.IsParent=false;application.saveAuthToken()}else{if($cn.data.ParentalControlsConfigured){$cn.data.IsParent=!$cn.data.ParentPinEnabled}else{$cn.data.IsParent=true;$cn.data.ParentPinEnabled=false;$cn.data.ParentPinEnabledOnStartup=false;$cn.data.PurchasePinEnabled=false;application.saveAuthToken()}}log.session.lastSync=new Date();log.session.sessionLimitMinutes=$cn.data.SessionLimitMinutes;log.session.sessionLimitRows=$cn.data.SessionLimitRows;log.session.checkinTimer.Interval=$cn.data.SessionLimitMinutes*60*1000;log.session.checkinTimer.Tick=log.session.upload;log.session.checkinTimer.Start()},navigationSetup:function(){this._methodMap={};pointer.init("detention");$("navigation").onkeyup=function(e){application.RepeatKeyBlock=false;var d={};if(!application.isBusy){switch(e.keyCode){case application.keys.KEY_RIGHT:d.direction="right";d.current=application.element.current;break;case application.keys.KEY_LEFT:d.direction="left";d.current=application.element.current;break;default:break}application.events.publish("keyup",d)}};$("navigation").onkeydown=function(j){var e=j.keyCode;var f=false;var h=$cn.utilities.DateDiff(new Date(),application.LastKeyDown);log.write("blocking access is: "+application.blockWidgetAccess);if(application.blockWidgetAccess){log.write("blocking widget access");if(e==application.keys.KEY_PANEL_MENU||e==application.keys.KEY_RETURN){log.write("back key override");e=application.keys.KEY_EXIT}}log.write("exit is "+application.keys.KEY_EXIT);log.write("key code after all - now - is: "+e);if(application.RepeatKeyBlock==true&&(h<application.RepeatKeyBlockDuration)){f=true;if(this.DEBUG){log.write("RepeatKeyBlock set")}}else{if(this.DEBUG){log.write("RepeatKeyBlock NOT set")}}if(application.TempKeyBlock){if(h<application.TempKeyBlockDuration){f=true}else{application.TempKeyBlock=false}}var d=false;if(application.TempKeyBlockEnter){if(h<application.TempKeyBlockDuration){d=true}else{application.TempKeyBlockEnter=false}}if(!application.isBusy&&d==true&&(e==application.keys.KEY_PANEL_ENTER||e==application.keys.KEY_PANEL_SOURCE||e==application.keys.KEY_ENTER)){f=true}if(f){application.blockNavigation(j);return}application.LastKeyDown=new Date();application.RepeatKeyBlock=true;var g={event:{keyCode:e}};if(!application.isBusy){log.write("keycode: "+e);switch(e){case application.keys.KEY_PANEL_CH_DOWN:case application.keys.KEY_DOWN:g.direction="down";g.current=application.element.current;application.events.publish("navigate",g);break;case application.keys.KEY_PANEL_CH_UP:case application.keys.KEY_UP:g.direction="up";g.current=application.element.current;application.events.publish("navigate",g);break;case application.keys.KEY_PANEL_VOL_UP:case application.keys.KEY_RIGHT:g.direction="right";g.current=application.element.current;application.events.publish("navigate",g);break;case application.keys.KEY_PANEL_VOL_DOWN:case application.keys.KEY_LEFT:g.direction="left";g.current=application.element.current;application.events.publish("navigate",g);break;case application.keys.KEY_PANEL_ENTER:case application.keys.KEY_PANEL_SOURCE:case application.keys.KEY_ENTER:log.write("CURRENT ELEMENT: "+application.element.current);if(!$(application.element.current).get("action")){g.direction="right";g.keypressed=application.keys.KEY_ENTER;g.current=application.element.current;application.events.publish("navigate",g)}else{g.direction="select";application.events.publish("select",g)}break;case application.keys.KEY_PANEL_MENU:case application.keys.KEY_RETURN:application.blockNavigation(j);g.direction="back";application.events.publish("back",g);break;case application.keys.KEY_MUTE:break;case application.keys.KEY_INFO:break;case application.keys.KEY_EXIT:application.blockNavigation(j);if(application.blockWidgetAccess){application.events.publish("no_choice_exit",g)}else{application.events.publish("exit",g)}break;case application.keys.KEY_INFOLINK:break;case application.keys.KEY_RW:application.events.publish("rewind",g);break;case application.keys.KEY_REWIND_:log.write("skip back");application.events.publish("skipback",g);break;case application.keys.KEY_PAUSE:application.events.publish("pause",g);break;case application.keys.KEY_FF:application.events.publish("fastforward",g);break;case application.keys.KEY_FF_:log.write("skip forward");application.events.publish("skipforward",g);break;case application.keys.KEY_PLAY:application.events.publish("play",g);break;case application.keys.KEY_STOP:application.events.publish("stop",g);break;case application.keys.KEY_PLAY_PAUSE:application.events.publish("play_pause",g);break;case application.keys.KEY_CC_TOGGLE:application.events.publish("cc_toggle",g);break;case application.keys.KEY_VOL_UP:break;case application.keys.KEY_VOL_DOWN:break;case application.keys.KEY_SUBTITLE:break;case application.keys.KEY_PAGE_UP:g.direction="pageup";application.events.publish("navigate",g);break;case application.keys.KEY_PAGE_DOWN:g.direction="pagedown";application.events.publish("navigate",g);break;default:break}application.events.publish("keydown",g)}else{log.write("Application is busy block navigation... (Except mandatory listeners)");switch(e){case application.keys.KEY_PANEL_CH_DOWN:case application.keys.KEY_DOWN:g.direction="down";g.current=application.element.current;application.events.publish("blockednavigate",g);break;case application.keys.KEY_PANEL_CH_UP:case application.keys.KEY_UP:g.direction="up";g.current=application.element.current;application.events.publish("blockednavigate",g);break;case application.keys.KEY_PANEL_VOL_UP:case application.keys.KEY_RIGHT:g.direction="right";g.current=application.element.current;application.events.publish("blockednavigate",g);break;case application.keys.KEY_PANEL_VOL_DOWN:case application.keys.KEY_LEFT:g.direction="left";g.current=application.element.current;application.events.publish("blockednavigate",g);break;case application.keys.KEY_PANEL_ENTER:case application.keys.KEY_PANEL_SOURCE:case application.keys.KEY_ENTER:if(!$(application.element.current).get("action")){g.direction="right";g.current=application.element.current;application.events.publish("blockednavigate",g)}else{g.direction="select";application.events.publish("select",g)}break;case application.keys.KEY_PANEL_MENU:case application.keys.KEY_RETURN:application.blockNavigation(j);g.direction="back";application.events.publish("back",g);break;case application.keys.KEY_EXIT:application.blockNavigation(j);if(application.blockWidgetAccess){application.events.publish("no_choice_exit",g)}else{application.events.publish("exit",g)}break;case application.keys.KEY_INFOLINK:break;case application.keys.KEY_PAUSE:application.events.publish("pause",g);break;case application.keys.KEY_PLAY:application.events.publish("play",g);break;case application.keys.KEY_STOP:application.events.publish("stop",g);break;default:break}}};$("navigation").focus();application.events.subscribe(application,"navigate",application.defaultNavigation);application.events.subscribe(application,"exit",application.defaultExit);application.events.subscribe(application,"back",application.defaultNavigation);application.events.subscribe(application,"select",application.defaultAction);application.events.subscribe(application,"goback",application.state.loadPrevious);application.events.subscribe(application,"error",function(d){setTimeout(function(){application.exception.onHandleError(d)},2500)})},exit:function(){log.write("application.exit: UI Closing.");if("WebSocketManager" in window){if("WebSocket" in window){log.write("application.exit: App quitting.");var d="<RNOPlatformCall>$$REQUESTID$$<QuitFlash/></RNOPlatformCall>";WebSocketManager.send(d,this,function(e){WebSocketManager.shutdown()})}}device.exit()},reset:function(){log.write("Application reset");$cn.data.TitlesByGenreID=-1;$cn.data.TitlesByGenrePages={};$cn.data.EpisodeCache={};$cn.data.TitlesByCast={};$cn.data.EpisodeListCache={};$cn.data.TitlesBySimilar={};$cn.data.LibraryWheelItems={};$cn.data.MyVideos=[];application.state.purge()},events:{evnts:{},appEvents:{},subscribe:function(e,d,h){var g={context:e,callback:h};if(e.id=="application"){this.appEvents[d]=this.appEvents[d]||[];this.appEvents[d].push(g)}else{var f=false;if(this.evnts[d]){this.evnts[d].each(function(j){if(j.context.id==e.id){f=true}})}if(!f){this.evnts[d]=this.evnts[d]||[];this.evnts[d].push(g)}}},unsubscribe:function(g,e){var d,f,h;if(this.evnts[e]){f=this.evnts[e];if(f.length>0){this.evnts[e]=[];for(d=0;d<f.length;d++){h=f[d];if(h.context.id!==g.id){this.evnts[e].push(h)}}}}},publish:function(e){var h,j=this.evnts[e],d=this.appEvents[e],g;log.write("Event: "+e);if(j||d){g=Array.prototype.slice.call(arguments,1);var f=false;var k={preventDefault:function(){f=true},args:g};if(j){for(h=0;h<j.length;h++){k.context=j[h].context;j[h].callback.apply(null,[k])}}if(d){for(h=0;h<d.length;h++){if(!f){k.context=d[h].context;d[h].callback.apply(null,[k])}}}}}},exception:{categories:{},onHandleError:function(d){BrowseView.onHandleError(d)},resolveMessagePath:function(e){var d=null;if(!e){d=application.resource.system_messages}else{if(this.categories[e]){if(application.resource[this.categories[e]]){d=application.resource[this.categories[e]]}else{d=application.resource.system_messages}}else{if(application.resource){d=application.resource.system_messages}}}return d}},state:{_history:[],_viewstate:{},purge:function(){application.state._history=null;application.state._history=[];application.state._viewstate={}},save:function(f){if(application.currentView.currentState){log.write("function: application.state.save()");var e=null;if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){e=application.element.current;log.write("Setting current focused element: "+e)}var h={};var g="history_"+application.utility.generate.counter++;$cn.data.History[g]=document.getElementById("uicontainer").innerHTML;$("dock-back").removeClass("disableBack");application.events.publish("savestate",h);var d={id:g,state:h,template:f,focusedElem:e,containerClass:document.getElementById("uicontainer").className,currentState:application.currentView.currentState,viewState:application.state._viewstate[application.currentView.currentState]};application.state._history.push(d);log.write("application.state._history.length: "+application.state._history.length);if(application.state._history.length>30){application.state._history.shift();log.write("First History item purged.")}application.state._viewstate[application.currentView.currentState]=d;h=null;d=null}},previous:function(){log.write("function: application.previousView()");if(application.currentView.currentState=="player-view"&&application.currentView.PlayerControl._currentStatus!=application.currentView.PlayerControl.STOPPED){log.write("Player is still player while changing views. Stop Player.");application.currentView.PlayerControl._currentStatus=application.currentView.PlayerControl.STOPPED;BrowseView.PlayerControl.stopPlayer()}if(application.state._history.length>0){if(application.state._history[application.state._history.length-1].currentState==="settings-view"&&application.doNotRestoreSettings===true){application.doNotRestoreSettings=false;BrowseView.goSettings(0);return}application.events.publish("goback",{})}else{if(application.state.exitOnBack){log.write("Exiting on back button press.");application.exit()}else{$("dock-back").addClass("disableBack")}}},loadPrevious:function(f){log.write("Load Previous View");var e=application.state._history.pop();application.currentView.currentState=e.currentState;application.currentView.LastGridProcess="backaction";application.currentView.CurrentProcessLoaded=true;var d=application.state._viewstate[application.currentView.currentState];if(d){application.state._viewstate[application.currentView.currentState]=d.viewState}application.state.loadPreviousView(e);var g=$cn.data.History[e.id];if(g){$cn.data.History[e.id]=null;delete g}d=null;e=null},loadPreviousView:function(e){if(e.id){if($cn.data.History[e.id]){var f=$cn.data.History[e.id];var d=document.getElementById("uicontainer");log.write("Loading view: "+e.id);d.setAttribute("class",e.containerClass);application.putInnerHTML(d,f)}if((!$cn.config.EnableMerch||$cn.data.ParentPinEnabled||$cn.data.ParentPinEnabledOnStartup)&&application.state._history.length>0){$("dock-back").removeClass("disableBack")}application.element.current=null;if(e.focusedElem){log.write("Setting default focus to: "+e.focusedElem);application.element.current=e.focusedElem}application.events.publish("restorestate",e.state);application.currentView.layoutIsDirty=true}else{log.write("Previous view DOM object not found.")}e=null},loadState:function(f){var e=application.state._viewstate[f];if(e){var d=$extend({},e);BrowseView.currentState=f;this.loadPreviousView(d);d=null;return true}return false}},loadView:function(d,f,e){this.events.publish("hideView");if(this.currentView&&typeof this.currentView.hideView=="function"){this.currentView.hideView()}log.write("preparing to destroy layout");this.ui.destroyLayout();log.write("layout destroyed");this._views[d.id]=d;this.currentView=d;log.write("preparing to load layout");this.ui.loadLayout(d.id);log.write("layout destroyed");this.currentView.init(f,"forward");log.write("initialize view");log.write("preparing to bind actions");this.element.bindActions(d.id);log.write("actions binded");if(!document.getElementById(application.element.current)){application.navigator.setFirstFocusableElement()}this.currentView.render();this.events.publish("loadView",{view:this.currentView})},registerHandler:function(d,e,f){this._methodMap[d+":"+e]=f},defaultNavigation:function(d){d=d.args[0];if((!application.element.current||application.element.current=="")||((application.element.current&&application.element.current!="")&&!document.getElementById(application.element.current))){application.navigator.setFirstFocusableElement()}switch(d.direction){case"up":application.navigator.up(d);break;case"down":application.navigator.down(d);break;case"right":application.navigator.right(d);break;case"left":application.navigator.left(d);break;case"back":application.state.previous();break;default:break}},defaultExit:function(d){device.exit()},defaultAction:function(payload){payload=payload.args[0];log.write("Item selected");if($(application.element.current).get("action")){eval("("+$(application.element.current).get("action")+")")}},saveAuthToken:function(d){if(this.DEBUG){log.write("application.saveAuthToken: $cn.data.AuthToken: "+$cn.data.AuthToken)}if(this.DEBUG){log.write("application.saveAuthToken: $cn.data.DeviceName: "+$cn.data.DeviceName)}if(this.DEBUG){log.write("application.saveAuthToken: $cn.data.UserEmailAddress: "+$cn.data.UserEmailAddress)}if(this.DEBUG){log.write("application.saveAuthToken: $cn.data.AdultPinEnabled: "+$cn.data.AdultPinEnabled)}if(this.DEBUG){log.write("application.saveAuthToken: $cn.data.ParentPinEnabled: "+$cn.data.ParentPinEnabled)}if(this.DEBUG){log.write("application.saveAuthToken: $cn.data.PurchasePinEnabled: "+$cn.data.PurchasePinEnabled)}if(this.DEBUG){log.write("application.saveAuthToken: $cn.data.ParentalControlsConfigured: "+$cn.data.ParentalControlsConfigured)}if(this.DEBUG){log.write("application.saveAuthToken: $cn.data.CurrentRegion: "+$cn.data.CurrentRegion)}if(this.DEBUG){log.write("application.saveAuthToken: $cn.data.ParentPinEnabledOnStartup: "+$cn.data.ParentPinEnabledOnStartup)}configuration.writeValue("AuthToken",$cn.data.AuthToken);configuration.writeValue("EnableParentControl",$cn.data.ParentPinEnabled);configuration.writeValue("EnablePurchasePIN",$cn.data.PurchasePinEnabled);configuration.writeValue("ParentalControlsConfigured",$cn.data.ParentalControlsConfigured);configuration.writeValue("EnableParentPinOnLaunch",$cn.data.ParentPinEnabledOnStartup);configuration.writeValue("CCTextColor",$cn.data.CCTextColor);configuration.writeValue("CCTextOpacity",$cn.data.CCTextOpacity);configuration.writeValue("CCTextSize",$cn.data.CCTextSize);configuration.writeValue("CCFont",$cn.data.CCFont);configuration.writeValue("CCBackgroundColor",$cn.data.CCBackgroundColor);configuration.writeValue("CCBackgroundOpacity",$cn.data.CCBackgroundOpacity);configuration.writeValue("CCTextEdge",$cn.data.CCTextEdge);configuration.writeValue("CCWindowColor",$cn.data.CCWindowColor);configuration.writeValue("CCWindowOpacity",$cn.data.CCWindowOpacity);configuration.writeValue("CCLanguage",$cn.data.CCLanguage)},clearAuthToken:function(){log.write("Clearing bad auth token.");configuration.clearValue(configuration.getPrefixedSettingKey("auth"));configuration.clearValue(configuration.getPrefixedSettingKey("welcome"));application.deleteActivationFile();$cn.data.AuthToken="";$cn.data.IsParent=false;$cn.data.ParentPinEnabledOnStartup=false;$cn.data.ParentPinEnabled=false;$cn.data.PurchasePinEnabled=false;$cn.data.AdultPinEnabled=false;$cn.data.LastCacheLoadTimeUTC=null;$cn.data.ShouldUpdateCache=false;$cn.data.AuthTokenActive=false;$cn.data.purchTypeFilter="any";$cn.data.PassCache={};$cn.data.UserEmailAddress="";$cn.data.PendingWishlistItem="";$cn.data.DeviceName="";$cn.data.DeviceID="";$cn.data.MyVideos=[];$cn.data.CurrentRegion="";var d='{"authToken": "'+$cn.data.AuthToken+'","adultPinEnabled": "'+$cn.data.AdultPinEnabled+'","parentPinEnabled": "'+$cn.data.ParentPinEnabled+'","deviceName": "'+$cn.data.DeviceName+'","emailAddress": "'+$cn.data.UserEmailAddress+'","purchasePinEnabled": "'+$cn.data.PurchasePinEnabled+'","parentalControlsConfigured": "'+$cn.data.ParentalControlsConfigured+'","parentPinEnabledOnStartup": "'+$cn.data.ParentPinEnabledOnStartup+'"}';application.saveAuthToken()},resolveEnv:function(e){var d={err:true,text:"",data:{}};if(application.appSetting("ApiUrl")=="auto"){webservices.makeAsyncRequestExt("https://enpointswitch.cinemanow.com","api/orbit/util/default.ashx","getDeviceEnv",{},false,this,function(g){d.err=false;d.text="CinemaNOW request successful";d.data=g.data;for(var f=0;f<d.data.result.enviroSelectable.length;f++){d.data.result.enviroSelectable[f].keyUrl="https://"+d.data.result.enviroSelectable[f].keyName+".cinemanow.com"}e.call(this,d)},function(){var f="http://"+document.domain+"/stgapi";webservices.makeAsyncRequestExt(f,"api/orbit/util/default.ashx","getDeviceEnv",{},false,this,function(h){d.err=false;d.text="CinemaNOW request successful";d.data=h.data;for(var g=0;g<d.data.result.enviroSelectable.length;g++){d.data.result.enviroSelectable[g].keyUrl="http://"+document.domain+"/"+d.data.result.enviroSelectable[g].keyName}e.call(this,d)},function(){application.authSupported=false;var g={result:{defaultKey:"stgapi",enviroSelectable:[{keyName:"stgapi",keyValue:"*Partner Staging",keyUrl:"https://stgapi.cinemanow.com"}],endPoints:[{keyName:"auth",keyValue:"api/orbit/auth/default.ashx"},{keyName:"browse",keyValue:"api/orbit/browse/default.ashx"},{keyName:"commerce",keyValue:"api/orbit/commerce/default.ashx"},{keyName:"library",keyValue:"api/orbit/library/default.ashx"},{keyName:"search",keyValue:"api/orbit/search/default.ashx"},{keyName:"stream",keyValue:"api/orbit/stream/default.ashx"},{keyName:"titledata",keyValue:"api/orbit/titledata/default.ashx"},{keyName:"util",keyValue:"api/orbit/util/default.ashx"},{keyName:"wishlist",keyValue:"api/orbit/wishlist/default.ashx"},{keyName:"download",keyValue:"api/orbit/download/default.ashx"}],}};d.err=false;d.text="CinemaNOW request successful";d.data=g;e.call(this,d)},true,false)},true,false)}else{this.apiUrl=this.appSetting("ApiUrl");$cn.data.apiUrl=this.apiUrl;e.call(this,this.apiUrl)}},bandwidthCheck:{lastRan:null,callbackParams:null,callbackType:"purchase",successCondition:0},testConnection:function(e,h){var g=new Image(),d=false,f=h||5000;g.onload=function(){if(!d){log.write("ERROR: TEST CONNECTION PASSED");e.call(this,{result:true});d=true}};g.onerror=function(){if(!d){log.write("ERROR: TEST CONNECTION FAILED");e.call(this,{result:false});d=true}};g.src=$cn.data.ImageLoadTest+"?d="+escape(Date());setTimeout(function(){if(!d){log.write("ERROR: TEST CONNECTION TIMED OUT");e.call(this,{result:false});d=true}},f)},createActivationFile:function(){device.createActivationFile()},deleteActivationFile:function(){device.deleteActivationFile()},loadAnimation:function(animation){var resource=eval("application.resource.animation."+animation);if(resource){if(resource.options.transition&&typeof(resource.options.transition)=="string"){resource.options.transition=eval(resource.options.transition)}}return resource},putInnerHTML:function(d,e){if(d!=null){while(d.firstChild){if(d.deleteChild){d.deleteChild(d.firstChild)}else{d.removeChild(d.firstChild)}}d.innerHTML=e}},blockNavigation:function(d){d.preventDefault()}};$cn.methods.DEBUG=false;function initAuthMethodOverrides(){$cn.methods.pollForToken=function(e){log.write("automatic activation after a few, since we are not on a device");var d={id:"9_pollForToken",result:{authToken:"a144df0b84615c62ac29b56509cb7778",deviceFriendlyName:"pp",emailAddress:"peng.litest001@rovicorp.com",adultPinEnabled:false,parentPinEnabled:false,purchasePinEnabled:false,parentalControlsConfigured:false,responseCode:0,responseMessage:"Success"}};e.call(this,d.result)};$cn.methods.getPurchasedTitle=function(g,e,k){var d={data:{id:"15_getPurchasedTitle",result:{passID:1210171,dateExpired:"2010-11-14T20:59:00.0000000-08:00",datePurchased:"2010-06-23T14:32:59.4370000-07:00",watchStatus:"WatchNow",streamPlayStatus:"stopped",streamStartTimeSeconds:4285,storeLogoUrl:"http://web1.cinemanow.com/img/BB_CN_logo_J_PSD_RGB.png",releaseYear:"2009",bonusAssets:[{bonusAssetID:485468,profile:"STANDARD",bonusType:"Trailer"}],availableProducts:[{skuID:381889,purchaseType:"buy",price:19.95,availableAssets:[{file_DRMProvider:"WIDEVINE",file_AccessType:"STREAM",file_FileProfile:"STANDARD",file_VideoFormat:"H264"}],expireDateUTC:"2010-11-14T08:00:00.0000000-08:00",promoText:"",rentalPeriod:0}],directors:"Albert Hughes, Allen Hughes",actors:"Denzel Washington, Gary Oldman, Mila Kunis, Ray Stevenson, Jennifer Beals, Frances De La Tour, Michael Gambon",writers:"Gary Whitta",producers:"Joel Silver, Denzel Washington, Broderick Johnson, Andrew A. Kosove, David Valdes",copyright:"&copy; 2009 Alcon Film Fund, LLC",ratingReason:"",wheelItems:["m_cast_bios","m_cast_crew","m_credits","m_images","r_critics","r_user_revs","s_audience","s_mood","s_place","s_plot","s_praise","s_time"],mPAARating:"R",synopsys:"In the not-too-distant future, some 30 years after the final war, a solitary man walks across the wasteland that was once America. A warrior not by choice but necessity, Eli (Denzel Washington) seeks only peace but, if challenged, will cut his attackers down before they realize their fatal mistake. It's not his life he guards so fiercely but his hope for the future; a hope he has carried and protected for 30 years and is determined to realize. Driven by this commitment and guided by his belief in something greater than himself, Eli does what he must to survive--and continue. Only one other man in this ruined world understands the power Eli holds, and is determined to make it his own: Carnegie (Gary Oldman), the self-appointed despot of a makeshift town of thieves and gunmen. Meanwhile, Carnegie's adopted daughter Solara (Mila Kunis) is fascinated by Eli for another reason: the glimpse he offers of what may exist beyond her stepfather's domain.",metaValues:[{keyName:"HD",keyValue:"False"},{keyName:"InUserWishlist",keyValue:"False"},{keyName:"RunTime",keyValue:"1 hour, 58 minutes."},{keyName:"AirDate",keyValue:"6/15/2010 12:00:00 AM"},{keyName:"YourRating",keyValue:"0"},{keyName:"51Aud",keyValue:"False"},{keyName:"HD",keyValue:"False"},{keyName:"Extras",keyValue:"False"},{keyName:"PromoString",keyValue:""},{keyName:"CriticsReview",keyValue:"12% liked it."},{keyName:"Flixster Users",keyValue:"41% liked it."}],seasonTitleID:0,showTitleID:0,titleType:"Movie",buyAvail:true,buyPrice:19.95,rentAvail:false,rentPrice:0,responseCode:0,responseMessage:"Success",titleID:381888,boxartPrefix:"the_book_of_eli_cbbd08c4_",name:"The Book of Eli"}}};var l={data:{id:"21_getPurchasedTitle",result:{passID:7983526,dateExpired:"2022-12-31T00:00:00.0000000-08:00",datePurchased:"2011-12-02T18:12:50.0970000-08:00",watchStatus:"WatchNow",expirationMessage:"Expires 12/25/2012",streamPlayStatus:"stopped",streamStartTimeSeconds:2281,storeLogoUrl:"http://web1.cinemanow.com/img/BB_CN_logo_J_PSD_RGB.png",isPassUV:true,releaseYear:"2011",bonusAssets:[{bonusAssetID:612974,profile:"STANDARD",bonusType:"Trailer"}],availableProducts:[{skuID:422932,purchaseType:"rent",price:4.99,availableAssets:[{file_DRMProvider:"WIDEVINE",file_AccessType:"STREAM",file_FileProfile:"STANDARD",file_VideoFormat:"H264",availableAudioProfiles:[]}],expireDateUTC:"2022-12-31T08:00:00.0000000-08:00",promoText:"",rentalPeriod:48,isUV:"False"}],directors:"Stephen Kay",actors:"",writers:"Donald Martin, Stephen Tolkin",producers:"",copyright:"2011 Sony Pictures Television Inc. All Rights Reserved.",ratingReason:"",wheelItems:["m_technical_details"],mPAARating:"NR",synopsys:"Seemingly flawless medical student Philip Markoff leads a double life and starts to descend into a twisted world of gambling, crime, battery and eventually murder, all while meeting his victims through Craigslist.",metaValues:[{keyName:"TotalLicenses",keyValue:"1"},{keyName:"LicensesUsed",keyValue:"0"},{keyName:"LicensesRemaining",keyValue:"1"},{keyName:"LicensesDelivered",keyValue:"0"},{keyName:"IsTHXMediaDirectorEnabled",keyValue:"False"},{keyName:"IsTHXMediaDirectorEnabledForTrailer",keyValue:"False"},{keyName:"IsFlashAccessDownloadAvailable",keyValue:"False"},{keyName:"HD",keyValue:"False"},{keyName:"CHVRSRating",keyValue:"PG"},{keyName:"LoyaltyPointsForBuy",keyValue:"0"},{keyName:"LoyaltyPointsForRent",keyValue:"25"},{keyName:"HasUV",keyValue:"False"},{keyName:"InUserWishlist",keyValue:"False"},{keyName:"RunTime",keyValue:"1 hour 28 minutes"},{keyName:"AirDate",keyValue:"10/12/2011 12:00:00 AM"},{keyName:"YourRating",keyValue:"4"}],seasonTitleID:0,showTitleID:0,titleType:"Movie",buyAvail:false,buyPrice:0,rentAvail:true,rentPrice:4.99,responseCode:0,responseMessage:"Success",titleID:421827,boxartPrefix:"the_craigslist_killer_c80c0109_",name:"The Craigslist Killer"}}};var j={data:{id:"17_getPurchasedTitle",result:{passID:1211189,dateExpired:"2011-05-19T20:59:00.0000000-07:00",datePurchased:"2010-07-13T14:54:39.7230000-07:00",watchStatus:"ExpiredRental",expirationMessage:"Expired 7/14/2010",streamPlayStatus:"stopped",streamStartTimeSeconds:22,storeLogoUrl:"http://web1.cinemanow.com/img/BB_CN_logo_J_PSD_RGB.png",releaseYear:"2010",bonusAssets:[{bonusAssetID:492875,profile:"STANDARD",bonusType:"Trailer"}],availableProducts:[{skuID:388095,purchaseType:"rent",price:4.99,availableAssets:[{file_DRMProvider:"WIDEVINE",file_AccessType:"STREAM",file_FileProfile:"STANDARD",file_VideoFormat:"H264"},{file_DRMProvider:"WIDEVINE",file_AccessType:"STREAM",file_FileProfile:"HIGH_DEFINITION",file_VideoFormat:"H264"}],expireDateUTC:"2011-05-19T07:00:00.0000000-07:00",promoText:"",rentalPeriod:24}],directors:"Paul Field",actors:"Murray Cook, Jeff Fatt, Anthony Field, Sam Moran, Greg Page",writers:"",producers:"",copyright:"c) 2010 The Wiggles Pty Limited. The Wiggles logo, Dorothy the Dinosaur, Henry the Octopus, Captain Feathersword, Wags the Dog and Big Red Car are trademarks of The Wiggles Pty Limited.",ratingReason:"",wheelItems:["r_critics","r_user_revs","m_credits","m_cast_bios","m_cast_crew","m_images","m_technical_details"],mPAARating:"NR",synopsys:"The most successful children's entertainment group in the world has finally released a collection of their most loved songs, Hot Potatoes! The Best of The Wiggles. The Wiggles' songs have drawn millions of people over the years to see their live concerts. The New York Times called The Wiggles, the band that rocks the cradle and this is certainly true. They have set records for their sold out performances everywhere from Madison Square Garden in New York to the Hammersmith Apollo in London to their home town of Sydney, Australia. Their songs are instantly memorable and get you wiggling in seconds! Those same songs have seen music royalty line up to record music with the fab four of fun! We've picked the best for you to listen to!",metaValues:[{keyName:"HD",keyValue:"True"},{keyName:"InUserWishlist",keyValue:"False"},{keyName:"RunTime",keyValue:"1 hour, 20 minutes."},{keyName:"AirDate",keyValue:"6/29/2010 12:00:00 AM"},{keyName:"YourRating",keyValue:"0"},{keyName:"CriticsReview",keyValue:"12% liked it."},{keyName:"Flixster Users",keyValue:"41% liked it."}],seasonTitleID:0,showTitleID:0,titleType:"Movie",buyAvail:false,buyPrice:0,rentAvail:true,rentPrice:4.99,responseCode:0,responseMessage:"Success",titleID:388001,boxartPrefix:"the_wiggles_hot_potatoes__ggles_c594d6e6_",name:"The Wiggles: Hot Potatoes! The Best Of The Wiggles"}}};var m={data:{id:"23_getPurchasedTitle",result:{passID:1211257,dateExpired:"2016-12-31T20:59:00.0000000-08:00",datePurchased:"2010-07-14T15:29:18.0630000-07:00",watchStatus:"WatchNow",expirationMessage:"",streamPlayStatus:"stopped",streamStartTimeSeconds:0,storeLogoUrl:"http://web1.cinemanow.com/img/BB_CN_logo_J_PSD_RGB.png",releaseYear:"2008",bonusAssets:[{bonusAssetID:491966,profile:"STANDARD",bonusType:"Trailer"}],availableProducts:[{skuID:386682,purchaseType:"rent",price:3.99,availableAssets:[{file_DRMProvider:"WIDEVINE",file_AccessType:"STREAM",file_FileProfile:"STANDARD",file_VideoFormat:"H264"}],expireDateUTC:"2010-12-13T08:00:00.0000000-08:00",promoText:"",rentalPeriod:24}],directors:"Luis Eduardo Reyes",actors:"Silvia Navarro, Alan Estrada, Plutarco Haza, Rafael Amaya, Octavio Ocana, Shakti Urrutia",writers:"Luis Eduardo Reyes",producers:"Jorge Levy, Fernando Perez Gavilan, Pablo Martnez De Velasco",copyright:"&copy; MMVIII Lions Gate Films Inc., Videocine, S.A.de C.V., and Prinz Films. All Rights Reserved.",ratingReason:"",wheelItems:["r_critics","r_user_revs","m_credits","m_cast_bios","m_cast_crew","m_images","m_technical_details"],mPAARating:"NR",synopsys:'Hanna makes a big mistake that puts her on a direct collision course with some eligible and not-so-eligible bachelors. Now, between her search for a new job and her hilarious forays into babysitting her best friend\'s son, Hanna has to find and retrieve "lost money" in this hilarious misadventure that proves romance happens where and when you least expect it.',metaValues:[{keyName:"HD",keyValue:"False"},{keyName:"InUserWishlist",keyValue:"False"},{keyName:"RunTime",keyValue:"1 hour, 39 minutes."},{keyName:"AirDate",keyValue:"7/13/2010 12:00:00 AM"},{keyName:"YourRating",keyValue:"0"},{keyName:"CriticsReview",keyValue:"12% liked it."},{keyName:"Flixster Users",keyValue:"41% liked it."}],seasonTitleID:0,showTitleID:0,titleType:"Movie",buyAvail:false,buyPrice:0,rentAvail:true,rentPrice:3.99,responseCode:0,responseMessage:"Success",titleID:338043,boxartPrefix:"amor_letra_por_letra_431d97a6_",name:"Amor, Letra Por Letra"}}};var f={data:{id:"23_getPurchasedTitle",result:{passID:1212625,dateExpired:"2010-11-03T00:00:00.0000000-07:00",datePurchased:"2010-08-05T15:30:16.4200000-07:00",watchStatus:"WatchNow",streamPlayStatus:"stopped",streamStartTimeSeconds:0,storeLogoUrl:"http://web1.cinemanow.com/img/BB_CN_logo_J_PSD_RGB.png",releaseYear:"2009",bonusAssets:[],availableProducts:[{skuID:368448,purchaseType:"buy",price:1.99,availableAssets:[{file_DRMProvider:"WIDEVINE",file_AccessType:"STREAM",file_FileProfile:"STANDARD",file_VideoFormat:"H264"}],expireDateUTC:"2010-11-03T07:00:00.0000000-07:00",promoText:"",rentalPeriod:0}],directors:"Fred Toye",actors:"Elizabeth Mitchell, Morris Chestnut, Joel Gretsch, Lourdes Benedicto, Logan Huffman, Laura Vandervoort, Morena Baccarin",writers:"Diego Gutierrez, Christine Roum",producers:"Scott Peters, Jace Hall, Jeffrey Bell",copyright:"&trade; &amp; &copy; 2009 Warner Bros. Entertainment Inc.  All rights reserved.",ratingReason:"",wheelItems:["m_credits","m_cast_bios","m_cast_crew","m_technical_details"],mPAARating:"NR",synopsys:"Chad reports from the Peace Ambassador Center as visas are issued to the first wave of Visitors, including Anna. Erica, paired with a V officer, begins tracking a death threat.",metaValues:[{keyName:"TVSeasonHeader",keyValue:"V : Season 01"},{keyName:"TVEpisodeHeader",keyValue:"Episode 03 : A Bright New Day"},{keyName:"HD",keyValue:"False"},{keyName:"InUserWishlist",keyValue:"False"},{keyName:"RunTime",keyValue:"1 hour, 0 minutes."},{keyName:"AirDate",keyValue:"11/23/2009 12:00:00 AM"},{keyName:"YourRating",keyValue:"0"},{keyName:"CriticsReview",keyValue:"12% liked it."},{keyName:"Flixster Users",keyValue:"41% liked it."}],seasonTitleID:367666,showTitleID:367668,titleType:"TV_Episode",buyAvail:true,buyPrice:1.99,rentAvail:false,rentPrice:0,responseCode:0,responseMessage:"Success",titleID:368447,boxartPrefix:"v__season_01__episode_03__w_day_a04116f8_",name:"A Bright New Day"}}};var h={data:{id:"24_getPurchasedTitle",result:{passID:1204272,dateExpired:"0001-01-01T00:00:00.0000000-08:00",datePurchased:"2010-04-09T10:21:55.6400000-07:00",watchStatus:"NotAvailable_HoldBack",streamPlayStatus:"stopped",streamStartTimeSeconds:0,storeLogoUrl:"http://web1.cinemanow.com/img/BB_CN_logo_J_PSD_RGB.png",releaseYear:"2007",bonusAssets:[],availableProducts:[],directors:"",actors:"Daniel Tosh",writers:"",producers:"",copyright:"&copy;",ratingReason:"",wheelItems:["r_critics","r_user_revs","m_credits","m_cast_bios","m_cast_crew","m_technical_details"],mPAARating:"NR",synopsys:"Comedy's chosen one, Daniel Tosh, has been healing the sick, stopping wars, helping underprivileged children... and filming Completely Serious, the single greatest hour in comedy.",metaValues:[{keyName:"HD",keyValue:"False"},{keyName:"InUserWishlist",keyValue:"False"},{keyName:"RunTime",keyValue:"1 hour, 0 minutes."},{keyName:"AirDate",keyValue:"5/30/2007 12:00:00 AM"},{keyName:"YourRating",keyValue:"0"},{keyName:"CriticsReview",keyValue:"12% liked it."},{keyName:"Flixster Users",keyValue:"41% liked it."}],seasonTitleID:0,showTitleID:0,titleType:"Movie",buyAvail:false,buyPrice:0,rentAvail:false,rentPrice:0,responseCode:0,responseMessage:"Success",titleID:246511,boxartPrefix:"daniel_tosh_completely_se_rious_db009af1_",name:"Daniel Tosh: Completely Serious"}}};$cn.utilities.adjustDate(l.data.result,$cn.config.replacementPattern);k.call(self,l.data.result)};$cn.methods.verifyCode=function(f,d,e){e.call(self,{giftCertificateBalance:2000,discountAmount:99,discountType:"Coupon",responseCode:0,responseMessage:"Success"})};$cn.methods.getActivationString=function(d){setTimeout(function(){var f=Math.random()*8999999;f+=1000000;f=parseInt(f);var e={data:{id:5,result:f.toString()}};d.call(self,e.data.result)},10)};$cn.methods.setupDevice=function(g,e,f){var d;switch($cn.config.CurrentTheme){case"dixons":d={data:{id:"1_setupDevice",result:{sessionID:"93401f4b-6c71-4b26-b6b0-24a788d0eb47",configValues:[{keyName:"BandwithCheckURLSize",keyValue:"3757608"},{keyName:"AffId",keyValue:"12345"},{keyName:"ImageLoadTest",keyValue:"http://www.cinemanow.com/images/spacer.gif"},{keyName:"ParentalControlsConfigured",keyValue:"True"},{keyName:"ParentPinEnabled",keyValue:"False"},{keyName:"JinniEnable",keyValue:"False"},{keyName:"FlixsterEnable",keyValue:"False"},{keyName:"AdultPinEnabled",keyValue:"False"},{keyName:"SessionLimitRows",keyValue:"30"},{keyName:"SessionLimitMinutes",keyValue:"2"},{keyName:"AllowAdult",keyValue:"False"},{keyName:"AllowPlayboy",keyValue:"False"},{keyName:"LastCacheLoadTimeUTC"},{keyName:"ShouldUpdateCache",keyValue:"True"},{keyName:"CountryID",keyValue:"1"},{keyName:"ActivationURL",keyValue:"bestbuy.cinemanow.com/activate"},{keyName:"DisplayEula",keyValue:"False"},{keyName:"ShouldEnableTvNode",keyValue:"True"},{keyName:"BandwithCheckURL",keyValue:"http://downloadtest.cinemanow.com.edgesuite.net/bumper1.vob"},{keyName:"AuthTokenActive",keyValue:"False"},{keyName:"RecomendedGenreIds",keyValue:"10972,10991,11096"},{keyName:"DolbyEnable",keyValue:"False"},{keyName:"DTSEnable",keyValue:"False"},{keyName:"SystemUnavailableMessage",keyValue:"This is my test message"},{keyName:"RegionCode",keyValue:"eng"},{keyName:"AllowedRegions",keyValue:"88,22,11"},{keyName:"CountryID",keyValue:"82"}],responseCode:0}}};break;case"bby":case"whitelabel":d={data:{id:"2_setupDevice",result:{sessionID:"d62760fd-3cef-4d3e-ad76-82ff0db79041",configValues:[{keyName:"ParentPinEnabled",keyValue:"False"},{keyName:"AdultPinEnabled",keyValue:"False"},{keyName:"PurchasePinEnabled",keyValue:"False"},{keyName:"ParentalControlsConfigured",keyValue:"False"},{keyName:"SessionLimitRows",keyValue:"30"},{keyName:"SessionLimitMinutes",keyValue:"2"},{keyName:"AllowAdult",keyValue:"False"},{keyName:"AllowPlayboy",keyValue:"False"},{keyName:"RootMoodGenreID",keyValue:"10995"},{keyName:"TVRootMoodGenreID",keyValue:"11040"},{keyName:"RecomendedGenreIds",keyValue:"10972,10991,11096"},{keyName:"ImageLoadTest",keyValue:"http://www.cinemanow.com/img/spacer.gif"},{keyName:"FlixsterIcon",keyValue:""},{keyName:"RottentomatoesIcon",keyValue:""},{keyName:"JinniEnable",keyValue:"True"},{keyName:"FlixsterEnable",keyValue:"True"},{keyName:"BaselineEnable",keyValue:"True"},{keyName:"DolbyEnable",keyValue:"True"},{keyName:"DTSEnable",keyValue:"false"},{keyName:"DolbyPlusEnable",keyValue:""},{keyName:"DolbyStereoEnable",keyValue:""},{keyName:"DTSStereoEnable",keyValue:""},{keyName:"Dolby51TestFile",keyValue:""},{keyName:"DTS51TestFile",keyValue:""},{keyName:"DolbyStereoTestFile",keyValue:""},{keyName:"DTSStereoTestFile",keyValue:""},{keyName:"CountryID",keyValue:"1"},{keyName:"CountryCode",keyValue:"usa"},{keyName:"ClientIP",keyValue:"173.164.127.145"},{keyName:"RegionCode",keyValue:"or"},{keyName:"AllowedRegions",keyValue:"ab,aol,bc,mb,nb,nf,ns,nt,nu,on,pe,sk,yt,na,qc"},{keyName:"LastCacheLoadTimeUTC",keyValue:"2012-06-28T19:47:02.0000000"},{keyName:"ShouldUpdateCache",keyValue:"True"},{keyName:"AffId",keyValue:"2314"},{keyName:"ActivationURL",keyValue:"www.cinemanow.com/activate"},{keyName:"EnableAccountLink",keyValue:"False"},{keyName:"Account_Link_URL",keyValue:"www.roxionow.com/link"},{keyName:"DisplayEula",keyValue:"False"},{keyName:"ShouldEnableTvNode",keyValue:"True"},{keyName:"BandwithCheckURL",keyValue:"http://downloadtest.cinemanow.com.edgesuite.net/bumper1.vob"},{keyName:"MinimumHDNetworkSpeedMBPS",keyValue:"3.5"},{keyName:"BandwithCheckURLSize",keyValue:"3757608"},{keyName:"BandwidthCheckURLSize",keyValue:"3757608"},{keyName:"GiftCardURL",keyValue:"www.cinemanow.com/bbgiftcard"},{keyName:"AuthTokenActive",keyValue:"False"},{keyName:"PollLibraryUpdateIntervalInSeconds",keyValue:"2"},{keyName:"UVEnabled",keyValue:"False"}],responseCode:0,responseMessage:"Success"}}};break}f.call(self,d)};$cn.methods.lookupPurchaseDetailsForTitle=function(d,f){var e={result:{isAvailable:true,passID:"0",state:"Bought_SD",responseCode:-1,responseMessage:"Invalid API Key"}};f.call(self,e.result)};$cn.methods.checkIfTitleInLibrary=function(d,e){e.call(self,false)};$cn.methods.getBillingInfo=function(e){var d={result:{giftCertificateBalance:500,responseCode:-1,cCLast4:"1234",responseMessage:"Invalid API Key"}};e.call(self,d.result)};$cn.methods.doPurchase=function(g,f,e){var d={result:{passID:0,responseCode:-1,responseMessage:"Invalid API Key"}};e.call(self,d.result)};$cn.methods.getGenres=function(e,f){var d={genres:[{iD:10959,name:"Action",visible:true,parentId:0},{iD:10960,name:"Adventure",visible:true,parentId:0},{iD:10961,name:"Animation",visible:true,parentId:0},{iD:10962,name:"Comedy",visible:true,parentId:0},{iD:10963,name:"Drama",visible:true,parentId:0},{iD:10964,name:"Family",visible:true,parentId:0},{iD:10965,name:"Horror",visible:true,parentId:0},{iD:10966,name:"Romance",visible:true,parentId:0},{iD:10967,name:"Sci-Fi",visible:true,parentId:0},{iD:10968,name:"Thriller",visible:true,parentId:0},{iD:10969,name:"Westerns",visible:true,parentId:0}],responseCode:0,responseMessage:"Success"};f.call(self,d.genres)};$cn.methods.getAvailMasterWheelOptions=function(e){var d={result:{masterWheelOptionList:["Movies","TV_Shows","Movie_Rentals","HD_Movies"],responseCode:0}};e.call(self,d.result)};$cn.methods.getAvailLibSlaveWheelOptionByMasterWheel=function(e,f){var d={slaveWheelOptionList:["All","Never_Watched","Unavailable","Expired","Expiring_Soon"],genreList:[{iD:10959,name:"Action",visible:true,parentId:10954},{iD:10960,name:"Adventure",visible:true,parentId:10954},{iD:10961,name:"Animation",visible:true,parentId:10954},{iD:10962,name:"Comedy",visible:true,parentId:10954},{iD:10963,name:"Drama",visible:true,parentId:10954},{iD:10964,name:"Family",visible:true,parentId:10954},{iD:10966,name:"Romance",visible:true,parentId:10954},{iD:10967,name:"Sci-Fi",visible:true,parentId:10954},{iD:10968,name:"Thriller",visible:true,parentId:10954},{iD:11070,name:"Animation",visible:true,parentId:11062},{iD:11073,name:"Comedy",visible:true,parentId:11062},{iD:11077,name:"Drama",visible:true,parentId:11062},{iD:11084,name:"Reality",visible:true,parentId:11062},{iD:11087,name:"Sci-Fi",visible:true,parentId:11062},{iD:11089,name:"Sports",visible:true,parentId:11062},{iD:11093,name:"Unscripted",visible:true,parentId:11062}],responseCode:0,responseMessage:"Success"};f.call(self,d)};$cn.methods.getUserLibrary=function(g,f,d,h){var e={result:{items:[{passID:7983526,titleID:421827,boxartPrefix:"the_craigslist_killer_c80c0109_",name:"The Craigslist Killer"},{passID:1141057,titleID:375612,boxartPrefix:"zoom_superheroes_",name:"Zoom: Academy for Superheroes Zoom: Academy for Superheroes"},{passID:1210171,titleID:381888,boxartPrefix:"the_book_of_eli_cbbd08c4_",name:"The Book of Eli"},{passID:1208381,titleID:380431,boxartPrefix:"avatar_a1ee5f9a_",name:"Avatar"},{passID:1144474,titleID:338330,boxartPrefix:"van_helsing_a9793ba8_",name:"Van Helsing"},{passID:1141057,titleID:132184,boxartPrefix:"zoom_superheroes_",name:"Zoom: Academy for Superheroes Zoom: Academy for Superheroes"},{passID:1141056,titleID:132184,boxartPrefix:"zoom_superheroes_",name:"Zoom: Academy for Superheroes"},{passID:1140868,titleID:255028,boxartPrefix:"magic_in_the_water_eeacf4ac_",name:"Magic in the Water"},{passID:1139654,titleID:26971,boxartPrefix:"mirrormask_",name:"MirrorMask"}],responseCode:0,responseMessage:"Success"}};h.call(self,e.result)};$cn.methods.getUserLibraryCounts=function(f){var e={id:"5_getUserLibraryCounts",result:{libraryCounts:[{keyName:"TotalTV",keyValue:"10"},{keyName:"TotalMovies",keyValue:"174"},{keyName:"TotalUnavailable",keyValue:"12"}],responseCode:0,responseMessage:"Success"}};var d={id:"93_getUserLibraryCounts",result:{libraryCounts:[],responseCode:31,responseMessage:"AuthToken Not Available"}};f.call(self,e.result.libraryCounts)};$cn.methods.checkUserWishListForItems=function(e){var d={result:true};e.call(self,d.result)};$cn.methods.addItemToWishList=function(e,f){var d={result:{responseCode:0,responseMessage:"Success"}};f.call(self,d.result)};$cn.methods.getWishlist=function(d,g){var f={result:{items:[],responseCode:0,responseMessage:"Success"}};var e={result:{items:[{titleID:387585,boxartPrefix:"memphis_beat_bc0ce123_",name:"Season 01"},{titleID:387583,boxartPrefix:"memphis_beat_bc0ce123_",name:"Memphis Beat"},{titleID:387580,boxartPrefix:"memphis_beat__season_01___pilot_dee4c2c1_",name:"Pilot"},{passID:1141057,titleID:132184,boxartPrefix:"zoom_superheroes_",name:"Zoom: Academy for Superheroes Zoom: Academy for Superheroes"},{passID:1141056,titleID:132184,boxartPrefix:"zoom_superheroes_",name:"Zoom: Academy for Superheroes Zoom: Academy for Superheroes"},{passID:1140868,titleID:255028,boxartPrefix:"magic_in_the_water_eeacf4ac_",name:"Magic in the Water"},{passID:1139654,titleID:26971,boxartPrefix:"mirrormask_",name:"MirrorMask"},{titleID:375612,boxartPrefix:"sherlock_holmes_15163820_",name:"Sherlock Holmes"},{titleID:377892,boxartPrefix:"alvin_and_the_chipmunks_t_kquel_9ec1ca66_",name:"Alvin and the Chipmunks: The Squeakquel Alvin and the Chipmunks: The Squeakquel"},{titleID:374145,boxartPrefix:"2012_403ab92b_",name:"2012"},{titleID:374691,boxartPrefix:"imax_under_the_sea_4f9ead1e_",name:"Under the Sea"},{titleID:375605,boxartPrefix:"the_blind_side_80b4e1eb_",name:"The Blind Side"},{titleID:375624,boxartPrefix:"fantastic_mr_fox_46abb859_",name:"Fantastic Mr. Fox"}],responseCode:0,responseMessage:"Success"}};setTimeout(function(){g.call(self,e.result)},500)};$cn.methods.removeItemFromWishList=function(e,f){var d={result:{responseCode:0,responseMessage:"Success"}};f.call(self,d.result)}}$cn.methods.GetCacheKey=function(g,f,e){var d="Metadata|"+g+"|";if(e){d+=($cn.data.IsParent?"1":"0")}if(f){for(o in f){d+=","+f[o]}}return d};$cn.methods.getNav=function(e){var d="getNavigation";webservices.makeAsyncRequest(application.EndPoints.browse,d,{},this,e,this.GetCacheKey(d,null,true))};$cn.methods.getMerchandize=function(e){var d="getMerchandize";webservices.makeAsyncRequest(application.EndPoints.browse,d,{},this,function(f){$cn.data.Merch=f.data.result;e.call(this,f.data.result)})};$cn.methods.getBrowseForTitlesByGenreId=function(e,f,j,d){var h="getBrowseList",g={GenreID:e,PageNum:f,ItemsPerPage:$cn.data.PAGE_SIZE,Sort:"Standard",ProfileFilter:"none",PurchaseType:(d)?d:$cn.data.purchTypeFilter};log.write("getBrowseForTitlesByGenreId Debug: Enter, calling getBrowseList with genreid "+e);webservices.makeAsyncRequest(application.EndPoints.browse,h,g,this,function(k){log.write("getBrowseForTitlesByGenreId Debug: Back from getBrowseList for genreid "+e+" with "+k.data.result.items.length+"items");if(k&&!k.err&&k.data&&k.data.result){$cn.data.TitlesByGenrePages[f]=k;var l=[],m=0;for(m=0;m<k.data.result.items.length;m++){l[m]=k.data.result.items[m].titleID}$cn.methods.getShortSummaryPlural(l,function(){if($cn.methods.DEBUG){log.write("getBrowseForTitlesByGenreId Debug: Invoking callback passing result with ids array:")}if($cn.methods.DEBUG){$cn.methods.dumpResultItems(k)}j.call(this,k)})}},this.GetCacheKey(h,g,true))};$cn.methods.dumpResultItems=function(d){if(d&&d.data&&d.data.result&&d.data.result.items){var e=[],f=0;for(f=0;f<d.data.result.items.length;f++){e[f]=d.data.result.items[f].titleID}log.write("dumpResultItems Debug: titleIds are "+log.dumpObj(e))}else{log.write("dumpResultItems Debug: titleIds are EMPTY")}};$cn.methods.getTitlesByGenreId=function(h,j,l,e){log.write("getTitlesByGenreId Debug: Enter with genreid "+h);$cn.data.ContentIsFiltered=(!$cn.data.IsParent&&$cn.data.ParentPinEnabled)?true:false;var k=false;for(var g=0;g<$cn.data.RecomendedGenreIds.length;g++){if(parseInt($cn.data.RecomendedGenreIds[g])==parseInt(h)){k=true;break}}if($cn.methods.DEBUG){log.write("getTitlesByGenreId Debug: isRecommended is set to "+k)}if(h!=$cn.data.TitlesByGenreID){$cn.data.TitlesByGenreID=h;$cn.data.TitlesByGenrePages={}}if(k||!$cn.data.TitlesByGenrePages[j]){if($cn.methods.DEBUG){log.write("getTitlesByGenreId Debug: Calling getBrowseForTitlesByGenreId (WS GetBrowseList) with genreid "+h)}$cn.methods.getBrowseForTitlesByGenreId(h,j,l,e)}else{if($cn.methods.DEBUG){log.write("getTitlesByGenreId Debug: Skipping WS GetBrowseList for genreid "+h+", page "+j+" and invoking callback passing ids array:")}if($cn.methods.DEBUG){$cn.methods.dumpResultItems($cn.data.TitlesByGenrePages[j])}var m=$cn.data.TitlesByGenrePages[j];var d=[],f=0;for(f=0;f<m.data.result.items.length;f++){d[f]=m.data.result.items[f].titleID}$cn.methods.getShortSummaryPlural(d,function(){if($cn.methods.DEBUG){log.write("getBrowseForTitlesByGenreId Debug: Invoking callback passing cached result with ids array:")}l.call(this,$cn.data.TitlesByGenrePages[j])})}};$cn.methods.getBrowseListByCast=function(d,e,h){log.write("getBrowseListByCast Debug: Enter.");if(!$cn.data.TitlesByCast[d+"-"+e]){var g="getBrowseListByCast",f={CastID:d,PageNum:e,ItemsPerPage:$cn.data.PAGE_SIZE,Sort:"Standard",ProfileFilter:"none",PurchaseType:$cn.data.purchTypeFilter};webservices.makeAsyncRequest(application.EndPoints.browse,g,f,this,function(j){$cn.methods.getSummariesForTheseIds(j,function(){if(j&&!j.err&&j.data&&j.data.result){$cn.data.TitlesByCast[d+"-"+e]=j;h.call(this,$cn.data.TitlesByCast[d+"-"+e])}})},this.GetCacheKey(g,f,true))}else{h.call(this,$cn.data.TitlesByCast[d+"-"+e])}};$cn.methods.getBrowseListByCastRole=function(d,j,e,h){log.write("getBrowseListByCastRole Debug: Enter.");var g="getBrowseListByCastRole",f={CastID:d,SearchOption:j,PageNum:e,ItemsPerPage:$cn.data.PAGE_SIZE,Sort:"Standard",ProfileFilter:"none",PurchaseType:$cn.data.purchTypeFilter};webservices.makeAsyncRequest(application.EndPoints.browse,g,f,this,function(k){if(k&&!k.err&&k.data&&k.data.result){$cn.methods.getSummariesForTheseIds(k,function(){h.call(this,k)})}},this.GetCacheKey(g,f,true))};$cn.methods.getBrowseListByGene=function(d,f,e,j){log.write("getBrowseListByGene Debug: Enter.");if(!$cn.data.TitlesBySimilar[f+"-"+d+"-"+e]){var h="getBrowseListByGene",g={GeneId:d,TitleId:f,PageNum:e,ItemsPerPage:$cn.data.PAGE_SIZE,Sort:"recommend",ProfileFilter:"none",PurchaseType:$cn.data.purchTypeFilter};webservices.makeAsyncRequest(application.EndPoints.browse,h,g,this,function(k){if(k&&!k.err&&k.data&&k.data.result){$cn.data.TitlesBySimilar[f+"-"+d+"-"+e]=k;j.call(this,$cn.data.TitlesBySimilar[f+"-"+d+"-"+e])}},this.GetCacheKey(h,g,true))}else{j.call(this,$cn.data.TitlesBySimilar[f+"-"+d+"-"+e])}};$cn.methods.getBrowseListByGeneWithSimilarBy=function(d,f,e,j){log.write("getBrowseListByGeneWithSimilarBy Debug: Enter.");log.write("Method key: "+f+"-"+d+"-"+e);if(!$cn.data.TitlesBySimilar[f+"-"+d+"-"+e]){var h="getBrowseListByGeneWithSimilarBy",g={GeneId:d,TitleId:f,PageNum:e,ItemsPerPage:$cn.data.PAGE_SIZE,Sort:"recommend",ProfileFilter:"none",PurchaseType:$cn.data.purchTypeFilter};webservices.makeAsyncRequest(application.EndPoints.browse,h,g,this,function(k){$cn.methods.getSummariesForTheseIds(k,function(){if(k&&!k.err&&k.data&&k.data.result){$cn.data.TitlesBySimilar[f+"-"+d+"-"+e]=k;j.call(this,$cn.data.TitlesBySimilar[f+"-"+d+"-"+e])}})},this.GetCacheKey(h,g,true))}else{j.call(this,$cn.data.TitlesBySimilar[f+"-"+d+"-"+e])}};$cn.methods.getGenesByWheelOptionPlural=function(d,g){log.write("getGenesByWheelOptionPlural Debug: Enter.");if(!$cn.data.TitleRecommendations[d]){var f="getGenesByWheelOptionPlural",e={TitleId:d};webservices.makeAsyncRequest(application.EndPoints.titledata,f,e,this,function(h){if(h&&!h.err&&h.data){$cn.data.TitleRecommendations[d]=h.data.result;g.call(this,h.data.result)}},this.GetCacheKey(f,e,true))}else{g.call(this,$cn.data.TitleRecommendations[d])}};$cn.methods.getBrowseListBySimilar=function(f,d,g,e,k){log.write("getBrowseListBySimilar Debug: Enter.");if(!$cn.data.TitlesBySimilar[d+"-"+f+"-"+e+"-"+g]){var j="getBrowseListBySimilar",h={SimilarBy:f,TitleID:d,CategoryID:e,PageNum:g,ItemsPerPage:999,Sort:"Standard",ProfileFilter:"none",PurchaseType:$cn.data.purchTypeFilter};webservices.makeAsyncRequest(application.EndPoints.browse,j,h,this,function(l){if(l&&!l.err&&l.data&&l.data.result){$cn.data.TitlesBySimilar[d+"-"+f+"-"+e+"-"+g]=l;k.call(this,$cn.data.TitlesBySimilar[d+"-"+f+"-"+e+"-"+g])}},this.GetCacheKey(j,h,true))}else{k.call(this,$cn.data.TitlesBySimilar[d+"-"+g])}};$cn.methods.getBundleListing=function(d,g){log.write("getBundleListing Debug: Enter.");var f="getBundleListing",e={TitleID:d};if(!$cn.data.getBundleListing[d]){webservices.makeAsyncRequest(application.EndPoints.browse,f,e,this,function(h){var j={};j.data={};j.data.result={};j.data.result.items=h.data.result.bundleItems;$cn.methods.getSummariesForTheseIds(j,function(){log.write("+++ getBundleListing after getShortSummaryPlural +++");$cn.data.getBundleListing[d]=h.data.result;g.call(this,h.data.result)})},this.GetCacheKey(f,e,true))}else{g.call(this,$cn.data.getBundleListing[d])}};$cn.methods.getBundleListingPurchased=function(d,e){log.write("getBundleListingPurchased Debug: Enter.");webservices.makeAsyncRequest(application.EndPoints.browse,"getBundleListingPurchased",{TitleID:d},this,function(f){var g={};g.data={};g.data.result={};g.data.result.items=f.data.result.bundleItems;$cn.methods.getSummariesForTheseIds(g,function(){log.write("+++ getBundleListingPurchase after multiples +++");e.call(this,f.data.result)})})};$cn.methods.getShortSummary=function(d,g){log.write("cn.methods.getShortSummary: Passed titleid is "+d);if(!$cn.data.TitleSummaryCache[d]){var f="getShortSummary",e={TitleID:d};webservices.killCurrentRequests();webservices.makeAsyncRequest(application.EndPoints.titledata,f,e,this,function(h){if(h&&!h.err&&h.data&&h.data.result){$cn.data.TitleSummaryCache[d]=h.data.result;if($cn.config.CustomRatingKey&&$cn.config.CustomRatingKey!=""&&$cn.data.CountryID==$cn.config.CustomRatingCountry){var j="CR_"+$cn.utilities.getMeta($cn.config.CustomRatingKey,$cn.data.TitleSummaryCache[d].metaValues).replace(" ","_").replace("+","_Plus");log.write("Custom Rating: "+j);log.debug("Title: "+$cn.data.TitleSummaryCache[d].name+", mPAARating: "+$cn.data.TitleSummaryCache[d].mPAARating+", CHVRSRating:"+$cn.utilities.getMeta("CHVRSRating",$cn.data.TitleSummaryCache[d].metaValues).replace(" ","_").replace("+","_Plus")+", BBFCRating: "+$cn.utilities.getMeta("BBFCRating",$cn.data.TitleSummaryCache[d].metaValues).replace(" ","_").replace("+","_Plus"));if(j!="CR_"){$cn.data.TitleSummaryCache[d].mPAARating=j;log.debug("mPAARating changed to: "+j)}log.debug("############################")}g.call(this,$cn.data.TitleSummaryCache[d])}},this.GetCacheKey(f,e))}else{g.call(this,$cn.data.TitleSummaryCache[d])}};$cn.methods.getShortSummaryPlural=function(d,j){log.write("cn.methods.getShortSummaryPlural: Passed titleids are "+d);var f,e=[];for(f=0;f<d.length;f++){if(!$cn.data.TitleSummaryCache[d[f]]){e[e.length]=d[f]}}if(e.length>0){var h="getShortSummaryPlural",g={TitleIDs:e.join()};webservices.killCurrentRequests();webservices.makeAsyncRequest(application.EndPoints.titledata,h,g,this,function(k){if(k&&!k.err&&k.data&&k.data.result){k.data.result.each(function(l){if($cn.config.CustomRatingKey&&$cn.config.CustomRatingKey!=""&&$cn.data.CountryID==$cn.config.CustomRatingCountry){l.mPAARating=$cn.utilities.getMeta($cn.config.CustomRatingKey,l.metaValues).replace("+","_Plus");l.mPAARating="CR_"+l.mPAARating}$cn.data.TitleSummaryCache[l.titleID]=l});j.call(this)}},this.GetCacheKey(h,g))}else{j.call(this)}};$cn.methods.getTitleListing=function(d,h,g){var f,e;if(!$cn.data.TitleDetailCache[d]||h){f="getFullSummary";e={TitleID:d,IncludePurchaseData:h};webservices.killCurrentRequests();webservices.makeAsyncRequest(application.EndPoints.titledata,f,e,this,function(j){if(j&&!j.err&&j.data&&j.data.result){var k="";$cn.utilities.adjustDate(j.data.result,$cn.config.replacementPattern);$cn.data.TitleDetailCache[d]=j.data.result;if($cn.config.CustomRatingKey&&$cn.config.CustomRatingKey!=""&&$cn.data.CountryID==$cn.config.CustomRatingCountry){var k="CR_"+$cn.utilities.getMeta($cn.config.CustomRatingKey,$cn.data.TitleDetailCache[d].metaValues).replace(" ","_").replace("+","_Plus");log.write("Custom Rating: "+k);if(k!="CR_"){$cn.data.TitleDetailCache[d].mPAARating=k}}g.call(this,$cn.data.TitleDetailCache[d])}})}else{g.call(this,$cn.data.TitleDetailCache[d])}};$cn.methods.getGenesByWheelOption=function(e,d,h){var g="getGenesByWheelOption",f={TitleID:e,WheelOption:d};webservices.makeAsyncRequest(application.EndPoints.titledata,g,f,this,function(j){if(j&&!j.err&&j.data&&j.data.result){h.call(this,j.data.result)}},this.GetCacheKey(g,f,true))};$cn.methods.getCastAndCrew=function(d,g){if(!$cn.data.TitleCastDetailCache[d]){var f="getCastAndCrew",e={TitleID:d};webservices.makeAsyncRequest(application.EndPoints.titledata,f,e,this,function(h){if(h&&!h.err&&h.data&&h.data.result){$cn.data.TitleCastDetailCache[d]=h.data.result;g.call(this,$cn.data.TitleCastDetailCache[d])}},this.GetCacheKey(f,e))}else{g.call(this,$cn.data.TitleCastDetailCache[d])}};$cn.methods.getCastBio=function(d,g){var f="getCastBio",e={CastID:d};webservices.makeAsyncRequest(application.EndPoints.titledata,f,e,this,function(h){if(h&&!h.err&&h.data&&h.data.result){g.call(this,h.data.result)}},this.GetCacheKey(f,e))};$cn.methods.getCastBios=function(d,g){var f="getCastBios",e={TitleID:d};webservices.makeAsyncRequest(application.EndPoints.titledata,f,e,this,function(h){if(h&&!h.err&&h.data&&h.data.result){g.call(this,h.data.result)}},this.GetCacheKey(f,e))};$cn.methods.getCredits=function(d,g){if(!$cn.data.TitleCreditsCache[d]){var f="getCredits",e={TitleID:d};webservices.makeAsyncRequest(application.EndPoints.titledata,f,e,this,function(h){if(h&&!h.err&&h.data&&h.data.result){$cn.data.TitleCreditsCache[d]=h.data.result;g.call(this,$cn.data.TitleCreditsCache[d])}},this.GetCacheKey(f,e))}else{g.call(this,$cn.data.TitleCreditsCache[d])}};$cn.methods.getImages=function(d,g){if(!$cn.data.TitleImagesCache[d]){var f="getImages",e={TitleID:d};webservices.makeAsyncRequest(application.EndPoints.titledata,f,e,this,function(h){if(h&&!h.err&&h.data&&h.data.result){$cn.data.TitleImagesCache[d]=h.data.result;g.call(this,$cn.data.TitleImagesCache[d])}},this.GetCacheKey(f,e))}else{g.call(this,$cn.data.TitleImagesCache[d])}};$cn.methods.getTechnicalDetails=function(d,g){if(!$cn.data.TitleTechnicalDetailsCache[d]){var f="getTechnicalDetails",e={TitleId:d};webservices.makeAsyncRequest(application.EndPoints.titledata,f,e,this,function(h){if(h&&!h.err){$cn.data.TitleTechnicalDetailsCache[d]=h.data.result;g.call(this,$cn.data.TitleTechnicalDetailsCache[d])}},this.GetCacheKey(f,e))}else{g.call(this,$cn.data.TitleTechnicalDetailsCache[d])}};$cn.methods.getReviews=function(e,d,h){var g="getReviews",f={TitleID:e,ReviewTypeFilter:d};webservices.makeAsyncRequest(application.EndPoints.titledata,g,f,this,function(j){if(j&&!j.err&&j.data){h.call(this,j.data.result)}},this.GetCacheKey(g,f))};$cn.methods.getUpgradeOffers=function(d,e){webservices.makeAsyncRequest(application.EndPoints.titledata,"getUpgradeOffers",{TitleID:d},this,function(f){if(f&&!f.err&&f.data){e.call(this,f.data.result)}})};$cn.methods.rateTitle=function(e,d,f){webservices.makeAsyncRequest(application.EndPoints.titledata,"rateTitle",{TitleID:e,Rating:d},this,function(g){if(g&&!g.err){f.call(this,g)}})};$cn.methods.getSearchTitle=function(f,e,g){log.write("+++ getSearchTitle +++");var d={Query:f,SearchOption:e};webservices.killCurrentRequests();webservices.makeAsyncRequest(application.EndPoints.search,"searchTitle",d,this,function(h){$cn.methods.getSummariesForTheseIds(h,function(){log.write("+++ getSearchTitle after getMultiples +++");$cn.data.TitleSearchCache["Search-"+f]=h.data.result;g.call(this,$cn.data.TitleSearchCache["Search-"+f])})})};$cn.methods.getSearchPerson=function(f,e,g){var d={Query:f,SearchOption:e};webservices.killCurrentRequests();webservices.makeAsyncRequest(application.EndPoints.search,"searchPerson",d,this,function(h){if(h&&!h.err&&h.data&&h.data.result){$cn.data.TitlePersonCache["SearchPerson-"+f]=h.data.result;g.call(this,$cn.data.TitlePersonCache["SearchPerson-"+f])}})};$cn.methods.getWishlist=function(d,e){webservices.makeAsyncRequest(application.EndPoints.wishlist,"getWishlist",{TitleTypeFilter:d},this,function(f){$cn.methods.getSummariesForTheseIds(f,function(){log.write("+++ getWishlist after multiples +++");e.call(this,f.data.result)})})};$cn.methods.getWishlistExt=function(d,e){webservices.makeAsyncRequest(application.EndPoints.wishlist,"getWishlistExt",{TitleTypeFilter:d},this,function(f){if(f&&!f.err){$cn.methods.getSummariesForTheseIds(f,function(){log.write("+++ getWishlistExt after getShortSummaryPlural +++");e.call(this,f.data.result)})}})};$cn.methods.checkUserWishListForItems=function(d){webservices.makeAsyncRequest(application.EndPoints.wishlist,"checkUserWishListForItems",{},this,function(e){log.write("checkUserWishListForItems returned "+e.data.result);if(e&&!e.err){d.call(this,e.data.result)}})};$cn.methods.addItemToWishList=function(d,e){webservices.makeAsyncRequest(application.EndPoints.wishlist,"addItemToWishList",{TitleID:d},this,function(f){if(f&&!f.err){e.call(this,f.data.result)}})};$cn.methods.removeAllItemsFromWishList=function(d){webservices.makeAsyncRequest(application.EndPoints.wishlist,"removeAllItemsFromWishList",{},this,function(e){if(e&&!e.err){d.call(this,e.data.result)}})};$cn.methods.removeItemFromWishList=function(d,e){webservices.makeAsyncRequest(application.EndPoints.wishlist,"removeItemFromWishList",{TitleID:d},this,function(f){if(f&&!f.err){e.call(this,f.data.result)}})};$cn.methods.getBillingInfo=function(d){webservices.makeAsyncRequest(application.EndPoints.commerce,"getBillingInfo",{test:1},this,function(e){if(e&&!e.err){d.call(this,e.data.result)}})};$cn.methods.doPurchase=function(g,d,f,e){webservices.makeAsyncRequest(application.EndPoints.commerce,"doPurchase",{SKUID:g,CouponCode:f,TitleID:d},this,function(h){e.call(this,h.data.result)})};$cn.methods.checkIfTitleInLibrary=function(d,e){webservices.makeAsyncRequest(application.EndPoints.commerce,"checkIfTitleInLibrary",{TitleID:d},this,function(f){if(f&&!f.err){e.call(this,f.data.result)}})};$cn.methods.lookupPurchaseDetailsForTitle=function(d,e){webservices.makeAsyncRequest(application.EndPoints.commerce,"lookupPurchaseDetailsForTitle",{TitleID:d},this,function(f){if(f&&!f.err){e.call(this,f.data.result)}})};$cn.methods.verifyCode=function(f,d,e){webservices.makeAsyncRequest(application.EndPoints.commerce,"verifyCode",{SKUID:f,Code:d},this,function(g){if(g&&!g.err){e.call(this,g.data.result)}})};$cn.methods.applyGiftCode=function(d,e){webservices.makeAsyncRequest(application.EndPoints.commerce,"applyGiftCode",{Code:d},this,function(f){if(f&&!f.err){e.call(this,f.data.result)}})};$cn.methods.calcOrderTax=function(f,d,e){if($cn.config.EnableTaxAPI){webservices.makeAsyncRequest(application.EndPoints.commerce,"calcOrderTax",{SKUID:f,Code:d},this,function(g){if(g&&!g.err){e.call(this,g.data.result)}})}else{calcOrderTaxDefault=new Object();calcOrderTaxDefault.subTotal=0;calcOrderTaxDefault.tax=0;calcOrderTaxDefault.errorHandled=false;e.call(this,calcOrderTaxDefault)}};$cn.methods.pollForToken=function(d){webservices.makeAsyncRequest(application.EndPoints.auth,"pollForToken",{test:1},this,function(e){if(e&&!e.err){d.call(this,e.data.result)}})};$cn.methods.verifyAuthToken=function(e,d){if(application.authSupported){webservices.makeAsyncRequest(application.EndPoints.auth,"verifyAuthToken",{},this,function(f){if(f&&!f.err){e.call(this,f.data.result)}},null,d?-1:null)}else{log.write("auto verifying::application.authSupported is false");e.call(this,true)}};$cn.methods.loadToken=function(e,d){webservices.makeAsyncRequest(application.EndPoints.auth,"loadToken",{},this,function(f){if(f&&!f.err){$cn.data.AuthToken=f.data.result.authToken;$cn.data.AdultPinEnabled=f.data.result.adultPinEnabled;$cn.data.DeviceName=f.data.result.deviceFriendlyName;$cn.data.UserEmailAddress=f.data.result.emailAddress;$cn.data.ParentalControlsConfigured=f.data.result.parentalControlsConfigured;application.saveAuthToken();e.call(this,f.data.result)}},null,d?-1:null)};$cn.methods.getActivationString=function(d){webservices.makeAsyncRequest(application.EndPoints.auth,"getActivationString",{test:1},this,function(e){if(e&&!e.err&&e.data&&e.data.result){d.call(this,e.data.result)}})};$cn.methods.checkParentPin=function(d,e){webservices.makeAsyncRequest(application.EndPoints.auth,"checkParentPin",{PinCode:d},this,function(f){if(f&&!f.err&&f.data){e.call(this,f.data.result)}})};$cn.methods.toggleParentPin=function(d,e){webservices.makeAsyncRequest(application.EndPoints.auth,"toggleParentPin",{Setting:d},this,function(f){if(f&&!f.err&&f.data){e.call(this,f.data.result)}})};$cn.methods.togglePurchasePin=function(d,e){webservices.makeAsyncRequest(application.EndPoints.auth,"togglePurchasePin",{Setting:d},this,function(f){if(f&&!f.err&&f.data){e.call(this,f.data.result)}})};$cn.methods.generalizedUvApiCall=function(e,f,d){webservices.makeAsyncRequest(application.EndPoints.uv_auth,e,{},this,function(g){if(g&&!g.err){f(g.data.result)}},null,d?-1:null)};$cn.methods.getLinkingAccount=function(e,d){$cn.methods.generalizedUvApiCall("getLinkingAccount",e,d)};$cn.methods.getAccountLinkState=function(e,d){$cn.methods.generalizedUvApiCall("getAccountLinkState",e,d)};$cn.methods.loginUserUv=function(e,d){$cn.methods.generalizedUvApiCall("loginUserUV",e,d)};$cn.methods.getUVTermsOfService=function(d){if(!$cn.data.UVTermsText){$cn.methods.generalizedUvApiCall("getUVTermsOfService",d)}else{d.call(this,$cn.data.UVTermsText)}};$cn.methods.getLegalInfo=function(d){if(!$cn.data.LegalInfo){webservices.makeAsyncRequest(application.EndPoints.util,"getLegalInfo",{},this,function(e){if(e&&!e.err&&e.data&&e.data.result){$cn.data.LegalInfo=e.data.result;d.call(this,e.data.result)}})}else{d.call(this,$cn.data.LegalInfo)}};$cn.methods.getTermsOfService=function(d){if(!$cn.data.TermsText){webservices.makeAsyncRequest(application.EndPoints.util,"getTermsOfService",{},this,function(e){if(e&&!e.err&&e.data&&e.data.result){$cn.data.TermsText=e.data.result;d.call(this,e.data.result)}})}else{d.call(this,$cn.data.TermsText)}};$cn.methods.getTermsOfServiceAcceptance=function(d){d.call(this,true);return;webservices.makeAsyncRequest(application.EndPoints.util,"getTermsOfServiceAcceptance",{},this,function(e){if(e&&!e.err&&e.data){d.call(this,e.data.result)}})};$cn.methods.getPrivacyPolicy=function(d){if(!$cn.data.PrivacyText){webservices.makeAsyncRequest(application.EndPoints.util,"getPrivacyPolicy",{},this,function(e){if(e&&!e.err&&e.data&&e.data.result){$cn.data.PrivacyText=e.data.result;d.call(this,e.data.result)}})}else{d.call(this,$cn.data.PrivacyText)}};$cn.methods.getEulaText=function(d){if(!$cn.data.EulaText){webservices.makeAsyncRequest(application.EndPoints.util,"getEulaText",{},this,function(e){if(e&&!e.err&&e.data&&e.data.result){$cn.data.EulaText=e.data.result;d.call(this,e)}})}else{d.call(this,$cn.data.EulaText)}};$cn.methods.acceptEula=function(d){webservices.makeAsyncRequest(application.EndPoints.util,"acceptEula",{},this,function(e){if(e&&!e.err){$cn.data.EulaText="";d.call(this,e)}})};$cn.methods.setupDevice=function(f,d,e){if(d){webservices.makeAsyncRequest(application.EndPoints.util,"setupDevice",{LastCache_UTCTime:f},this,function(g){if(g&&!g.err){$cn.data.DeviceSettings=g;e.call(this,g)}})}else{e.call(this,$cn.data.DeviceSettings)}};$cn.methods.recordSessionData=function(d,e){webservices.makeAsyncRequest(application.EndPoints.util,"recordSessionData",{SessionData:d},this,function(f){if(f&&!f.err){e.call(this,f)}})};$cn.methods.recordSessionConnectionSpeedTest=function(d,e){webservices.makeAsyncRequest(application.EndPoints.util,"recordSessionConnectionSpeedTest",{TransferDuration:d,BytesTransferred:$cn.data.BandwithCheckURLSize},this,function(f){if(f&&!f.err){e.call(this,f)}})};$cn.methods.defineErrorCode=function(d,e){webservices.makeAsyncRequest(application.EndPoints.util,"defineErrorCode",{ErrorCode:d},this,function(f){if(f&&!f.err){e.call(this,f)}})};$cn.methods.headerTest=function(d){log.write("headertest");webservices.makeAsyncRequest(application.EndPoints.util,"CheckHeaderValues",{test:1},this,function(e){log.write(e);log.write("callback")})};$cn.methods.getAudioDefaultProperty=function(d){webservices.makeAsyncRequest(application.EndPoints.util,"getAudioDefaultProperty",{test:"void"},this,function(e){if(e&&!e.err){d.call(this,e.data.result)}})};$cn.methods.setAudioDefaultProperty=function(d,e){webservices.makeAsyncRequest(application.EndPoints.util,"setAudioDefaultProperty",{AudioSetting:d},this,function(f){if(f&&!f.err){e.call(this,f)}})};$cn.methods.getPurchasedTitle=function(e,d,f){webservices.makeAsyncRequest(application.EndPoints.library,"getPurchasedTitle",{PassID:e,TitleId:d},this,function(g){if(g&&!g.err){$cn.utilities.adjustDate(g.data.result,$cn.config.replacementPattern);if(g.data.result&&g.data.result.watchStatus&&g.data.result.watchStatus.indexOf("NotAvailable")>=0){f.call(this,g.data.result);return}if(!$cn.data.TitleDetailCache[d]){$cn.methods.getTitleListing(d,true,function(j){if($cn.config.CustomRatingKey&&$cn.config.CustomRatingKey!=""&&$cn.data.CountryID==$cn.config.CustomRatingCountry){var k="CR_"+$cn.utilities.getMeta($cn.config.CustomRatingKey,g.data.result.metaValues).replace(" ","_").replace("+","_Plus");log.write("Custom Rating: "+k);if(k!="CR_"){g.data.result.mPAARating=k}}f.call(this,g.data.result);j.errorHandled=true})}else{if($cn.config.CustomRatingKey&&$cn.config.CustomRatingKey!=""&&$cn.data.CountryID==$cn.config.CustomRatingCountry){var h="CR_"+$cn.utilities.getMeta($cn.config.CustomRatingKey,g.data.result.metaValues).replace(" ","_").replace("+","_Plus");log.write("Custom Rating: "+h);if(h!="CR_"){g.data.result.mPAARating=h}}f.call(this,g.data.result)}}})};$cn.methods.getUserLibrary=function(f,e,d,g){webservices.makeAsyncRequest(application.EndPoints.library,"getUserLibrary",{GenreId:f,MasterWheel:e,SlaveWheel:d},this,function(h){var k=h.data.result.items.length,j;$cn.data.isPassUVCache={};if($cn.config.EnableUV){while(k--){j=h.data.result.items[k];$cn.data.isPassUVCache[j.passID]={passID:j.passID,isPassUV:j.isPassUV}}}$cn.methods.getSummariesForTheseIds(h,function(){log.write("+++ getUserLibrary after getShortSummaryPlural +++");g.call(this,h.data.result)})})};$cn.methods.getUserLibraryExt=function(d){webservices.makeAsyncRequest(application.EndPoints.library,"getUserLibraryExt",{},this,function(e){if(e&&!e.err){var g=e.data.result.items.length,f;$cn.data.isPassUVCache={};if($cn.config.EnableUV){while(g--){f=e.data.result.items[g];$cn.data.isPassUVCache[f.passID]={passID:f.passID,isPassUV:f.isPassUV}}}$cn.methods.getSummariesForTheseIds(e,function(){log.write("+++ getUserLibraryExt after getShortSummaryPlural +++");d.call(this,e.data.result)})}},null,application.appSetting("WSRequestTimeout")*5)};$cn.methods.getSummariesForTheseIds=function(d,g){log.write("+++ getSummariesForTheseIds +++");var e=[],f=0;if(d&&!d.err&&d.data&&d.data.result){for(f=0;f<d.data.result.items.length;f++){if(d.data.result.items[f].titleID){e[e.length]=d.data.result.items[f].titleID}else{if(d.data.result.items[f].TitleID){e[e.length]=d.data.result.items[f].TitleID}else{log.write("+++++ getSummariesForTheseIds error ++++++++")}}}$cn.methods.getShortSummaryPlural(e,g)}};$cn.methods.getGenres=function(d,e){webservices.makeAsyncRequest(application.EndPoints.library,"getGenres",{TitleType:d},this,function(f){if(f&&!f.err){e.call(this,f.data.result.genres)}})};$cn.methods.getAvailGenresAndLibSlaveWheelOptions=function(d){webservices.makeAsyncRequest(application.EndPoints.library,"getAvailGenresAndLibSlaveWheelOptions",{},this,function(e){if(e&&!e.err){d.call(this,e.data.result)}})};$cn.methods.getAvailLibSlaveWheelOptionByMasterWheel=function(d,e){webservices.makeAsyncRequest(application.EndPoints.library,"getAvailLibSlaveWheelOptionByMasterWheel",{MasterWheel:d},this,function(f){if(f&&!f.err){$cn.data.LibraryWheelItems[d]=f.data.result;$cn.data.LibraryWheelItemsLastLoaded=new Date();log.write($cn.data.LibraryWheelItems[d]);e.call(this,$cn.data.LibraryWheelItems[d])}})};$cn.methods.getAvailMasterWheelOptions=function(d){webservices.makeAsyncRequest(application.EndPoints.library,"getAvailMasterWheelOptions",{},this,function(e){if(e&&!e.err){d.call(this,e.data.result)}})};$cn.methods.getUserLibraryCounts=function(d){webservices.makeAsyncRequest(application.EndPoints.library,"getUserLibraryCounts",{},this,function(e){if(e&&!e.err){d.call(this,e.data.result.libraryCounts)}})};$cn.methods.getBonusAssetLocation=function(d,e){if(!$cn.data.BonusAssetCache[d]){if(configuration.readValue("PreferredDRMProvider")=="DIVX"){webservices.makeXMLAsyncRequest("api/DivX/getBonusAssetLocation/default.ashx","getBonusAssetLocation",{BonusAssetID:d,TagStart:"<DivXGetBonusAssetLocation>",TagEnd:"</DivXGetBonusAssetLocation>"},this,function(f){if(f&&!f.err&&f.data&&f.data.result){$cn.data.BonusAssetCache[d]=f.data.result;e.call(this,$cn.data.BonusAssetCache[d])}})}else{webservices.makeAsyncRequest(application.EndPoints.stream,"getBonusAssetLocation",{BonusAssetID:d},this,function(f){if(f&&!f.err&&f.data&&f.data.result){$cn.data.BonusAssetCache[d]=f.data.result;e.call(this,$cn.data.BonusAssetCache[d])}})}}else{e.call(this,$cn.data.BonusAssetCache[d])}};$cn.methods.getStreamingAssetLocation=function(d,f,e){if(configuration.readValue("PreferredDRMProvider")=="DIVX"){webservices.makeXMLAsyncRequest("api/DivX/getStreamingURL/default.ashx","getStreamingAssetLocation",{PassID:d,FileProfile:f,TagStart:"<DivXGetStreamingURL>",TagEnd:"</DivXGetStreamingURL>"},this,function(g){if(g&&!g.err&&g.data&&g.data.result){e.call(this,g.data.result)}})}else{webservices.makeAsyncRequest(application.EndPoints.stream,"getStreamingAssetLocation",{PassID:d,FileProfile:f},this,function(g){if(g&&!g.err&&g.data&&g.data.result){e.call(this,g.data.result)}})}};$cn.methods.sendStopMessageForStream=function(d,e,f){if(configuration.readValue("PreferredDRMProvider")=="DIVX"){webservices.makeXMLAsyncRequest("api/DivX/sendStopMessageForStream/default.ashx","sendStopMessageForStream",{StreamID:d,StopTimeSeconds:e,TagStart:"<DivXsendStopMessageForStream>",TagEnd:"</DivXsendStopMessageForStream>"},this,function(g){if(g&&!g.err&&g.data&&g.data.result){f.call(this,g.data.result)}})}else{webservices.makeAsyncRequest(application.EndPoints.stream,"sendStopMessageForStream",{StreamID:d,StopTimeSeconds:e},this,function(g){if(g&&!g.err&&g.data&&g.data.result){f.call(this,g.data.result)}})}};$cn.methods.loadLastStreamingAssetLocationForPass=function(d,f,e){if(configuration.readValue("PreferredDRMProvider")=="DIVX"){webservices.makeXMLAsyncRequest("api/DivX/getLastStreaming/default.ashx","loadLastStreamingAssetLocationForPass",{PassID:d,FileProfile:f,TagStart:"<DivXGetLastStreaming>",TagEnd:"</DivXGetLastStreaming>"},this,function(g){if(g&&!g.err&&g.data&&g.data.result){e.call(this,g.data.result)}})}else{webservices.makeAsyncRequest(application.EndPoints.stream,"loadLastStreamingAssetLocationForPass",{PassID:d,FileProfile:f},this,function(g){if(g&&!g.err&&g.data&&g.data.result){e.call(this,g.data.result)}})}};$cn.methods.updateResumeTimeForPass=function(e,d,f){if(configuration.readValue("PreferredDRMProvider")=="DIVX"){webservices.makeXMLAsyncRequest("api/DivX/UpdateResumeTimeForPass/default.ashx","updateResumeTimeForPass",{PassID:e,ResumeTimeInSeconds:d,TagStart:"<DivXUpdateResumeTimeForPass>",TagEnd:"</DivXUpdateResumeTimeForPass>"},this,function(g){if(g&&!g.err&&g.data&&g.data.result){f.call(this,g.data.result)}})}else{webservices.makeAsyncRequest(application.EndPoints.stream,"updateResumeTimeForPass",{PassID:e,ResumeTimeInSeconds:d},this,function(g){if(g&&!g.err&&g.data&&g.data.result){f.call(this,g.data.result)}})}};var ccrender={safearea:0.05,width:960,height:540,originX:0,originY:0,resolutionX:864,resolutionY:486,minRow:4,maxFontSize:32,renderHtmlDivs:[],styleList:[],cellResolution:{cols:32,rows:15},defaultCCDisplayEnabled:false,userCCDisplayEnabled:undefined,isCCStreamAvailable:false,fontScale:1,ClosedCaptionPreview:"Preview text",colorRGB:{white:[255,255,255],black:[0,0,0],red:[255,0,0],green:[0,128,0],blue:[0,0,255],yellow:[255,255,0],magenta:[255,0,255],cyan:[0,255,255]},getCCRGB:function(d){d=this.colorRGB[d];if(!d){d=this.colorRGB.white}return d},getHTMLrgba:function(e,d){return"rgba("+Math.floor(e[0])+","+Math.floor(e[1])+","+Math.floor(e[2])+","+d+")"},init:function(e){log.write("ccrender.init");this.originX=Math.floor(this.width*this.safearea);this.originY=Math.floor(this.height*this.safearea);this.resolutionX=this.width-2*this.originX;this.resolutionY=this.height-2*this.originY;this.styleList=[];this.renderHtmlDivs=[];var d=$(e),f=0;if(d&&d.childNodes&&d.childNodes.length){for(f=0;f<this.minRow&&f<d.childNodes.length;f++){var g=d.childNodes[f];g.set("html","");g.hide();this.renderHtmlDivs.push(g)}if(f<this.minRow){log.write("ccrender.init: container number is smaller than the minimum (at least 4)!")}}this.defaultCCDisplayEnabled=configuration.readValue("DefaultCCDisplayEnabled")||this.defaultCCDisplayEnabled;this.userCCDisplayEnabled=configuration.readValue("UserCCDisplayEnabled")},clean:function(){for(var d=0;d<this.renderHtmlDivs.length;d++){this.renderHtmlDivs[d].set("html","");this.renderHtmlDivs[d].hide()}},isCCEnabled:function(){if(!this.userCCDisplayEnabled){return this.defaultCCDisplayEnabled}else{return this.userCCDisplayEnabled}},setCCEnabled:function(d){this.userCCDisplayEnabled=d;configuration.writeValue("UserCCDisplayEnabled",d)},isCCAvailable:function(){return this.isCCStreamAvailable},setCCAvailable:function(d){this.isCCStreamAvailable=d},convertXMLNodetoJSObj:function(m){log.write("ccrender.convertXMLNodetoJSObj: Enter");var d=m;var h=[];for(var g=0;g<d.length;g++){if(d[g].nodeName=="Metadata"){styleNodes=d[g].childNodes;for(var f=0;f<styleNodes.length;f++){if(styleNodes[f].nodeName=="Style"){var l=this._parseXMLStyleNode(styleNodes[f]);this.styleList.push(l)}else{if(styleNodes[f].nodeName=="cellResolution"){var e=this._parseCellResolution(styleNodes[f]);this.cellResolution=e}}}}if(d[g].nodeName=="Data"){for(var f=0;f<d[g].childNodes.length;f++){if(d[g].childNodes[f].nodeName=="p"){var k=this._parseXMLParagraghNode(d[g].childNodes[f]);h.push(k)}}}}log.write("ccrender.convertXMLNodetoJSObj: Return");return h},renderCCXMLNodes:function(d){if(this.renderHtmlDivs.length>=this.minRow){this.renderCCJSNodes(this.convertXMLNodetoJSObj(d))}else{log.write("ccrender.renderCCXMLNodes: Should init firstly and the render nodes cannot be empty!")}},renderCCJSNodes:function(e){if(e&&e.length>0){this.renderPopupStyle(e)}else{for(var d=0;d<this.renderHtmlDivs.length;d++){this.renderHtmlDivs[d].set("html","");this.renderHtmlDivs[d].hide()}}},renderPopupStyle:function(p){var h,f;for(h=0;h<p.length;h++){this.renderHtmlDivs[h].set("html",p[h].timedText);this.renderHtmlDivs[h].setStyles(p[h].divStyle);this.renderHtmlDivs[h].show();this.renderHtmlDivs[h].setStyles({visiblitiy:"hidden"})}var l=h;var m=this.renderHtmlDivs.slice(0,l);var d=p.slice(0,l);m.sort(function(q,j){var s=parseInt(q.getStyle("top"));var r=parseInt(j.getStyle("top"));if(s>r){return 1}else{return -1}});d.sort(function(q,j){var s=parseInt(q.divStyle.top);var r=parseInt(j.divStyle.top);if(s>r){return 1}else{return -1}});for(h=1;h<d.length;h++){var g=m[h-1].getHeight();var k=parseInt(d[h].divStyle.top);var e=parseInt(d[h-1].divStyle.top);if((k-e-g>=0)&&(k-e-g<=10)){var n=parseInt(m[h-1].getStyle("top"));m[h].setStyles({top:(n+g)+"px"})}else{if((k-e-g<=0)&&(k-e-g>=-10)){var n=parseInt(m[h-1].getStyle("top"));m[h].setStyles({top:(n+g)+"px"})}}}for(h=0;h<d.length;h++){m[h].show()}for(f=l;f<this.renderHtmlDivs.length;f++){this.renderHtmlDivs[f].set("html","");this.renderHtmlDivs[f].hide()}},renderRollupStyle:function(d){},renderPaintonStyle:function(d){},_parseCellResolution:function(e){var d=e.textContent.split(" ");var f={cols:32,rows:15};if(d&&d.length==2){f.cols=d[0];f.rows=d[1]}return f},getCCShadowColor:function(h,g){var e,d=[0,0,0];for(e=0;e<3;++e){var j=(g[e]+128)/2;var f=h[e]/2;d[e]=(j+f)/2}return d},applyCCEdgeEffect:function(m){var n=m.textColor,e=m.backgroundColor,k=Number(m.backgroundOpacity)/100,j=[0,0,0],f,l,g,h,d=3;for(h=0;h<3;++h){j[h]=128+(e[h]-128)*k}m.padding.left+=2;m.padding.top+=2;m.padding.right+=3;m.padding.bottom+=3;switch(m.edgeEffect){case"raised":f=this.getHTMLrgba([51,51,51],1);m.textshadow="0 1px 0 "+f+", 1px 0 0 "+f+", 1px 1px 0 "+f;break;case"depressed":f=this.getHTMLrgba([51,51,51],1);m.textshadow="0 -1px 0 "+f+", -1px 0 0 "+f+", -1px -1px 0 "+f;break;case"uniform":g=this.getHTMLrgba(this.getCCShadowColor(n,j),1);l=this.getHTMLrgba(j,1);m.textshadow="-1px -1px 0 "+l+", 1px -1px 0 "+l+", -1px 1px 0 "+l+", 1px 1px 0 "+l+", -2px -2px 0px "+g+", 2px -2px 0px "+g+", -2px 2px 0px "+g+", 2px 2px 0px "+g;break;case"drop_shadowed":f=this.getHTMLrgba(this.getCCShadowColor(n,j),1);m.textshadow="";for(h=0;h<d;++h){if(h!==0){m.textshadow+=","}m.textshadow+=" "+h+"px "+h+"px 0 "+f}break;default:break}},_parseXMLStyleNode:function(h){var d={};var f=h.getAttribute("id");var m=this._getFontsize(h.getAttribute("fontSize"));var n=h.getAttribute("fontWeight")||"normal";var l=h.getAttribute("fontStyle")||"normal";var k=h.getAttribute("fontFamily")||"monospaceSerif";var j=h.getAttribute("color")||"white";var q=h.getAttribute("backgroundColor")||"black";var g=h.getAttribute("backgroundOpacity")||"100";var e=h.getAttribute("textDecoration")||"none";var p="nowrap";d={id:f,fontsize:m,fontweight:n,fontstyle:l,fontfamily:k,color:j,"white-space":p,backgroundColor:q,backgroundOpacity:g,textdecoration:e};log.write("ccrender._parseXMLStyleNode: get a style node");return d},_parseXMLParagraghNode:function(f){var k={timedText:"",divStyle:{},id:0};var j=this._getPosition(f.getAttribute("origin"));var d=f.getAttribute("id");var e=this.resolutionX+"px";var m="auto";k.divStyle={id:d,left:j.left,top:j.top,width:e,height:m};var h="";var l=f.childNodes;for(var g=0;g<l.length;g++){if(l[g].nodeName=="t"||l[g].nodeName=="b"){h+=this._parseXMLTextNode(l[g])}}k.timedText=h;return k},_parseXMLTextNode:function(h){var j="";if(h.nodeName=="t"){var f=this._getCCStyle(h.getAttribute("sid"));var k=(($cn.data.CCTextEdge==null)||($cn.data.CCTextEdge=="auto"))?"auto":$cn.data.CCTextEdge;var d=(($cn.data.CCBackgroundColor==null)||($cn.data.CCBackgroundColor=="auto"))?f.backgroundColor:$cn.data.CCBackgroundColor;var g=(($cn.data.CCTextColor==null)||($cn.data.CCTextColor=="auto"))?f.color:$cn.data.CCTextColor;var e={fontsize:f.fontsize,fontweight:f.fontweight,fontstyle:f.fontstyle,fontfamily:(($cn.data.CCFont==null)||($cn.data.CCFont=="auto"))?this._getCCFontFamily(f.fontfamily):this._getCCFontFamily($cn.data.CCFont),textdecoration:f.textdecoration,textColor:this.getCCRGB(g),textOpacity:(($cn.data.CCTextOpacity==null)||($cn.data.CCTextOpacity=="auto"))?100:$cn.data.CCTextOpacity,backgroundColor:this.colorRGB[d]?this.colorRGB[d]:(this.colorRGB[f.backgroundColor]?this.colorRGB[f.backgroundColor]:this.colorRGB.black),backgroundOpacity:($cn.data.CCBackgroundOpacity==null)?(isNaN(f.backgroundOpacity)?"100":f.backgroundOpacity):(isNaN($cn.data.CCBackgroundOpacity)?(isNaN(f.backgroundOpacity)?"100":f.backgroundOpacity):$cn.data.CCBackgroundOpacity),edgeEffect:k,textshadow:"",padding:{left:0,top:2,right:0,bottom:0}};this.applyCCEdgeEffect(e);j="<span style='background-color: "+this.getHTMLrgba(e.backgroundColor,Number(e.backgroundOpacity)/100)+" !important;padding: "+e.padding.top+"px "+e.padding.right+"px "+e.padding.bottom+"px "+e.padding.left+"px;font-size:"+e.fontsize+";font-weight:"+e.fontweight+";font-style:"+e.fontstyle+";font-family:"+e.fontfamily+";color: "+this.getHTMLrgba(e.textColor,1)+";text-decoration:"+e.textdecoration+";text-shadow:"+e.textshadow+";white-space: nowrap;display:inline-block;float:left;'><span style='opacity:"+Number(e.textOpacity)/100+";'>"+h.textContent+"</span></span>"}else{if(h.nodeName=="b"){j="<br/>"}}return j},_getCCFontFamily:function(d){if(d=="monospace"||d=="auto"||d=="default"){d="monospaceSerif"}else{if(d=="serif"){d="proportionalSerif "}else{if(d=="sansSerif"){d="proportionalSansSerif "}}}return"CC_"+d},_getCCStyle:function(d){for(var e=0;e<this.styleList.length;e++){if(this.styleList[e].id==d){return this.styleList[e]}}},_getFontsize:function(d){var e=this.maxFontSize;if(d.indexOf("%")>-1){e=parseFloat(d.substring(0,d.indexOf("%")));if(e<10){e*=8}e=Math.floor((e*this.resolutionY)/(this.cellResolution.rows*100))}else{if(d.indexOf("px")>-1){e=d.substring(0,d.indexOf("px"))}else{if(d.indexOf("c")>-1){e=Math.floor((this.resolutionY/this.cellResolution.rows)*d.substring(0,d.indexOf("c")))}}}if((parseInt($cn.data.CCTextSize)>1)){this.fontScale=parseInt($cn.data.CCTextSize)/100;if(this.fontScale>1.55){this.fontScale=1.55}e=Math.floor(e*this.fontScale)}else{this.fontScale=1}return e+"px"},_getPosition:function(f){var h=0,g=0;var d="";var j=0,e=0;if(f){d=f.split(" ")}if(d.length==2){j=d[0].slice(0,d[0].indexOf("%"));e=d[1].slice(0,d[1].indexOf("%"));if(this.fontScale>=1){if(j<60){j=(j/this.fontScale)}}var k=0.325;if(e<50){e=(e*(this.fontScale+k))}else{e=(100-(100-e)*(this.fontScale+k))}h=Math.floor(j*this.resolutionX/100);g=Math.floor(e*this.resolutionY/100)}else{h=Math.floor(this.resolutionX*0.2);g=Math.floor(this.resolutionY*0.8)}h+=this.originX;g+=this.originY;return{left:h+"px",top:g+"px"}},getClosedCaptionPreview:function(){var h="";var j=(($cn.data.CCTextEdge==null)||($cn.data.CCTextEdge=="auto"))?"auto":$cn.data.CCTextEdge;var e=(($cn.data.CCBackgroundColor==null)||($cn.data.CCBackgroundColor=="auto"))?"black":$cn.data.CCBackgroundColor;var d=(($cn.data.CCWindowColor==null)||($cn.data.CCWindowColor=="auto"))?"black":$cn.data.CCWindowColor;var g=(($cn.data.CCTextColor==null)||($cn.data.CCTextColor=="auto"))?"white":$cn.data.CCTextColor;var f={fontsize:this._getFontsize("8%"),fontweight:"normal",fontstyle:"normal",fontfamily:($cn.data.CCFont==null)?"CC_monospaceSerif":this._getCCFontFamily($cn.data.CCFont),textdecoration:"none",textColor:this.getCCRGB(g),textOpacity:(($cn.data.CCTextOpacity==null)||($cn.data.CCTextOpacity=="auto"))?100:$cn.data.CCTextOpacity,backgroundColor:this.colorRGB[e]?this.colorRGB[e]:this.colorRGB.black,backgroundOpacity:($cn.data.CCBackgroundOpacity==null)?"100":(isNaN($cn.data.CCBackgroundOpacity)?"100":$cn.data.CCBackgroundOpacity),windowColor:this.colorRGB[d]?this.colorRGB[d]:this.colorRGB.black,windowOpacity:($cn.data.CCWindowOpacity==null)?"0":(isNaN($cn.data.CCWindowOpacity)?"0":$cn.data.CCWindowOpacity),edgeEffect:j,textshadow:"",padding:{left:0,top:2,right:0,bottom:0}};this.applyCCEdgeEffect(f);h="<span style='position: absolute;top: "+((Number(f.windowOpacity)/100<=0)?"0px":"-2px")+";left: "+((Number(f.windowOpacity)/100<=0)?"0px":"-2px")+";background-color: "+this.getHTMLrgba(f.backgroundColor,Number(f.backgroundOpacity)/100)+" !important;border: "+((Number(f.windowOpacity)/100<=0)?"0px":"2px")+" solid "+this.getHTMLrgba(f.windowColor,Number(f.windowOpacity)/100)+";padding: "+f.padding.top+"px "+f.padding.right+"px "+f.padding.bottom+"px "+f.padding.left+"px;font-size:"+f.fontsize+";font-weight:"+f.fontweight+";font-style:"+f.fontstyle+";font-family:"+f.fontfamily+";color: "+this.getHTMLrgba(f.textColor,1)+";text-decoration:"+f.textdecoration+";text-shadow:"+f.textshadow+";white-space: nowrap;display:inline;'><span style='opacity:"+Number(f.textOpacity)/100+";'>"+this.ClosedCaptionPreview+"</span></span>";return h}};var pointer={enablePointerMode:false,maxTravelsLevel:3,isActive:false,lastFocusId:null,useDeviceBOM:false,ignoreOverEvent:false,prevPointerFocus:null,init:function(e){this.enablePointerMode=configuration.readValue("EnablePointerMode")||false;if(!this.enablePointerMode){return}var d=$(e);d.onclick=this._onClickHandler.bind(this);d.onmouseover=this._onMouseOverHandler.bind(this);d.onmousedown=this._onMouseDownHandler.bind(this);d.onmouseup=this._onMouseUpHandler.bind(this);if(device.setHandlerToCustomizedBOM){this.useDeviceBOM=true;device.setHandlerToCustomizedBOM(this._onMouseActiveHandler,this._onMouseDeActiveHandler)}else{document.onkeydown=this._onMouseDeActiveHandler}},ignorePointerEvents:function(d){this.ignoreOverEvent=d},isPointerModeActive:function(){if(this.useDeviceBOM){var d=device.isPointerModeActive();return d=="on"?true:false}else{return this.isActive}},_onClickHandler:function(event){if(!this.useDeviceBOM&&!this.isActive){this._onMouseActiveHandler(event);return}log.write("mouse onclick begin");var focusedElement=this._getActionElement(event,"action");if(focusedElement){if(focusedElement.get("pointeraction")){eval("("+focusedElement.get("pointeraction")+")")}else{eval("("+focusedElement.get("action")+")")}}application.events.publish("pointerclick",event)},_onMouseOverHandler:function(event){if(this.ignoreOverEvent){return}if(this.isPointerModeActive()){if(application.element.current){log.write("Pointer._onMouseOverHandler lastFocusId:"+application.element.current);this.lastFocusId=application.element.current}var focusedElement=this._getActionElement(event,"action");if(this.prevPointerFocus!==null){if(this.prevPointerFocus!==focusedElement){eval("("+this.prevPointerFocus.get("pointermouseout")+")");application.events.publish("pointermouseout",event)}}if(focusedElement){if(this.prevPointerFocus!==focusedElement){if(focusedElement.get("pointerfocus")){eval("("+focusedElement.get("pointerfocus")+")")}else{this.lastFocusId=focusedElement.id;navigation.setFocus(focusedElement.id)}}}else{navigation.setFocus(null)}this.prevPointerFocus=focusedElement}},_onMouseDownHandler:function(event){if(this.isPointerModeActive()){var focusedElement=this._getActionElement(event,"mousedownaction");if(focusedElement){eval("("+focusedElement.get("mousedownaction")+")");application.events.publish("pointermousedown",event)}}},_onMouseUpHandler:function(event){if(this.isPointerModeActive()){var focusedElement=this._getActionElement(event,"mouseupaction");if(focusedElement){eval("("+focusedElement.get("mouseupaction")+")");application.events.publish("pointermouseup",event)}}},_getActionElement:function(f,e){var g=false;var h=f.target;for(var d=0;d<this.maxTravelsLevel;d++){if(!h.get(e)){if(h.parentElement){h=h.parentElement}}else{g=true;break}}return g?h:null},_onMouseActiveHandler:function(event){pointer.isActive=true;log.write("Pointer mode activated.");var focusedElement=pointer._getActionElement(event,"action");if(focusedElement){if(focusedElement.get("pointerfocus")){log.write("Pointer._onClickHandler pointerfocus");eval("("+focusedElement.get("pointerfocus")+")")}else{log.write("Pointer._onClickHandler lastFocusId:"+focusedElement.id);pointer.lastFocusId=focusedElement.id;navigation.setFocus(focusedElement.id)}this.prevPointerFocus=focusedElement}else{if(application.element.current){log.write("Pointer._onClickHandler lastFocusId:"+application.element.current);pointer.lastFocusId=application.element.current}navigation.setFocus(null)}application.events.publish("pointeractivated",event)},_onMouseDeActiveHandler:function(d){prevPointerFocus=null;if(!pointer.useDeviceBOM){if(document.activeElement.id=="navigation"&&!pointer.isPointerModeActive()){return}}log.write("Reset navigation focus.");$("navigation").focus();if(pointer.lastFocusId==null){log.write("_onKeyDownHandler: setFirstFocusableElement");navigation.setFocus(null);navigation.setFirstFocusableElement()}else{if(application.element.current!=pointer.lastFocusId){navigation.setFocus(null);application.element.current=pointer.lastFocusId;navigation.setFocus(pointer.lastFocusId)}else{if($(application.element.current)){$(application.element.current).addClass("hover")}}}pointer.isActive=false;log.write("Pointer mode deactivated.");application.events.publish("pointerdeactivated",d)}};application.resource={modalConfig:{"default":{width:"345px",left:"308px",top:"200px"},message_parentalcontrols:{width:"450px",left:"256px",top:"200px"},legal:{width:"625px",left:"168px",top:"100px",height:"340px"},uvtermsofservice:{width:"450px",left:"258px",top:"60px",height:"420px"},eula:{width:"625px",left:"168px",top:"100px",height:"340px"},message_error_askabouthd:{width:"960px",height:"540px",left:"0px",top:"0px"},message_error_connectiontooslow_player:{width:"960px",height:"540px",left:"0px",top:"0px"},changeuserpopup:{width:"325px",height:"175px",left:"318px",top:"140px"},imagepopup:{width:"425px",height:"220px",left:"268px",top:"140px"},confirmpopup:{width:"390px",height:"auto",left:"285px",top:"125px","text-align":"center",visibility:"hidden"},speedpopup:{width:"430px",height:"310px",left:"260px",top:"114px","text-align":"center"},systemstatuspopup:{width:"430px",height:"215px",left:"260px",top:"166px","text-align":"center"},pinpopup:{width:"600px",height:"302px",left:"180px",top:"126px","text-align":"center"},ratepopup:{width:"437px",height:"228px",left:"261px",top:"156px"},giftcard:{width:"615px",height:"455px",left:"173px",top:"60px"},envchange:{width:"425px",height:"380px",left:"268px",top:"80px"},activate:{display:"none"},activate_show5:{width:"536px",height:"420px",left:"210px",top:"59px",display:"block"},activate_show6:{width:"638px",height:"420px",left:"158px",top:"59px",display:"block"},activate_show7:{width:"740px",height:"420px",left:"98px",top:"59px",display:"block"},message_error_default:{width:"480px",left:"240px",top:"200px"},message_error_purchase:{width:"545px",left:"207px",top:"200px"},message_error_playback:{width:"385px",left:"288px",top:"200px"},message_system_details:{width:"545px",left:"207px",top:"200px"},message_content:{width:"400px",left:"280px"},message_content_callback:{width:"500px",left:"230px"},message_d2d_content:{width:"545px",height:"400px",left:"207px",top:"69px"},message_exit:{width:"445px",left:"260px"},message_return:{width:"445px",left:"260px"},message_okcancel:{width:"545px",left:"207px"},message_okcancel_vert:{width:"468px",left:"240px",top:"88px"},message_three_button_vert:{width:"468px",left:"249px",top:"88px"},message_restart:{width:"545px",left:"207px"},message_alreadyownuv:{width:"545px",left:"207px"},message_region_reset:{width:"545px",left:"207px"},message_region_notdefault:{width:"545px",left:"207px"},payment_table_popup:{width:"545px",left:"207px"},audiopopup:{width:"545px",top:"65px",left:"207px",height:"410px"}},animation:{wheel:{options:{duration:200,fps:50,link:"cancel",transition:"Fx.Transitions.Sine.easeIn"},properties:{primary:{focus:"#ffffff",color:"#ffffff"},secondary:{color:"#585858"},tertiary:{color:"#373737"}}},grid:{similar:{left:"150px"},browse:{left:"150px"},options:{duration:300,fps:50,transition:"Fx.Transitions.Sine.EaseIn"}}},td_similar:{s_audience:"Similar Audience",s_mood:"Similar Mood",s_plot:"Similar Plot",s_test:"Similar Test",s_time:"Similar Time/Period",s_place:"Similar Place",s_praise:"Similar Praise",m_cast_crew:"Cast and Crew",s_all:"Similar Movies",s_all_TV_Show:"Similar TV Shows",s_genres:"Similar Genre"},td_moreinfo:{m_cast_bios:"Cast Biographies",m_images:"Images",r_critics:"Critic Reviews",r_user_revs:"User Reviews",m_credits:"Credits",m_technical_details:"Technical Details"},td_reviews:{r_critics:"Critic Reviews",r_user_revs:"User Reviews"},review_enum:{r_critics:"CritictsReview",r_user_revs:"UserReview"},copyrightString:"&copy; 2013 RMH All Rights Reserved.",gift_card_poup_heading_purchase_path:"Enter gift card or coupon.",gift_card_poup_heading:"Enter Gift Card.",gift_card_error_message:"Gift cards must be redeemed on a PC.<br /><span class='grey'>Go to <span class='link'>www.cinemanow.com/bbgiftcard</span> to redeem your gift card.</span>",all_episodes:"Details",unwatched_episodes:"Unwatched Episodes",episodes:"Episodes",legal_title:"LEGAL INFORMATION",terms_title:"TERMS OF SERVICE",privacy_title:"PRIVACY POLICY",eula_title:"END-USER LICENSE AGREEMENT",wish_list_success:"Add to Wish List Successful",wish_list_fail:"Add to Wish List Unsuccessful",switch_user_notsetup:'<strong>You need to configure parental controls for your account before using this feature. </strong><div class="content">Go to <span class="url">www.cinemanow.com/parent</span> to configure parental controls.</div>',loading_enum:{downloadingupdate:"Downloading Update...",installingupdate:"Installing Update...",loadingwishlist:"Loading Wish List...",orderprocessing:"Processing Order...",giftcard:"Validating Code...",pin:"Validating PIN...",searching_donotuse:"Searching...",wishlistadd:"Adding to Wish List...",wishlistremove:"Removing from Wish List...",library:"Loading My Library...",loading:"Loading Videos...",playback:"Loading Video...",tvloading:"Loading TV Shows...",loadinggeneric:"Loading...",busy:"Loading...",activation:"Activating Device..."},buy_text:{TV_Show:"Buy Series",TV_Season:"Buy Season",TV_Episode:"Buy Episode"},unavailable_messages:{NotAvailable_HoldBack:{Message:"This video became unavailable on {Date} due to content provider licensing restrictions.",Content:"It may become available again; please check back later."},NotAvailable_LicensorRestricted:{Message:"This video is currently unavailable for this device due to content provider licensing restrictions.",Content:"It may become available again; please check back later."},NotAvailable_NotArrived:{Message:"This video is currently unavailable for this device.",Content:"It may become available; please check back later."},NotAvailable_In_This_Store:{Message:"This video is not licensed for playback from within this application due to content provider licensing restrictions.",Content:"It can only be played within [Retailer 1, Retailer 2, and Retailer 3 etc] applications."},NotAvailable_In_This_Territory:{Message:"This video is not licensed for playback from within this territory.",Content:"It can only be played within [Territory 1, Territory 2, and Territory 3 etc]."},UV_Unavailable:{Message:"This UltraViolet title is not available for playback from CinemaNow.",Content:"For details on where you can watch this title, go to www.uvvu.com"},NotAvailable_Pre_Ordered:{Message:"You pre-ordered this movie on {PurchaseDate}.",Content:"It is due to become available for playback on {Date}."},NotAvailable_Aired_Episode:{Message:"You bought a season pass on {PurchaseDate} which included this episode.",Content:"It is due to become available for playback on {Date}."}},ownership_state:{title:{Bought_SD:"You already own this movie.",Bought_HD:"You already own this movie in HD.",Active_Rental_SD:"Your current rental of this movie is still active.",Active_Rental_HD:"Your current HD rental of this movie is still active.",Expired_Rental_SD:"You previously rented this movie, but it has expired.",Expired_Rental_HD:"You previously rented this movie in HD, but it has expired."},tv_title:{Bought_SD:"You already own this episode.",Bought_HD:"You already own this episode in HD.",TV_Own_Some_Episodes:"You already own some episodes in this season.",TV_Own_Season_SD:"You already own this season.",TV_Own_Season_HD:"You already own this season in HD."}},currency_symbol:"$",tax_string:'<span class="white"> * </span> See email confirmation for applicable taxes',title_availability:{rent_not_available:"Rent&nbsp;not<br/>available",buy_not_available:"Buy&nbsp;not<br/>available"},checkout_messages:{uv_error:{Title:"Checkout",Message:"",Content:"For more info, go to <span class='white'>www.uvvu.com</span>",OK:"",Footer:"",Cancel:"Close"},purchase_error:{Title:"Checkout",Message:'A network error occurred while processing this order: <br /> "##title##"',Content:"Please check your library, and see if this order was added. <br /> If it appears in the library and you have received an email receipt, the order was processed successfully. ",OK:"Go to My Library",Footer:"",Cancel:"Close"},Invalid_SKU_Or_Purchase_Option_ID:{Title:"Checkout",Message:"Your order cannot be completed.",Content:"This video is no longer available to buy and/or rent.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/store/support</span> and type the following error code in the search box: <span class="errorCode">1 {m}</span>',Cancel:"Cancel"},Rental_Warning:{Title:"Checkout",Message:'You are about to start watching "##name##".',Content:"If you start this video now, you have ##rentalperiod## hours to finish watching, and will only be able to watch it on this device.<br /><br />Do you want to proceed?",Footer:"",OK:"YES",Cancel:"NO"},User_Credit_Card_Security_Code_Is_Invalid:{Title:"Checkout",Message:"Your credit card security code (CVV) is currently missing from your account.",Content:'You\'ll need to provide a valid credit card security code in order to proceed with your purchase.<br /><br />Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">4 {m}</span>',OK:"Try Again",Cancel:"Cancel"},User_Credit_Card_Number_Is_Invalid:{Title:"Checkout",Message:"Your credit card number is not valid.",Content:'Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">5 {m}</span>',OK:"Try Again",Cancel:"Cancel"},User_Credit_Card_Not_On_File_And_User_Does_Not_Have_Sufficient_Prepaid_Funds_For_This_Transaction:{Title:"Checkout",Message:"Your current coupon/gift card balance is not enough for this order.",Content:'You\'ll need to provide a valid credit card in order to proceed with your purchase.<br /><br />Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">12 {m}</span>',OK:"Try Again",Cancel:"Cancel"},User_Credit_Card_Not_On_File:{Title:"Checkout",Message:"No credit card has been added to your account.",Content:'You\'ll need to provide a valid credit card in order to proceed with <br />your purchase.<br /><br />Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">11 {m}</span>',OK:"Try Again",Cancel:"Cancel"},Transaction_Failed_Please_Verify_Credit_Card:{Title:"Checkout",Message:"Your credit card could not be charged.",Content:'Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">7 {m}</span>',OK:"Try Again",Cancel:"Cancel"},User_Credit_Card_Is_Expired:{Title:"Checkout",Message:"Your credit card has expired.",Content:'Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">6 {m}</span>',OK:"Try Again",Cancel:"Cancel"},Daily_Spending_Limit_Reached:{Title:"Checkout",Message:"Your credit card could not be charged.",Content:'You have exceeded your credit card\'s spending limit.<br /><br />Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">8 {m}</span>',OK:"Try Again",Cancel:"Cancel"},Credit_Card_Declined:{Title:"Checkout",Message:"Your credit card could not be charged.",Content:'Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">7 {m}</span>',OK:"Try Again",Cancel:"Cancel"},Daily_Transaction_Limit_Reached:{Title:"Checkout",Message:"Your credit card could not be charged.",Content:'You have exceeded your credit card\'s spending limit.<br /><br />Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">9 {m}</span>',OK:"Try Again",Cancel:"Cancel"},AVS_Fail:{Title:"Checkout",Message:"Your credit card address on file is invalid.",Content:'Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">10 {m}</span>',OK:"Try Again",Cancel:"Close"},User_Address_Is_Invalid:{Title:"Checkout",Message:"Your credit card address on file is invalid.",Content:'Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">3 {m}</span>',OK:"Try Again",Cancel:"Cancel"},Title_ID_Not_Found:{Title:"Checkout",Message:"Your order cannot be completed.",Content:"This video is no longer available to buy and/or rent.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">1 {m}</span>',Cancel:"Cancel"},Invalid_User_ID:{Title:"Checkout",Message:"Your order cannot be completed.",Content:'Your user account has been removed or deleted. Go to <span class="url">www.cinemanow.com/billing</span> to create a new account.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2 {m}</span>',Cancel:"Cancel"},no_internet:{Title:"Checkout",Message:"Unable to connect to the Internet.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">512 {m}</span>',OK:"Try Again",OK_Action:"retry",Cancel:"Cancel",Cancel_Action:"",MessageType:"message_error_default"},socket_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2013 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},system_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},system_incorrecttime:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Your device's time or date is set incorrectly. Please check your settings and restart the application.",Footer:'Having trouble? Go to <span class="url">www.cinemanow.com/support</span>',Cancel:"OK",MessageType:"message_error_default"}},merch_messages:{genre_unavailable:{Message:"Error",Content:"Sorry, this genre is temporarily unavailable.",Close:"Close"}},system_messages:{region_error:{MessageType:"message_content_callback",Message:"CinemaNow is not available in this region.",Close:"Exit"},application_error:{MessageType:"message_content",Message:"Application Error.",Close:"Exit"},region_moved:{MessageType:"message_region_reset",Message:"This device has been moved outside of the region in which it was previously launched.",Content:"Titles available in the CinemaNow store and your library vary based on region. Titles that you may have purchased from CinemaNow outside of your current region will currently not be available for playback.",OK:"Continue",Close:"Exit"},region_notdefault:{MessageType:"message_region_notdefault",Message:"This device has been moved outside of the default region.",Content:"Titles available in the CinemaNow store and your library vary based on region. Titles that you may have purchased from CinemaNow outside of your current region will currently not be available for playback.",OK:"Continue",Close:"Exit"},region_moved_notallowed:{MessageType:"message_content_callback",Message:"CinemaNow is not available in this region.",Content:"",Close:"Exit"},no_internet:{Title:"Checkout",Message:"Unable to connect to the Internet.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">512 {m}</span>',OK:"Try Again",OK_Action:"retry",Cancel:"Cancel",Cancel_Action:"",MessageType:"message_error_default"},timeout_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2012 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},socket_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2013 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},system_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"}},already_purchased:{Title:"Checkout",Message:"You already own this title in your CinemaNow library.",Content:"Select <span class=\"white\">'Play'</span> to play the title. If you select <span class=\"white\">'Purchase Again'</span>, your credit card on file will be charged for the full amount of the title's purchase price.",OK:"Purchase Again",Cancel:"Cancel",Action:"Play"},uv_responses:{Inactive:{code:"122",status:"AcctNotAvailable",settingsPanelMessage:"Your CinemaNow account is not currently linked to an UltraViolet account. Go to ##UvLink## to link an UltraViolet account to your CinemaNow account and enable access to your UltraViolet Digitial Collection."},BlockedTOU:{code:"205",status:"BlockedTOU",settingsPanelMessage:"Your UltraViolet account is blocked. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection."},Archived:{code:"210",status:"Archived",settingsPanelMessage:"Your UltraViolet account is not active. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection."},"Inactive ":{code:"331",status:"Inactive",settingsPanelMessage:"Your UltraViolet account is inactive. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection."},Server_Error:{code:"551",status:"Server Error",settingsPanelMessage:"There was a Server Error (551). UltraViolet features are not currently accessible. Please try again later."}},uv_messages:{account_Pending:{Message:"Your UltraViolet account is pending",Content:"You must verify your account to watch UltraViolet content. Verify your UltraViolet account by confirming your email address in the email that was sent to <span class='white'>{email}</span>.<br/><br/>If you don't see the message in your inbox, check your junk or spam folder.",OK:"Resend Email from UltraViolet",Cancel:"Close"},account_BlockedTOU:{Message:"Your UltraViolet account is blocked",Content:"Your UltraViolet account has been blocked since the UltraViolet Terms of Use have been updated since you last accepted them.<br/><br/>Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and then select 'Try Again'.",OK:"Try Again",Cancel:"Close"},account_Inactive:{Message:"There is a problem with your UltraViolet account.",Content:"To purchase UltraViolet content, you must have a valid UltraViolet account. Please sign in to your UltraViolet account at www.uvvu.com for more information on your account status. Once you have resolved your account, select 'Try Again' to complete the checkout process.",OK:"Try Again",Cancel:"Not Now"},account_default:{Message:"There is a problem with your UltraViolet account.",Content:"To purchase UltraViolet content, you must have a valid UltraViolet account. Please sign in to your UltraViolet account at www.uvvu.com for more information on your account status. Once you have resolved your account, select <span class=\"white\">'Try Again'</span> to complete the checkout process.",OK:"Try Again",Cancel:"Not Now"},account_Expired:{Message:"Your UltraViolet account has expired",Content:'Because of the added benefits and additional rights that come with UltraViolet content, you\'ll need to link an UltraViolet account to your CinemaNow account to complete this purchase.<br/><br/>Your UV account has expired. Go to <span class="white">www.cinemanow.com/account</span> to complete your account linking and then select <span class="white">Try Again</span>.',OK:"Try Again",Cancel:"Not Now"},account_AcctNotAvailable:{Message:"Your UltraViolet account is not linked to your CinemaNow account",Content:"You selected a movie that comes with UltraViolet rights, allowing you to stream and download across multiple devices. You'll be able to access your purchased movies immediately after linking your UltraViolet account to your CinemaNow account.<br/><br/>Go to <span class=\"white\">www.cinemanow.com/account</span> to link your UltraViolet account or create a new one and then select 'Try Again'.",OK:"Try Again",Cancel:"Not Now"},account_Server_Error:{Message:"There is a problem.",Content:"There was a Server Error (551). UltraViolet features are not currently accessible. Please try again later.",OK:"Try Again",Cancel:"Close"},already_own:{Message:"You already own this title in your CinemaNow library.",Content:"Select <span class=\"white\">'Play'</span> to play the title. If you select <span class=\"white\">'Purchase Again'</span>, your credit card on file will be charged for the full amount of the title's purchase price.",OK:"Purchase Again",Cancel:"Cancel",Action:"Play"},HD_unavailable:{Title:"Unable to Playback in HD.",Message:"You have HD rights to this title in your UltraViolet Digital Collection, but it is currently unavailable in HD on this device.",Content:"Do you want to watch in standard definition instead?",OK:"Play in SD",Cancel:"Close"},technical_details:{uv_library_view:"Your UltraViolet rights for this title are:",uv_store_view:"UltraViolet rights are included with the purchase of this title, including:"},success:{Message:"Your UltraViolet account has been successfully ##status##.",OK:"Continue"},settingsPanel:{UVDeviceInactive:"CinemaNow is not currently activated on this device. Go to ##Activate## to activate CinemaNow and link to an existing UltraViolet account or create a new one.",UVNotSupported:"Your CinemaNow account is not currently linked to an UltraViolet account. Go to ##UvLink## to link an UltraViolet account to your CinemaNow account and enable access to your UltraViolet Digitial Collection.",Active:"Your CinemaNow account is currently linked to an UltraViolet account enabling access to your UltraViolet Digital Collection.",Pending:"Your UltraViolet account is pending. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection.",Deleted:"Your UltraViolet account has been deleted. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection.",Suspended:"Your UltraViolet account has been suspended. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection.",BlockedTOU:"Your UltraViolet account has been blocked since the UltraViolet Terms of Use have been updated since you last accepted them. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection",Archived:"Your UltraViolet account is not active. Please log into your UltraViolet account at www.uvvu.com for more information",Unlinking:"Your UltraViolet account is not active. Please log into your UltraViolet account at www.uvvu.com for more information",Inactive:"Your UltraViolet account is inactive. Please sign in to your UltraViolet account at www.uvvu.com to resolve your account issue and enable access to your UltraViolet Digital Collection.","Server Error":"There was a Server Error (551). UltraViolet features are temporarily inaccessible. Please try again later.",Status:{Active:"Linked to CinemaNow (Expires on ##expiration##)",Pending:"Pending",AcctNotAvailable:"Account Not Available",Unlinking:"Unlinking",BlockedTOU:"Blocked due to UltraViolet Terms of Use update",Archived:"Inactive",Suspended:"Suspended",Deleted:"Deleted",Inactive:"Inactive","Server Error":"Server Error"}},helpString:'For details on where you can watch this title, go to <span class="white">www.uvvu.com</span>',uvTermsOfService:{ChangedMessage:"The UltraViolet Terms of Use has changed",UnacceptedMessage:"UltraViolet Terms of Use",Content:"To purchase, access or playback UltraViolet content, you must accept the latest UltraViolet Terms of Use.",OK:"Accept UltraViolet Terms of Use",Close:"Not Now"}},d2d_messages:{invalid:{Message:"The disc you inserted could not be validated",Content:"You need to load the original disc that was used to qualify for the Disc to Digital Purchase",OK:"OK"},already_own:{Message:"We have found a similar title in your library",Content:'You have chosen to buy <span class="white">##title##</span> via Disc to Digital, but you already have <span class="white">##libTitle##</span> in your library. Do you still want to purchase <span class="white">##title##</span> for $##price##?',OK:"Continue",Cancel:"Cancel"}},store_messages:{no_internet:{Title:"Checkout",Message:"Unable to connect to the Internet.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">512 {m}</span>',OK:"Try Again",OK_Action:"retry",Cancel:"Cancel",Cancel_Action:"",MessageType:"message_error_default"},timeout_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2012 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},socket_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2013 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},system_error:{Title:"Checkout",Message:"Unable to contact the server.",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550 {m}</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},Title_ID_Not_Found:{Title:"Error",Message:"We're sorry, the title no longer exists or you are trying to play the title from a geographical location that is not supported.",Content:"Currently, you can only play CinemaNow titles within the United States. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <br /><span class="errorCode">515 {m}</span>',Cancel:"OK",MessageType:"message_content_callback"},Similar_Titles_Not_Found:{Title:"Error",Message:"Similar titles not found.",Content:"No results were found.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <br /><span class="url">{responseCode} {m}</span>',Cancel:"Cancel",MessageType:"message_content_callback"}},testing_messages:{connectionHeading:'<span class="white">Connection Type: ##type##</span><br/>',storeHeading:'<span class="white">Store Connection: ##status##</span><br/>',activationHeading:'<span class="white">Activation Status: ##status##</span><br/>',defaultString:"Errors",connected:"No Errors",notActivated:"Not Activated",activated:"Activated",testingBandwidth:"1 of 6 Testing Bandwidth",bwMessage:{SpeedResult1:"A sustained bandwidth of ##speed## Mbps is too slow to watch streaming videos at high quality. We recommend upgrading your Internet connection. ",SpeedResult2:"Good News! A sustained bandwidth of ##speed## Mbps will be sufficient to watch streaming videos at high quality. You might consider upgrading your Internet connection in order to view HD videos at the highest quality.",SpeedResult3:"Good News! A sustained bandwidth of ##speed## Mbps is excellent. You can view HD videos at the highest quality. "},connectionInfo:{None:"You are not connnected to the internet.",Wireless:"Wireless is typically slower than a wired connection. Try a wired connection for faster performance."},activationInfo:"You will be able to buy and rent movies if you activate.",storeInfo:"The server is not responding.",connectionType:{none:"None",wireless:"Wireless",wired:"Wired",unknown:"Unknown"},show_details:{Title:"System Status Check Details",connectionType:"",connectionInfo:"",storeConnection:"",Cancel:"Close",MessageType:"message_system_details"}},player_messages:{connectiontooslow_error:{Title:"Video Playback",Message:"Your Internet connection is too slow to instantly stream this video.",Content:"We recommend that you upgrade your Internet connection to enable instant streaming.",OK:"Continue",Cancel:"Cancel",MessageType:"message_error_connectiontooslow"},connectiontooslow_error_sd:{Title:"Video Playback",Message:"Your Internet connection is too slow to instantly stream SD video.",Content:"We recommend that you upgrade your Internet connection to enable instant SD streaming.",OK:"Continue",Cancel:"Cancel",MessageType:"message_error_connectiontooslow"},connectiontooslow_error_hd:{Title:"Video Playback",Message:"Your Internet connection is too slow to instantly stream HD video.",Content:"We recommend that you upgrade your Internet connection to enable instant streaming.",OK:"Continue",Cancel:"Cancel",MessageType:"message_error_connectiontooslow"},connectiontooslow_error_player:{Title:"Video Playback",Message:"Your Internet connection is currently too slow to stream this video.",Content:"<p>Other connected devices sharing your Internet connection may be downloading large files, or there may be heavy Internet usage in your local area.</p><p>We recommend that you upgrade your Internet connection so you can enjoy instant streaming without interruptions:</p><p>For a good video experience, we recommend 4 Mbps.<br/>For the best HD or 3D experience, we recommend at least 8 Mbps.</p>",OK:"Stop",Cancel:"Continue",MessageType:"message_error_connectiontooslow_player"},askabouthdswap_error:{Title:"Video Playback",Message:"Your Internet connection is currently too slow to stream this video in HD.<br/>For the best HD experience, we recommend at least 8 Mbps",Content:"If your connection speed is at least 8 Mbps, there may be heavy Internet usage in your local area or other devices sharing your Internet connection may be downloading large files. Cancel any downloads in progress or other operations that use bandwidth and then try resuming in HD.",Footer:"OTHER OPTIONS<br/>If your connection speed is slower than 8 Mbps, consider upgrading your Internet connection so you can enjoy instant HD streaming without interruptions. For now, you can resume your program in SD to help ensure there will be no further interruptions. You may also choose to stop playback and resume later.",TryAgain:"Resume in HD",OK:"Continue in SD",Cancel:"Stop Playback",MessageType:"message_error_askabouthd"},no_internet:{Title:"Video Playback",Message:"Unable to connect to the Internet.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">512</span>',OK:"Try Again",OK_Action:"retry",Cancel:"Cancel",Cancel_Action:"",MessageType:"message_error_default"},OnNetworkDisconnected:{Title:"Video Playback",Message:"Unable to connect to the Internet.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">512</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},OnConnectionFailed:{Title:"Video Playback",Message:"Unable to connect to the Internet.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">512</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},timeout_error:{Title:"Video Playback",Message:"Unable to contact the server.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2012</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},socket_error:{Title:"Video Playback",Message:"Unable to contact the server.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">2013</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},system_error:{Title:"Video Playback",Message:"We're sorry. We have encountered a technical playback error.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_playback"},OnRenderError:{Title:"Video Playback",Message:"We're sorry. We have encountered a technical playback error.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_playback"},OnStreamNotFound:{Title:"Video Playback",Message:"We're sorry. We have encountered a technical playback error.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_playback"},OnStreamNotFound_trailer:{Title:"Video Playback",Message:"Unable to playback trailer.",Content:"The trailer is currently unavailable. Please try again later.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_playback"},OnAuthenticationFailed:{Title:"Video Playback",Message:"Unable to connect to license server.",Content:"Please check your Internet connection, and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_default"},OnWideVineError_550:{Title:"Video Playback",Message:"Unable to contact the server. ",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_default"},OnWideVineError_2004:{Title:"Video Playback",Message:"Unable to contact the server. ",Content:"Please retry in a few minutes.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550</span>',Cancel:"OK",MessageType:"message_error_default"},OnWideVineError_513:{Title:"Video Playback",Message:"This title cannot be watched at this moment because it is currently playing on another device simultaneously.",Content:"The same title cannot be watched simultaneously on more than one device due to content licensing restrictions. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">513</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_514:{Title:"Video Playback",Message:"No credit card has been added to your account.",Content:'You\'ll need to provide a valid credit card in order to proceed with playback. <br /><br />Go to <span class="url">www.cinemanow.com/billing</span> to update your billing information.',Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">514</span>',OK:"Try Again",Cancel:"Cancel",MessageType:"message_error_default"},OnWideVineError_515:{Title:"Video Playback",Message:"We're sorry, the title no longer exists or you are trying to play the title from a geographical location that is not supported.",Content:"Currently, you can only play CinemaNow titles within the United States.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">515</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_516:{Title:"Video Playback",Message:"We're sorry. It appears this title cannot be played at your current geographic location due to content owner restrictions.",Content:"Currently, you can only play CinemaNow titles within the United States.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">516</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_517:{Title:"Video Playback",Message:"We're sorry. We have encountered a technical error.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">517</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_520:{Title:"Video Playback",Message:"We're sorry, the title you are trying to stream is not available or on a different device.",Content:"Please reactivate this device with your CinemaNow account and retry. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">520</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_521:{Title:"Video Playback",Message:"We're sorry, the title you are trying to stream is not available or on a different device.",Content:"Please reactivate this device with your CinemaNow account and retry. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">521</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_522:{Title:"Video Playback",Message:"We're sorry, your rental has expired or your title is no longer available for streaming.",Content:"Please re-purchase the title and retry in a few minutes. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">522</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_523:{Title:"Video Playback",Message:"We're sorry, your user name with this device cannot be matched.",Content:"Please reactivate this device with your CinemaNow account. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">523</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_524:{Title:"Video Playback",Message:"We're sorry. It appears this video cannot be watched on this device because you have used up all your available licenses.",Content:"You will need to stop playback from other devices, remove the video, or repurchase it. ",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">524</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_525:{Title:"Video Playback",Message:"We're sorry, the title was not found.",Content:"Please reactivate your device or update its software.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">525</span>',Cancel:"OK",MessageType:"message_error_playback"},OnWideVineError_570:{Title:"Video Playback",Message:"Your account has been locked.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">570</span>',Cancel:"OK",MessageType:"message_error_playback"}},lib_d2d_info:{title:"How to start the Disc to Digital process.",step1:"Insert a DVD that you own into your device while CinemaNow is running.",step2:"CinemaNow will locate if there is a Disc to Digital offer for your Disc Media Type.",step3:"If your Disk Media Title appears as an offer in the CinemaNow store. follow the simple on-screen instructions."},show_play_error:{Not_Owned:{Title:"",Message:"You do not own this movie."},Bought_SD:{Title:"",Message:"You already own this movie."},Bought_HD:{Title:"",Message:"You already own this movie in HD."},Active_Rental_SD:{Title:"",Message:"Your current rental of this movie is still active. "},Active_Rental_HD:{Title:"",Message:"Your current HD rental of this movie is still active."},Expired_Rental_SD:{Title:"",Message:"You previously rented this movie, but it has expired."},Expired_Rental_HD:{Title:"",Message:"You previously rented this movie in HD, but it has expired."},TV_Own_Some_Episodes:{Title:"",Message:""},TV_Own_Season_SD:{Title:"",Message:""},TV_Own_Season_HD:{Title:"",Message:""}},confirmation:{buy:{Movie:"BUY","TV_Season ":"BUY SEASON",TV_Episode:"BUY EPISODE"},rent:"RENT for {Period} Hrs",hd:" in HD"},processing_strings:{search_donotuse:"Searching..."},activation_messages:{success:{Message:'<strong class="white">Device activated successfully.</strong>',Title:"",OK:"OK"}},LibMasterWheelOptions:{Movies:"Movies",Movie_Rentals:"Movie Rentals",HD_Movies:"HD Movies",TV_Shows:"TV Shows",HD_TV_Shows:"HD TV Shows",UV_Movies:"My<br/>UltraViolet",D2D_Movies:"Disc to<br/>Digital"},LibSlaveWheelOptions:{All:"All",Never_Watched:"Never<br/>Watched",Unavailable:"Unavailable",Expired:"Expired",Expiring_Soon:"Expiring<br/>Soon",Info:"Info",UltraViolet:"UltraViolet",Action:"Action",Adventure:"Adventure",Animation:"Animation",Comedy:"Comedy",Drama:"Drama",Family:"Family",Horror:"Horror",Reality:"Reality",Romance:"Romance","Sci-Fi":"Sci-Fi",Sports:"Sports",Thriller:"Thriller",Westerns:"Westerns","Animation and Cartoons":"Animation and Cartoons","Food and Leisure":"Food and Leisure","Home and Garden":"Home and Garden",Music:"Music","Reality and Game Shows":"Reality and Game Shows",Other:"Other"},SettingsWheelOptionStrings:{General:"General",ClosedCaptions:"Closed<br />Captions",CCTextColor:"Text<br />Color",CCTextFont:"Text<br />Font",CCTextSize:"Text<br />Size",CCTextOpacity:"Text<br />Opacity",CCTextEdging:"Text<br />Edging",CCBackgroundColor:"Background<br />Color",CCBackgroundOpacity:"Background<br />Opacity",CCWindowColor:"Window<br />Color",CCWindowOpacity:"Window<br />Opacity",Audio:"Audio",Family:"Family",Debug:"Test Setup Page",Library:"My Library",Activate:"Activate<br />Device",GiftCards:"Gift Cards",UV:"UltraViolet<br/>Account",About:"About",Format:"Format",Parental:"Parental<br/>Controls",RequirePIN:"Require PIN for Purchases",RoxioNow:"Account Linking",DeviceInfo:"Device Info",ChangeEnvironment:"Change Environment",ConfigurationValues:"Configuration Values",AudioSupport:"Change Audio Format Support",SystemStatus:"System Status"},HelpWheelOptionStrings:{GettingStarted:"Getting<br />Started",BrowsingStore:"Browsing the Store",Searching:"Searching",WishList:"Wish List",Library:"My Library",ParentalControls:"Parental<br/>Controls",OnscreenControls:"On-screen Controls",CustomerSupport:"Customer Support",RentingBuying:"Renting or Buying",Ultraviolet:"UltraViolet"},support_strings:{Support:'Having trouble? Go to <span class="url">www.cinemanow.com/support</span>',ErrorCode:"Error code: "},pinPopup:{left:"202"},titleview_strings:{Duration_Concat:" / ",Starring_Concat_Length:"130"}};(function(){var d;application.resource.uv_responseCodes={};for(d in application.resource.uv_responses){if(application.resource.uv_responses.hasOwnProperty(d)){application.resource.uv_responseCodes[application.resource.uv_responses[d].code]=application.resource.uv_responses[d]}}}());var BrowseView={id:"store",persist:{},controls:{},focusState:{},layoutIsDirty:true,WheelControl:null,GiftCardPanel:null,SearchWheelControl:null,TitleMetaWheelControl:null,RecomendationWheelControl:null,TitleCheckOutWheelControl:null,SignInControl:null,GridController:null,GridControl:null,MerchControl:null,MessagePopup:null,SystemStatusPopup:null,AudioPopup:null,DockControl:null,Legal:null,hasShownActivate:false,CurrentTitleID:"",orderHailMary:false,orderIsProcessing:false,bwPercentProgress:0,bwTempCount:0,bwTempTotalSpeed:0,LastGridProcess:"",CurrentProcessLoaded:null,TitleViewControl:null,WishListLastLoaded:new Date(),titleViewLoading:false,uniquePurchaseId:false,CurrentWheelValue:"",tryAgainToPlayCount:0,init:function(g,f){var e=this,d;log.write("store.init()");this.DockControl=new DockControl();if($cn.data.SystemOffline){e.showSystemMessage();return}this.GridController=new GridController();if(g){this.persist=g}this.WheelControl=new WheelControl();this.GridControl=new GridControl();this.ImageGrid=new ContentGrid("imagegrid");this.BioGrid=new ContentGrid("biogrid");this.ReviewGrid=new ContentGrid("reviewgrid");this.CreditsGrid=new ContentGrid("creditsgrid");this.TechGrid=new ContentGrid("techgrid");this.MerchControl=new MerchControl();this.WelcomeControl=new WelcomeControl();this.ActivationPcView=new ActivationPcView();this.SystemStatusPopup=new SystemStatusPopup();if($cn.config.EnableD2D&&$cn.config.DeviceD2DEnabled){this.DiscToDigitalGrid=new ContentGrid("disctodigitalgrid");this.GridController.register(this.DiscToDigitalGrid)}this.GridController.register(this.GridControl);this.GridController.register(this.ImageGrid);this.GridController.register(this.BioGrid);this.GridController.register(this.ReviewGrid);this.GridController.register(this.CreditsGrid);this.GridController.register(this.TechGrid);this.ScrollBar=new ScrollBar("scrollbar");this.SearchKeyboard=new SearchKeyboardControl();this.SettingsPanel=new SettingsPanelControl();this.CheckoutPanel=new CheckoutPanelControl();this.GiftCardPanel=new GiftCardPanelControl();this.HelpPanel=new HelpPanelControl();this.WishList=new WishList();this.TitleViewControl=new TitleViewControl();this.GiftCardKeyboard=new GiftCardKeyboardControl();this.GiftCardPanel.keyboard=this.GiftCardKeyboard;this.goHome();application.events.subscribe(this.TitleViewControl,"loadtitleview",function(j){var k,h=($cn.data.d2dPath?0:2000);log.write("titleViewLoading: "+e.titleViewLoading);if(e.titleViewLoading||BrowseView.GridController.spinnerSpinning){return}k=$cn.utilities.showLoadingModal(h,"Loading Title...");e.titleViewLoading=true;application.TempKeyBlock=true;application.TempKeyBlockDuration=1500;application.state.save();log.session.addActivity("Title_Details",["Title_ID",String(j.args[0].id)]);application.state.current="titleview";BrowseView.CurrentTitleID=j.args[0].id;BrowseView.CurrentTitleLayout=j.args[0].type;if(j.args[0].type&&j.args[0].type=="library"){log.write("type is library");if(j.args[0].passID){$cn.methods.verifyAuthToken(function(l){if(l){$cn.methods.getPurchasedTitle(j.args[0].passID,j.args[0].id,function(m){var p,n;if(m.titleID!=0){if($cn.utilities.isTrue(m.isPassUV)){e.UV=new $cn.utilities.UserUVManager("CheckoutPanel");$cn.utilities.clearLoadingSpinner(k);e.UV.checkUVAccount(function(q){if(q){k=$cn.utilities.showLoadingModal(h,"Loading Title...");BrowseView.loadTitle(m,j.args[0].action,k)}else{e.titleViewLoading=false}},true)}else{BrowseView.loadTitle(m,j.args[0].action,k)}}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;p=application.resource.store_messages.Title_ID_Not_Found;n={Message:p.Message,Content:p.Content,Footer:p.Footer.replace("{m}",e.resolveMethodCode("getPurchasedTitle")),Close:p.Cancel,callback:function(q){log.write("Error (Unrecoverable)...")}};BrowseView.showMessage(p.MessageType,n)}})}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;BrowseView.showActivate()}})}else{log.write("type is NOT library");$cn.methods.getTitleListing(j.args[0].id,true,function(l){var n=$extend({passID:-1},l),p,m;if(n.titleID!=0){BrowseView.loadTitle(n,j.args[0].action,k)}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;p=application.resource.store_messages.Title_ID_Not_Found;m={Message:p.Message,Content:p.Content,Footer:p.Footer.replace("{m}",e.resolveMethodCode("getFullSummary")),Close:p.Cancel,callback:function(q){log.write("Error (Unrecoverable)...")}};BrowseView.showMessage(p.MessageType,m)}})}}else{if(j.args[0].checklibrary&&$cn.data.AuthToken.length!=0){log.write("we are in args checklibrary");$cn.methods.lookupPurchaseDetailsForTitle(j.args[0].id,function(l){var n,m;if(l.responseCode==0&&l.isAvailable){log.write("we are in is available");$cn.methods.getPurchasedTitle(l.passID,j.args[0].id,function(p){if(j.args[0].action=="checkout"){j.args[0].action=""}if(p.titleID!=0){BrowseView.loadTitle(p,j.args[0].action,k)}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;n=application.resource.store_messages.Title_ID_Not_Found;m={Message:n.Message,Content:n.Content,Footer:n.Footer.replace("{m}",e.resolveMethodCode("getPurchasedTitle")),Close:n.Cancel,callback:function(q){log.write("Error (Unrecoverable)...")}};BrowseView.showMessage(n.MessageType,m)}})}else{log.write("we are not in is available");$cn.methods.getTitleListing(j.args[0].id,true,function(p){var r,q;$("uicontainer").removeClass("redbuttons");if(p.titleID!=0){BrowseView.loadTitle(p,j.args[0].action,k)}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;r=application.resource.store_messages.Title_ID_Not_Found;q={Message:r.Message,Content:r.Content,Footer:r.Footer.replace("{m}",e.resolveMethodCode("getFullSummary")),Close:r.Cancel,callback:function(s){log.write("Error (Unrecoverable)...")}};BrowseView.showMessage(r.MessageType,q)}});l.errorHandled=true}})}else{$cn.methods.getTitleListing(j.args[0].id,true,function(l){var n,m;if($cn.data.d2dPath){l.availableProducts.unshift($cn.data.d2dTitleOffers.availableOffers[0])}$("uicontainer").removeClass("redbuttons");if(l.titleID!=0){BrowseView.loadTitle(l,j.args[0].action,k)}else{$cn.utilities.clearLoadingSpinner(k);e.titleViewLoading=false;n=application.resource.store_messages.Title_ID_Not_Found;m={Message:n.Message,Content:n.Content,Footer:n.Footer.replace("{m}",e.resolveMethodCode("getFullSummary")),Close:n.Cancel,callback:function(p){log.write("Error (Unrecoverable)...")}};BrowseView.showMessage(n.MessageType,m)}})}}});application.events.subscribe(this,"exit",this.onExit.bind(this));application.events.subscribe(this,"no_choice_exit",this.onNoChoiceExit.bind(this));application.events.subscribe(this,"return",this.onReturn.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"gridloading",this.handleGridLoading.bind(this));application.events.subscribe(this,"gridloaded",this.handleGridLoaded.bind(this));application.events.subscribe(application,"badauthtoken",this.handleBadAuthToken.bind(this));application.events.subscribe(application,"authparent",this.handleAuthParent.bind(this));application.events.subscribe(this,"goback",this.handleGoBack.bind(this));application.events.subscribe(this,"recommendeddataloaded",this.handleLoadRecommendation.bind(this));application.events.subscribe(this,"error",function(){var h=this;setTimeout(function(){h.onHandleError.bind(h)()},2500)}.bind(this));application.events.subscribe(this,"elementfocus",this.onFocus.bind(this));application.events.subscribe(this,"elementblur",this.onBlur.bind(this));application.events.subscribe(application,"ready",function(){if(application.ApplicationError){$("wheel").hide();$("SplashScreen").hide();if(document.getElementById("welcome")){$("welcome").hide()}e.showMessage(application.ApplicationError.type,application.ApplicationError);return}if(application.regionError){$("wheel").hide();$("SplashScreen").hide();if(document.getElementById("welcome")){$("welcome").hide()}e.showMessage(application.regionError.type,application.regionError);return}application.isLoaded=true;if($cn.data.isConnected){if($cn.data.SystemOffline){e.showSystemMessage()}else{log.write("ParentPinEnabled: "+$cn.data.ParentPinEnabled+", $cn.data.IsParent: "+$cn.data.IsParent+", $cn.data.ParentPinEnabledOnStartup: "+$cn.data.ParentPinEnabledOnStartup);d=e.initCallback.bind(e);log.write("Check to see if Eula needs to be displayed. $cn.data.DisplayEula: "+$cn.data.DisplayEula);if($cn.data.DisplayEula){application.blockWidgetAccess=true;setTimeout(function(){e.showEula("eula",true)},100)}else{d()}}}else{application.events.publish(application,"error",{type:"no_internet",recoverable:false})}});application.events.subscribe(application,"activated",function(j){log.write("User has been activated.");log.write("$cn.data.ParentPinEnabled: "+$cn.data.ParentPinEnabled);if($cn.data.ParentPinEnabled){$("btnAccount").addClass("locked");$cn.data.IsParent=false;BrowseView.reset()}else{$cn.data.IsParent=true;if($cn.data.ContentIsFiltered){BrowseView.reset()}}if(j&&j.args[0]){var h=j.args[0];if(h.method!="getStreamingAssetLocation"){log.write("Making post activation call.");if(h.endPoint){webservices.makeAsyncRequest(h.endPoint,h.method,h.params,h.cb_context,h.callback,true)}else{if(h.callback){h.callback.call()}}}else{log.write("Cannot make post activation call because the last call was playback. Wait for user input")}}application.state._viewstate["library-view"]=null;application.state._viewstate["wishlist-view"]=null}.bind(this))},initCallback:function(){var d=this;application.blockWidgetAccess=false;if(!$cn.data.partnerOfferID){setTimeout(function(){$("SplashScreen").hide()},2500)}if($cn.data.d2dPath){if($cn.data.d2dTitleInfo.id===null||$cn.data.d2dTitleInfo.error){d.showD2DUnavailable()}else{if($cn.data.AuthToken.length!=0&&$cn.data.AuthTokenActive==true){application.events.publish("loadtitleview",{id:$cn.data.d2dTitleInfo.id,action:"checkout"})}else{log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");log.write("D2D TRUE GOING TO ACTIVATE SCREEN");$("defaultWelcome").addClass("hidden");$("diskToDigitalWelcome").removeClass("hidden");d.WelcomeControl.getStarted();d.WelcomeControl.show()}}}else{if($cn.data.partnerOfferID){d.handleDeepLinking()}else{if($cn.data.AuthToken.length!=0&&$cn.data.AuthTokenActive==true){log.debug("$cn.data.EnableMerchPage: "+$cn.data.EnableMerchPage);d.WelcomeControl.hide();if($cn.data.EnableMerchPage){d.showMerch()}else{application.navigator.setFocus("selectedmaster",true)}}else{$("SplashScreen").hide();d.WelcomeControl.show();application.navigator.setFocus("welcomebutton",true)}}}if($cn.data.ParentPinEnabled){$("btnAccount").addClass("locked")}},showD2DUnavailable:function(){$cn.data.d2dPath=false;this.WelcomeControl.show();$("d2dUnavailable").show();log.write("D2D NO GO ");log.write("D2D NO GO ");log.write("D2D NO GO ");log.write("D2D NO GO ");log.write("D2D NO GO ");log.write("D2D NO GO ");log.write("D2D NO GO ");application.navigator.setFocus("d2dbrowsebutton",true)},tryStoreDeepLink:function(e){var d=this;var g="getShortSummary",f={TitleID:e};webservices.makeAsyncRequest(application.EndPoints.titledata,g,f,d,function(h){var j=false;if(h.data&&h.data.result){if(h.data.result.responseCode==0){$cn.data.partnerOfferAction="";application.currentView.currentState=null;application.events.publish("loadtitleview",{id:e});j=true}else{if(h.data.result.responseCode==20){h.data.result.errorHandled=true}else{j=true}}}if(!j){$cn.data.partnerOfferID="";$("SplashScreen").hide();d.initCallback()}},$cn.methods.GetCacheKey(g,f))},tryLibraryDeepLink:function(e){var d=this;webservices.makeAsyncRequest(application.EndPoints.commerce,"lookupPurchaseDetailsForTitle",{TitleID:e},this,function(f){var g=false;if(f.data&&f.data.result){if(f.data.result.responseCode==0){if(f.data.result.state!=="Not_Owned"){if(!f.data.result.isAvailable){$cn.data.partnerOfferAction=""}application.currentView.currentState=null;application.events.publish("loadtitleview",{id:e,passID:f.data.result.passID,type:"library"});g=true}}else{g=true}}if(!g){log.write("Deep linking Not handled by title lookup. Try store lookup.");d.tryStoreDeepLink(e)}})},handleDeepLinking:function(){var d=$cn.data.partnerOfferID;if($cn.data.AuthToken.length!=0&&$cn.data.AuthTokenActive==true){this.tryLibraryDeepLink(d)}else{this.tryStoreDeepLink(d)}},checkForUpdates:function(){},clone:function(){var d=$extend({},application.currentView);d.ScrollBar=$extend({},application.currentView.ScrollBar);return d},showPlayer:function(h,g,d,f,k,j,e){this.setView("player-view");if(this.PlayerControl==null){this.PlayerControl=new PlayerControl()}this.PlayerControl.load(h,g,d,f,k,j,e);if(j&&j!=""){$("PlayerLogo").addClass("redbuttons")}else{$("PlayerLogo").removeClass("redbuttons")}this.PlayerControl.show()},showTrailer:function(f,e){var d=this;log.write("Showing trailer: "+f+" : "+e);var g=$cn.utilities.showLoadingModal(0,"Loading...");$cn.methods.getBonusAssetLocation(e,function(h){$cn.utilities.clearLoadingSpinner(g);d.showPlayer(f,h.streamID,$cn.utilities.buildPlaybackURL(h.streamingAssetLocation,h.streamID,h.dRMServerURL,h.dRMACKServerURL,h.heartbeatURL,h.heartbeatPollInSeconds,false,h.customData),0,false,"",h.availableClosedCaptions)})},showPlay:function(j,d,f,e,l){var n=this,k=false,m=$cn.data.PassCache[d],h,g;$cn.methods.verifyAuthToken(function(p){if(p){if($cn.utilities.isTrue(m.isPassUV)&&!l){this.UV=new $cn.utilities.UserUVManager("showPlay");this.UV.checkUVAccount(function(r){if(r){n.showPlay(j,d,f,e,true)}},true);return}k=false;if(m&&m.availableProducts){m.availableProducts.each(function(s){var r;if(!k){for(r=0;r<s.availableAssets.length;r++){k=(s.availableAssets[r].file_FileProfile=="HIGH_DEFINITION");if(k){break}}}})}if(m&&m.availableProducts){log.write("If user is in library, check to see if they are trying to play a rental and have not received a license.");if(this.currentState=="titleview"&&!e){log.write("shouldShowRentalWarning: "+this.TitleViewControl.shouldShowRentalWarning());if(this.TitleViewControl.shouldShowRentalWarning()&&f==0){h=application.resource.checkout_messages.Rental_Warning;g={Message:h.Message.replace("##name##",m.name),Content:h.Content.replace("##rentalperiod##",this.TitleViewControl.getRentalPeriod()).replace("##expirationmessage##",m.expirationMessage.replace("Expires","")),Close:"No",OK:"Yes",callback:function(r){if(r){var s=$cn.utilities.getAudioProfileTypesForPurchase(d);if(!$cn.data.PreferredAudioTypeSet&&s.length>0&&!e){n.showAudioOptions(j,d,f)}else{BrowseView.showPlay(j,d,0,true)}}else{}}};BrowseView.showMessage("message_okcancel",g);return}}var q=$cn.utilities.getAudioProfileTypesForPurchase(d);if(!$cn.data.PreferredAudioTypeSet&&q.length>0){n.showAudioOptions(j,d,f,function(){$cn.methods.getStreamingAssetLocation(d,k?"HIGH_DEFINITION ":"STANDARD",function(r){n.showPlayer(j,r.streamID,$cn.utilities.buildPlaybackURL(r.streamingAssetLocation,r.streamID,r.dRMServerURL,r.dRMACKServerURL,r.heartbeatURL,r.heartbeatPollInSeconds,k,r.customData),f,k,d,r.availableClosedCaptions)})})}else{$cn.methods.setAudioDefaultProperty($cn.utilities.currentlyPlayingAudioProfile(d),function(){$cn.methods.getStreamingAssetLocation(d,k?"HIGH_DEFINITION ":"STANDARD",function(r){n.showPlayer(j,r.streamID,$cn.utilities.buildPlaybackURL(r.streamingAssetLocation,r.streamID,r.dRMServerURL,r.dRMACKServerURL,r.heartbeatURL,r.heartbeatPollInSeconds,k,r.customData),f,k,d,r.availableClosedCaptions)})})}}else{if(d&&d!=""&&d!=0){$cn.methods.lookupPurchaseDetailsForTitle(j,function(r){if(!r.isAvailable){application.events.publish("error",{type:"show_play_error",state:r.state,titleID:j});return}var s=$cn.utilities.getAudioProfileTypesForPurchase(d);if(!$cn.data.PreferredAudioTypeSet&&s.length>0){n.showAudioOptions(j,d,f,function(){$cn.methods.getStreamingAssetLocation(d,k?"HIGH_DEFINITION ":"STANDARD",function(u){n.showPlayer(j,u.streamID,$cn.utilities.buildPlaybackURL(u.streamingAssetLocation,u.streamID,u.dRMServerURL,u.dRMACKServerURL,u.heartbeatURL,u.heartbeatPollInSeconds,k,u.customData),f,k,d,u.availableClosedCaptions)})})}else{$cn.methods.setAudioDefaultProperty($cn.utilities.currentlyPlayingAudioProfile(d),function(){$cn.methods.getStreamingAssetLocation(d,k?"HIGH_DEFINITION ":"STANDARD",function(u){n.showPlayer(j,u.streamID,$cn.utilities.buildPlaybackURL(u.streamingAssetLocation,u.streamID,u.dRMServerURL,u.dRMACKServerURL,u.heartbeatURL,u.heartbeatPollInSeconds,k,u.customData),f,k,d,u.availableClosedCaptions)})})}})}}}else{BrowseView.showActivate()}}.bind(this))},showLegalInfo:function(e){var d=this;this.Legal=new LegalPopup("legal");var f=$cn.utilities.showLoadingModal(2000,"Loading...");$cn.methods.getLegalInfo(function(g){$cn.utilities.clearLoadingSpinner(f);d.Legal.loadData([{title:application.resource.legal_title,text:g}]);d.layoutIsDirty=true;d.Legal.firstFocus="LegalOK";d.Legal.show()})},showTerms:function(e){var d=this;this.Legal=new LegalPopup("legal");var f=$cn.utilities.showLoadingModal(2000,"Loading...");$cn.methods.getTermsOfService(function(g){$cn.utilities.clearLoadingSpinner(f);d.Legal.loadData([{title:application.resource.terms_title,text:g}]);d.layoutIsDirty=true;d.Legal.firstFocus="LegalOK";d.Legal.show()})},showPrivacy:function(e){var d=this;this.Legal=new LegalPopup("legal");var f=$cn.utilities.showLoadingModal(2000,"Loading...");$cn.methods.getPrivacyPolicy(function(g){$cn.utilities.clearLoadingSpinner(f);d.Legal.loadData([{title:application.resource.privacy_title,text:g}]);d.layoutIsDirty=true;d.Legal.firstFocus="LegalOK";d.Legal.show()})},showEula:function(h,f,e){this.Legal=new LegalPopup(h);var d=this;var g=$cn.utilities.showLoadingModal(2000,"Loading...");$cn.methods.getEulaText(function(j){$cn.utilities.clearLoadingSpinner(g);d.Legal.loadData([{title:application.resource.eula_title,text:$cn.data.EulaText}]);d.layoutIsDirty=true;d.Legal.firstFocus="LegalOK";d.Legal.show(e);if("eula"===h){d.Legal.cachedCss=$("modalcontainer").getStyles("background","width","height","z-index","position");if(f){$("modalcontainer").setStyles({background:"black"})}}if(f){$("Overlay").setStyle("background-color","black")}$("SplashScreen").hide()})},acceptEula:function(){var d=this;$cn.methods.acceptEula(function(e){d.Legal.hide();if(d.Legal.cachedCss){$("modalcontainer").setStyles(d.Legal.cachedCss);delete d.Legal.cachedCss}d.Legal.hide();$("Overlay").setStyle("background-color","transparent");d.initCallback()})},showChangeEnv:function(){if(this.EnvironmentPopup==null){this.EnvironmentPopup=new EnvironmentPopup()}this.EnvironmentPopup.loadData([{endpoint:"txt"}]);this.EnvironmentPopup.show()},showActivate:function(f){var g,e=this;if(this.ActivatePanel==null){this.ActivatePanel=new ActivatePanel()}if(document.getElementById("skinnykeyboard").style.display=="block"){this.GiftCardKeyboard.hide()}log.write("showing activate panel");this.layoutIsDirty=true;this.hasShownActivate=true;var d=this.hasShownActivate?"Cancel":"Continue Without Activating";g=$cn.utilities.showLoadingModal(2000,"Loading Activation String...");$cn.methods.getActivationString(function(h){$cn.utilities.clearLoadingSpinner(g);e.ActivatePanel.show(f);e.ActivatePanel.loadData([{buttonTxt:d}],h)})},hideActivate:function(){log.write("hiding activate panel");this.layoutIsDirty=true;this.ActivatePanel.hide()},showSpeed:function(){this.showingOtherModal=true;if(this.MessagePopup){this.MessagePopup.hide()}if(this.SpeedPopup==null){this.SpeedPopup=new SpeedPopup()}this.SpeedPopup.firstFocus="SpeedCancel";this.SpeedPopup.loadData([{cancel:"Cancel"}]);log.write("showing speed panel");this.layoutIsDirty=true;this.SpeedPopup.show();this.SpeedPopup.startSpeedCheck()},showSystemStatus:function(){log.write("System status is initiated");if(this.MessagePopup){this.MessagePopup.hide()}if(this.SystemStatusPopup===null){this.SystemStatusPopup=new SystemStatusPopup()}this.SystemStatusPopup.firstFocus="SystemStatusCancel";this.SystemStatusPopup.loadData([{cancel:"",duration:""}]);this.layoutIsDirty=true;this.SystemStatusPopup.show();this.SystemStatusPopup.start()},showSystemDetails:function(){log.write("System status Details Page");messagepath=application.resource.testing_messages.show_details;data={Title:messagepath.Title,InformativeText:$cn.data.SystemTests.informativeText,Cancel:"Close",Path:messagepath.MessageType};this.showMessage(messagepath.MessageType,data)},bwMessage:function(){var d=application.resource.testing_messages.bwMessage.SpeedResult1;if($cn.data.bwTest.speedBytes>0&&$cn.data.bwTest.speedBytes<125000){d=application.resource.testing_messages.bwMessage.SpeedResult1}else{if($cn.data.bwTest.speedBytes>0&&$cn.data.bwTest.speedBytes<1250000){d=application.resource.testing_messages.bwMessage.SpeedResult2}else{if($cn.data.bwTest.speedBytes>0){d=application.resource.testing_messages.bwMessage.SpeedResult3}}}d=d.replace("##speed##",parseInt($cn.data.bwTest.speedBytes*8/10000,10)/100);$$("#SystemStatus .bwMessage .theResult").set("html",d)},showAudioOptions:function(e,f,d,g){if(this.MessagePopup){this.MessagePopup.hide()}if(this.AudioPopup==null){this.AudioPopup=new AudioPopup()}this.layoutIsDirty=true;this.AudioPopup.loadData([{val:"void"}]);this.AudioPopup.show(e,f,d,g)},handleAuthParent:function(d){var e=(d.args&&d.args[0]&&d.args[0].callback)?d.args[0].callback:null;this.showPin(e)},showPin:function(d){if(this.PinPopup==null){this.PinPopup=new PinPopup()}if(pointer.isPointerModeActive()){pointer.lastFocusId="Pin0"}this.PinPopup.firstFocus="Pin0";this.PinPopup.loadData([{cancel:"Cancel"}]);if(d){this.PinPopup.callback=d}log.write("showing pin panel");this.layoutIsDirty=true;this.PinPopup.show()},showCCPopup:function(d){if(this.CCPopup==null){this.CCPopup=new CCPopup()}this.CCPopup.loadData([{cancel:"Cancel"}]);if(d){this.CCPopup.callback=d}log.write("showing CCPopup ");this.layoutIsDirty=true;this.CCPopup.show()},showConfirm:function(j,k,f,e,h,g,d){if(!this.ConfirmPopup){this.ConfirmPopup=new ConfirmPopup()}g.name=j.name;g.titleID=j.titleID;g.season="";g.episode="";if(j.titleType=="TV_Episode"){g.name=$cn.utilities.getMeta("ShowName",j.metaValues);g.season=$cn.utilities.getMeta("SeasonName",j.metaValues)+", "+$cn.utilities.getMeta("EpisodeNumber",j.metaValues);g.episode='"'+j.name+'"'}else{if(j.titleType=="TV_Season"){g.name=$cn.utilities.getMeta("ShowName",j.metaValues);g.season=j.name}}this.CurrentProcessLoaded=true;this.ConfirmPopup.loadData([g]);this.ConfirmPopup.setStatus(k,f,e,h,d)},showRate:function(e){if(!this.RatePopup){this.RatePopup=new RatePopup()}var d;d=BrowseView.TitleViewControl.getUserRatingFloat();$cn.methods.verifyAuthToken(function(f){if(f){this.RatePopup.loadData([{titleID:e,rate:"Rate"}]);this.RatePopup.firstFocus="RateControl";this.layoutIsDirty=true;this.RatePopup.show();this.RatePopup.setRate(d||3)}else{this.showActivate()}}.bind(this))},showHelp:function(){if(this.CurrentProcessLoaded){navigation.setFocusElement(null);application.state.save();log.session.addActivity("help");$("uicontainer").removeClass("redbuttons");$("wheel").hide();$("singlewheel").show();this.GridControl.cleanUI();this.TitleViewControl.cleanUI();this.hideExtras("HelpPanel");if(!this.HelpWheelControl){this.HelpWheelControl=new HelpWheelControl()}this.HelpPanel.show();this.HelpWheelControl.activate();this.HelpWheelControl.loadHelpMenu();navigation.setFocus("singleselectedmaster",true);this.setView("help-view");this.layoutIsDirty=true}},onExit:function(d){if(d.preventDefault){d.preventDefault()}if(!application.regionError){this.showExit()}},onNoChoiceExit:function(e){var d=this;e.preventDefault();if($$("div.giftcard").length>0&&$$("div.giftcard")[0].style.display=="block"){this.hideGiftCard()}d.Legal.hide();BrowseView.showMessage("message_exit",{callback:function(f){log.write("Exit?: "+f);if(f){application.exit()}else{d.showEula("eula")}}})},onReturn:function(d){d.preventDefault();this.showReturn()},onFocus:function(f){var d,e;log.write(f);if(f.args[0].focusedelem=="selectedmaster"||f.args[0].focusedelem=="selectedslave"||f.args[0].focusedelem=="singleselectedmaster"){d="";if(f.args[0].focusedelem=="selectedmaster"){d="masterdatasource"}else{if(f.args[0].focusedelem=="selectedslave"){d="slavedatasource"}else{if(f.args[0].focusedelem=="singleselectedmaster"){d="singlemasterdatasource"}}}e=application.loadAnimation("wheel");$$("#"+d+" div.wheelitem").each(function(g){if(g.getStyle("color")==e.properties.primary.color){g.setStyle("color",e.properties.primary.focus)}})}},onBlur:function(f){var d,e;if(f.args[0].bluredelem=="selectedmaster"||f.args[0].bluredelem=="selectedslave"||f.args[0].bluredelem=="singleselectedmaster"){d="";if(f.args[0].blureditem=="selectedmaster"){d="masterdatasource"}else{if(f.args[0].blureditem=="selectedslave"){d="slavedatasource"}else{if(f.args[0].blureditem=="singleselectedmaster"){d="singlemasterdatasource"}}}e=application.loadAnimation("wheel");$$("#"+d+" div.wheelitem").each(function(g){if(g.getStyle("color")==e.properties.primary.focus){g.setStyle("color",e.properties.primary.color)}})}},showExit:function(){if($$("div.giftcard").length>0&&$$("div.giftcard")[0].style.display=="block"){this.hideGiftCard()}BrowseView.showMessage("message_exit",{callback:function(d){log.write("Exit?: "+d);if(d){if(BrowseView.currentState=="player-view"){BrowseView.PlayerControl.stopPlayer();BrowseView.PlayerControl._saveStatus("stopped",function(){device.exit()})}application.exit()}}})},showReturn:function(){if($$("div.giftcard").length>0&&$$("div.giftcard")[0].style.display=="block"){this.hideGiftCard()}BrowseView.showMessage("message_return",{callback:function(d){log.write("Return to Media Hub?: "+d);if(d){device.sendReturnEvent()}}})},exitStore:function(){if(BrowseView.currentState=="player-view"){BrowseView.PlayerControl.stopPlayer();Player.Shutdown();BrowseView.PlayerControl._saveStatus("stopped",function(){device.exit()});BrowseView.currentState=null}application.exit()},returnStore:function(){if(BrowseView.currentState=="player-view"){BrowseView.PlayerControl.stopPlayer();BrowseView.PlayerControl._saveStatus("stopped",function(){device.sendReturnEvent()});BrowseView.currentState=null}else{device.sendReturnEvent()}application.exit()},showMessage:function(d,f,e){if(document.getElementById("skinnykeyboard")&&document.getElementById("skinnykeyboard").style.display=="block"){this.GiftCardKeyboard.hide()}if(this.MessagePopup){this.MessagePopup.hide()}this.MessagePopup=new MessagePopup(d);this.MessagePopup.loadData(f);this.layoutIsDirty=true;this.MessagePopup.show(e)},loadImagePopup:function(d){if(!this.ImagePopup){this.ImagePopup=new ImagePopup()}this.ImagePopup.loadData(d)},showImages:function(){if(this.ImagePopup){this.ImagePopup.show()}},showSystemMessage:function(){this.showMessage("message_service",{Message:$cn.data.SystemUnavailableMessage,close:"close"})},handleBadAuthToken:function(d){log.write("bad auth token detected. Clear info. Current view: "+this.currentState+", Current element: "+application.element.current);application.clearAuthToken();this.CurrentProcessLoaded=true;this.GiftCardPanel.isProcessing=false;if(this.currentState=="titleview_wheel"&&application.element.current=="checkout_order"){application.isBusy=false;this.orderIsProcessing=false}if(this.currentState=="library-view"){this.goLibrary()}else{if(this.currentState=="wishlist-view"){this.goWishlist()}else{this.showActivate(d.args[0])}}if(this.SettingsPanelControl){this.SettingsPanelControl.isInitialized=false}$("btnAccount").removeClass("locked")},handleGridLoading:function(e){var d=this;this.CurrentProcessLoaded=false;if(application.isLoaded){document.getElementById("gridview").className="grid-loading";document.getElementById("GridOverlay").className="";application.putInnerHTML(document.getElementById("gridloadingprocessstring"),"");application.putInnerHTML(document.getElementById("genericloadingprocessstring"),"");if(e.args[0].cssClass&&e.args[0].cssClass!=""){if(application.resource.processing_strings[e.args[0].cssClass]){$("GridOverlay").addClass("gridspinnertext");application.putInnerHTML(document.getElementById("gridloadingprocessstring"),application.resource.processing_strings[e.args[0].cssClass]);application.putInnerHTML(document.getElementById("genericloadingprocessstring"),application.resource.processing_strings[e.args[0].cssClass])}}$("gridspinnercontainer").setStyle("width",$(e.args[0].grid).offsetWidth+"px");$("gridloadercontainer").show();if(!d.CurrentProcessLoaded){if($("store").hasClass("episode-panel")){$("titlelist").innerHTML="";log.write("spinner cleared!!!!!!!!!!!!")}log.write("calling spinner init");BrowseView.GridController.initSpinner()}}},handleGridLoaded:function(e){var d;$("gridloadercontainer").hide();document.getElementById("gridview").className="";this.CurrentProcessLoaded=true;this.GridController.deinitSpinner();var f=document.getElementById("titlegrid");if(f&&f.style.display!="none"){if((application.element.current!=""&&!document.getElementById(application.element.current))){d=$("titlegrid").getElementsByTagName("a");if(d.length>0){application.navigator.setFocus(d[0].id,true)}}}},showChangeUser:function(){var d;if(this.CurrentProcessLoaded){d=1;if($cn.data.AllowedAudioProfiles&&$cn.data.AllowedAudioProfiles.length>0){d=2}if(application.resource.SettingsWheelOptionStrings.ClosedCaptions!=undefined){d++}this.goSettings(d)}},showTitleDetails:function(e,f){var d=this;this.SearchKeyboard.hide();this.CheckoutPanel.hide();this.HelpPanel.hide();this.TitleLoading=true;this.layoutIsDirty=true;this.expandTitleDetails(function(g){if(!$cn.data.d2dPath){$cn.utilities.clearLoadingSpinner(f)}d.titleViewLoading=false;d.TitleViewControl.show();log.write("... action is: "+e);if(e==="checkout"){d.showCheckOut(d.TitleViewControl.persist.title.titleID,f)}else{if(e==="nextEpisode"||e==="skipFocus"){}else{d.TitleViewControl.setFocus()}}d.TitleLoading=false;$cn.data.LoadTitleID="";application.events.publish("displaytitledetails",{});if($cn.data.partnerOfferID){$("SplashScreen").hide();if($cn.data.partnerOfferAction==="play"){$cn.data.partnerOfferAction="";BrowseView.showPlay(d.TitleViewControl.persist.title.titleID,d.TitleViewControl.persist.title.passID,0)}application.state._history=[];$("dock-back").removeClass("disableBack");application.state.exitOnBack=true;$cn.data.partnerOfferID=""}})},onPanelClose:function(d){if(this.panel!=null){$("store").removeClass(this.panel);switch(this.panel){case"checkout-panel":this.CheckoutPanel.hide();break;case"episode-panel":this.EpisodePanel.hide();break;case"similar-panel":break;case"moreinfo-panel":break}}this.panel=null;this.setView("titleview");this.TitleViewControl.enableButtons()},expandTitleDetails:function(d){$("titledetails").setStyle("overflow","visible");$("WheelSeparator").hide();$("titledetailsmask").setStyle("visibility","hidden");log.write("Device SOC:"+device.getDeviceSoc());BrowseView.onPanelClose();BrowseView.ScrollBar.deactivate();$("wheel").hide();$("singlewheel").hide();BrowseView.hideExtras("hideTitleDetails");BrowseView.layoutIsDirty=true;$("titledetails").setStyles({width:840,left:0});if(d){d.call()}},showTvEpisodes:function(d){$("wheel").hide();if(!this.EpisodePanel){this.EpisodePanel=new EpisodePanelControl()}this.EpisodePanel.show(d)},shrinkTitleDetails:function(d,h){var f,e,g;log.write("Shrinking... panel:"+d);$("titledetails").setStyle("overflow","hidden");f=this;e=$("store");e.addClass("title-panel");e.addClass(d);this.panel=d;$("WheelSeparator").show();$("titledetailsmask").setStyle("visibility","visible");if(!device.getDeviceSoc()=="BCOM"){g=new Fx.Morph($("titledetails"),{duration:300,transition:Fx.Transitions.Sine.easeOut,onComplete:function(j){f.currentState="titleview_wheel";BrowseView.TitleViewControl.disableButtons();log.write("$$$$$$$$$$$$$ "+f.panel+"$$$$$$$$$$$$$$$$");if(d=="checkout-panel"){f.CheckoutPanel.show()}if(h){navigation.setFocus(h,true)}}});g.start({width:250,left:0})}else{f.currentState="titleview_wheel";BrowseView.TitleViewControl.disableButtons();log.write("$$$$$$$$$$$$$ "+f.panel+"$$$$$$$$$$$$$$$$");$("titledetails").setStyles({width:250,left:0});if(d=="checkout-panel"){f.CheckoutPanel.show()}if(h){navigation.setFocus(h,true)}}},hideTitleDetails:function(){var d;this.CheckoutPanel.hide();$("WheelSeparator").hide();if(!device.getDeviceSoc()=="BCOM"){d=new Fx.Morph($("titledetails"),{duration:300,transition:Fx.Transitions.Sine.easeOut,onComplete:function(f){$("titledetails").hide();application.currentView.layoutIsDirty=true}});d.start({width:0,left:0})}else{$("titledetails").setStyles({width:0,left:0})}$("store").removeClass("title-panel");$("store").removeClass("episode-panel")},hideTitleDetailsMask:function(){log.write("hideTitleDetailsMask! panel:"+this.panel);var d=this.panel;BrowseView.expandTitleDetails();BrowseView.TitleViewControl.enableButtons();if(d!=null){if(d=="checkout-panel"){pointer.lastFocusId="tdbuttonCheckout"}if(d=="moreinfo-panel"){pointer.lastFocusId="tdbuttonMoreInfo"}if(d=="similar-panel"){pointer.lastFocusId="tdbuttonSimilar"}}},handleLoadRecommendation:function(d){log.write("$$$$$$$$$$$$$$$$$$$$$$$$ SHOW WHEEL $$$$$$$$$$$$$$$$$$$$$$$$");$("wheel").show()},showSimilar:function(e){log.write("Similar-ing...");var f=$cn.utilities.showLoadingModal(1000,"Loading Similar Titles...");$("wheel").show();$("singlewheel").hide();$("titlegrid_container").removeClass("header");this.GridControl.cleanUI();this.CheckoutPanel.hide();this.HelpPanel.hide();this.currentTitle=$cn.data.TitleDetailCache[e];if(!this.RecomendationWheelControl){this.RecomendationWheelControl=new RecomendationWheelControl()}var d=this;this.RecomendationWheelControl.loadData(e,function(h,g){$cn.utilities.clearLoadingSpinner(f);if(h==0){d.shrinkTitleDetails("similar-panel","selectedmaster")}else{messagepath=application.resource.store_messages.Similar_Titles_Not_Found;data={Message:messagepath.Message,Content:messagepath.Content,Footer:messagepath.Footer,Close:messagepath.Cancel,callback:function(j){log.write("Similar: Call to load Similar pane data load failed; responseCode is "+h+"; responseMessage is "+g)}};if(data.Footer){data.Footer=data.Footer.replace("{responseCode}",h);data.Footer=data.Footer.replace("{m}",this.resolveMethodCode("getGenesByWheelOptionPlural"))}BrowseView.showMessage(messagepath.MessageType,data)}})},showMoreInfo:function(){log.write("More Info-ing...");this.CheckoutPanel.hide();this.HelpPanel.hide();$("singlewheel").hide();$("wheel").show();if(!this.TitleMetaWheelControl){this.TitleMetaWheelControl=new TitleMetaWheelControl()}this.GridController.initSpinner();this.TitleMetaWheelControl.activate();this.TitleMetaWheelControl.loadData(this.moreInfoItems,this.currentTitle);this.shrinkTitleDetails("moreinfo-panel","selectedmaster")},showCheckOut:function(d,e){log.write("Checkout...");this.LastGridProcess="";if($cn.data.d2dPath){application.state.purge()}$("wheel").hide();$("singlewheel").show();this.SearchKeyboard.hide();this.HelpPanel.hide();$("titlegrid").hide();this.GridController.hideAll();this.ScrollBar.hide();if(!this.TitleCheckOutWheelControl){this.TitleCheckOutWheelControl=new TitleCheckOutWheelControl()}$cn.utilities.clearLoadingSpinner(e);this.TitleCheckOutWheelControl.activate();this.TitleCheckOutWheelControl.loadCheckOutData(d);this.CheckoutPanel.show();this.shrinkTitleDetails("checkout-panel");application.currentView.layoutIsDirty=true},goCheckOut:function(n,h,e,f,l){var m=this,g,k,j,d;application.TempKeyBlock=true;log.write("Keys blocked during checkout");application.TempKeyBlockDuration=90000;log.write("================= goCheckOut =======================");log.write("uniquePurchaseId is: "+m.uniquePurchaseId);if(this.orderIsProcessing){return}log.write("titleid is: "+n);log.write("skuid is: "+h);if(!m.uniquePurchaseId){$cn.data.LastBandwidthCheck=false;m.uniquePurchaseId=$cn.utilities.uniqueIdentifier()}if(application.authSupported){if($cn.data.AuthToken==""){this.showActivate()}else{if($cn.data.PurchasePinEnabled&&!f){application.TempKeyBlock=false;application.TempKeyBlockDuration=1000;this.showPin(function(){m.goCheckOut(n,h,e,true)});return}this.currentTitle=$cn.data.TitleDetailCache[n];g=$cn.utilities.isHdTitle(this.currentTitle,h);k=$cn.utilities.isSurroundSoundTitle(this.currentTitle,h);if(!l){l=$cn.utilities.bandwidthCheckValid(g)}this.CurrentProcessLoaded=false;this.orderIsProcessing=true;if(!l){log.write("doCheckout: performing bandwidth check");this.HelpPanel.hide();this.hideExtras(["CheckoutPanel","hideTitleDetails"]);this.showMessage("message_loading",{Message:application.resource.loading_enum.orderprocessing});BandwidthCheck.purchaseBandwidthCheck(n,h,e,g,PlaybackBandwidthTest);return}else{this.HelpPanel.hide();this.hideExtras(["CheckoutPanel","hideTitleDetails"]);this.showMessage("message_loading",{Message:application.resource.loading_enum.orderprocessing});$cn.methods.getTermsOfServiceAcceptance(function(p){log.write("++++++++++ tos acceptance is: "+p);if(!p){log.write("++++ not accepted ++++++");BrowseView.showMessage("message_okcancel",{Message:application.resource.terms_title,Content:application.resource.terms_changed,OK:"Try Again",Close:"Cancel",callback:function(q){if(q){m.errorCleanup();m.goCheckOut(n,h,e)}else{m.errorCleanup()}}})}else{$cn.methods.doPurchase(h,n,e,function(A){var w,v,u,r,s,q;if(!A){application.TempKeyBlock=false;w=application.resource.checkout_messages.system_error;v={Message:w.Message,Content:w.Content,Footer:w.Footer.replace("{m}",this.resolveMethodCode("doPurchase")),OK:w.OK,Close:w.Cancel,Path:w.MessageType,callback:function(B){if(B){BrowseView.goCheckOut(n,h,e)}}.bind(this)};m.errorCleanup();m.showMessage(w.MessageType,v)}else{if(A.responseCode!=0){application.TempKeyBlock=false;if(A.responseCode>=120&&A.responseCode<=400){w=application.resource.checkout_messages.uv_error;w.Message=A.responseMessage}else{w=application.resource.checkout_messages[A.responseMessage.replace(/ /g,"_")]}if(!w){w=application.resource.checkout_messages.system_error}log.write("Error message Path: "+w);u=(w.MessageType)?w.MessageType:"message_okcancel";if(!w.OK){u="message_content"}v={Message:w.Message,Content:w.Content,Footer:w.Footer.replace("{m}",this.resolveMethodCode("doPurchase")),OK:w.OK,Close:w.Cancel,Path:w,callback:function(B){if(B){BrowseView.goCheckOut(n,h,e)}}.bind(this)};m.errorCleanup();m.showMessage(u,v)}else{application.TempKeyBlock=false;application.TempKeyBlockDuration=1000;if(BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}navigation.setFocusElement(null);application.events.publish("purchasecomplete",{skuid:h});application.state._viewstate["library-view"]=null;r="play";s="";q=$cn.utilities.getPurchaseSkuProduct(this.currentTitle,h);if(q.purchaseType=="rent"){s="rent"+q.rentalPeriod}else{s=q.purchaseType+this.currentTitle.titleType}m.showConfirm(m.currentTitle,q.purchaseType,s,r,g,A,k)}}application.TempKeyBlock=false;application.TempKeyBlockDuration=1000;m.orderIsProcessing=false;m.uniquePurchaseId=false}.bind(m))}})}}}else{application.TempKeyBlock=false;application.TempKeyBlockDuration=1000;navigation.setFocusElement(null);this.currentTitle=$cn.data.TitleDetailCache[n];g=$cn.utilities.isHdTitle(this.currentTitle,h);k=$cn.utilities.isSurroundSoundTitle(this.currentTitle,h);j=$cn.utilities.getPurchaseSkuProduct(this.currentTitle,h);this.showConfirm(this.currentTitle,j.purchaseType,j.purchaseType+this.currentTitle.titleType,"play",g,function(){},k)}},errorCleanup:function(){application.TempKeyBlock=false;application.TempKeyBlockDuration=1000;this.CurrentProcessLoaded=true;this.orderIsProcessing=false;this.uniquePurchaseId=false},showMerch:function(){this.setView("merch-view");this.MerchControl.show()},goGiftCard:function(d,f){var e=this;$cn.methods.verifyAuthToken(function(g){if(g){if(e.MessagePopup){e.MessagePopup=null}e.GiftCardPanel.show(d,f);navigation.setFocus("SkinnyFirstKey",true)}else{BrowseView.showActivate()}}.bind(this))},hideGiftCard:function(){this.GiftCardKeyboard.hide();this.GiftCardPanel.hide()},goHome:function(d){if(this.CurrentProcessLoaded||!application.isLoaded){var e=this.currentState;log.write("store.goHome: Navigating to home page - dontsave = "+d);log.session.addActivity("store");if(this.currentState!=null&&!d){navigation.setFocusElement(null);application.state.save()}if(!this.loadSavedState("browse-view")){$("uicontainer").removeClass("redbuttons");this.hideExtras("BrowseView");$("titlegrid").show();$("wheel").show();$("singlewheel").hide();this.GridControl.currentId=0;this.WheelControl.activate();this.WheelControl.loadData($cn.data.masterWheel,$cn.data.slaveWheel)}if(e!=null&&!d){$("dock-back").removeClass("disableBack")}navigation.setFocus("selectedmaster",true);this.setView("browse-view");this.layoutIsDirty=true}},goSearch:function(){if(this.CurrentProcessLoaded){navigation.setFocusElement(null);application.state.save();log.session.addActivity("search");$("uicontainer").removeClass("redbuttons");this.layoutIsDirty=true;this.hideExtras();$("wheel").hide();this.SearchKeyboard.show();this.CheckoutPanel.cleanUI();this.TitleViewControl.cleanUI();this.GridControl.cleanUI();this.setView("search-view");if(!this.SearchWheelControl){this.SearchWheelControl=new SearchWheelControl()}this.SearchWheelControl.activate();this.SearchWheelControl.loadSearchMenu();navigation.setFocus("FirstKey",true)}},addToWishList:function(d){if($cn.data.AuthToken==""){this.showActivate({callback:function(){this.addToWishList(d)}.bind(this)})}else{$cn.methods.addItemToWishList(d,function(e){if(e&&(e.responseCode==0||e.responseCode!=0)){application.events.publish("wishlistinsert",d)}})}},goWishlist:function(){if(this.CurrentProcessLoaded){this._goWishlist()}},_goWishlist:function(){var e=$cn.utilities.DateDiff(new Date(),this.WishListLastLoaded),d=this,f;if(e<this.viewLoadingTimeout){return}this.WishListLastLoaded=new Date();navigation.setFocusElement(null);application.state.save();log.session.addActivity("wish_list");f=$cn.utilities.showLoadingModal(2000,application.resource.loading_enum.loadingwishlist);$cn.methods.verifyAuthToken(function(g){$cn.utilities.clearLoadingSpinner(f);if(!g){application.clearAuthToken();application.state._viewstate["wishlist-view"]=null}if(!this.loadSavedState("wishlist-view")){$("titledetails").hide();$("WheelSeparator").hide();$("uicontainer").removeClass("redbuttons");this.hideExtras();$("wheel").hide();$("singlewheel").hide();this.GridControl.cleanUI();if(!this.WishList){this.WishList=new WishList()}this.WishList.show()}this.setView("wishlist-view");this.layoutIsDirty=true;if(BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}}.bind(this))},goLibrary:function(e,d){if(this.CurrentProcessLoaded){this._goLibrary(e,d)}},_goLibrary:function(f,e){var d=this;navigation.setFocusElement(null);application.state.save();if(f){f()}log.session.addActivity("library");$cn.utilities.showSharedLoadingModal(2000,application.resource.loading_enum.library);$cn.methods.verifyAuthToken(function(g){if(!g){$cn.utilities.clearSharedLoadingSpinner();application.clearAuthToken();application.state._viewstate["library-view"]=null}if(!this.loadSavedState("library-view")){this.hideExtras();$("wheel").hide();$("singlewheel").hide();$("titlegrid").hide();$("scrollbar").hide();$("titledetails").hide();$("WheelSeparator").hide();this.hideExtras();if(!this.Library){this.Library=new Library()}this.Library.show()}this.setView("library-view");if(e){e()}}.bind(this))},setLibrary:function(d){$("uicontainer").addClass("redbuttons");if(!d){this.setView("library-view")}},goSettings:function(d){if(this.CurrentProcessLoaded){navigation.setFocusElement(null);application.state.save();log.session.addActivity("settings");log.write("showing settings");$("uicontainer").removeClass("redbuttons");this.layoutIsDirty=true;this.TitleViewControl.cleanUI();this.hideExtras("SettingsPanel");$("wheel").show();$("singlewheel").hide();this.GridControl.cleanUI();if(!this.SettingsWheelControl){this.SettingsWheelControl=new SettingsWheelControl()}this.SettingsWheelControl.activate();this.SettingsWheelControl.loadSettingsMenu(d);this.SettingsPanel.show();if(d&&d!=0){navigation.setFocus("btnsettingsparental",true)}else{navigation.setFocus("selectedmaster",true)}this.setView("settings-view")}},render:function(){},handleGoBack:function(f){var d=this,e;if(this.CurrentProcessLoaded){if(this.TitleLoading){f.preventDefault();return}BrowseView.CurrentProcessLoaded=true;switch(this.currentState){case"titleview_wheel":f.preventDefault();if(document.getElementById("imagepopup").style.display=="block"){this.ImagePopup.hide()}else{this.expandTitleDetails(function(g){$("titledetails").show();d.layoutIsDirty=true;if(ActiveWheel.id=="TitleMetaWheelControl"){application.navigator.setFocus("tdbuttonMoreInfo",true)}else{if(ActiveWheel.id=="RecomendationWheelControl"){application.navigator.setFocus("tdbuttonSimilar",true)}else{if(ActiveWheel.id=="TvSeasonsWheelControl"){application.navigator.setFocus("tdbuttonEpisodes",true)}else{log.write("Tracer to see if the goback method is moving focus from the error popup.");e=document.getElementById("ButtonPanel").getElementsByTagName("a");if(e.length>0){application.navigator.setFocus(e[0].id,true)}else{application.navigator.setFocus("dock-home",true)}}}}})}break;case"wishlist-view":if(this.TitleViewControl.persist.title){if(application.state._history.length>1&&application.state._history[application.state._history.length-1].currentState=="titleview"){this.TitleViewControl.update({forceUpdate:true})}}break}}else{f.preventDefault()}},hideExtras:function(d){if(!d||(d&&d.indexOf("SearchKeyboard")==-1)){this.SearchKeyboard.hide()}if(!d||(d&&d.indexOf("CheckoutPanel")==-1)){this.CheckoutPanel.hide()}if(!d||(d&&d.indexOf("SettingsPanel")==-1)){this.SettingsPanel.hide()}if(!d||(d&&d.indexOf("hideTitleDetails")==-1)){this.hideTitleDetails()}if(!d||(d&&d.indexOf("GiftCardKeyboard")==-1)){this.GiftCardKeyboard.hide()}if(!d||(d&&d.indexOf("GridController")==-1)){this.GridController.hideAll()}if(!d||(d&&d.indexOf("ScrollBar")==-1)){this.ScrollBar.hide()}if(!d||(d&&d.indexOf("HelpPanel")==-1)){this.HelpPanel.hide()}if(this.Library){if(!d||(d&&d.indexOf("Library")==-1)){this.Library.hide()}}if(!d||(d&&d.indexOf("BrowseView")!==-1)){$("titledetails").hide();$("WheelSeparator").hide()}$("messagepanel").hide();$("titlegrid_container").removeClass("header")},showLogo:function(){$("logo").show()},hideLogo:function(){$("logo").hide()},loadTitle:function(f,e,g){var d;log.write(f.wheelItems);this.similarItems=[];this.moreInfoItems=[];for(d=0;d<f.wheelItems.length;d++){if(f.wheelItems[d].indexOf("s_")==0||f.wheelItems[d].indexOf("m_cast_crew")>-1){this.similarItems.push(f.wheelItems[d])}else{this.moreInfoItems.push(f.wheelItems[d])}}if(f.titleType=="TV_Episode"){$cn.methods.getBundleListing(f.showTitleID,function(h){f.show=h.name;f.seasonal=f.seasonTitleID!=0;if(f.seasonTitleID){$cn.methods.getBundleListing(f.seasonTitleID,function(k){if(k.bundleItems.length==0){BrowseView.TitleViewControl.noBundleError=true;log.write("$$$$$ ERROR - Empty bundle listing $$$$$")}for(var j=0;j<k.bundleItems.length;++j){if(k.bundleItems[j].titleID==f.titleID){f.season=k.name+", Episode "+k.bundleItems[j].itemNumber;if(k.bundleItems.length>j+1){f.nextEpisodeID=k.bundleItems[j+1].titleID}break}}this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}.bind(this));return}else{for(d=0;d<h.bundleItems.length;++d){if(h.bundleItems[d].titleID==f.titleID){f.season="Episode "+h.bundleItems[d].itemNumber;break}}this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}}.bind(this))}else{if(f.titleType=="TV_Season"){$cn.methods.getBundleListing(f.showTitleID,function(h){f.show=$cn.utilities.getMeta("ShowName",f.metaValues);f.season=f.name;f.seasonal=true;this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}.bind(this))}else{if(f.titleType=="TV_Show"){f.show=f.name;$cn.methods.getBundleListing(f.showTitleID,function(h){if(h.bundleItems.length==1){$cn.methods.getBundleListing(h.bundleItems[0].titleID,function(j){f.seasonal=j.bundleItems.length>0;this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}.bind(this))}else{f.seasonal=true;this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}}.bind(this))}else{this.TitleViewControl.loadData(f);this.showTitleDetails(e,g)}}}},loadSavedState:function(e){var d;if(this.currentState!=e){d=this.currentState;if(application.state.loadState(e)){this.currentState=d;return true}}return false},reset:function(d){log.write("Resetting view state - current state: "+this.currentState);application.reset();if(d==null){d=this.currentState}switch(d){case"search-view":this.currentState=null;BrowseView.goSearch();break;case"wishlist-view":this.currentState=null;BrowseView.goWishlist();break;case"library-view":this.currentState=null;BrowseView.goLibrary();break;case"browse-view":case"titleview":case"titleview_wheel":this.currentState=null;BrowseView.goHome();break}},setView:function(d){var e;if(d!=this.currentState){this.layoutIsDirty=true;e=$("store");e.removeClass(this.currentState);e.addClass(d);this.currentState=d;application.events.publish("viewchanged",d);log.write("Current view: "+d)}},onSaveState:function(e){var d=e.args[0];d[this.id]={currentState:this.currentState,panel:this.panel}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id]);log.write("Current State: "+this.currentState);if((!application.element.current||application.element.current!="")||(application.element.current&&application.element.current!=""&&!document.getElementById(application.element.current))){switch(this.currentState){case"merch-view":if(!application.element.current||(application.element.current&&application.element.current=="")){navigation.setFocus("f_button",true)}break;case"browse-view":if(!application.element.current||(application.element.current&&application.element.current=="")){navigation.setFocus("selectedmaster",true)}break;case"search-view":if(!application.element.current||(application.element.current&&application.element.current=="")){navigation.setFocus("FirstKey",true)}break;case"wishlist-view":break;case"library-view":if(!application.element.current||(application.element.current&&application.element.current=="")){this.Library.setFocus()}$cn.utilities.clearSharedLoadingSpinner();break;case"settings-view":navigation.setFocus("selectedmaster",true);break;case"titleview":this.TitleViewControl.setFocus();break;case"help-view":navigation.setFocus("singleselectedmaster",true);break}}},onBlockedKey:function(d){d.preventDefault()},resolveMethodCode:function(e){var d=" - 0.1";switch(e){case"getNavigation":d=" - 1.1";break;case"getMerchandize":d=" - 1.2";break;case"getBrowseList":d=" - 1.3";break;case"getBrowseListByCast":d=" - 1.4";break;case"getBrowseListByCastRole":d=" - 1.5";break;case"getBrowseListByGene":d=" - 1.6";break;case"getBrowseListByGeneWithSimilarBy":d=" - 1.7";break;case"getGenesByWheelOptionPlural":d=" - 1.8";break;case"getBundleListing":d=" - 1.10";break;case"getBundleListingPurchased":d=" - 1.11";break;case"getShortSummary":d=" - 1.12";break;case"getFullSummary":d=" - 1.13";break;case"getGenesByWheelOption":d=" - 1.14";break;case"getCastAndCrew":d=" - 1.15";break;case"getCastBio":d=" - 1.16";break;case"getCastBios":d=" - 1.17";break;case"getCredits":d=" - 1.18";break;case"getImages":d=" - 1.19";break;case"getTechnicalDetails":d=" - 1.20";break;case"getReviews":d=" - 1.21";break;case"rateTitle":d=" - 1.22";break;case"getBrowseListBySimilar":d=" - 1.92";break;case"getShortSummaryPlural":d=" - 1.96";break;case"searchTitle":d=" - 2.24";break;case"searchPerson":d=" - 2.25";break;case"getWishlist":d=" - 2.26";break;case"checkUserWishListForItems":d=" - 2.27";break;case"addItemToWishList":d=" - 2.28";break;case"removeAllItemsFromWishList":d=" - 2.29";break;case"removeItemFromWishList":d=" - 2.30";break;case"getWishlistExt":d=" - 2.124";break;case"doPurchase":d=" - 3.32";break;case"checkIfTitleInLibrary":d=" - 3.33";break;case"lookupPurchaseDetailsForTitle":d=" - 3.34";break;case"getBillingInfo":d=" - 3.35";break;case"verifyCode":d=" - 3.36";break;case"applyGiftCode":d=" - 3.37";break;case"calcOrderTax":d=" - 3.103";break;case"pollForToken":d=" - 4.39";break;case"verifyAuthToken":d=" - 4.40";break;case"loadToken":d=" - 4.41";break;case"getActivationString":d=" - 4.42";break;case"checkParentPin":d=" - 4.43";break;case"toggleParentPin":d=" - 4.44";break;case"togglePurchasePin":d=" - 4.45";break;case"getLinkingAccount":d=" - 4.132";break;case"getLegalInfo":d=" - 5.46";break;case"getEulaText":d=" - 5.47";break;case"acceptEula":d=" - 5.48";break;case"setupDevice":d=" - 5.49";break;case"recordSessionData":d=" - 5.50";break;case"recordSessionConnectionSpeedTest":d=" - 5.51";break;case"defineErrorCode":d=" - 5.52";break;case"CheckHeaderValues":d=" - 5.53";break;case"getAudioDefaultProperty":d=" - 5.54";break;case"setAudioDefaultProperty":d=" - 5.55";break;case"getTermsOfService":d=" - 5.114";break;case"getPrivacyPolicy":d=" - 5.115";break;case"getTermsOfServiceAcceptance":d=" - 5.126";break;case"getPurchasedTitle":d=" - 6.56";break;case"getUserLibrary":d=" - 6.57";break;case"getGenres":d=" - 6.58";break;case"getAvailGenresAndLibSlaveWheelOptions":d=" - 6.59";break;case"getAvailLibSlaveWheelOptionByMasterWheel":d=" - 6.60";break;case"getAvailMasterWheelOptions":d=" - 6.61";break;case"getUserLibraryCounts":d=" - 6.62";break;case"getUserLibraryExt":d=" - 6.128";break;case"getBonusAssetLocation":d=" - 7.63";break;case"getStreamingAssetLocation":d=" - 7.64";break;case"sendStopMessageForStream":d=" - 7.65";break;case"loadLastStreamingAssetLocationForPass":d=" - 7.66";break;case"updateResumeTimeForPass":d=" - 7.123";break;default:break}return d},onHandleError:function(r){var v=this,k=null,h=null,j={},d="0.1",m=this,g,u,q,w,p,s,f,l;v.titleViewLoading=false;try{log.write("Error Method: "+r.args[0].method+", Error type: "+r.args[0].type+", Error status: "+r.args[0].status);d=r.args[0].method;if(!application.ui.wasInitialized){r.preventDefault();log.write("============ pre ui init error caught =============");application.ui.init(function(){application.loadView(BrowseView);$("wheel").hide();$("dock").hide();$("logo").hide();$("SplashScreen").hide();r.restartApp=true;v.onHandleError(r)},true);return}else{$("SplashScreen").hide()}}catch(n){}try{if(d=="recordSessionData"){log.write("Error saving session data. Ignore and continue as usual.");return}if(typeof r.preventDefault=="function"){r.preventDefault()}if(d!="doPurchase"){log.write('payload.args[0].type === "system_error":'+(r.args[0].type==="system_error"));log.write("payload.args[0].status == 500:"+(r.args[0].status==500));if($("ActivatePanel")&&$("ModalWindow")){$("ActivatePanel").hide();$("ModalWindow").show()}if(d==="getActivationString"&&r.args[0].status==500){k=application.resource.system_messages["spoof_check_error"];$("modalcontrol").addClass("show5");$("ModalWindow").setAttribute("style","");u=(application.resource.modalConfig.activate_show5);for(g in u){$("ModalWindow").setStyle(g,u[g])}log.write("Modal Class for error: "+$("modalcontrol").className);$("modalcontrol").removeClass("activate")}else{k=application.exception.resolveMessagePath(this.currentState)[r.args[0].type]}h=(k&&k.MessageType)?k.MessageType:"message_okcancel";if(k.Footer){k.Footer=k.Footer.replace("{m}",this.resolveMethodCode(d))}}}catch(n){log.write("Something very bad happened. Unrecoverable. Message path for current state "+this.currentState+" and type "+r.args[0].type+" could not be found.");j={Message:"Unable to contact the server.",Content:"Make sure your network connection is active and try again.",Footer:'Still having trouble? Please go to <span class="url">www.cinemanow.com/support</span> and type the following error code in the search box: <span class="errorCode">550 {m}</span>',OK:"Close",callback:function(e){if(!e){if(BrowseView.currentState=="player-view"){log.write("stopping player, and backing out to tile view");application.events.publish("back")}}}};if(j.Footer){j.Footer=j.Footer.replace("{m}",this.resolveMethodCode(d))}this.showMessage("message_error_default",j);return}if($("gridloadercontainer")){$("gridloadercontainer").hide()}this.errorCleanup();if(this.GridController){this.GridController.deinitSpinner()}if(r.restartApp){s=function(){$("SplashScreen").show();$("SplashProgress").hide();window.location.reload(false)};h="message_restart";j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:s};if(j.Footer){j.Footer=j.Footer.replace("{m}",this.resolveMethodCode(d))}this.showMessage(h,j);return}switch(r.args[0].type){case"while_purchase_bw_internet_out":k=application.resource.checkout_messages.purchase_error;h="message_error_purchase";q=r.args[0].params;w=q.titleid;p=$cn.data.TitleDetailCache[w];j={Message:k.Message.replace("##title##",p.name),Content:k.Content,OK:k.OK,Close:k.Cancel,Path:k,Footer:k.Footer.replace("{m}",v.resolveMethodCode(d)),callback:function(e){if(e){log.write("Going to Library.");$("WheelSeparator").hide();$("titledetailsmask").setStyle("visibility","hidden");BrowseView.goLibrary()}}};v.errorCleanup();v.showMessage(h,j);break;case"no_internet":case"timeout_error":case"socket_error":if(d=="sendStopMessageForStream"){r.args[0].callback.call(r.args[0].cb_context,{data:{result:" "}});return}log.write("ERROR: no_internet, timeout_error, or socket_error occurred: "+r.args[0].type);log.write("TEST INTERNET CONNECTION");application.testConnection(function(e){log.write("INTERNET CONNECTION RESULT ("+e.result+")");log.write("TimeoutMethod: "+d);log.write("the hail mary is set to: "+m.orderHailMary);if(d!="doPurchase"){log.write("store.handleError Debug: Not Purchase Method");if(!e.result){if(m.orderHailMary){webservices.killCurrentRequest();log.write("Mary hailed");k=application.resource.checkout_messages.purchase_error;m.orderHailMary=false;m.orderIsProcessing=false}else{if(m.orderIsProcessing){k=application.resource.checkout_messages.purchase_error;m.orderHailMary=false;m.orderIsProcessing=false}else{k=application.exception.resolveMessagePath(v.currentState)[r.args[0].type];log.write("store.handleError Debug: Default processing  of type "+r.args[0].type+" for no hail mary and no order, setting basic error message to "+k);$cn.utilities.clearLoadingSpinner()}}if(m.orderHailMary){h=(k.MessageType)?k.MessageType:"message_error_purchase"}else{h=(k.MessageType)?k.MessageType:"message_okcancel"}application.isConnected=false}if(m.orderHailMary){w=r.args[0].params.TitleID;p=$cn.data.TitleDetailCache[w];j={Message:k.Message.replace("##title##",p.name),Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(A){if(A){log.write("Going to Library.");$("WheelSeparator").hide();$("titledetailsmask").setStyle("visibility","hidden");BrowseView.goLibrary()}}}}else{if(d==="getActivationString"){j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(A){if(A){BrowseView.showActivate()}}}}else{j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(A){if(A){v.showMessage("message_loading",{Message:""});log.write("store.onHandleError Debug: Trying to call previous method...");webservices.makeAsyncRequest(r.args[0].endPoint,r.args[0].method,r.args[0].params,r.args[0].cb_context,function(B){if(v.MessagePopup){v.MessagePopup.hide()}log.write("store.onHandleError Debug: Internal response callback - invoking payload callback");r.args[0].callback.call(r.args[0].cb_context,B)},true,false)}}}}}log.write("=== restart app is: "+r.restartApp);log.write("=== data callaback is: "+j.callback);if(j.Footer){j.Footer=j.Footer.replace("{m}",v.resolveMethodCode(d))}v.showMessage(h,j)}else{log.write("Purchase Method. Now wait for an additional 30 seconds to see if the transaction completes.");setTimeout(function(){log.write("We now have waited an additional 30 seconds, try to see if we now have access to the movie.");log.write(log.dumpObj(r.args[0].params));m.orderHailMary=true;$cn.methods.lookupPurchaseDetailsForTitle(r.args[0].params.TitleID,function(A){var F,C,D,E,B;log.write(log.dumpObj(A));if(A.passID>0){log.write("PassID valid go to library.");r.args[0].params.passID=A.passID;r.args[0].params.titleID=r.args[0].params.TitleID;F=$cn.utilities.isHdTitle(v.currentTitle,r.args[0].params.SKUID);C=$cn.utilities.isSurroundSoundTitle(v.currentTitle,r.args[0].params.SKUID);if(BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}application.events.publish("purchasecomplete",{skuid:r.args[0].params.SKUID});application.state._viewstate["library-view"]=null;D="play";E="";B=$cn.utilities.getPurchaseSkuProduct(v.currentTitle,r.args[0].params.SKUID);if(B.purchaseType=="rent"){E="rent"+B.rentalPeriod}else{E=B.purchaseType+v.currentTitle.titleType}v.showConfirm(v.currentTitle,B.purchaseType,E,D,F,A,C);v.orderIsProcessing=false}else{log.write("PassID not valid throw purchase error.");k=application.resource.checkout_messages.purchase_error;h="message_error_purchase";q=r.args[0].params;w=q.titleid;p=$cn.data.TitleDetailCache[w];j={Message:k.Message.replace("##title##",p.name),Content:k.Content,OK:k.OK,Close:k.Cancel,Path:k,Footer:k.Footer.replace("{m}",v.resolveMethodCode(d)),callback:function(G){if(G){log.write("Going to Library.");$("WheelSeparator").hide();$("titledetailsmask").setStyle("visibility","hidden");BrowseView.goLibrary()}}.bind(this)};v.errorCleanup();v.showMessage(h,j)}})}.bind(this),(application.appSetting("WSRequestTry2Timeout")*1000))}});break;case"system_error":if(d=="doPurchase"){k=application.resource.checkout_messages.purchase_error;h="message_error_purchase";p=$cn.data.TitleDetailCache[r.args[0].params.TitleID];k.Message=k.Message.replace("##title##",p.name)}j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(e){if(e){v.showMessage("message_loading",{Message:""});log.write("Trying to call previous method...");webservices.makeAsyncRequest(r.args[0].endPoint,r.args[0].method,r.args[0].params,this,function(A){log.write("Response...");v.MessagePopup.hide();r.args[0].callback.call(r.args[0].cb_context,A)},true,false)}}};if(j.Footer){j.Footer=j.Footer.replace("{m}",this.resolveMethodCode(d))}this.showMessage(h,j);break;case"country_invalid":break;case"OnNetworkDisconnected":case"OnConnectionFailed":case"OnWideVineError_514":case"OnWideVineError_2004":j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(e){log.write("Error (Recoverable)..."+e);if(e){application.testConnection(function(A){log.write("INTERNET CONNECTION RESULT ("+A.result+")");if(A.result){var C=$cn.utilities.showLoadingModal(0,"Loading...");var B=setInterval(function(){this.tryAgainToPlayCount++;if(this.tryAgainToPlayCount>15){clearInterval(B);this.tryAgainToPlayCount=0;$cn.utilities.clearLoadingSpinner(C);application.events.publish("error",{type:"OnNetworkDisconnected",titleID:r.args[0].titleID,streamID:r.args[0].streamID,url:r.args[0].url,startTimeSeconds:r.args[0].startTimeSeconds,isHd:r.args[0].isHd,passID:r.args[0].passID})}else{if(!Player.initialized){clearInterval(B);this.tryAgainToPlayCount=0;$cn.utilities.clearLoadingSpinner(C);application.navigator.setFocus(BrowseView.PlayerControl.lastFocus,true);BrowseView.showPlayer(r.args[0].titleID,r.args[0].streamID,r.args[0].url,r.args[0].startTimeSeconds,r.args[0].isHd,r.args[0].passID)}}}.bind(this),2000)}else{application.events.publish("error",{type:"OnNetworkDisconnected",titleID:r.args[0].titleID,streamID:r.args[0].streamID,url:r.args[0].url,startTimeSeconds:r.args[0].startTimeSeconds,isHd:r.args[0].isHd,passID:r.args[0].passID})}})}else{application.events.publish("back")}}};this.showMessage(h,j);break;case"OnAuthenticationFailed":j={Message:k.Message,Content:k.Content,Footer:k.Footer,OK:k.OK,Close:k.Cancel,callback:function(e){log.write("Error (Recoverable)..."+e);if(e){application.navigator.setFocus(BrowseView.PlayerControl.lastFocus,true);BrowseView.showPlayer(r.args[0].titleID,r.args[0].streamID,r.args[0].url,r.args[0].startTimeSeconds,r.args[0].isHd,r.args[0].passID,r.args[0].availableClosedCaptions)}else{BrowseView.PlayerControl.hasError=false;BrowseView.PlayerControl._handleReturnKey()}}};this.showMessage(h,j);break;case"OnStreamNotFound":case"OnStreamNotFound_trailer":case"OnRenderError":case"OnWideVineError_513":case"OnWideVineError_515":case"OnWideVineError_516":case"OnWideVineError_517":case"OnWideVineError_520":case"OnWideVineError_521":case"OnWideVineError_522":case"OnWideVineError_523":case"OnWideVineError_524":case"OnWideVineError_525":case"OnWideVineError_550":case"OnWideVineError_570":j={Message:k.Message,Content:k.Content,Footer:k.Footer,Close:k.Cancel,callback:function(e){log.write("Error (Unrecoverable)...");application.events.publish("back")}};this.showMessage(h,j);break;case"show_play_error":f=r.args[0].state;l=(r.args[0].titleID)?r.args[0].titleID:"";k=application.resource[r.args[0].type][f];h="message_standard";j={Message:k.Message,OK:k.OK,callback:function(){if(f=="Not_Owned"){application.events.publish("loadtitleview",{id:l,noSaveState:true})}}};v.showMessage(h,j);break;case"connectiontooslow_error":if(BandwidthCheck.callbackType=="purchase"){k=application.resource.player_messages[(r.args[0].isHd)?"connectiontooslow_error_hd":"connectiontooslow_error_sd"]}else{if(BandwidthCheck.callbackType=="player"){k=application.resource.player_messages["connectiontooslow_error"]}}h="message_error_connectiontooslow";j={Message:k.Message,Content:k.Content,OK:k.OK,callback:function(e){var A;if(e){if(BandwidthCheck.callbackParams){log.write("Calling bandwidthcheck success callback.");A=BandwidthCheck.callbackParams;if(BandwidthCheck.callbackType=="purchase"){BrowseView.orderIsProcessing=false;BrowseView.goCheckOut(A.titleid,A.skuid,A.couponcode,A.pinValidated,A.bandwidthValidated)}else{if(BandwidthCheck.callbackType=="player"){BrowseView.PlayerControl._play(A.url,A.resume)}}}}else{if(BandwidthCheck.callbackType=="player"){BrowseView.PlayerControl.bandwidthError=true;log.write("stopping player, and backing out to tile view");application.events.publish("back")}}}};this.CurrentProcessLoaded=true;this.showMessage(h,j);break;case"connectiontooslow_error_player":k=application.resource.player_messages["connectiontooslow_error_player"];h="message_error_connectiontooslow_player";j={Message:k.Message,Content:k.Content,OK:k.OK,Cancel:k.Cancel,callback:function(e){var A=r.args[0];if(e){BrowseView.PlayerControl._resume()}else{log.write("stopping player, and backing out to tile view");application.events.publish("stop",{event:{keycode:70}})}}};this.CurrentProcessLoaded=true;this.showMessage(h,j,true);break;case"askabouthdswap_error":k=application.resource.player_messages["askabouthdswap_error"];h="message_error_askabouthd";j={Message:k.Message,Content:k.Content,Footer:k.Footer,TryAgain:k.TryAgain,OK:k.OK,Cancel:k.Cancel,callback:function(e){var A=r.args[0];switch(e){case"tryagain":BrowseView.PlayerControl._resume();break;case"ok":BrowseView.PlayerControl._handleHdSwap();break;case"cancel":application.events.publish("stop",{event:{keycode:70}});break}}};this.CurrentProcessLoaded=true;this.showMessage(h,j,true);break;default:break}}};function PlaybackBandwidthTest(j){var f,l=j.split("?"),k,g,h,e,d;switch(l[0]){case"SpeedUpdate":g=parseInt(l[1],10);if(g>=0){BrowseView.bwTempTotalSpeed+=g;BrowseView.bwTempCount+=1}log.write("PlaybackBandwidthTest: SpeedUpdate: checkSpeed "+g+"   avgspeed "+(BrowseView.bwTempTotalSpeed/BrowseView.bwTempCount));break;case"ProgressUpdate":BrowseView.bwPercentProgress=parseInt(l[1],10);if(BrowseView.bwPercentProgress%10==0){log.write("PlaybackBandwidthTest: ProgressUpdate: "+BrowseView.bwPercentProgress)}break;case"Complete":h=BrowseView.bwTempCount;e=BrowseView.bwTempTotalSpeed;BrowseView.bwPercentProgress=0;BrowseView.bwTempCount=0;BrowseView.bwTempTotalSpeed=0;if(1!==parseInt(l[1],10)){log.write("PlaybackBandwidthTest: Complete: Error! "+parseInt(l[1],10));if(BandwidthCheck.callbackParams){f=BandwidthCheck.callbackParams;if(BandwidthCheck.callbackType=="purchase"){application.events.publish("error",{type:"while_purchase_bw_internet_out",recoverable:false,method:"doPurchase",params:f})}else{if(BandwidthCheck.callbackType=="player"){}}}return}log.write("BW Test completed");k=new Date();g=parseInt(e/h,10);$cn.data.LastBandwidthCheck=k;$cn.data.LastBandwidthSpeed=g;log.write("Speedtest: "+g+" bytes per sec.");log.write("BandwidthCheck.lastRan: "+BandwidthCheck.lastRan);log.write("Recording connection speed (duration): "+$cn.utilities.DateDiff(k,BandwidthCheck.lastRan));$cn.methods.recordSessionConnectionSpeedTest($cn.utilities.DateDiff(k,BandwidthCheck.lastRan),function(){var m=BandwidthCheck.callbackParams;$cn.data.speedchecked=true;log.write("bw speeed: "+g+", mini bw speed: "+BandwidthCheck.successCondition);if(BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}if(g<BandwidthCheck.successCondition){if(BandwidthCheck.callbackType=="purchase"){d="doPurchase"}else{if(BandwidthCheck.callbackType=="player"){d="player";BrowseView.PlayerControl._clearAllBufferTimeouts()}}log.write("Connection Too Slow error Method: "+d);application.events.publish("error",{type:"connectiontooslow_error",method:d,params:m,isHd:(BandwidthCheck.successCondition==application.appSetting("HDMinimumBandwidth"))})}else{if(BandwidthCheck.callbackParams){log.write("Calling bandwidthcheck success callback.");if(BandwidthCheck.callbackType=="purchase"){BrowseView.orderIsProcessing=false;BrowseView.goCheckOut(m.titleid,m.skuid,m.couponcode,m.pinValidated,m.bandwidthValidated)}else{if(BandwidthCheck.callbackType=="player"){BrowseView.PlayerControl._play(m.url,m.resume)}}}}});break}}var DockControlObjects={id:"dock",persist:{},controls:{},buttons:[],layoutIsDirty:true,hasFocus:false,tpl:null,selection:null,initialize:function(){this.tpl=new ui.template("dockcontainer",application.ui.loadTpl(this.id+".tpl"));this.tpl.compile();this.draw();application.events.subscribe(application,"viewchanged",this.onViewChanged.bind(this));application.events.subscribe(this,"elementfocus",this.onFocusChanged.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"navigate",this.onNavigate.bind(this))},init:function(d){log.write("dockcontrol.init()");if(d){this.persist=d}},draw:function(){var e="PARENTAL CONTROLS";var f=false;this.tpl.append({SignInString:e});this.tpl.apply();if(f){$("btnAccount").removeClass("double-line")}else{$("btnAccount").addClass("double-line")}if(configuration.readValue("BackButtonStyle")){var d=$("dock-back");d.removeClass("btnBack");d.addClass("btnBack"+configuration.readValue("BackButtonStyle"))}},onNavigate:function(e){if(application.debugMode===true){application.debugMode=false;application.doNotRestoreSettings=true}if($("dock-back").hasClass("disableBack")){$("dock-home").setAttribute("up","dock-exit");$("dock-exit").setAttribute("down","dock-home")}else{$("dock-home").setAttribute("up","dock-back");$("dock-exit").setAttribute("down","dock-back")}if(e.args[0].direction=="left"&&application.element.current=="dock-back"){log.write("left pressed on dock back")}if(BrowseView.currentState=="titleview"){if(application.element.current.indexOf("dock-")==0||application.element.current.indexOf("btnAccount")==0){if(e.args[0].direction=="right"){var d=document.getElementById("ButtonPanel").getElementsByTagName("a");if(d.length>0){e.preventDefault();BrowseView.TitleViewControl.setFocus()}}}}},onFocusChanged:function(d){log.write("dock.onFocusChanged");if(document.getElementById(d.args[0].focusedelem)){if($(this.id).isParentOf($(d.args[0].focusedelem))){if(!this.hasFocus){this.hasFocus=true}}else{this.hasFocus=false}}},onViewChanged:function(f){var e=document.getElementById("dockcontainer").getElementsByTagName("a"),d;for(d=0;d<e.length;d++){$(e[d].id).removeClass("selected");this.selection=null}switch(f.args[0]){case"browse-view":this.selection="dock-home";break;case"search-view":this.selection="dock-search";break;case"wishlist-view":this.selection="dock-wishlist";break;case"library-view":this.selection="dock-library";break;case"settings-view":this.selection="dock-settings";break;case"help-view":this.selection="dock-help";break}if(this.selection!=null){$(this.selection).addClass("selected")}},onSaveState:function(e){var d=e.args[0];d[this.id]={selection:this.selection,hasFocus:this.hasFocus}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id])},dockbackPointerFocus:function(){if(!$("dock-back").hasClass("disableBack")){pointer.lastFocusId="dock-back";application.navigator.setFocus("dock-back")}else{application.navigator.setFocus(null)}}};var DockControl=new Class(DockControlObjects);var ItemAnimationMap=["tertiary","secondary","primary","secondary","tertiary"];var Wheel=new Class({source:[],container:null,itemHeight:0,padding:0,selection:0,topPosition:0,wheelChangedTimeout:1000,initialize:function(e,d){this.id=e;this.container=d;application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this))},clean:function(){var d=$(this.container);if(d){if(d.getChildren().length>0){d.getChildren().destroy()}}this.selection=0},indexOf:function(d){var e=this.selection+(d-2);if(e<0){e=(this.source.length<5?-1:e+this.source.length)}else{if(e>=this.source.length){e=(this.source.length<5?-1:e-this.source.length)}}return e},measureElement:function(j){var g=j.getElements("td"),f=null,d=0;if(g&&g.length&&g[0]&&g[0].firstChild){f=g[0].firstChild}if(f){var e=document.createRange();e.selectNodeContents(f);if(e.getBoundingClientRect){var h=e.getBoundingClientRect();if(h){d=h.bottom-h.top}}}return{y:d}},move:function(n){var l=false;var j=this.indexOf(2+n);if(j!=-1){if(n<0){var e=this.indexOf(-1);if(e!=-1){this.renderItem(e,-1)}}else{var h=this.indexOf(5);if(h!=-1){this.renderItem(h,5)}}var q=this;var k=$(this.container).getChildren();this.selection=j;this.topPosition-=n;var f={};var g=application.loadAnimation("wheel");for(m=0;m<k.length;m++){var p=k[m];p.slot=this.topPosition+m;p.idx=this.indexOf(p.slot);var d=(p.slot<0||p.slot>=ItemAnimationMap.length)?ItemAnimationMap[0]:ItemAnimationMap[p.slot];f[m]=$extend({},g.properties[d]);f[m].top=p.slot*this.itemHeight+(this.padding/2);if(p.slot==2){p.addClass("hover");f[m].color=f[m].focus}else{p.removeClass("hover")}}if(g){var r=$extend({},g.options);if(device.getDeviceSoc()!="BCOM"){if(((1000/r.fps)*2)>=r.duration){r.duration=100;r.fps=1000/r.duration}r.onComplete=function(u){for(var s=0;s<k.length;++s){this.onComplete(k[s])}}.bind(this);new Fx.Elements(k,r).start(f);l=true}else{for(var m=0;m<k.length;++m){k[m].setStyles(f[m]);this.onComplete(k[m])}}}}return l},onComplete:function(f){var d=this;if(f.slot<0||f.slot>4){if(f.slot==this.topPosition){f.destroy();this.topPosition=$(this.container).getFirst().slot}else{f.destroy()}}else{if(f.slot==2&&f.idx==this.selection){if(this.onWheelChanged){var e=this.source[this.selection].iD;this.lastKey=this.source[this.selection].iD;setTimeout(function(){if(e==d.lastKey){log.write("onWheelchanged");log.write("key: "+e+", lastKey: "+d.lastKey);d.onWheelChanged({sourceid:d.container,source:d.source,selectedidx:d.selection,selectedvalue:d.source[d.selection].iD})}},d.wheelChangedTimeout)}}}},render:function(e,d){this.clean();this.source=e;this.selection=(d?d:0);this.itemHeight=($cn.utilities.measure($(this.container)).y-this.padding)/5;this.topPosition=2;for(var f=0;f<5;++f){d=this.indexOf(f);if(d!=-1){this.renderItem(d,f)}}if(application.element.current==="selectedslave"){navigation.setFocusElement($("selectedslave"),true)}},renderItem:function(p,n){var f=$(this.container),h=new Element("div",{"class":"wheelitem"}),q=Math.floor(this.itemHeight*n+(this.padding/2)),d,m,r,g,s,j,k,l,e;h.set("genreid",this.source[p].iD);h.setStyle("visibility","hidden");h.slot=n;l=$cn.config.CenterWheel?"align='center'":"";if(n<this.topPosition){this.topPosition=n}if(n<0){q=f.getFirst().style.top.toInt()-this.itemHeight;h.inject(f,"top")}else{if(f.getLast()){q=f.getLast().style.top.toInt()+this.itemHeight}h.inject($(this.container))}d=this.source[p];if(d.name){j=d.name;if(typeof($cn.config.CustomTextCasing)=="function"){j=$cn.config.CustomTextCasing(j)}m="<table class='item-holder'><tr><td "+l+">"+j+"</td></tr></table>";application.putInnerHTML(h,m);s=this.measureElement(h).y;if(s>this.itemHeight){j=this.truncateText(h,j,this.itemHeight,0,j.length,l).trim();if(j.endsWith("-")){j=j.substring(0,j.length-1)}m="<table class='item-holder'><tr><td "+l+">"+j+"</td></tr></table>";application.putInnerHTML(h,m)}}k=application.loadAnimation("wheel");e=(n<0||n>=ItemAnimationMap.length)?ItemAnimationMap[0]:ItemAnimationMap[n];new Fx.Morph(h,k.options).set(k.properties[e]);h.setStyle("top",q+"px");h.setStyle("visibility","visible");if(n==2){h.addClass("hover")}},truncateText:function(h,j,d,l,g,e){if(l<g-1){var k=Math.round((l+g)/2);var f="<table class='item-holder'><tr><td "+e+">"+$cn.utilities.ellipsis(j,k)+"</td></tr></table>";application.putInnerHTML(h,f);if(this.measureElement(h).y<=d){return this.truncateText(h,j,d,k,g,e)}else{return this.truncateText(h,j,d,l,k,e)}}else{return $cn.utilities.ellipsis(j,l)}},onSaveState:function(e){var d=e.args[0];d[this.id]={source:this.source,selection:this.selection,topPosition:this.topPosition}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id])}});var ActiveWheel=null;var WheelControl=new Class({id:"WheelControl",type:"wheel",persist:{},controls:{},history:[],layoutIsDirty:true,isNavigating:false,singleWheel:false,_masterWheel:null,_slaveWheel:null,_masterSource:[],_slaveSource:[],wheelChangedTimeout:1000,masterSourceElement:"masterdatasource",masterSelectedElement:"selectedmaster",itemHeight:0,initialize:function(e){log.write("Initializing: "+this.id);var d=this;if(e){this.persist=e}application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"pointerdeactivated",this.onPointerdeactivated.bind(this))},activate:function(){if(ActiveWheel!==this){if(ActiveWheel){application.events.unsubscribe(ActiveWheel,"wheelitemchanged");application.events.unsubscribe(ActiveWheel,"wheelrendered");application.events.unsubscribe(ActiveWheel,"navigate")}application.events.subscribe(this,"wheelitemchanged",this.handleWheelItemChange.bind(this));application.events.subscribe(this,"wheelrendered",this.wheelRendered.bind(this));application.events.subscribe(this,"navigate",this.navigate.bind(this));ActiveWheel=this}},cleanUI:function(){if($(this.masterSelectedElement)){$(this.masterSelectedElement).label=""}if($("selectedslave")){$("selectedslave").label=""}if($(this.masterSourceElement)){if($(this.masterSourceElement).getChildren().length>0){$(this.masterSourceElement).getChildren().destroy()}}if($("slavedatasource")){if($("slavedatasource").getChildren().length>0){$("slavedatasource").getChildren().destroy()}}},loadData:function(f,d,e){this.cleanUI();this._masterSource=f;this._slaveSource=d;if(f.length>0){this._renderWheel($(this.masterSourceElement),this._masterSource,e)}},wheelRendered:function(e){if(e.context===ActiveWheel){var d=e.args[0];if(d.source.indexOf("master")>-1){$("slavedatasource").getElements("div").destroy();e.context._renderWheel($("slavedatasource"),e.context._slaveSource[d.selectedvalue]);application.events.publish("wheelitemchanged",{wheelinstance:d.wheelinstance,sourceid:d.sourceid,source:d.source,selectedidx:d.selectedidx,selectedvalue:(e.context._slaveSource[d.selectedvalue])?e.context._slaveSource[d.selectedvalue][0].iD:d.selectedvalue})}}},handleWheelItemChange:function(k){log.write("context id: "+k.context.id);log.write("active id: "+ActiveWheel.id);if(k.context===ActiveWheel){log.write("Generic Wheel Item changed. id: "+k.args[0].wheelinstance);var g=this,j=k.args[0],f,e=j.source[j.selectedidx].parentID,d=j.selectedvalue,h=0;this.lastValue=d;if(j.sourceid.indexOf("slave")>-1){f=j.source.length;while(f--){if(j.source[f].iD==d){this.lastSlaveValue=j.source[f].name}}}if(j.sourceid.indexOf("master")>-1){e=j.selectedvalue;if(this.lastSlaveValue){f=k.context._slaveSource[e].length;while(f--){if(k.context._slaveSource[e][f].name==this.lastSlaveValue){d=k.context._slaveSource[e][f].iD;h=f}}}if(h===0){this.lastSlaveValue=false;d=k.context._slaveSource[e][0].iD}$("slavedatasource").getElements("div").destroy();k.context._renderWheel($("slavedatasource"),k.context._slaveSource[j.selectedvalue],h)}BrowseView.CurrentWheelValue=e+":"+d;if(g.lastValue&&(g.lastValue==e||g.lastValue==d)){application.events.publish("wheelvaluechanged",{wheelinstance:g.id,mastervalue:e,slavevalue:d})}}},onWheelChanged:function(d){this.isNavigating=false;log.write("onWheelChanged::called()");d.wheelinstance=this.id;application.events.publish("wheelitemchanged",d)},_morph:function(e,f,d,g){if(!g){g=function(){}}if(e.morphInstance){e.morphInstance.cancel()}e.morphInstance=new Fx.Morph(e,{duration:f,transition:Fx.Transitions.Sine.easeOut,onComplete:g}).start(d)},saveHistory:function(){var d=$(this.type);var e=$extend(this,{});this.history.push({instance:e,dom:d})},loadPrevious:function(){log.write("function: "+this.id+".previousView()");var d=this.history.pop()},_renderWheel:function(d,g,f){if(g&&g.length>0){var e=this;if(f==null){f=0}if(d.id==this.masterSourceElement){if(!this._masterWheel){this._masterWheel=new Wheel(this.id+"_master",this.masterSourceElement);this._masterWheel.wheelChangedTimeout=this.wheelChangedTimeout;this._masterWheel.onWheelChanged=function(h){e.onWheelChanged(h)}}log.write("rendering wheel");this._masterWheel.render(g,f);application.events.publish("wheelrendered",{wheelinstance:e.id,sourceid:e.id,source:"masterdatasource",selectedidx:f,selectedvalue:g[f].iD});return}else{if(d.id=="slavedatasource"){if(!this._slaveWheel){this._slaveWheel=new Wheel(this.id+"_slave","slavedatasource");this._slaveWheel.wheelChangedTimeout=this.wheelChangedTimeout;this._slaveWheel.onWheelChanged=function(h){e.onWheelChanged(h)}}this._slaveWheel.render(g,f);application.events.publish("wheelrendered",{sourceid:e.id,source:"slavedatasource",selectedidx:f,selectedvalue:g[f].iD});return}}}},navigate:function(g){log.write("navigate wheel");var h=(this.singleWheel)?"singleselectedmaster":"selectedmaster";if(g.context===ActiveWheel){if(application.element.current==h||application.element.current=="selectedslave"){if(g.args[0].direction=="up"||g.args[0].direction=="down"){g.preventDefault();if(this.lastNavigate){log.write(this.lastNavigate+", "+$cn.utilities.DateDiff(new Date(),this.lastNavigate))}if(!this.lastNavigate||(this.lastNavigate&&$cn.utilities.DateDiff(new Date(),this.lastNavigate)>500)){if(this._masterWheel){this.lastNavigate=new Date();var f=g.args[0].direction=="up"?-1:1;var d=application.element.current==h?this._masterWheel:this._slaveWheel;this.isNavigating=d.move(f);return}}else{log.write("Clicking too fast, ignore wheel change.");return}}else{if(g.args[0].direction=="right"&&$("titlegrid").style.display=="block"){if(application.element.current=="selectedslave"||(this.singleWheel)){if(this.isNavigating||!BrowseView.CurrentProcessLoaded){g.preventDefault()}else{var e=$("titlegrid").getElementsByTagName("a");if(e.length>0){g.preventDefault();application.navigator.setFocus(e[0].id)}}}else{if(application.element.current=="selectedmaster"&&(this.isNavigating)){g.preventDefault()}}}else{if(g.args[0].direction=="left"){if(application.element.current=="selectedmaster"||(this.singleWheel)){switch(BrowseView.currentState){case"browse-view":g.preventDefault();navigation.setFocus("dock-home");break;case"search-view":g.preventDefault();navigation.setFocus("dock-search");break;case"wishlist-view":g.preventDefault();navigation.setFocus("dock-wishlist");break;case"library-view":g.preventDefault();navigation.setFocus("dock-library");break;case"settings-view":g.preventDefault();navigation.setFocus("dock-settings");break;case"help-view":g.preventDefault();navigation.setFocus("dock-help");break}}}}}}}},render:function(){},split:function(f){var d="",e=f.split(" "),g="";e.each(function(h){if(h.length>0){if(h.length>12){if(h.indexOf("-")>-1){log.write(h);g=h.split("-");g.each(function(j){if(j.stripHTML().length>12){d=d+j.stripHTML().substring(0,11)+"<br />";d=d+j.stripHTML().substring(11,h.stripHTML().length)+"<br />"}else{d=d+j+"<br />"}})}else{if(h.stripHTML().length>12){d=d+h.substring(0,11)+"<br />";d=d+h.substring(11,h.length)+"<br />"}else{d=d+h}}}else{d=d+h+"<br />"}}});if(d.endsWith("-<br />")){d=d.substring(0,d.lastIndexOf("-<br />"))+"<br />"}return d},onSaveState:function(e){var d=e.args[0];d[this.id]={_masterSource:this._masterSource,_slaveSource:this._slaveSource};if(this===ActiveWheel){d.ActiveWheel=this}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id]);if(d.ActiveWheel===this){this.activate()}},onPointerdeactivated:function(){if(pointer.lastFocusId=="selectedmaster"){this.hideWheelMask("masterwheelmaskup");this.hideWheelMask("masterwheelmaskdown")}else{if(pointer.lastFocusId=="selectedslave"){this.hideWheelMask("slavewheelmaskup");this.hideWheelMask("slavewheelmaskdown")}else{if(pointer.lastFocusId=="singleselectedmaster"){this.hideWheelMask("singlewheelmaskup");this.hideWheelMask("singlewheelmaskdown")}}}},setWheelPointerFocus:function(e,f,d){$(e).setStyle("opacity",d);navigation.setFocusElement($(f));pointer.lastFocusId=f},setWheelPointerLoseFocus:function(e,d){this.hideWheelMask(e);pointer.lastFocusId=d},clickWheelAction:function(f,d,g,e){application.element.current=g;$(f).setStyle("opacity",e);application.events.publish("navigate",{direction:d,current:g});navigation.setFocusElement($(g));pointer.lastFocusId=g},hideWheelMask:function(d){$(d).setStyle("opacity","0.0");$(d).setStyle("visibility","visible")}});var TitleViewControlProperties={id:"titleviewcontrol",persist:{},controls:{},tv:false,episode:false,season:false,tvshow:false,isLibrary:false,showingRating:false,layoutIsDirty:true,noBundleError:false,tpl:null,initialize:function(){application.events.subscribe(this,"elementfocus",this.updateSeparator);application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"wishlistinsert",this.onWishlistInsert.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"updatewishlistbutton",this.onWishlistError.bind(this))},updateSeparator:function(e){if(document.getElementById(e.args[0].focusedelem)&&(BrowseView.currentState=="titleview_wheel"||BrowseView.currentState=="titleview_tvepisodes")){var d=$("titledetailscontainer").getElement(".buttonpanel");if(d&&$(e.args[0].focusedelem).getParent().hasClass("buttonpanel")){BrowseView.expandTitleDetails();BrowseView.TitleViewControl.enableButtons()}}},init:function(e,d){log.write("titleviewcontrol.init()");if(e){this.persist=e}},cleanUI:function(){if($("titledetailscontainer")){if($("titledetailscontainer").getChildren().length>0){$("titledetailscontainer").getChildren().destroy()}}},loadData:function(e){var d;this.persist.title=e;this.showingRating=false;this.tv=e.titleType.substring(3,0)=="TV_";this.season=e.titleType=="TV_Season";this.episode=e.titleType=="TV_Episode";this.tvshow=e.titleType=="TV_Show";this.audioProfiles=$cn.utilities.getAudioProfileForTitle(e.titleID);d=this.tvshow?"titleview.tvtitle":"titleview.title";this.tpl=new ui.template("titledetailscontainer",application.ui.loadTpl(d));this.tpl.compile();this.draw()},drawMeta:function(d,e){log.write("Getting meta for: "+d);if(!e){var f=$cn.utilities.getMeta(d,this.persist.title.metaValues);if(d=="Flixster Users"||d=="CriticsReview"){f=f.replace(" liked it","").replace(" liked it.","")}return f}else{f=$cn.utilities.getMeta(d,this.persist.title.metaValues)}return $cn.utilities.formatDate(f,e)},show3rdPartyData:function(){var d="";if(this.showMetaField("CriticsReview")=="_hidden"&&this.showMetaField("Flixster Users")=="_hidden"){d="_hidden"}return d},thirdPartyReviewsEnabled:function(){var d="";if(!$cn.data.flixsterEnable){d="_hidden"}return d},getAudioCssClass:function(){var d=this.audioProfiles.Dolby_Digital_Plus_51;if(!d){d=this.audioProfiles.Dolby_Digital_Plus_Stereo;if(!d){d=this.audioProfiles.DTS_Express_51;if(!d){d=this.audioProfiles.DTS_Express_Stereo}}}if(!d){return"_hidden"}else{return""}},getSurroundAudioCssClass:function(){var d=this.audioProfiles.Dolby_Digital_Plus_51;if(!d){d=this.audioProfiles.DTS_Express_51}if(!d||(this.displaySurroundSoundBadge()=="hideextra")){return"_hidden"}else{return""}},getAudioIconCssClass:function(e){var d=this.audioProfiles[e];var f="_hidden";if(d&&!this.isLibrary){f=""}else{if(d&&this.isLibrary&&!this.audioProfiles.HDOnly){f=""}else{if(d&&this.isLibrary&&this.audioProfiles.HDOnly&&$cn.utilities.getMeta("HD",this.persist.title.metaValues)=="True"){f=""}}}return f},showAudioMetaField:function(e){var d=this.audioProfiles[e];if("HDOnly"==e&&d){return""}var f="_hidden";if(d&&!this.isLibrary){f=""}else{if(d&&this.isLibrary&&!this.audioProfiles.HDOnly){f=""}else{if(d&&this.isLibrary&&this.audioProfiles.HDOnly&&$cn.utilities.getMeta("HD",this.persist.title.metaValues)=="True"){f=""}}}return f},showAudioTechnicalField:function(d,e){var f="_hidden";if(d=="Standard Definition"&&this.getAudioCssClass()!="_hidden"&&!this.audioProfiles.HDOnly&&this.audioProfiles[e]){f=""}else{if(d=="High Definition"&&this.getAudioCssClass()!="_hidden"&&this.audioProfiles[e]){f=""}}return f},showUVTechnicalDetails:function(d){if(d=="UltraViolet"){return(this.isLibrary?application.resource.uv_messages.technical_details.uv_library_view:application.resource.uv_messages.technical_details.uv_store_view)}},showMetaField:function(e){var d=$cn.utilities.getMeta(e,this.persist.title.metaValues);if(d.length==0){return"_hidden"}return""},showReviewMetaFields:function(){var f="",e="",d="";f=$cn.utilities.getMeta("Flixster Users",this.persist.title.metaValues);e=$cn.utilities.getMeta("CriticsReview",this.persist.title.metaValues);if(f.length==0&&e.length==0){d="hidden"}return d},drawTomatoFactor:function(g){var f="splaticon";g=$cn.utilities.getMeta(g,this.persist.title.metaValues);if(g&&g.length>0){try{var d=g.split("%");if(parseInt(d[0].trim())>=60){f="freshicon"}}catch(h){}}return f},getDirectorCssClass:function(){return(this.persist.title.directors.length==0)?"_hidden":""},getCastCssClass:function(){return(this.persist.title.actors.length==0)?"_hidden":""},drawStarRating:function(e){log.write("Drawing rating for: "+e);for(var d=1;d<=5;d++){$("TitleStar"+d).erase("class");if(e>=d){$("TitleStar"+d).addClass("fullstar")}else{if(e<d&&e>(d-1)){$("TitleStar"+d).addClass("halfstar")}}}},getTrailer:function(){var d="";this.hasTrailer=false;this.persist.title.bonusAssets.each(function(e){if(e.bonusType=="Trailer"){d=e.bonusAssetID;this.hasTrailer=true}}.bind(this));return d},getPurchaseButtonText:function(){return $cn.utilities.purchaseText(this.persist.title)},getActors:function(){return $cn.utilities.ellipsis(this.persist.title.actors,application.resource.titleview_strings.Starring_Concat_Length)},getUserRatingFloat:function(d){var g=0;try{if(!d){g=parseFloat($cn.utilities.getMeta("YourRating",this.persist.title.metaValues))}else{g=parseFloat(d)}}catch(f){g=0}return g},setUserRating:function(d){$cn.utilities.setMeta("YourRating",d,this.persist.title.metaValues)},getUserRating:function(d){var e=this.getUserRatingFloat(d);return(e>0)?"block":"none"},getRateButtonText:function(){var e=parseFloat($cn.utilities.getMeta("YourRating",this.persist.title.metaValues));var d="Rate it";if(e>0){d="Change Rating"}return d},getEpisodeShowTitle:function(){return(this.persist.title.show?this.persist.title.show:"")},getEpisodeShowSeason:function(){return(this.persist.title.season?this.persist.title.season:"")},displayBonusAsset:function(d){var e="hideextra";this.persist.title.bonusAssets.each(function(f){if(f.bonusType==d){e="showextra"}});log.write("BonusAsset: "+e);return e},displayAvailability:function(e){var d=e!=null?e:false;if(this.persist&&this.persist.title.watchStatus&&this.persist.title.watchStatus!=WatchStatus.WatchNow&&this.persist.title.watchStatus!=WatchStatus.ExpiredRental){d=!d}return d?"showextra":"hideextra"},displayExtra:function(e,g){var d,f;if(e==="HasUV"&&!$cn.config.EnableUV){return"hideextra"}if(this.persist.title.isPassUV&&e==="HasUV"){d=this.persist.title.isPassUV}else{d=$cn.utilities.getMeta(e,this.persist.title.metaValues)}f="hideextra";if(((d=="True"||(d!="False"&&d!=""))&&!g)||(d=="False"&&g)){f="showextra"}return f},displayCCbadge:function(){var d="hideextra";b=$cn.utilities.getMeta("HasClosedCaption",this.persist.title.metaValues);if(b=="True"){d="showextra"}return d},displaySurroundSoundBadge:function(){var d=this.audioProfiles.Dolby_Digital_Plus_51,e="hideextra";if(d&&!this.isLibrary){e="showextra"}else{if(d&&this.isLibrary&&!this.audioProfiles.HDOnly){e="showextra"}else{if(d&&this.isLibrary&&this.audioProfiles.HDOnly&&$cn.utilities.getMeta("HD",this.persist.title.metaValues)=="True"){e="showextra"}}}return e},displayMoreInfo:function(){var e=0,d;for(d=0;d<this.persist.title.wheelItems.length;d++){if((this.persist.title.wheelItems[d]=="m_credits"||this.persist.title.wheelItems[d]=="m_cast_bios"||this.persist.title.wheelItems[d]=="m_cast_crew")&&$cn.data.baselineEnable){e++}if((this.persist.title.wheelItems[d]=="r_critics"||this.persist.title.wheelItems[d]=="r_user_revs"||this.persist.title.wheelItems[d]=="m_technical_details"&&configuration.readValue("EnableTechnicalDetailsWheelOption"))&&$cn.data.flixsterEnable){e++}}return(e>0)?"showextra":"hideextra"},displayExtraIfPresent:function(e){var d=$cn.utilities.getMeta(e,this.persist.title.metaValues);var f="hideextra";if(d&&d!=""&&d.length>0){f="showextra"}return f},drawDurationString:function(){var f="",e=this.drawMeta("AirDate",$cn.config.DateFormat?$cn.config.DateFormat:"longDate"),d=$cn.utilities.getMeta("RunTime",this.persist.title.metaValues);if(/^-|^0+\s/.test(d)){d="";log.write("runTime was either 0 or negative and has been removed.")}if(this.episode){if(e&&e.length>0){f=this.formatReviewDate(e)}}else{if(this.persist.title.releaseYear&&this.persist.title.releaseYear.length>0){f=this.persist.title.releaseYear}}if(!this.season&&!this.tvshow){if(d&&d.length>0){if(f&&f.length>0){f=f+application.resource.titleview_strings.Duration_Concat}else{f=""}f=f+d}}if(!f||f.length==0){if(document.getElementById("titlemeta_duration")){$("titlemeta_duration").hide()}}return f},storeLogo:function(){if(this.persist.title&&this.persist.title.storeLogoUrl){log.write("STORE URL: <img src='"+this.persist.title.storeLogoUrl+"' id='storeLogo' alt='' />");return"<img src='"+this.persist.title.storeLogoUrl+"' id='storeLogo' alt='' style='vertical-align:middle;margin-left:5px;'  />"}else{log.write("STORE URL: NOTHING");return""}},getRentalStatus:function(){var d="";if(this.persist.title.watchStatus=="ExpiredRental"){d=this.persist.title.expirationMessage}else{if(this.persist.title.expirationMessage&&this.persist.title.expirationMessage!=""){d="("+this.persist.title.expirationMessage+") "}}return d},formatReviewDate:function(n){var m="",g=null,f="",l="",j="",h=new Array("January","February","March","April","May","June","July","August","September","October","November","December");try{g=Date.parse(n);if(!isNaN(g.getDate())){f=g.getDate();l=g.getMonth();j=g.getFullYear();m=h[l]+" "+f+", "+j}}catch(k){alert(k);m=""}return m},reviewIcon:function(d){return(d&&d!="")?d:""},getVisibleElements:function(e){var d=[];if(e){var f=e.getChildren();for(var g=0;g<f.length;g++){if(f[g].getStyle("display")=="block"){d.push(f[g])}}}return d},draw:function(){var j;this.cleanUI();log.write(this.persist.title);$("ruler").setStyles({"font-weight":"bold","font-size":"17px"});if(this.persist.title.passID){BrowseView.setLibrary(true);this.isLibrary=true}this.persist.title.name=this.persist.title.name.ellipsToPixels(460);this.tpl.append(this.persist.title);this.tpl.apply();var k=this.persist.title.watchStatus!=null&&this.persist.title.watchStatus!=WatchStatus.WatchNow&&this.persist.title.watchStatus!=WatchStatus.ExpiredRental;log.write("$cn.data.flixsterEnable: "+$cn.data.flixsterEnable);if($cn.data.flixsterEnable){if(this.displayExtraIfPresent("CriticsReview")=="showextra"&&this.displayExtraIfPresent("Flixster Users")=="showextra"&&$("reviewcontainer")){$("reviewcontainer").addClass("bothreviewssvisible")}}if(!this.tvshow){var p="buttonpanel.title";if(this.persist.title.passID){if(this.season){p="buttonpanel.library.alternate"}else{if(k){p="buttonpanel.library.alternate"}else{p="buttonpanel.library"}}}j=new ui.template("ButtonPanel",application.ui.loadTpl(p));j.compile();j.append(this.persist.title);j.apply();if(k){$("ButtonPanel").addClass("unavailabletitle")}}if(this.tv){if(!this.persist.title.seasonal){application.putInnerHTML($("tdbuttonEpisodes"),application.resource.episodes)}if(!this.noBundleError&&!k){$("tdbuttonEpisodes").removeClass("hideextra")}else{this.noBundleError=false}$("titlemeta_criticsreview").addClass("hideextra");$("titlemeta_flixsterusers").addClass("hideextra");if(!this.tvshow){if($("reviewcontainer")){$("reviewcontainer").addClass("hideextra")}$("tdbuttonRating").hide();$("ratingstar").hide()}if(this.season){if(document.getElementById("duration")){$("duration").hide()}}$$(".tv").show();$$(".movie").hide();if(!this.episode){if($("tdbuttonWatchTrailer")){$("tdbuttonWatchTrailer").addClass("hideextra")}if($("tdbuttonCheckout")){$("tdbuttonCheckout").addClass("hideextra")}$$("#mainstage .episode").hide()}if(this.season||this.episode){$("titlemeta_rating").hide()}}if(this.persist.title.passID){BrowseView.setLibrary(true);this.isLibrary=true;$("purchaseinfostringdetails").hide();if(this.persist.title.passID>0){$("titlepurchasedstring").removeClass("hidden")}if(this.persist.title.watchStatus=="ExpiredRental"){$("tdbuttonExpired").removeClass("hideextra");$("tdbuttonPlay").hide()}if((this.persist.title.streamStartTimeSeconds>$cn.config.EarliestResumeS-$cn.config.RewindUponResumeS)&&this.persist.title.watchStatus==WatchStatus.WatchNow){$("tdbuttonResumePlay").removeClass("hideextra")}if(this.episode&&this.persist.title.nextEpisodeID){$("ButtonPanel").addClass("nextepisode")}log.write("Current Pass: "+this.persist.title.passID);if(!$cn.data.PassCache[this.persist.title.passID]){log.write("Adding pass to pass cache");$cn.data.PassCache[this.persist.title.passID]=this.persist.title}}if(this.hasSimiliar()&&!k){$("tdbuttonSimilar").show()}else{$("tdbuttonSimilar").hide()}if(this.persist.title.availableProducts.length==0&&$("tdbuttonCheckout")){$("tdbuttonCheckout").hide()}this.drawStarRating(parseFloat($cn.utilities.getMeta("YourRating",this.persist.title.metaValues)));application.currentView.layoutIsDirty=true;log.write("Detail Image:");$("titledetailsboxartwrap").show();var h=document.getElementById("TitleBoxArt");if(h&&!h.onerror){h.onerror=function(q){$("titledetailsboxartwrap").hide()}}var m=this.displaySurroundSoundBadge();log.write("showSurroundSound: "+m);if(m=="hideextra"){$("fiveonebadge").hide()}var l=$("ButtonPanel"),e=l.getElements(".half"),d=this.getVisibleElements(e[0]),n=this.getVisibleElements(e[1]),g,f;if(n.length>d.length){g=n.length-d.length;for(f=0;f<g;++f){e[1].removeChild(n[f]);e[0].getParent().insertBefore(n[f],e[0])}}else{if(d.length>n.length){g=d.length-n.length;for(f=0;f<g;++f){e[0].removeChild(d[f]);e[0].getParent().insertBefore(d[f],e[0])}}}},shouldShowRentalWarning:function(){var e=false,f=false,d;for(d=0;d<this.persist.title.availableProducts.length;d++){if(this.persist.title.availableProducts[d].purchaseType=="rent"){e=true;break}}if(e){if($cn.utilities.getMeta("LicensesDelivered",this.persist.title.metaValues)=="0"){f=true}}return f},getRentalPeriod:function(){var e="24",d;for(d=0;d<this.persist.title.availableProducts.length;d++){if(this.persist.title.availableProducts[d].purchaseType=="rent"){log.write("Found rental period: "+this.persist.title.availableProducts[d].rentalPeriod);e=this.persist.title.availableProducts[d].rentalPeriod;break}}return e},update:function(e){var d=this;this.showingRating=false;log.write(".... payload.leaveFocusAlone ..... is: "+e.leaveFocusAlone);if(BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}if(e&&e.passID){if(this.persist.title){this.persist.title.passID=e.passID}}log.write("TitleView.update(User Rating: "+this.getUserRatingFloat()+", payload.stopPositionMins: "+e.stopPositionMins+", payload.stopPositionPercent: "+e.stopPositionPercent+")");if(document.getElementById("titledetails").style.display=="block"||e.forceUpdate){if(this.persist.title&&this.persist.title.passID){$cn.methods.getPurchasedTitle(this.persist.title.passID,this.persist.title.titleID,function(f){if(e.setFocus){BrowseView.loadTitle(f,"nextEpisode");if($("tdbuttonNextEpisode").getStyle("display")!=="block"){log.write("Next Episode Button is Hidden, Dont set focus");d.setFocus()}else{log.write("Calling next Episode focus: "+e.setFocus);application.navigator.setFocus(e.setFocus,true);application.element.current=e.setFocus}}else{if(!e.leaveFocusAlone){BrowseView.loadTitle(f);log.write("..... resetting focus .....");d.setFocus()}else{BrowseView.loadTitle(f,"skipFocus");log.write("..... not resetting focus .....")}}if(d.getUserRatingFloat()==0&&(e.stopPositionMins>=30||e.stopPositionPercent>=96)){log.write("Show rate modal");d.showingRating=true;if(d.tv){BrowseView.showRate(d.persist.title.titleID)}else{BrowseView.showRate(d.persist.title.titleID)}}})}else{if(e.forceUpdate){log.write(".... forcing update ....");$cn.methods.getTitleListing(this.persist.title.titleID,true,function(f){BrowseView.loadTitle(f);navigation.setFocus("tdbuttonCheckout",true)})}else{log.write(".... last branch ....");navigation.setFocus("tdbuttonCheckout",true)}}if(e.bandwidthError){log.write("Bandwidth error!!!!!!")}}},goLibrary:function(d,e){BrowseView.TitleViewControl.setFocus();$cn.methods.getPurchasedTitle(e,d,function(f){BrowseView.loadTitle(f,"")})},navigate:function(payload){var buttons,contender,currentLeft,currentTop,bLength,visButtons=[];if(!payload.preventCustom){if((application.element.current&&application.element.current!="")&&document.getElementById(application.element.current)&&$(application.element.current).getParent()!=null&&($(application.element.current).getParent().hasClass("buttonpanel")||$(application.element.current).getParent().getParent().hasClass("buttonpanel"))){if(payload.args[0].direction=="right"){if(payload.args[0].current==$(application.element.current).get("id")&&$(application.element.current).get("rightaction")){eval("("+$(application.element.current).get("rightaction")+")");payload.preventDefault()}}else{if(BrowseView.currentState=="titleview"&&payload.args[0].direction=="left"){buttons=$("ButtonPanel").getElements("a");contender=-1;currentLeft=document.getElementById(application.element.current).offsetLeft;currentTop=document.getElementById(application.element.current).offsetTop;for(var i=0;i<buttons.length;i++){if(buttons[i].offsetWidth){if(parseInt(buttons[i].offsetLeft)<parseInt(currentLeft)&&parseInt(buttons[i].offsetTop)==parseInt(currentTop)){contender=i;break}}}if(contender==-1){for(var i=0;i<buttons.length;i++){if(buttons[i].offsetWidth){if(parseInt(buttons[i].offsetLeft)<parseInt(currentLeft)&&parseInt(buttons[i].offsetTop)<parseInt(currentTop)){contender=i}}}}if(contender==-1){payload.preventDefault();navigation.setFocus("dock-back",true)}else{payload.preventDefault();navigation.setFocus(buttons[contender].id,true)}}else{if(BrowseView.currentState=="titleview"&&payload.args[0].direction=="down"){buttons=$("ButtonPanel").getElements("a");contender=-1;currentLeft=document.getElementById(application.element.current).offsetLeft;currentTop=document.getElementById(application.element.current).offsetTop;for(var i=0;i<buttons.length;i++){if(buttons[i].offsetWidth){if(parseInt(buttons[i].offsetLeft)==parseInt(currentLeft)&&parseInt(buttons[i].offsetTop)>parseInt(currentTop)){contender=i;break}}}if(contender==-1){for(var i=0;i<buttons.length;i++){if(buttons[i].offsetWidth){if(parseInt(buttons[i].offsetLeft)>parseInt(currentLeft)&&parseInt(buttons[i].offsetTop)>parseInt(currentTop)){contender=i;break}}}}if(contender==-1){payload.preventDefault();for(var i=0;i<buttons.length;i++){if(buttons[i].offsetWidth){if(buttons[i].id==application.element.current&&parseInt(buttons[i].offsetTop)==parseInt(currentTop)){bLength=buttons.length;while(bLength--){if(buttons[bLength].getStyle("display")=="block"){visButtons.unshift(buttons[bLength])}}navigation.setFocus(visButtons[0].id,true);break}}}}else{payload.preventDefault();navigation.setFocus(buttons[contender].id,true)}}else{if(BrowseView.currentState=="titleview"&&payload.args[0].direction=="up"){buttons=$("ButtonPanel").getElements("a");bLength=buttons.length;log.write(bLength);while(bLength--){if(buttons[bLength].getStyle("display")=="block"){visButtons.unshift(buttons[bLength])}}bLength=visButtons.length;if(application.element.current==visButtons[0].id){payload.preventDefault();if(visButtons[0].offsetWidth==visButtons[(bLength-1)].offsetWidth){navigation.setFocus(visButtons[(bLength-1)].id,true)}else{if($("tdbuttonWishlist-1")&&$("tdbuttonWishlist-1").getStyle("display")=="block"){navigation.setFocus(visButtons[(bLength-1)].id,true)}else{if($(visButtons[(bLength-2)].id).getParent().getPrevious(".half")){navigation.setFocus(visButtons[(bLength-3)].id,true)}else{navigation.setFocus(visButtons[(bLength-2)].id,true)}}}}}}}}}}},hasSimiliar:function(){var e=false;var d=this;if($cn.data.jinniEnable&&($cn.utilities.getMeta("SimilarAvail",d.persist.title.metaValues)=="True")){if(this.persist.title.wheelItems.length>0){this.persist.title.wheelItems.each(function(f){if(f.indexOf("s_")==0){e=true}})}}if(!e&&$cn.data.baselineEnable){if(this.persist.title.wheelItems.length>0){this.persist.title.wheelItems.each(function(f){if(f.indexOf("m_cast_crew")==0){e=true}})}}return e},setFocus:function(){log.write("Setting title view focus...");if(!this.showingRating){log.write("Not showing the rating...");var f=$("ButtonPanel").getElements("a");var e=-1;for(var d=0;d<f.length;d++){if(f[d].id=="tdbuttonResumePlay"&&document.getElementById("tdbuttonResumePlay").className.indexOf("hideextra")==-1){e=d;log.write("contender: "+f[d].id);break}log.write(f[d].id+":"+f[d].offsetWidth);if(f[d].offsetWidth){if(e==-1){e=d;continue}else{if(parseInt(f[d].offsetLeft)<parseInt(f[e].offsetLeft)&&parseInt(f[d].offsetTop)<=parseInt(f[e].offsetTop)){e=d}}}}log.write("contender"+e);if(document.getElementById("modalcontrol")&&document.getElementById("modalcontrol").className=="message_exit"&&document.getElementById("modalcontrol").style.display=="block"){if(e!=-1){BrowseView.MessagePopup.lastFocus=f[e].id}else{if(f.length>0){BrowseView.MessagePopup.lastFocus=f[0].id}}}else{if(e!=-1){log.write("titleview.setfocus: "+f[e].id);navigation.setFocus(f[e].id,true)}else{if(f.length>0){navigation.setFocus(f[0].id,true)}}}}},disableButtons:function(){if($("ButtonPanel")){$("ButtonPanel").addClass("disabled")}},enableButtons:function(){if($("ButtonPanel")){$("ButtonPanel").removeClass("disabled")}},show:function(){$("titledetails").show();$("titledetailscontainer").show();if(document.getElementById("ButtonPanel")){var d=$("ButtonPanel").getElements("a");navigation.buildNavigation(d)}},showAvailability:function(){var d=this.persist.title.watchStatus;if($cn.utilities.isTrue(this.persist.title.isPassUV)){d="UV_Unavailable"}var e=application.resource.unavailable_messages[d];switch(this.persist.title.watchStatus){case WatchStatus.NotAvailable_HoldBack:e={Message:e.Message.replace("{Date}",$cn.utilities.formatDate(this.persist.title.dateExpired,"short")),Content:e.Content};break;case WatchStatus.NotAvailable_Aired_Episode:e={Message:e.Message.replace("{PurchaseDate}",$cn.utilities.formatDate(this.persist.title.datePurchased,"short")),Content:e.Content};break;case WatchStatus.NotAvailable_Pre_Ordered:e={Message:e.Message.replace("{PurchaseDate}",$cn.utilities.formatDate(this.persist.title.datePurchased,"short")),Content:e.Content};break}if(e){e.Close="Close";BrowseView.showMessage("message_content",e)}},onEpisodes:function(d){BrowseView.showTvEpisodes(this.persist.title)},onWishlistError:function(d){log.write("======== wishlist error 1 ========");log.write("pa0 is: "+d.args[0]);log.write("pa0tid is: "+d.args[0].titleId);log.write("======== wishlist error 2 ========");this.onWishlistInsert(d)},onWishlistInsert:function(f){if(this.persist.title.titleID==f.args[0]){var d=$("tdbuttonWishlist");if(d){if(d==$(application.element.current)){this.setFocus()}d.hide()}if(d.getParent(".half")==null){$("tdbuttonWishlist-1").inject($("tdbuttonWishlist"),"after");log.write("fullsize move")}d=$("tdbuttonWishlist-1");if(d){d.show()}var e=$("ButtonPanel").getElements("a");e.each(function(g){g.removeProperties("up","down","left","right")});navigation.buildNavigation(e)}},onSaveState:function(e){var d=e.args[0];d[this.id]={persist:$extend({},this.persist),tv:this.tv,episode:this.episode,season:this.season,tvshow:this.tvshow}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id])}},TitleViewControl=new Class(TitleViewControlProperties);var WatchStatus={WatchNow:"WatchNow",ExpiredRental:"ExpiredRental",NotAvailable_HoldBack:"NotAvailable_HoldBack",NotAvailable_LicensorRestricted:"NotAvailable_LicensorRestricted",NotAvailable_NotArrived:"NotAvailable_NotArrived",NotAvailable_In_This_Store:"NotAvailable_In_This_Store",NotAvailable_In_This_Territory:"NotAvailable_In_This_Territory",NotAvailable_Aired_Episode:"NotAvailable_Aired_Episode",NotAvailable_Pre_Ordered:"NotAvailable_Pre_Ordered"};var ActiveGrid=null;var GridController=new Class({DEBUG:false,registeredControls:{},spinnerPos:1,spinnerTimer:null,spinnerSpinning:false,spinnerPosition:1,initialize:function(){application.events.subscribe(this,"loadgrid",this.activate.bind(this));application.events.subscribe(this,"gridloading",this.handleGridLoading.bind(this));this.spinnerTimer=new Timer();this.spinnerTimer.Interval=80},activate:function(g){if(this.DEBUG){log.write("gridcontroller.activate Debug: Enter with payload "+log.dumpObj(g))}g=g.args[0];if(BrowseView.LastGridProcess==g.gridProcess){log.write("gridcontroller.activate Debug: Loading grid...position is "+g.position);var d;if(ActiveGrid!=null&&g.grid!=ActiveGrid.id){if(this.DEBUG){log.write("gridcontroller.activate Debug: Hiding active grid.")}d=$(ActiveGrid.id);d.hide()}var e=g.className?g.className:"";ActiveGrid=this.registeredControls[g.grid];ActiveGrid.className=e;ActiveGrid.altMessage=g.altMessage;ActiveGrid.returnFocus=g.returnFocus;ActiveGrid.showFade=g.showFade;d=$(ActiveGrid.id);d.className=e;if((e!="wishlistgrid")&&g.position){if(this.DEBUG){log.write("gridcontroller.activate Debug: payload.position set, calling ActiveGrid.redraw passing data"+log.dumpObj(g.data))}ActiveGrid.redraw(g.data)}else{var f=(!g.data)?0:g.data.length;f=(f!=0&&(g.customLength&&g.customLength>g.data.length))?g.customLength:f;if(this.DEBUG){log.write("gridcontroller.activate Debug: payload.position NOT set, Calling ActiveGrid.loadData passing data of length "+f+": "+log.dumpObj(g.data))}ActiveGrid.loadData(g.data,g.columns,g.template,g.position,f,(g.customPages)?g.customPages:1,g.genreid)}d.show();application.currentView.layoutIsDirty=true}},hideAll:function(){ActiveGrid=null;for(var d in this.registeredControls){$(this.registeredControls[d].id).hide()}},initSpinner:function(){log.write("Init Spinner");BrowseView.GridController.spinnerTimer.Tick=BrowseView.GridController.spinnerTick;if(!BrowseView.GridController.spinnerSpinning){$("gridspinnercontainer").hide();BrowseView.GridController.spinnerPosition=1;BrowseView.GridController.spinnerTimer.Start();BrowseView.GridController.spinnerSpinning=true}},deinitSpinner:function(){BrowseView.GridController.spinnerTimer.Stop();BrowseView.GridController.spinnerSpinning=false;$("gridspinnercontainer").hide()},spinnerTick:function(){var h=document.getElementById("gridspinner");if(h){var g=false;var d=-413;var j=-461;if(!g){d=-1004;j=-1052}BrowseView.GridController.spinnerPosition=(BrowseView.GridController.spinnerPosition+1)%16;var e=BrowseView.GridController.spinnerPosition*80*-1;var f=d;if(BrowseView.GridController.spinnerPosition>7){e=(BrowseView.GridController.spinnerPosition-8)*80*-1;f=j}h.style.backgroundPosition=parseInt(e)+"px "+f+"px";$("gridspinnercontainer").show()}},register:function(d){this.registeredControls[d.id]=d},handleGridLoading:function(f){f=f.args[0];var d;if(ActiveGrid!=null&&f.grid!=ActiveGrid.id){d=$(ActiveGrid.id);d.hide()}var e=f.className?f.className:"";ActiveGrid=this.registeredControls[f.grid];ActiveGrid.className=e;d=$(ActiveGrid.id);d.className=e;d.show();application.currentView.layoutIsDirty=true}});var ContentGridProperties={id:"contentgrid",tplKey:null,tpl:null,_data:[],scroll:false,scrollBuffer:30,imageTimer:null,imageTimerTicking:false,initialize:function(d){this.id=d;this.tplKey=this.id;this.tpl=new ui.template(this.id,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile();this.imageTimer=new Timer();this.imageTimer.Interval=200;log.write(this.id+".init()");application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"scroll",function(e){if($(this.id).offsetWidth){if(e.args[0].isDrag){this.verticalDragScroll(e.args[0].direction,e.args[0].scrollbar,e.args[0].rows)}else{this.onScroll(e.args[0].direction,e.args[0].scrollbar)}}}.bind(this))},initImageTimer:function(){log.write("Init Image Timer");this.imageTimer.Tick=this.validateImages.bind(this);this.imageTimerTime=new Date();if(!this.imageTimerTicking){this.imageTimer.Start();this.imageTimerTicking=true}},deinitImageTimer:function(){this.imageTimer.Stop();this.imageTimerTicking=false},validateImages:function(){log.write("Images Validating...");var g=document.getElementById(this.id).getElementsByTagName("img");var f=g.length,d;if(g.length>0){for(d=0;d<g.length;d++){var e=g[d];if(e.complete){if(e.width>0){f--;log.write("Image loaded.")}else{log.write("0 Width detected. Swap img.");if(document.getElementById("griddefaultbg")){$("griddefaultbg").show();e.style.display="none"}f--}}else{if($cn.utilities.testDuration(this.imageTimerTime,3)){if(document.getElementById("griddefaultbg")){$("griddefaultbg").show();e.style.display="none"}f--}}}if(f===0){log.write("All Images Loaded.");this.onLoad();this.deinitImageTimer()}}else{log.write("image loading error");this.deinitImageTimer();this.onLoad()}},cleanUI:function(){this.tpl.empty();BrowseView.ScrollBar.setRange(0)},loadData:function(f,d,e){if(e&&e!=this.tplKey){this.tpl=new ui.template(this.id,application.ui.loadTpl(e+".tpl"));this.tpl.compile();this.tplKey=e}this._data=[];this._data=f;this.draw()},scaleDefaultImage:function(){alert(this.style.width)},onScroll:function(j,k){var h=$(this.id),e="";if(h){var d=h.childNodes[0];if(d){e=h.clientHeight-this.scrollBuffer;var f=k.getPosition()+(j=="down"?1:-1);f=Math.min(Math.max(0,f),k.range);if(f!=k.getPosition()){var g=-(f*e)+5;d.setStyle("margin-top",g);k.setPosition(f)}}}},verticalDragScroll:function(j,m,d){var f=$(this.id),k="";if(f){var l=f.childNodes[0];if(l){k=f.clientHeight-this.scrollBuffer;log.write("^^^^^^^^^^^^^^titlegrid this.pageSize  "+m.pageSize);var e=m.getPosition()+d;e=Math.min(Math.max(0,e),m.range);var h=-e*k;var g=new Fx.Morph(l,{duration:"short",transition:Fx.Transitions.Sine.easeOut});g.start({"margin-top":h})}}},imgResize:function(d){if(d){if(d.className.indexOf("resize")>-1){log.write(d);if(document.getElementById("griddefaultbg")){document.getElemetById("griddefaultbg").style.display="none"}}}},imgLoad:function(){this.imageCount--;if(this.imageCount===0){this.onLoad()}},imgError:function(d){log.write("image loading error");if(document.getElementById("griddefaultbg")){$("griddefaultbg").show();d.target.style.display="none"}this.imageCount--;if(this.imageCount===0){this.onLoad()}},draw:function(){var d=this,h;this.cleanUI();application.events.publish("gridloading",{grid:this.id});$(this.id).setStyle("visibility","hidden");var g="<div>";this._data.each(function(k){g=g+d.tpl.applyTemplate(k)});g=g+"</div>";var e=g.toElement();if(e){document.getElementById(this.id).appendChild(e)}var j=document.getElementById(this.id).getElementsByTagName("img");this.imageCount=0;for(var f=0;f<j.length;f++){h=j[f].getAttribute("src");log.write("image source "+h);if(j[f].src.indexOf("localhost")>-1||h===""){$("griddefaultbg").show();$(j[f]).hide()}j[f].onerror=function(){log.write("!!image load error");log.write(this);$("griddefaultbg").show();$(this).hide()}}this.onLoad()},navigate:function(d){if((application.element.current&&application.element.current!=="")&&document.getElementById(application.element.current)&&application.element.current==BrowseView.ScrollBar.thumb){if(d.args[0].direction=="left"&&$(this.id).getSize().y){d.preventDefault();navigation.setFocus("selectedslave",true)}}},onLoad:function(){application.events.publish("gridloaded",{grid:this.id});$(this.id).setStyle("visibility","inherit");var g=$(this.id);var d=0,f;if(g){var e=g.childNodes[0];if(e){f=e.clientHeight;if(f>g.clientHeight){d=Math.ceil(f/g.clientHeight)-1;if(((f%g.clientHeight)+(d*this.scrollBuffer))>g.clientHeight){d=d+1}this.scroll=true}}}BrowseView.ScrollBar.setPosition(0);BrowseView.ScrollBar.setRange(d)}},ContentGrid=new Class(ContentGridProperties);var GridControlProperties={DEBUG:false,id:"titlegrid",persist:{},controls:{},history:[],layoutIsDirty:true,template:"",tpl:null,tplCache:{},scroll:true,tplMeta:null,altMessage:null,itemidx:-1,isActive:false,hault:0,currentId:0,currentTopLeft:0,totalRecords:0,currentPage:0,genreid:0,totalPages:0,rowHeight:0,maskViewIndex:-1,gridLoaded:false,itemsRequested:false,metaRequest:null,spinnerPos:1,spinnerTimer:null,spinnerSpinning:false,lastMovement:new Date(),lastNavigationDirection:"",spinnerPosition:1,imgPreloader:[],prefetchSpinner:false,config:{numRows:3,numCols:3,numDisplay:9,numStartIndex:0},_data:[],initialize:function(d){if(d&&d.id){this.id=d.id}this.loadTemplate("listgrid.tpl");this.loadTemplate("refinementgrid.tpl");this.loadTemplate("librarylist.tpl");this.loadTemplate("titlelist.tpl");this.loadTemplate("similarlist.tpl");log.write("gridcontrol.init()");application.element.registerControl(this);application.events.subscribe(this,"elementfocus",this.gridFocus.bind(this));application.events.subscribe(this,"elementblur",this.gridBlur.bind(this));application.events.subscribe(this,"griditemselected",this.loadMeta.bind(this));application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"wheelvaluechanged",this.handleWheelItemChange.bind(this));application.events.subscribe(this,"viewchanged",this.onViewChange.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"error",this.onHandleError.bind(this));application.events.subscribe(this,"pointerdeactivated",this.onPointerdeactivated.bind(this));application.events.subscribe(this,"pointertrack",this.onPointerTrackMove.bind(this));application.events.subscribe(this,"scroll",function(e){this.nextIndexTitle=0;if($("titlelist").offsetWidth){if(e.args[0].rows||e.args[0].rows==0){this.movegrid(e.args[0].direction,Math.abs(e.args[0].rows))}else{this.movegrid(e.args[0].direction,this.config.numRows)}}}.bind(this))},init:function(){},cleanUI:function(){if($("titlelist").getChildren().length>0){$("titlelist").getChildren().destroy()}document.getElementById("titlelist").className="";if(this.tplMeta){this.tplMeta.empty();this.tplMeta=null}BrowseView.ScrollBar.deactivate()},handleWheelItemChangeInit:function(f){log.write("WheelItemChangedInit Called.");var e=f.args[0].wheelinstance;if(e!="SearchWheelControl"&&e!="SettingsWheelControl"&&e!="TitleCheckOutWheelControl"&&e!="TvSeasonsWheelControl"&&e!="HelpWheelControl"){var d=3;if(f.context.activeControl=="TitleMetaWheelControl"){d=2}if(f.args[0].slavevalue!=f.context.currentId){application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:d})}}},handleWheelItemChange:function(h){log.write("grid.handleWheelItemChange Debug: Enter with payload:");log.write(h);var e=this,g=h.args[0].wheelinstance,d=h.args[0].slavevalue,f;if(g!="SearchWheelControl"&&g!="SettingsWheelControl"&&g!="TitleCheckOutWheelControl"&&g!="TvSeasonsWheelControl"&&g!="HelpWheelControl"){f=3;if(h.context.activeControl=="TitleMetaWheelControl"){f=2}if(d!=h.context.currentId){h.context.currentId=d;if(this.DEBUG){log.write("grid.WheelItemChanged Debug: About to call publish with gridloading")}application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:f});setTimeout(function(){if(BrowseView.CurrentWheelValue.indexOf(String(d))>-1){if(this.DEBUG){log.write("grid.WheelItemChanged Debug: About to call getTitlesByGenreId.")}$cn.methods.getTitlesByGenreId(d,1,function(k){if(this.DEBUG){log.write("grid.WheelItemChanged Debug: Back from getTitlesByGenreId with callback "+k)}if(BrowseView.CurrentWheelValue.indexOf(String(d))>-1){var j=null;if($cn.data.RecomendedGenreIds&&$cn.data.RecomendedGenreIds.contains(k.data.result.genreID.toString())){j="recommended_empty"}BrowseView.LastGridProcess="titlelist";if(this.DEBUG){log.write("grid.WheelItemChanged Debug: About to call publish with loadGrid")}application.events.publish("loadgrid",{grid:"titlegrid",data:k.data.result.items,genreid:k.data.result.genreID.toString(),customLength:k.data.result.totalItems,customPages:k.data.result.totalPages,columns:f,altMessage:j,gridProcess:"titlelist",cssClass:""})}else{if(this.DEBUG){log.write("[CALLBACK] Current wheel value does not match payload. Ignore request.")}}})}},1000)}}},gridFocus:function(d){if(document.getElementById(d.args[0].focusedelem)){if($("titlelist").isParentOf($(d.args[0].focusedelem))){log.write("gridfocus");$("titlemeta").setStyle("visibility","visible");this.itemidx=parseInt($(application.element.current).get("titleidx"));this.isActive=true}else{$("titlemeta").setStyle("visibility","hidden");$("titlemeta").setStyle("top","");$("titlelist").setStyle("height","470px");if($("titlegrid").hasClass("episodegrid")){$("titlelist").setStyle("height",this.rowHeight*this.config.numRows+"px")}this.itemidx=-1;this.isActive=false;if(this.maskViewIndex>0){this.setPointerLoseFocus()}}}},gridBlur:function(d){if((this.maskViewIndex>0)&&(d.args[0].nextFocus==null)){this.setPointerLoseFocus()}if($("titlemeta")){$("titlemeta").setStyle("visibility","hidden")}},loadData:function(k,e,g,d,j,h,f){this.numColumns=e;this.cleanUI();this.currentPage=1;this.totalRecords=j;this.totalPages=h;this.genreid=f;this.itemsRequested=false;this.template=(g)?g:"titlelist";this.tpl=this.loadTemplate(this.template+".tpl");switch(this.template){case"refinementgrid":case"listgrid":$("titlelist").addClass("listgrid");break;case"librarylist":case"similarlist":default:$("titlelist").removeClass("listgrid");break}this.config.numStartIndex=d==null?0:d;this.config.numCols=typeof(e)!="undefined"?e:3;this.hideAltMessage();this._data=[];if(k){this._data=k}this.draw();application.events.publish("gridloaded",{grid:this.id})},loadMeta:function(f){var e=(this.lastNavigationDirection=="up"||this.lastNavigationDirection=="down")?250:1;var d=f.args[0].id;this.lastMetakey=f.args[0].id;log.write(this.lastMetakey+":"+d);setTimeout(function(){var m,l;if(d==this.lastMetakey){if(f.context.id=="titlegrid"){this.tplMeta=this.loadTemplate("titlelist."+f.args[0].type+"meta","titlemetacontainer");$("titlemetacontainer").erase("class");$("titlemetacontainer").addClass(f.args[0].type+"meta");if(f.args[0].type=="cast"){log.write("Cast Bio: loading id: "+f.args[0].id);this.tplMeta.emptyAndAppend({});$cn.methods.getCastBio(f.args[0].id,function(n){if(d==this.lastMetakey){n.bio=(n.bio)?n.bio.firstWithEllips(150):"";this.tplMeta.emptyAndAppend(n);this.tplMeta.apply();$("castmeta").setStyle("visibility","inherit")}}.bind(this))}else{if(f.args[0].type=="episode"){var g=this.totalRecords;var k=(g+1)*32;if(g<10){$("titlelist").setStyle("height",k+"px");$("titlemeta").setStyle("top",(k+34)+"px")}else{$("titlelist").setStyle("height",this.rowHeight*this.config.numRows+"px");$("titlemeta").setStyle("top","386px")}j=$cn.data.TitleSummaryCache[f.args[0].id];this.loadTitleSummary(j,f,f.args[0].passID)}else{if(f.args[0].type=="similar"&&$cn.data.TitlesBySimilar[BrowseView.RecomendationWheelControl.titleID+"-"+BrowseView.RecomendationWheelControl.slaveIdx+"-1"]){var h=$cn.data.TitlesBySimilar[BrowseView.RecomendationWheelControl.titleID+"-"+BrowseView.RecomendationWheelControl.slaveIdx+"-1"].data.result,j=$cn.data.TitleSummaryCache[f.args[0].id];this.loadTitleSummary(j,f.args[0],undefined);for(x=0;x<h.similarTitles.length;x++){if(f.args[0].id==h.similarTitles[x].keyName){j.synopsys="Similar because: "+h.similarTitles[x].keyValue;break}}}else{j=$cn.data.TitleSummaryCache[f.args[0].id];if(!j){if(f.args[0].type=="library"){$cn.methods.getPurchasedTitle(f.args[0].passID,f.args[0].id,function(n){if(n){if(n.responseCode==0){this.updateTitleSummary(d,this.lastMetakey,n,f)}else{this.updateTitleSummary(d,this.lastMetakey,null,f);n.errorHandled=true}}}.bind(this))}else{$cn.methods.getShortSummary(f.args[0].id,function(n){if(n){if(n.responseCode==0){this.updateTitleSummary(d,this.lastMetakey,n,f)}else{this.updateTitleSummary(d,this.lastMetakey,null,f);n.errorHandled=true}}}.bind(this))}}else{if(d==this.lastMetakey){log.write("grid: Else processing, about to call loadTitleSummary on title "+j);this.loadTitleSummary(j,f,f.args[0].passID);log.write("grid: Else processing, back from loadTitleSummary on title "+j)}}}}}}}}.bind(this),e)},updateTitleSummary:function(e,g,d,f){if(e==g){this.loadTitleSummary(d,f,f.args[0].passID);if(d){$cn.data.TitleSummaryCache[f.args[0].id]=d}}},loadTitleSummary:function(j,k,g){log.write("grid.loadTitleSummary: Entered with title "+j);if(!j){$("titlemetacontainer").getElement(".metapanel").setStyle("display","none");return}var e=j.name;var d="",h=$cn.utilities.highlightKeywordForSynopsis(j.synopsys,BrowseView.SearchKeyboard.getkeyword()),m;if(BrowseView.currentState==="library-view"){if($cn.data.isPassUVCache&&$cn.data.isPassUVCache[g]){m=$cn.data.isPassUVCache[g].isPassUV}else{m=false}}else{m=$cn.utilities.getMeta("HasUV",j.metaValues)}m=$cn.utilities.isTrue(m)&&$cn.config.EnableUV;log.write("hasUv is: "+m+" from "+BrowseView.currentState);if(j.titleType=="TV_Episode"&&k.args[0].type!="episode"){e=$cn.utilities.getMeta("TVSeasonHeader",j.metaValues);d=$cn.utilities.getMeta("TVEpisodeHeader",j.metaValues);h=""}else{if(j.titleType=="TV_Season"){e=$cn.utilities.getMeta("TVSeasonHeader",j.metaValues)}}if(this.tplMeta){this.tplMeta.emptyAndAppend({titleID:j.titleID,name:e,mPAARating:j.mPAARating,UVAvailable:(m?"yesUV":"noUV"),Episode:d,synopsys:h,hasClosedCaption:($cn.utilities.getMeta("HasClosedCaption",j.metaValues)=="True"?"hasCC":"noCC")});var f=$("titlemeta_title");if($("store").hasClass("search-view")){f.set("html",$cn.utilities.highlightKeywordForTitlename(e,BrowseView.SearchKeyboard.getkeyword()))}if(f){var l=f.getParent().getSize().x;if(f.getNext()){l=l-(f.getNext().offsetWidth)-11;if(f.getNext(".ratingholder").getNext(".ratingholder")){l=l-(f.getNext().getNext().offsetWidth);if(f.getNext(".ratingholder").getNext(".ratingholder").getNext(".ratingholder")){l=l-(f.getNext().getNext().getNext().offsetWidth)}}}f.setStyle("width",Math.min(f.offsetWidth,l)+2);if(f.getNext()){f.getNext().setStyle("padding-left","3px")}}this.tplMeta.apply();$("titlemetacontainer").getElement(".metapanel").setStyle("visibility","inherit");log.debug("Title: "+e+", mPAARating: "+j.mPAARating);log.debug("############################")}},loadHeader:function(e,f){application.putInnerHTML($("titlegrid_header"),"");var d=new ui.template("titlegrid_header",application.ui.loadTpl(e));d.compile();d.append(f);d.apply();$("titlegrid_container").addClass("header")},getElipsisLength:function(){if(BrowseView.DockControl.selection=="dock-search"){return 95}else{if(this.config.numCols==2){return 65}else{return 95}}},loadTemplate:function(f,d){var e=this.tplCache[f];if(e==null){if(d==null){d="titlelist"}e=new ui.template(d,application.ui.loadTpl(f));e.compile();this.tplCache[f]=e}return e},configure:function(){var d=$("titlelist"),g;if(d!=null){if(this._data&&this._data.length){d.show();var e=this.config.numStartIndex;if(this._data[e]){this._data[e].titleidx=e;this.tpl.append(this._data[e]);var f=d.getFirst();this.configure.titleWidth=f.offsetWidth;this.rowHeight=f.offsetHeight+parseInt(f.getStyle("margin-top"))+parseInt(f.getStyle("margin-bottom"))}}else{this.rowHeight=150}g=d.clientHeight>0?d.clientHeight:this.config.numRows*this.rowHeight;this.config.numRows=Math.floor(g/this.rowHeight);this.config.numDisplay=this.config.numCols*this.config.numRows}},resize:function(d){if(this.template=="listgrid"){log.write("Singlewheel display: "+$("singlewheel").getStyle("display"))}$("titlemeta").setStyle("width",$("titlelist").offsetWidth)},redraw:function(h){var d=$("titlelist").getChildren();if(d.length>0){d.destroy()}var g=Math.floor((h.length-this.config.numCols)/this.config.numCols)*this.config.numCols;var f=this.itemidx>=0?this._data[this.itemidx].titleID:0;if(this.config.numStartIndex>g){this.config.numStartIndex=g}this._data=h;this.resize();this.draw();var e=$("titlelist").getElement("a[titleid='"+f+"']");if(e){navigation.setFocusElement(e,true)}application.events.publish("gridloaded",{grid:this.id})},draw:function(){var k,h;$("titlegrid").show();this.configure();this.resize(this.config.numCols);h=Math.min(this.totalRecords,this.config.numStartIndex+this.config.numDisplay);var n=this;if(this.totalRecords>0){this.scroll=!(this.totalRecords<this.config.numDisplay);log.write("totalRecords: "+this.totalRecords+" numDisplay: "+this.config.numDisplay+" numCols: "+this.config.numCols+" this.scroll: "+this.scroll);for(k=this.config.numStartIndex+1;k<h;k++){if(this._data[k]){var q=[],j=0;this._data[k].titleidx=k;this.tpl.append(this._data[k]);if(this._data[k+9]){q[j]=new Image();q[j].src="http://cache.cinemanow.com/images/boxart/v2_107/"+this._data[k+9].boxartPrefix+"v2_107.jpg";j++}q=null;delete q;if(!$cn.data.TitleCache[this._data[k].titleID]){$cn.data.TitleCache[this._data[k].titleID]=this._data[k]}}}this.tpl.apply();$$("#titlelist .title img").each(function(r){r.onerror=function(s){log.write("IMAGE ERROR");r.hide()}});if(typeof $cn.config.CustomDefaultGridImage=="function"){$$("#titlelist .title .title-text").each(function(s){var r=$cn.config.CustomDefaultGridImage(s);s.addClass(r)})}var g=$("titlelist");var m=g.getFirst();var d=Math.min(Math.floor(($("titlemeta").getPosition().y-g.getPosition().y)/this.rowHeight),this.config.numRows);var p=Math.ceil(this.totalRecords/this.config.numCols);var e=$("store").hasClass("episode-panel");var f=$("store").hasClass("search-view");if(e&&!f){log.write("##### adjusting tv episodes scrollbar ########");$("scrollbar").setStyles({"margin-top":"33px",height:g.offsetHeight})}else{if($("titlegrid").hasClass("refinementgrid")){$("scrollbar").setStyles({"margin-top":"0px",height:g.offsetHeight});$("scrollbar").getElement(".scrollarea").addClass("refinementgridAreaHeight")}else{$("scrollbar").setStyles({"margin-top":"0px",height:g.offsetHeight})}}var l=$("scrollbar").getElement(".scrollbottom").getStyle("height");$("scrollbar").getElement(".scrollarea").setStyle("height",g.offsetHeight-parseInt(l)*2);if(Math.max(0,p-d)>0){BrowseView.ScrollBar.setPosition(Math.floor(this.config.numStartIndex/this.config.numCols));BrowseView.ScrollBar.setRange(Math.max(0,p-d));BrowseView.ScrollBar.draw()}}else{this.showAltMessage();if($("store").hasClass("browse-view")){navigation.setFocus("selectedslave",true);if(pointer.isPointerModeActive()){if($("slavewheelmaskup").getStyle("opacity")=="0.6"||$("slavewheelmaskdown").getStyle("opacity")=="0.6"){navigation.setFocus("selectedslave",true)}if($("masterwheelmaskup").getStyle("opacity")=="0.6"||$("masterwheelmaskdown").getStyle("opacity")=="0.6"){navigation.setFocus("selectedmaster",true)}}}}application.currentView.layoutIsDirty=true},itemCount:function(){return this.totalRecords},getPosition:function(){return BrowseView.ScrollBar.getPosition()*this.config.numCols},remove:function(h){if(h>=0&&h<this.totalRecords){var j=$("titlelist"),g=j.getChildren(),e;this._data.splice(h,1);if(g.length){var f=parseInt(g[0].getElement("a").get("titleidx")),d=f+g.length;if(h>=f&&h<d){this.tpl.empty();for(e=f;e<d;e++){if(this._data[e]){this._data[e].titleidx=e;this.tpl.append(this._data[e])}}this.tpl.apply();if(h==this.itemidx){var l=Math.min(this.totalRecords-2,h);navigation.setFocusElement(j.getElement("a[titleidx='"+l+"']"),true);this.nextIndexTitle=l}this.totalRecords--}}var k=BrowseView.ScrollBar.getPosition();BrowseView.ScrollBar.setRange(this.totalRecords<(this.config.numDisplay-this.config.numCols)?0:Math.ceil((this.totalRecords-(this.config.numDisplay-this.config.numCols))/this.config.numCols));if(k>0&&k>BrowseView.ScrollBar.range){this.movegrid("up",1)}application.currentView.layoutIsDirty=true}},showAltMessage:function(){var e="";if(this.altMessage){e=this.altMessage}else{if(BrowseView.DockControl.selection=="dock-search"){if(BrowseView.SearchKeyboard._currentValue.length>=1){e="search_empty"}else{return}}else{e="empty"}}var d=new ui.template("altmessage",application.ui.loadTpl(e+".tpl"));d.compile();d.empty();d.append();d.apply();$("titlelist").hide();$("altmessage").show()},hideAltMessage:function(){$("altmessage").hide();$("altmessage").set("html","")},onViewChange:function(d){this.currentView=d.args[0]},setPointerFocus:function(h){var g=$("titlelist");var n=g.getElement("a[titleidx='"+h+"']");var d=Math.min(Math.floor(($("titlemeta").getPosition().y-g.getPosition().y)/this.rowHeight),this.config.numRows);var e=g.getChildren();var l;var k=parseInt(this.totalRecords)-1;var j=(e[0])?e[0].getElements("a")[0]:null;this.currentTopLeft=(j)?(j.get("titleidx")!=null?parseInt(j.get("titleidx")):-1):(k+1);var f=h-this.currentTopLeft;if((f)>=(this.config.numCols*d)){var m=f-this.config.numCols;if(this.maskViewIndex>0){this.setPointerLoseFocus()}this.maskViewIndex=f;l=$(e[this.maskViewIndex]);if(l&&l.getElement(".titlelistmask")){l.getElement(".titlelistmask").show()}n=g.getElement("a[titleidx='"+(h-this.config.numCols)+"']");navigation.setFocusElement(n)}else{navigation.setFocusElement(n);if(this.maskViewIndex>0){this.setPointerLoseFocus()}}},setPointerLoseFocus:function(){var f=$("titlelist");var e=f.getChildren();var d;if(this.maskViewIndex>0){d=$(e[this.maskViewIndex]);if(d&&d.getElement(".titlelistmask")){d.getElement(".titlelistmask").hide();this.maskViewIndex=-1}}},clickAction:function(){this.setPointerLoseFocus();this.movegrid("down",1)},metaClickAction:function(){var h=this.maskViewIndex;if((this.maskViewIndex>0)&&(this.template!="listgrid")&&(this.template!="refinementgrid")){this.setPointerLoseFocus();this.movegrid("down",1);var g=$("titlelist");var f=g.getChildren();var d=(f[0])?f[h].getElements("a")[0]:null;var e=d.get("titleidx");this.setPointerFocus(e)}},onPointerdeactivated:function(){this.setPointerLoseFocus()},onPointerTrackMove:function(f){var j=f.args[0];var k=$("titlelist");var g=k.getChildren();var l;var n;var m;var d=Math.min(Math.floor(($("titlemeta").getPosition().y-k.getPosition().y)/this.rowHeight),this.config.numRows);if((this.template=="refinementgrid")||(this.template=="listgrid")){return}if($(g[this.config.numCols*d])==null){return}else{for(var h=(this.config.numCols*d);h<((this.config.numCols*d)+this.config.numCols);h++){l=$(g[h]).getBoundingClientRect();if((j.clientX>l.left)&&(j.clientX<l.right)&&(j.clientY>l.top)&&(j.clientY<l.bottom)){n=g[h].getElements("a")[0];m=parseInt(n.get("titleidx"));this.setPointerFocus(m);break}}}},loadPage:function(d){$cn.methods.getTitlesByGenreId(this.genreid,d,function(e){self=this.self;log.write("Got title response. itemsRequested="+self.itemsRequested+", page="+this.page+", currentPage="+self.currentPage);if(self.itemsRequested&&self.currentPage==this.page){self.itemsRequested=false;log.write("before concat: "+self._data.length+" result items. ->"+e.data.result.items.length);self._data=self._data.concat(e.data.result.items);log.write("after concat "+e.data.result.items.length+" items, yielding "+self._data.length);if(self.prefetchSpinner){self.movegrid("down",0);application.events.publish("gridloaded",{grid:self.id})}}}.bind({self:this,page:d}))},loadPageForInstant:function(g,f,e,h,d){log.write("send request:"+h);$cn.methods.getTitlesByGenreId(this.genreid,f,function(p){self=this.self;log.write("Got title response. itemsRequested="+self.itemsRequested+", page="+this.page+", currentPage="+self.currentPage);if(self.itemsRequested||h){self.itemsRequested=false;log.write("before concat: "+self._data.length+" result items. ->"+p.data.result.items.length);var n=p.data.result.items.slice(0);var l=(this.page-1)*$cn.data.PAGE_SIZE;log.write("pageStart concat: "+l);for(var k=0;k<n.length;k++){self._data[l++]=n[k]}log.write("after concat "+p.data.result.items.length+" items, yielding "+self._data.length);log.write("requestIndex "+h);if(h==1){self.loadPageForInstant(g,d+1,e,2);return}else{if(self.prefetchSpinner){var m=e.start;var j=e.end;if(g=="down"){self.dragshowDown(m,j)}else{if(g=="up"){self.dragshowUp(m,j)}}application.events.publish("gridloaded",{grid:self.id});self.prefetchSpinner=false}}}}.bind({self:this,page:f}))},dragshowUp:function(d,f){log.write("---------------draw:"+d+":"+f+" ****************");log.write("--------data length:"+this._data.length+" ****************");var j,h=$("titlelist");if(d<=f){var p=[];var g=0;var m=false;var k=this.config.numCols;var e=1;for(var l=f;l>=d;l--){if(this._data[l]){this._data[l].titleidx=l;this.tpl.prepend(this._data[l]);log.write("prepend:"+this._data[l].name+"-"+this._data[l].titleID+" ****************")}}this.tpl.apply();$$("#titlelist .title img").each(function(q){q.onerror=function(r){log.write("IMAGE ERROR");q.hide()}});if(typeof $cn.config.CustomDefaultGridImage=="function"){$$("#titlelist .title .title-text").each(function(r){var q=$cn.config.CustomDefaultGridImage(r);r.addClass(q)})}j=h.getChildren()}p=null;application.currentView.layoutIsDirty=true;this.hault=0;if(!application.element.current){application.element.current="app-gen-0"}log.write("nextIndexTitle--"+this.nextIndexTitle);if(this.nextIndexTitle){var n=h.getElement("a[titleidx='"+this.nextIndexTitle+"']");navigation.setFocus(n,true);this.nextIndexTitle=0}for(i=f-d+1;i<j.length;i++){j[i].destroy();log.write("destroy:"+i+" ****************")}this.prefetchSpinner=false},dragshowDown:function(d,g){log.write("---------------draw:"+d+":"+g+" ****************");log.write("--------data length:"+this._data.length+" ****************");var l,k=$("titlelist");var h=k.getChildren().length;if(d<=g){var r=[];var j=0;var p=false;var m=this.config.numCols;var f=1;for(var n=d;n<=g;n++){if(this._data[n]){this._data[n].titleidx=n;this.tpl.append(this._data[n]);log.write("append:"+this._data[n].name+"-"+this._data[n].titleID+" ****************")}}this.tpl.apply();$$("#titlelist .title img").each(function(s){s.onerror=function(u){log.write("IMAGE ERROR");s.hide()}});if(typeof $cn.config.CustomDefaultGridImage=="function"){$$("#titlelist .title .title-text").each(function(u){var s=$cn.config.CustomDefaultGridImage(u);u.addClass(s)})}l=k.getChildren()}r=null;var e=[];for(i=0;i<h;i++){e[i]={"margin-top":-(this.rowHeight*1)}}for(var n=0;n<e.length;++n){l[n].setStyles(e[n]);log.write("setStyles:"+n+"  "+e[n]["margin-top"]+" ****************")}application.currentView.layoutIsDirty=true;this.hault=0;if(!application.element.current){application.element.current="app-gen-0"}elem1=null;for(i=0;i<l.length;i++){if(l[i].style.marginTop&&parseInt(l[i].style.marginTop.replace("px",""))<0){l[i].destroy();log.write("destroy:"+i+" ****************")}}log.write("nextIndexTitle--"+this.nextIndexTitle);if(this.nextIndexTitle){var q=k.getElement("a[titleidx='"+this.nextIndexTitle+"']");navigation.setFocus(q,true);this.nextIndexTitle=0}this.prefetchSpinner=false},movegrid:function(N,q){log.write("hault: "+this.hault);var I=application.loadAnimation("grid"),K=I.options.duration,E,r,O,s,F=this._data.length,m,f,e,G,B,v,J,H,A,n,k,l,L=false,h,D,u,C,P,w,p,d=I.options.fps,g=I.options.transition;log.write("^^^^^^^^^^^^^^titlegrid this.pageSize  "+BrowseView.ScrollBar.pageSize);this.lastMovement=new Date();if(this.hault==0){s="";J=$("titlelist");v=J.getChildren();P=this.totalRecords;O=(v[0])?v[0].getElements("a")[0]:null;r=this.config.numCols;H=this.config.numDisplay;e=parseInt(this.totalRecords)-1;n=q;w=v.length;E=false;this.currentTopLeft=(O)?(O.get("titleidx")!=null?parseInt(O.get("titleidx")):-1):(e+1);E=(!O);l=Math.floor(this.currentTopLeft/r);log.write("original length of this._data[]:"+this._data.length);if(N=="down"){log.write("start drag  down ************");log.write("============ prefetch spinner is: "+this.prefetchSpinner);if(l<BrowseView.ScrollBar.range){if(this.showFade){$("HorizontalFadeTop").show()}this.hault=1;k=Math.min(BrowseView.ScrollBar.range,l+q);log.write("row: "+l+" range: "+BrowseView.ScrollBar.range);log.write("=====|||  rows: "+q+"  pos: "+k+"||||========");C=k*this.config.numCols;K=(n==1)?K:K*2;h=C;f=Math.min(e,C+this.config.numDisplay-1);log.write(" start-end :"+h+":"+f+" ****************");if(((1000/d)*2)>=K){K=100;d=1000/K}if(!this._data[h]||!this._data[f]){var j=Math.floor(h/$cn.data.PAGE_SIZE);var M=Math.floor(f/$cn.data.PAGE_SIZE);if(M<=this.totalPages){if(!this.itemsRequested){log.write("loading from ws request :"+h+":"+f+" ****************");this.itemsRequested=true;this.prefetchSpinner=true;application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:this.numColumns});if(j==M){log.write("loading  $cn.data.PAGE_SIZE 27 "+$cn.data.PAGE_SIZE);log.write("*********loading startpage+1:"+(j+1));this.loadPageForInstant(N,j+1,{start:h,end:f})}else{log.write("loading  $cn.data.PAGE_SIZE 27 x 2 "+$cn.data.PAGE_SIZE);log.write("*********loading startpage+1 & endpage+1:"+(j+1)+"  "+(M+1));this.loadPageForInstant(N,j+1,{start:h,end:f},1,M)}this.currentPage=j;n=0}}else{log.write("pre-fetch call not made. currentPage:"+this.currentPage+" is >= totalPages:"+this.totalPages)}}else{log.write("loading from local _data[]*********************:"+h+":"+f+" ****************");this.dragshowDown(h,f)}BrowseView.ScrollBar.setPosition(k)}else{log.write("row >= range ,it's the bottom, no movement made")}}else{if(N=="up"){log.write("start drag up ************");if(l>0){this.hault=1;k=Math.max(l-q,0);C=k*r;K=(n==1)?K:K*2;if(((1000/d)*2)>=K){K=100;d=1000/K}h=C;f=Math.min(e,C+this.config.numDisplay-1);if(!this._data[h]||!this._data[f]){var j=Math.floor(h/$cn.data.PAGE_SIZE);var M=Math.floor(f/$cn.data.PAGE_SIZE);if(M<=this.totalPages){if(!this.itemsRequested){log.write("loading from ws request :"+h+":"+f+" ****************");this.itemsRequested=true;this.prefetchSpinner=true;application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:this.numColumns});if(j==M){log.write("loading  $cn.data.PAGE_SIZE 27 "+$cn.data.PAGE_SIZE);log.write("*********loading startpage+1:"+(j+1));this.loadPageForInstant(N,j+1,{start:h,end:f})}else{log.write("loading  $cn.data.PAGE_SIZE 27 xxxxxx 2 "+$cn.data.PAGE_SIZE);log.write("*********loading startpage+1 & endpage+1:"+(j+1)+"  "+(M+1));this.loadPageForInstant(N,j+1,{start:h,end:f},1,M)}this.currentPage=j;n=0}}else{log.write("pre-fetch call not made. currentPage:"+this.currentPage+" is >= totalPages:"+this.totalPages)}}else{log.write("loading from local _data[]*********************:"+h+":"+f+" ****************");this.dragshowUp(h,f)}this.currentTopLeft=C;BrowseView.ScrollBar.setPosition(k);m=null}else{log.write("row <= 0 , it's the top, no movement made")}}}J=null;O=null}},movegridOld:function(M,q){log.write("hault: "+this.hault);var I=application.loadAnimation("grid"),K=I.options.duration,E,r,N,s,F=this._data.length,m,g,f,G,B,v,J,H,A,n,k,l,L=false,j,D,u,C,O,w,p,e=I.options.fps,h=I.options.transition;this.lastMovement=new Date();if(this.hault==0){s="";J=$("titlelist");v=J.getChildren();O=this.totalRecords;N=(v[0])?v[0].getElements("a")[0]:null;r=this.config.numCols;H=this.config.numDisplay;f=parseInt(this.totalRecords)-1;n=q;w=v.length;E=false;this.currentTopLeft=(N)?(N.get("titleidx")!=null?parseInt(N.get("titleidx")):-1):(f+1);E=(!N);l=Math.floor(this.currentTopLeft/r);log.write("============== items requested is: "+this.itemsRequested);if(M=="up"){log.write("===== moving on up ========");if(this.prefetchSpinner){application.events.publish("gridloaded",{grid:this.id});this.prefetchSpinner=false}if(l>0){this.hault=1;k=Math.max(-q,l-q);C=k*r;K=(n==1)?K:K*2;if(((1000/e)*2)>=K){K=100;e=1000/K}for(G=parseInt(this.currentTopLeft)-1;G>=C;--G){if(this._data[G]){this._data[G].titleidx=G;this.tpl.prepend(this._data[G])}}this.tpl.apply();$$("#titlelist .title img").each(function(P){P.onerror=function(Q){log.write("IMAGE ERROR");P.hide()}});if(typeof $cn.config.CustomDefaultGridImage=="function"){$$("#titlelist .title .title-text").each(function(Q){var P=$cn.config.CustomDefaultGridImage(Q);Q.addClass(P)})}v=J.getChildren();u=(k-l)*(this.rowHeight)+1;for(G=0;G<(r*n)&&(G<v.length);G++){v[G].setStyle("margin-top",u)}A={};for(G=0;G<(r*n);G++){if(G<v.length){A[G]={"margin-top":"1px"}}}if(device.getDeviceSoc()!="BCOM"){application.TempKeyBlockEnter=true;application.TempKeyBlockDuration=K*2;if(!application.element.current){application.element.current="app-gen-0"}m=new Fx.Elements(v,{duration:(L)?0:K,fps:e,transition:h,onComplete:function(P){application.TempKeyBlockEnter=false;if(this.currentTopLeft==0&&this.showFade){$("HorizontalFadeTop").hide()}if(E){if(v[v.length]&&v[v.length].id){navigation.setFocus(v[v.length].id,true)}else{navigation.setFocus("singleselectedmaster",true)}}setTimeout(function(){var Q;application.currentView.layoutIsDirty=true;for(Q=v.length-1;Q>=H;--Q){log.write("Removing title at "+Q);v[Q].destroy()}this.config.numStartIndex=C;this.hault=0}.bind(this),200)}.bind(this)});m.start(A)}else{for(var p=0;p<v.length;++p){v[p].setStyles(A[p]);if(this.currentTopLeft==0&&this.showFade){$("HorizontalFadeTop").hide()}if(E){if(v[v.length]&&v[v.length].id){navigation.setFocus(v[v.length].id,true)}else{navigation.setFocus("singleselectedmaster",true)}}setTimeout(function(){var P;application.currentView.layoutIsDirty=true;for(P=v.length-1;P>=H;--P){log.write("Removing title at "+P);v[P].destroy()}this.config.numStartIndex=C;this.hault=0}.bind(this),200)}}this.currentTopLeft=C;BrowseView.ScrollBar.setPosition(k);m=null}}else{if(M=="down"){log.write("============ prefetch spinner is: "+this.prefetchSpinner);if(l<BrowseView.ScrollBar.range){log.write("row: "+l+" range: "+BrowseView.ScrollBar.range);if(this.showFade){$("HorizontalFadeTop").show()}this.hault=1;k=Math.min(BrowseView.ScrollBar.range,l+q);C=k*this.config.numCols;K=(n==1)?K:K*2;j=parseInt(this.currentTopLeft)+v.length;g=Math.min(f,C+this.config.numDisplay);if(j>=g){n=1;k=Math.min(BrowseView.ScrollBar.range,l+n);C=k*this.config.numCols;K=(n==1)?K:K*2;j=parseInt(this.currentTopLeft)+v.length;g=Math.min(f,C+this.config.numDisplay)}if(((1000/e)*2)>=K){K=100;e=1000/K}if(g>F){n=q=0;log.write("======= user scrolled to end of page =======================");if(this.itemsRequested){this.prefetchSpinner=true;application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:this.numColumns})}}log.write("this.currentTopLeft: "+this.currentTopLeft+" finalIndex: "+f+" pos: "+k+" topLeft: "+C+" start: "+j+" end: "+g+" items.length: "+v.length);if(!this._data[g+$cn.data.PAGE_PRE_FETCH]){log.write("===== Getting ready to make pre fetch page call (itemsRequested="+this.itemsRequested+") ========");if(this.currentPage<this.totalPages){if(!this.itemsRequested){this.currentPage++;this.itemsRequested=true;log.write("before method. currentPage = "+this.currentPage+", items = "+this._data.length);this.loadPage(this.currentPage)}}else{log.write("pre-fetch call not made. currentPage:"+this.currentPage+" is >= totalPages:"+this.totalPages)}}log.write("Rendering items "+j+" to "+g);D=[];if(j<=g){B=0;for(p=j;p<=g;p++){if(this._data[p]){this._data[p].titleidx=p;this.tpl.append(this._data[p]);if(!L){if(this._data[p+(n*r)]){D[B]=new Image();D[B].src="http://cache.cinemanow.com/images/boxart/v2_107/"+this._data[p+(n*r)].boxartPrefix+"v2_107.jpg";B++}}}}this.tpl.apply();$$("#titlelist .title img").each(function(P){P.onerror=function(Q){log.write("IMAGE ERROR");P.hide()}});if(typeof $cn.config.CustomDefaultGridImage=="function"){$$("#titlelist .title .title-text").each(function(Q){var P=$cn.config.CustomDefaultGridImage(Q);Q.addClass(P)})}v=J.getChildren()}D=null;A={};for(G=0;G<(r*n);G++){if(G<v.length){A[G]={"margin-top":-(this.rowHeight*n)}}}if(device.getDeviceSoc()!="BCOM"){application.TempKeyBlockEnter=true;application.TempKeyBlockDuration=K*2;m=new Fx.Elements(v,{duration:(L)?0:K,fps:e,transition:h,onComplete:function(P){application.TempKeyBlockEnter=false;application.currentView.layoutIsDirty=true;this.hault=0;for(G=0;G<v.length;G++){if(v[G].style.marginTop&&parseInt(v[G].style.marginTop.replace("px",""))<0){v[G].destroy()}}log.write("Deleted overflow titles.");this.config.numStartIndex=C}.bind(this)});m.start(A)}else{for(var p=0;p<v.length;++p){v[p].setStyles(A[p])}application.currentView.layoutIsDirty=true;this.hault=0;for(G=0;G<v.length;G++){if(v[G].style.marginTop&&parseInt(v[G].style.marginTop.replace("px",""))<0){v[G].destroy()}}log.write("Deleted overflow titles.");this.config.numStartIndex=C}if(!application.element.current){application.element.current="app-gen-0"}var d=parseInt($(application.element.current).get("titleidx"),10);if(d+1+r>=this.totalRecords-r){log.write("*********** bottom of page *****************");k=BrowseView.ScrollBar.range}BrowseView.ScrollBar.setPosition(k);m=null}}}J=null;N=null}},navigate:function(m){if(this.isActive){if(this.prefetchSpinner){m.preventDefault();return}this.lastNavigationDirection=m.args[0].direction;if(m.args[0].direction=="up"||m.args[0].direction=="down"){m.preventDefault();log.write("hault: "+this.hault);if(this.hault!=1){var n=false,g=$("titlelist"),j=g.getChildren(),k=m.args[0].direction,h=parseInt($(application.element.current).get("titleidx"),10),f=h+(k=="up"?-this.config.numCols:this.config.numCols);if(f>=this.totalRecords){if(Math.floor((this.totalRecords-1)/this.config.numCols)>Math.floor(h/this.config.numCols)){f=this.totalRecords-1}}this.nextIndexTitle=f;if(f>=0&&f<this.totalRecords){this.currentTopLeft=parseInt(j[0].getElements("a")[0].get("titleidx"));if(f<this.currentTopLeft){if(this.prefetchSpinner){n=true}else{this.movegrid("up",1)}}else{if((f>=this.currentTopLeft+this.config.numDisplay)){if(this.prefetchSpinner){n=true}else{this.movegrid("down",1)}}else{var p=j[f-this.currentTopLeft];if(!p){return}if((p.getPosition().y+p.getSize().y)>$("titlemeta").getPosition().y){this.movegrid("down",1)}}}if(!n){var q=g.getElement("a[titleidx='"+f+"']");if(q){navigation.setFocus(q,true)}}}}}else{if(m.args[0].direction=="left"){if(this.itemidx%this.config.numCols==0){if(this.returnFocus){navigation.setFocus(this.returnFocus,true);m.preventDefault()}}else{f=this.itemidx-1;navigation.setFocusElement($("titlelist").getElement("a[titleidx='"+f+"']"),true);m.preventDefault()}}else{if(m.args[0].direction=="right"){m.preventDefault();if(this.itemidx%this.config.numCols==this.config.numCols-1||this.itemidx==this.totalRecords-1){if(document.getElementById("scrollbar")&&document.getElementById("scrollbar").style.display=="block"){navigation.setFocus(BrowseView.ScrollBar.thumb,true)}}else{f=this.itemidx+1;var d=$("titlelist").getElement("a[titleidx='"+f+"']");if(d){navigation.setFocusElement($("titlelist").getElement("a[titleidx='"+f+"']"),true)}}}}}}else{if((application.element.current&&application.element.current!="")&&document.getElementById(application.element.current)&&application.element.current==BrowseView.ScrollBar.thumb){if(m.args[0].direction=="left"&&$("titlelist").getSize().y){if(this.hault==0){var e=$("titlelist").getElementsByTagName("a");var l=Math.min(e.length-1,this.config.numCols-1);if(e.length>l){application.navigator.setFocusElement(e[l],true);m.preventDefault()}}else{m.preventDefault()}}}}},onSaveState:function(e){var d=e.args[0];d[this.id]={_data:this._data,tpl:this.tpl,isActive:this.isActive,rowHeight:this.rowHeight,returnFocus:this.returnFocus,hault:0,currentPage:this.currentPage,totalRecords:this.totalRecords,totalPages:this.totalPages,itemidx:this.itemidx,genreid:this.genreid,config:$extend({},this.config),showFade:this.showFade,itemsRequested:this.itemsRequested};this.itemsRequested=false},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id]);this.config=$extend({},d[this.id].config);if(this.itemsRequested){this.loadPage(this.currentPage)}},onHandleError:function(d){if(this.itemsRequested){this.currentPage--;this.itemsRequested=false}}},GridControl=new Class(GridControlProperties);var ModalControlProperties={id:"modalcontrol",persist:{},controls:{},buttons:[],layoutIsDirty:true,_data:[],tpl:null,scroll:false,lastFocus:null,firstFocus:null,contentControlId:"",isNowVisible:false,contentId:"ModalContent",initialize:function(e,d){this.id=e;if(d){this.contentId=d}this.tpl=new ui.template(this.contentId,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile()},setCssClass:function(d){$("modalcontrol").erase("class");$("modalcontrol").addClass(d);if(d!=this.id){$("modalcontrol").addClass(this.id)}},init:function(e,d){log.write("modalcontrol.init()");this.hide();if(e){this.persist=e}},cleanUI:function(){},loadData:function(d){log.write("loadData modal.js");this._data=[];this._data=d;this.draw()},draw:function(){log.write("draw modal.js");var d=this;this.cleanUI();this.tpl.empty();this._data.each(function(g){d.tpl.append(g)});var f=this.tpl.apply();if(!this.firstFocus){var e=$(this.contentId).getElement(".default");if(e){this.firstFocus=e.id}}},html:function(d){$(this.contentId).set("html",d)},resetFocus:function(){log.write("resetting modal focus");if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastFocus=application.element.current}},show:function(){this.isNowVisible=true;log.write("showing a modal");if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastFocus=application.element.current}if(this.firstFocus){if(pointer.isPointerModeActive()){pointer.lastFocusId=this.firstFocus;navigation.setFocus(null)}else{navigation.setFocus(this.firstFocus,true)}}this.setCssClass(this.id);var d=(application.resource.modalConfig[this.id])?application.resource.modalConfig[this.id]:(application.resource.modalConfig["default"]);for(style in d){$("ModalWindow").setStyle(style,d[style])}log.write("making modalcontrol visible");$("modalcontrol").show();application.events.subscribe(this,"back",this.onBack.bind(this))},hide:function(){this.isNowVisible=false;log.write("..... hiding modal .....");application.events.unsubscribe(this,"back");if(this.lastFocus){if(this.lastFocus==="playerctl"&&(!$("playerctl")||!$("playerctl").style||!$("playerctl").style.display||$("playerctl").style.display==="none")){log.write("modal title view set focus");BrowseView.TitleViewControl.setFocus()}else{log.write("modal title view nav focus");navigation.setFocus(this.lastFocus,true)}}else{navigation.setFocus("dock-home",true)}$("modalcontrol").hide();var d=document.getElementById("ModalWindow");d.removeAttribute("style")},onBack:function(d){if(d){d.preventDefault()}this.hide()},startPlay:function(e,f){log.write("start play");var d=this;var g=$cn.utilities.showLoadingModal(2000,"Loading Title...");$cn.methods.getPurchasedTitle(f,e,function(h){$cn.utilities.clearLoadingSpinner(g);log.write("Current Pass: "+f);if(!$cn.data.PassCache[f]){log.write("Adding pass to pass cache");$cn.data.PassCache[f]=h}var m=false,j="24";for(x=0;x<h.availableProducts.length;x++){if(h.availableProducts[x].purchaseType=="rent"){if($cn.utilities.getMeta("LicensesDelivered",h.metaValues)=="0"){m=true;j=h.availableProducts[x].rentalPeriod;break}}}if(m){log.write("---- rental pathway -----");var l=application.resource.checkout_messages.Rental_Warning;var k={Message:l.Message.replace("##name##",h.name),Content:l.Content.replace("##rentalperiod##",j).replace("##expirationmessage##",h.expirationMessage.replace("Expires","")),Close:"No",OK:"Yes",callback:function(n){if(n){d.hide();BrowseView.showPlay(e,f,0)}}};BrowseView.showMessage("message_okcancel",k)}else{log.write("---- not rental pathway -----");BrowseView.showPlay(e,f,0)}}.bind(this))}},ModalControl=new Class(ModalControlProperties);var TitleMetaWheelControl=new Class({Extends:WheelControl,Implements:WheelControl,id:"TitleMetaWheelControl",MetaData:[],handleWheelItemChange:function(f){log.write(f);if(f.context===ActiveWheel){var e=f.args[0];log.write("Title Wheel Item changed. Now fire custom method. "+f.args[0].wheelinstance);if(e.sourceid.indexOf("master")>-1){$("slavedatasource").getElements("div").destroy();f.context.loadSlaveDataSource(e.selectedvalue)}else{if(e.sourceid.indexOf("slave")>-1){log.write("The slave wheel item has changed. Update results.");var d=f.args[0].selectedvalue.split("|");this.loadSlaveGrid(d[0],d[1])}}}},loadSlaveGrid:function(l,g){var j=this.MetaData[l];switch(l){case"m_cast_bios":j.each(function(m){if(m.castID==g){BrowseView.LastGridProcess="bios";m.bio=m.bio.firstWithEllips(4500);application.events.publish("loadgrid",{grid:"biogrid",gridProcess:"bios",data:[m],columns:1})}});break;case"r_user_revs":case"r_critics":log.write(l+":"+g);j.each(function(n){if(n.reviewer==g){var m="reviewgrid";if(l=="r_user_revs"){m="userreviewgrid"}BrowseView.LastGridProcess="reviews";application.events.publish("loadgrid",{grid:"reviewgrid",gridProcess:"reviews",data:[n],columns:1,template:m})}});break;case"m_cast_crew":break;case"m_credits":var f=[],k=[],e,h;if(j){if(g=="0"){e="";j.castMetaValues.each(function(m){if(m&&m.keyName!=""&&m.keyValue!=""){e=e+"<p>"+m.keyName+" ("+m.keyValue+")</p>"}else{if(m&&m.keyName!=""){e=e+"<p>"+m.keyName+"</p>"}}});f.push({keyName:"Actors",keyValue:e});f.push({keyName:"",keyValue:"FBI Anti-piracy Warning: Unauthorized copying is punishable under Federal Law.<br />"});BrowseView.LastGridProcess="credits";application.events.publish("loadgrid",{grid:"creditsgrid",gridProcess:"credits",data:f,columns:1,template:"creditsgrid"})}else{e="";j.productionMetaValues.each(function(m){h=false;k.each(function(n){if(n.keyName==m.keyName){n.keyValue=n.keyValue+m.keyValue+"<br />";h=true}});if(!h){k.push({keyName:m.keyName,keyValue:m.keyValue+"<br />"})}});k.push({keyName:"",keyValue:"FBI Anti-piracy Warning: Unauthorized copying is punishable under Federal Law.<br />"});BrowseView.LastGridProcess="production";application.events.publish("loadgrid",{grid:"creditsgrid",gridProcess:"production",data:k,columns:1,template:"creditsgrid"})}}break;case"m_technical_details":if(j){var d=[];j.technicalDetailItems.each(function(m){if(m.videoRecordingFormat==g||m.name==g){d.push(m)}});if(d){BrowseView.LastGridProcess="tech";application.events.publish("loadgrid",{grid:"techgrid",gridProcess:"tech",data:d,columns:1,template:"techgrid"});if(!d[0]&&!d[0].audioFormat){$("audioTech").hide()}if(d[0].name=="UltraViolet"){$("uv-technical-details").removeClass("hidden");if(d[0].streaming){$("tech-streaming").show()}if(d[0].downloads){$("tech-downloads").show()}}else{$("videoTech").removeClass("hidden");$("audioTech").removeClass("hidden")}}}break;default:break}},isSpecialAudio:function(d){var e="hidden";log.write(d);$cn.config.HackedDtsTitles.each(function(f){if(BrowseView.CurrentTitleID==f&&d=="1080p"){e="visible"}});return e},loadSlaveDataSource:function(f){log.write("masterKey: "+f);var m=this;var d=false;if(this._slaveSource[this._masterSource[f]]){this._renderWheel($("slavedatasource"),this._slaveSource[f])}else{var l=(f.indexOf("s_")==0),h=(f.indexOf("r_")==0),j=(f.indexOf("m_")==0),g=null,k;if(l){log.write('Load Similar sub-sections. Right now only option is "ALL"');if(f.indexOf("s_")==0){application.events.publish("gridloading",{grid:"titlegrid",message:"loadinggeneric",cssClass:"meta"});$cn.methods.getBrowseListBySimilar(f,BrowseView.CurrentTitleID,1,0,function(n){m._slaveSource[f]=[];m._slaveSource[f].push({name:"All",iD:"All",parentID:0});d=true;m.loadSlave(f,g);BrowseView.LastGridProcess="similarAll";application.events.publish("loadgrid",{grid:"titlegrid",gridProcess:"similarAll",data:n,columns:2})})}d=true}else{if(h){var e="Undefined";if(f.indexOf("critics")>0){e="CritictsReview"}else{if(f.indexOf("user")>0){e="UserReview"}}application.events.publish("gridloading",{grid:"reviewgrid"});$cn.methods.getReviews(BrowseView.CurrentTitleID,e,function(r){m.MetaData[f]=r.reviews;m._slaveSource[f]=[];r.reviews.each(function(s){m._slaveSource[f].push({name:m.split(s.reviewer),iD:f+"|"+s.reviewer,parentID:0});d=true});var q,p;for(q=0;q<m._slaveSource[f].length;q++){for(p=0;p<m._slaveSource[f].length;p++){if(m._slaveSource[f][q].name.toLowerCase()<m._slaveSource[f][p].name.toLowerCase()){var n=m._slaveSource[f][q];m._slaveSource[f][q]=m._slaveSource[f][p];m._slaveSource[f][p]=n}}}if(r.reviews.length>0){g=r.reviews[0].reviewer}else{d=true}m.loadSlave(f,g)})}else{if(j){switch(f){case"m_cast_bios":application.events.publish("gridloading",{grid:"biogrid"});$cn.methods.getCastBios(BrowseView.CurrentTitleID,function(n){m.MetaData[f]=n.castMembers;m._slaveSource[f]=[];n.castMembers.each(function(p){m._slaveSource[f].push({name:m.split(p.name),subtext:p.role,iD:f+"|"+p.castID,parentID:0});d=true});if(n.castMembers.length>0){g=n.castMembers[0].castID}m.loadSlave(f,g)});break;case"m_images":application.events.publish("gridloading",{grid:"titlegrid",message:"loadinggeneric"});$cn.methods.getImages(BrowseView.CurrentTitleID,function(n){m.MetaData[f]=[];k=0;n.images.each(function(p){m.MetaData[f].push({imageURL:p.imageURL,idx:k});k++});m._slaveSource[f]=[];m._slaveSource[f].push({name:"All",iD:"All",parentID:0});d=true;m.loadSlave(f,g);BrowseView.loadImagePopup(n.images);BrowseView.LastGridProcess="images";application.events.publish("loadgrid",{grid:"imagegrid",gridProcess:"images",data:m.MetaData[f],columns:1})});break;case"m_cast_crew":$cn.methods.getCastAndCrew(BrowseView.CurrentTitleID,function(n){m.MetaData[f]=n.castMembers;m._slaveSource[f]=[];n.castMembers.each(function(p){m._slaveSource[f].push({name:p.name,subtext:p.role,iD:f+"|"+p.castID,parentID:0})});m.loadSlave(f,g)});break;case"m_credits":application.events.publish("gridloading",{grid:"creditsgrid"});$cn.methods.getCredits(BrowseView.CurrentTitleID,function(p){var n=-1;m.MetaData[f]=p;m._slaveSource[f]=[];if(p.castMetaValues.length>0){m._slaveSource[f].push({name:"Cast",iD:f+"|0",parentID:0});n=0}if(p.productionMetaValues.length>0){m._slaveSource[f].push({name:"Production",iD:f+"|1",parentID:0});n=(n==-1)?1:0}m.loadSlave(f,g);m.loadSlaveGrid("m_credits",n)});break;case"m_technical_details":application.events.publish("gridloading",{grid:"techgrid"});$cn.methods.getTechnicalDetails(BrowseView.CurrentTitleID,function(n){m._slaveSource[f]=[];m.MetaData[f]=n;n.technicalDetailItems.each(function(p){if(p.name=="UltraViolet"){if($cn.config.EnableUV===true){m._slaveSource[f].push({name:p.name.replace(" ","<br />"),iD:f+"|"+p.name,parentID:0})}else{}}else{m._slaveSource[f].push({name:p.name.replace(" ","<br />"),iD:f+"|"+p.videoRecordingFormat,parentID:0})}});m.loadSlave(f,g);m.loadSlaveGrid("m_technical_details",n.technicalDetailItems[0].videoRecordingFormat)});break;default:break}}}}}},loadSlave:function(e,d){this._renderWheel($("slavedatasource"),this._slaveSource[e]);if(d){this.loadSlaveGrid(e,d)}else{log.write("error: there are no slave wheel items for this content");BrowseView.LastGridProcess="emptylist";application.events.publish("loadgrid",{grid:"reviewgrid",gridProcess:"emptylist",data:[],columns:1,template:"reviewgrid"})}},loadData:function(f,g){var e=this;var d="";this.layoutIsDirty=true;this.saveHistory();this.cleanUI();this._masterSource=[];this._slaveSource=[];log.write("Current Title:");log.write(g);log.write("Current Collection");log.write(f);if(!$cn.data.baselineEnable){f.erase("m_credits");f.erase("m_cast_bios");f.erase("m_cast_crew")}if(!$cn.data.flixsterEnable){f.erase("r_critics");f.erase("r_user_revs");f.erase("m_technical_details")}if(!configuration.readValue("EnableTechnicalDetailsWheelOption")){f.erase("m_technical_details")}f.each(function(h){if(d==""){d=h}if(h.indexOf("s_")==0){e._masterSource[e._masterSource.length]={name:application.resource.td_similar[h],iD:h,parentID:0};e._slaveSource[h]=[];e._slaveSource[h].push({name:"All",iD:"all",parentID:h})}if(h.indexOf("m_")==0){e._masterSource[e._masterSource.length]={name:application.resource.td_moreinfo[h],iD:h,parentID:0}}if(h.indexOf("r_")==0){e._masterSource[e._masterSource.length]={name:application.resource.td_reviews[h],iD:h,parentID:0}}});if(this._masterSource.length>0){this._renderWheel($("masterdatasource"),this._masterSource);this.loadSlaveDataSource(d)}},navigate:function(e){var d=e.args[0];if(e.context===ActiveWheel){if((d.current=="selectedmaster")){if(d.direction=="left"){e.preventDefault();BrowseView.expandTitleDetails();BrowseView.TitleViewControl.enableButtons();navigation.setFocus("tdbuttonMoreInfo",true)}else{if(d.direction=="right"&&(this.isNavigating||!BrowseView.CurrentProcessLoaded)){e.preventDefault()}else{this.parent(e)}}}else{if(d.current=="selectedslave"){if(d.direction=="right"&&$("imagegrid").getStyle("display")=="block"){navigation.setFocus($("imagegrid").getElement("a").id,true)}else{this.parent(e)}}else{this.parent(e)}}}}});var GiftCardPanelControl=new Class({Extends:ModalControl,id:"giftcard",layoutIsDirty:true,isValid:false,tpl:null,sku:"",keyboard:null,isPurchasePath:false,initialize:function(){log.write("giftcard.init()");this.parent("giftcard")},show:function(d,f){$("ModalWindow").setAttribute("style","");var e=(d)?application.resource.gift_card_poup_heading_purchase_path:application.resource.gift_card_poup_heading;this.parent();this.loadData([{buttonTxt:"Cancel",headingTxt:e}]);BrowseView.GiftCardKeyboard.show();this.sku=(d)?f:0;this.isValid=false;this.isPurchasePath=d;application.events.subscribe(this,"back",this.handleBack.bind(this));application.events.subscribe(this,"navigate",this.handleNavigate.bind(this))},hide:function(){this.isValid=false;this.parent();application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"navigate")},apply:function(){if(this.isValid){$cn.data.CurrentPromotion=this.keyboard.value.trim()}},handleBack:function(d){d.preventDefault();application.currentView.GiftCardKeyboard.hide();this.hide()},handleNavigate:function(d){if(d.args[0].direction=="right"&&(application.element.current=="")){}},redeem:function(){$("giftcodeerror").innerHTML="";var d=this,f=null;this.isValid=false;this.isProcessing=true;var e=this.keyboard.value.trim();if(!e.length){this.isProcessing=false;$("giftcodeerror").innerHTML="Invalid code.";return}if(this.isPurchasePath){f=$cn.utilities.showLoadingModal(2000,"Redeem Gift Code...");$cn.methods.verifyCode(this.sku,e,function(g){$cn.utilities.clearLoadingSpinner(f);d.isProcessing=false;if($("giftcodeerror")==null){BrowseView.GiftCardPanel.show(true,d.sku);navigation.setFocus("gcredeem",true)}if(g.responseCode==0){d.isValid=true;d.keyboard.clear();if(g.discountType=="GiftCertificate"){$("giftcodetotal").innerHTML="-"+application.resource.currency_symbol+$cn.utilities.formatAsMoney(g.giftCertificateBalance);$("giftcodesredeemed").show();application.events.publish("redeemed",{giftCertificate:g.giftCertificateBalance})}else{if(g.discountType=="Coupon"){$("coupontotal").innerHTML="-"+application.resource.currency_symbol+$cn.utilities.formatAsMoney(g.discountAmount);$("couponseredeemed").show();application.events.publish("redeemed",{coupon:e,amount:g.discountAmount})}}}else{var h="Invalid code.";switch(g.responseCode){case 36:h="Coupon code already used.";break;case 37:h="Code already used.";break;default:break}d.keyboard.clear();$("giftcodeerror").innerHTML=h}})}else{f=$cn.utilities.showLoadingModal(2000,"Redeem Gift Code...");$cn.methods.applyGiftCode(e,function(g){$cn.utilities.clearLoadingSpinner(f);d.isProcessing=false;if($("giftcodeerror")==null){BrowseView.GiftCardPanel.show(false);navigation.setFocus("gcredeem",true)}if(g.responseCode==0){d.isValid=true;d.keyboard.clear();$("giftcodetotal").innerHTML="-"+application.resource.currency_symbol+$cn.utilities.formatAsMoney(g.giftCertificateBalance);$("giftcodesredeemed").show()}else{var h="Invalid code.";switch(g.responseCode){case 36:h="Code already used.";break;case 37:h="Code already used.";break;default:break}d.keyboard.clear();$("giftcodeerror").innerHTML=h}})}}});var ScrollBarProperties={id:"scrollbar",onScroll:null,range:0,position:0,tpl:null,thumb:null,isBusy:false,initialize:function(e,d){this.id=e;this.tpl=new ui.template(this.id,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile();this.tpl.append();this.tpl.apply();this.thumb=$(this.id).getElement(".scrollthumb").id;application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));application.events.subscribe(this,"pointerdeactivated",this.resetFocus.bind(this));if(!d){this.subscribePointmousedown()}else{this.unsubscribePointmousedown()}},activate:function(d){log.write("ScrollBar.activate is deprecated")},deactivate:function(){this.hide()},destroy:function(){application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"savestate");application.events.unsubscribe(this,"restorestate");application.events.unsubscribe(this,"pointermousedown",this.verticalDrag.bind(this))},hide:function(){$(this.id).hide()},draw:function(){if(this.range==0){return}var f=$(this.id);if(f){var e=$(this.thumb);var d=(this.range>0?this.position/this.range:0);var h=e.getSize().y;var g=this.arrow;if(g){g.addClass("hover");this.arrow=null}e.setStyles({"margin-top":(f.getElement(".scrollarea").clientHeight-h)*d});if(g){g.removeClass("hover")}}},getPosition:function(){return this.position},setPosition:function(d){d=Math.min(this.range,Math.max(0,d));if(d!=this.position){this.position=d;this.draw()}},setRange:function(d){if(d!=this.range){this.range=d;if(this.position>this.range){this.position=this.range}if(this.range>0){this.draw()}}if(this.range>0){$(this.id).show()}else{this.hide()}this.initScrollBarParam()},getThumb:function(){return this.thumb},setThumbPosition:function(d){d=Math.min(this.range,Math.max(0,d));if(d!=this.position){this.position=d}},initScrollBarParam:function(){var f=$(this.id);if(f){var d=$(this.thumb);var e=f.getElement(".scrollarea").clientHeight;var g=Math.min(e/3*2,Math.max(30,e/this.range));d.setStyle("height",g);this.rangeSize=e-g;this.pageSize=this.rangeSize/this.range}},subscribePointmousedown:function(){application.events.subscribe(this,"pointermousedown",this.verticalDrag.bind(this))},unsubscribePointmousedown:function(){application.events.unsubscribe(this,"pointermousedown")},loadData:function(e,d){this._data.scrollID="scrollbarID";this.draw()},navigate:function(d){if((application.element.current&&application.element.current!="")&&document.getElementById(application.element.current)&&application.element.current==this.thumb){if(d.args[0].direction=="down"||d.args[0].direction=="up"){this.arrow=$(this.id).getElement(d.args[0].direction=="down"?".scrollbottom":".scrolltop");if(this.onScroll!=null){this.onScroll(d.args[0].direction,this)}else{application.events.publish("scroll",{direction:d.args[0].direction,scrollbar:this})}d.preventDefault()}}},onViewChanged:function(d){this.currentView=d.args[0]},onSaveState:function(e){var d=e.args[0];d[this.id]={position:this.position,range:this.range}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id])},setScrollBarFocus:function(e,d){navigation.setFocusElement($(e));if(d){pointer.lastFocusId="LegalThumb"}else{pointer.lastFocusId="app-gen-0"}},resetFocus:function(){if(pointer.lastFocusId=="scrolltop"||pointer.lastFocusId=="scrollbottom"){navigation.setFocus("app-gen-0")}},verticalDrag:function(){this.initScrollBarParam();this.setScrollBarFocus("app-gen-0");var d=arguments[0].args[0].clientY;var f=arguments[0].args[0].clientY;var e=$(this.getThumb());var g=d-parseFloat(e.getStyle("margin-top"));pointer.ignorePointerEvents(true);$(document).addEvent("mousemove",function(j){var h=Math.min(Math.max(0,(j.page.y-g)),this.rangeSize);e.setStyles({"margin-top":h})}.bind(this));$(document).addEvent("mouseup",function(m){this.setScrollBarFocus("app-gen-0");var p=m.page.y-f;var k;if(p>0){k="down"}else{k="up"}var n=Math.round(p/this.pageSize);var l=this.getPosition()+n;var q=false;if(p>0&&l>=this.range){q=true}else{if(p<0&&l<=0){q=true}}this.deviation=p-n*this.pageSize;var h=parseFloat($(this.getThumb()).getStyle("margin-top"));if(q){if(p>0&&h-Math.floor(this.rangeSize)<0){q=false}else{if(p<0&&h>0){q=false}}}log.write("^^^^^^^^^^^^^^this.pageSize  "+this.pageSize);log.write("^^^^^^^^^^^^^^  oldPosition before move "+this.getPosition());log.write("^^^^^^^^^^^^^^  slidePageNumber before move "+n);if(n!=0){application.events.publish("scroll",{direction:k,rows:n,scrollbar:this,isDrag:true})}var j=h-(q?0:this.deviation);j=Math.min(Math.max(0,j),this.rangeSize);$(this.getThumb()).setStyles({"margin-top":j});log.write("^^^^^^^^^^^^^^  oldPosition after move"+this.getPosition());this.setThumbPosition(l);log.write("^^^^^^^^^^^^^^  newPosition "+l);$(document).removeEvents("mousemove");$(document).removeEvents("mouseup");pointer.ignorePointerEvents(false)}.bind(this))}},ScrollBar=new Class(ScrollBarProperties);var ScrollViewProperties={id:"scrollview",content:null,pageHeight:0,scrollbar:null,onScroll:null,initialize:function(d){this.content=d.getChildren()[0].getChildren()[0];this.scrollbar=new ScrollBar(d.getElement(".scrollbar").id,true);this.scrollbar.onScroll=this.onScroll.bind(this);application.events.subscribe(this,"scroll",this.scroll.bind(this));BrowseView.ScrollBar.unsubscribePointmousedown();application.events.subscribe(this,"pointermousedown",this.verticalDrag.bind(this));application.events.subscribe(this,"pointerdeactivated",this.resetFocus.bind(this))},destroy:function(){BrowseView.ScrollBar.subscribePointmousedown();this.scrollbar.destroy();application.events.unsubscribe(this,"scroll");application.events.unsubscribe(this,"pointermousedown");application.events.unsubscribe(this,"pointerdeactivated");$(this.scrollbar.getThumb()).removeEvents("mousedown");$(document).removeEvents("mousemove");$(document).removeEvents("mouseup")},draw:function(){var d=this.content.attributes.pageHeight;this.pageHeight=d==null?this.content.getParent().clientHeight:d.value.toInt();log.write("scroll amount: "+this.pageHeight);var f=this.content.getDimensions().y;this.scrollbar.setPosition(0);var e=Math.ceil(f/this.pageHeight)-1;this.scrollbar.setRange(e);if(e<2){this.scrollbar.hide()}},onScroll:function(f,g){if(this.content){var d=g.getPosition()+(f=="down"?1:-1);d=Math.min(Math.max(0,d),g.range);if(d!=g.getPosition()){var e=-d*this.pageHeight;this.content.setStyle("margin-top",e);g.setPosition(d)}}},scroll:function(g){if(this.content){totalheight=this.content.clientHeight;var f=g.args[0].direction;scrollbar=this.scrollbar;var d=scrollbar.getPosition()+(f=="down"?1:-1);d=Math.min(Math.max(0,d),scrollbar.range);if(d!=scrollbar.getPosition()){var e=-d*this.pageHeight;this.content.setStyle("margin-top",e);scrollbar.setPosition(d)}}},setScrollBarFocus:function(d){navigation.setFocusElement($(d));pointer.lastFocusId="LegalThumb"},resetFocus:function(){if(pointer.lastFocusId=="legalscrolltop"||pointer.lastFocusId=="legalscrollbottom"){navigation.setFocus("LegalThumb",true)}},verticalDrag:function(f){var d=f.args[0]||window.event;this.startY=d.clientY;this.contentStartY=d.clientY;this.setScrollBarFocus("LegalThumb");pointer.ignorePointerEvents(true);$(document).addEvent("mousemove",function(g){log.write("startYb"+this.startY);var h=g.page.y-this.startY;this.startY=g.page.y;log.write("startYa"+this.startY);var e=parseFloat($(this.scrollbar.getThumb()).getStyle("margin-top"));this.newTop=Math.min(Math.max(0,e+h),this.scrollbar.rangeSize);$(this.scrollbar.getThumb()).setStyles({"margin-top":this.newTop})}.bind(this));$(document).addEvent("mouseup",function(g){this.setScrollBarFocus("LegalThumb");var k=g.page.y-this.contentStartY;var e=Math.round(k/this.scrollbar.pageSize);var h=this.scrollbar.getPosition()+e;var j=false;if(k>0&&h>=this.scrollbar.range){j=true}else{if(k<0&&h<=0){j=true}}h=Math.min(Math.max(0,h),this.scrollbar.range);var n=-h*this.pageHeight;var l=new Fx.Morph(this.content,{duration:"short",transition:Fx.Transitions.Sine.easeOut});l.start({"margin-top":n});this.scrollbar.setThumbPosition(h);this.deviation=k-e*this.scrollbar.pageSize;var p=parseFloat($(this.scrollbar.getThumb()).getStyle("margin-top"));if(j){if(k>0&&p-Math.floor(this.scrollbar.rangeSize)<0){j=false}else{if(k<0&&p>0){j=false}}}var m=p-(j?0:this.deviation);m=Math.min(Math.max(0,m),this.scrollbar.rangeSize);$(this.scrollbar.getThumb()).setStyles({"margin-top":m});$(document).removeEvents("mousemove");$(document).removeEvents("mouseup");pointer.ignorePointerEvents(false)}.bind(this))}},ScrollView=new Class(ScrollViewProperties);var SearchWheelControl=new Class({Extends:WheelControl,id:"SearchWheelControl",container:"singlewheel",singleWheel:true,MetaData:[],masterSourceElement:"singlemasterdatasource",masterSelectedElement:"singleselectedmaster",cleanUI:function(){$("singlewheel").show();if($("singleselectedmaster")){$("singleselectedmaster").label=""}if($("singlemasterdatasource")){if($("singlemasterdatasource").getChildren().length>0){$("singlemasterdatasource").getChildren().destroy()}}},handleWheelItemChange:function(e){log.write(e);if(e.context===ActiveWheel){var d=e.args[0];log.write("Search Wheel Item changed. Now fire custom method. "+e.args[0].wheelinstance);application.events.publish("searchwheelchanged",{selectedvalue:d.selectedvalue})}},loadSearchMenu:function(){this.layoutIsDirty=true;this.cleanUI();var d=[];d.push({name:"Title",iD:"Title",parentID:0,list:0});if($cn.data.baselineEnable){d.push({name:"Actor",iD:"Actor",parentID:0,list:1});d.push({name:"Director",iD:"Director",parentID:0,list:1});d.push({name:"Writer",iD:"Writer",parentID:0,list:1})}d.push({name:"Keyword",iD:"Keyword",parentID:0,list:0});this.loadData(d,[{}])},navigate:function(d){if(d.context===ActiveWheel){if(document.getElementById(application.element.current)&&application.element.current=="singleselectedmaster"){if(d.args[0].direction=="left"){d.preventDefault();application.navigator.setFocus("dock-search",true)}else{if(d.args[0].direction=="right"){d.preventDefault();if($("FirstKey").style.display!="none"){application.navigator.setFocus("FirstKey",true)}else{application.navigator.setFocus("KeyboardKey1",true)}}else{this.parent(d)}}}}}});var KeyboardControl=new Class({id:"keyboard",persist:{},controls:{},layoutIsDirty:true,swappedState:"standard",tpl:null,_currentValue:"",initialize:function(){application.element.registerControl(this);application.events.subscribe(this,"keyboardback",this.keyback.bind(this));application.events.subscribe(this,"keyboardclear",this.keyclear.bind(this));application.events.subscribe(this,"keyboardselect",this.keyselect.bind(this));application.events.subscribe(this,"keyboardswap",this.keyboardswap.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this))},init:function(f,e){log.write("searchkeyboard.init()");var d=this;if(f){this.persist=f}},cleanUI:function(){},loadData:function(d){this.persist.title=d;this.draw()},draw:function(){this.cleanUI()},keyback:function(d){this._currentValue=this._currentValue.substring(0,this._currentValue.length-1);this.valuechange(d)},keyclear:function(d){this._currentValue="";$("SearchText").set("html","_");this.valuechange(d)},keyselect:function(d){log.write("keyboard select:"+d.args[0].value);log.write(d);if(this._currentValue.length<11){this._currentValue+=d.args[0].value}this.valuechange(d)},valuechange:function(d){if(d&&d.args[0].caller==this.id){if(this._currentValue.length<11){$("SearchText").set("html",this._currentValue+"_")}else{$("SearchText").set("html",this._currentValue)}this.handlechange();application.events.publish("keyboardvaluechanged",{currentValue:this._currentValue})}},handlechange:function(){},keyboardswap:function(d){log.write("keyboard swap");switch(d.args[0].value){case"alt":log.write($$("a.standard").each(function(e){e.hide()}));log.write($$("a.alt").each(function(e){e.show()}));navigation.setFocus("KeyboardStandardSwap",true);this.swappedState="alt";break;default:log.write($$("a.alt").each(function(e){e.hide()}));log.write($$("a.standard").each(function(e){e.show()}));navigation.setFocus("KeyboardAltSwap",true);this.swappedState="standard";break}application.currentView.layoutIsDirty=true;navigation.buildNavigation($("keyboard").getElements("a"))},show:function(){document.getElementById("keyboard").className=this.id;this._currentValue="";this.swappedState="standard";application.currentView.layoutIsDirty=true;navigation.buildNavigation($("keyboard").getElements("a"));$("keyboard").show()},hide:function(){document.getElementById("keyboard").className="";$("keyboard").hide()},onSaveState:function(e){var d=e.args[0];d[this.id]={_currentValue:this._currentValue,swappedState:this.swappedState}},onRestoreState:function(e){var d=e.args[0];$extend(this,d[this.id])}});var SearchKeyboardControl=new Class({Extends:KeyboardControl,id:"searchkeyboardcontrol",isActive:false,_currentCategory:"",_refined:false,_hault:0,_state:null,initialize:function(){this.parent();application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"keydown",this.handleKeyPress.bind(this));application.events.subscribe(this,"elementblur",this.gridBlur.bind(this));application.events.subscribe(this,"elementfocus",this.keyboardFocus.bind(this));application.events.subscribe(this,"refineselection",this.refineSelection.bind(this));application.events.subscribe(this,"searchwheelchanged",this.setcategory.bind(this))},keyboardFocus:function(d){if(document.getElementById(d.args[0].focusedelem)){if(document.getElementById(d.args[0].focusedelem).className.indexOf("key")>-1){if($("keyboard").isParentOf($(d.args[0].focusedelem))){log.write("keyboardfocus");this.isActive=true;this._hault=0;$("searchPanelMask").setStyle("visibility","hidden");if(this._refined){this._refined=false;application.state.previous();navigation.setFocus(d.args[0].focusedelem,true)}}}}},unsubEvents:function(){application.events.unsubscribe(this,"keydown");application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"elementblur");application.events.unsubscribe(this,"elementfocus");application.events.unsubscribe(this,"refineselection")},keyselect:function(d){log.write("keyboard select:"+d.args[0].value);log.write(d);this._currentValue+=d.args[0].value;this.valuechange(d)},valuechange:function(e){if(e&&e.args[0].caller==this.id){if(this._currentValue==""){this.shiftReset()}var d=this._currentValue;d=d.replace(/ /g,"&nbsp;");$("SearchText").set("html",d+"_");this.shiftLeft();this.handlechange()}},shiftLeft:function(){var h=parseInt($("SearchText").clientWidth),f=parseInt($("SearchTextWrap").getComputedSize().width),g=parseInt($("SearchText").getStyle("margin-left")),d,e;if(h>f){if(g==""){g=0}d=this.lastTextwidth-h;d=parseInt(d)+g;if(h+g>(f)+12){log.write("Out of search window - fixing");d=f-h-5}e=new Fx.Morph($("SearchText"),{duration:300,transition:Fx.Transitions.Sine.easeOut});e.start({"margin-left":d+"px"})}else{this.shiftReset()}this.lastTextwidth=parseInt($("SearchText").clientWidth)},shiftReset:function(){$("SearchText").setStyle("margin-left","0")},handleKeyPress:function(d){if(this.isActive){switch(d.args[0].event.keyCode){case application.keys.KEY_1:if(document.getElementById("KeyboardKey1").style.display=="block"){application.navigator.setFocus("KeyboardKey1",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"1"});break;case application.keys.KEY_2:if(document.getElementById("KeyboardKey2").style.display=="block"){application.navigator.setFocus("KeyboardKey2",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"2"});break;case application.keys.KEY_3:if(document.getElementById("KeyboardKey3").style.display=="block"){application.navigator.setFocus("KeyboardKey3",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"3"});break;case application.keys.KEY_4:if(document.getElementById("KeyboardKey4").style.display=="block"){application.navigator.setFocus("KeyboardKey4",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"4"});break;case application.keys.KEY_5:if(document.getElementById("KeyboardKey5").style.display=="block"){application.navigator.setFocus("KeyboardKey5",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"5"});break;case application.keys.KEY_6:if(document.getElementById("KeyboardKey6").style.display=="block"){application.navigator.setFocus("KeyboardKey6",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"6"});break;case application.keys.KEY_7:if(document.getElementById("KeyboardKey7").style.display=="block"){application.navigator.setFocus("KeyboardKey7",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"7"});break;case application.keys.KEY_8:if(document.getElementById("KeyboardKey8").style.display=="block"){application.navigator.setFocus("KeyboardKey8",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"8"});break;case application.keys.KEY_9:if(document.getElementById("KeyboardKey9").style.display=="block"){application.navigator.setFocus("KeyboardKey9",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"9"});break;case application.keys.KEY_0:if(document.getElementById("KeyboardKey0").style.display=="block"){application.navigator.setFocus("KeyboardKey0",true)}application.events.publish("keyboardselect",{caller:"searchkeyboardcontrol",value:"0"});break;default:break}}},gridBlur:function(d){this.isActive=false},handlechange:function(){this._refined=false;$("ScreenSeparator").addClass("minimized");$("ScreenSeparator").removeClass("searchkeyboardcontrol-arrow");$("ScreenSeparatorThumb").removeClass("wheel-thumb-left").show();var d=this._currentValue;if(this._currentValue.length>0){if(this._currentCategory=="Director"||this._currentCategory=="Actor"||this._currentCategory=="Writer"){application.events.publish("gridloading",{grid:"titlegrid",message:"searching",columns:1,className:"refinementgrid",cssClass:"searchList"});$cn.methods.getSearchPerson(this._currentValue,this._currentCategory,function(f){log.write(f.castMembers.length);if(this._currentValue==d||this._currentValue.length>0){BrowseView.LastGridProcess="search";if(f.castMembers.length>0){var e=false;if(f.castMembers.length>16){document.getElementById("HorizontalFade").className="personSearch";document.getElementById("HorizontalFadeTop").className="personSearch";$("HorizontalFade").show();e=true}else{$("HorizontalFade").hide();$("HorizontalFadeTop").hide();document.getElementById("HorizontalFade").className="";document.getElementById("HorizontalFadeTop").className=""}application.events.publish("loadgrid",{grid:"titlegrid",data:f.castMembers,columns:1,gridProcess:"search",template:"refinementgrid",className:"refinementgrid",showFade:e,returnFocus:"KeyboardKeyBACKTop"})}else{application.events.publish("loadgrid",{grid:"titlegrid",columns:1,template:"refinementgrid",gridProcess:"search",className:"refinementgrid",returnFocus:"KeyboardKeyBACKTop"})}}}.bind(this))}else{$("HorizontalFade").hide();$("HorizontalFadeTop").hide();document.getElementById("HorizontalFade").className="";document.getElementById("HorizontalFadeTop").className="";application.events.publish("gridloading",{grid:"titlegrid",message:"searching",columns:2,cssClass:"search",className:"searchgrid"});$cn.methods.getSearchTitle(this._currentValue,this._currentCategory,function(e){if(this._currentValue==d){BrowseView.LastGridProcess="search";if(e&&e.items.length>0){application.events.publish("loadgrid",{grid:"titlegrid",data:e.items,columns:2,gridProcess:"search",template:"searchtitlelist",className:"searchgrid",returnFocus:"KeyboardKeyBACKTop"})}else{application.events.publish("loadgrid",{grid:"titlegrid",columns:2,gridProcess:"search",template:"searchtitlelist",className:"searchgrid",returnFocus:"KeyboardKeyBACKTop"})}}else{if(this._currentValue.length<1){application.events.publish("loadgrid",{grid:"titlegrid",columns:2,gridProcess:"search",template:"searchtitlelist",className:"searchgrid",returnFocus:"KeyboardKeyBACKTop"})}}}.bind(this))}}else{if(this._currentValue.length==0&&(this._currentCategory=="Director"||this._currentCategory=="Actor"||this._currentCategory=="Writer")){BrowseView.LastGridProcess="search";application.events.publish("loadgrid",{grid:"titlegrid",columns:1,gridProcess:"search",template:"refinementgrid",className:"refinementgrid"})}else{if(this._currentValue.length==0){BrowseView.LastGridProcess="search";application.events.publish("loadgrid",{grid:"titlegrid",columns:2,gridProcess:"search",template:"searchtitlelist",className:"searchgrid"})}}}},setcategory:function(d){this._currentCategory=d.args[0].selectedvalue;this.keyclear();this.shiftReset();if(document.getElementById("KeyboardStandardSwap")&&document.getElementById("KeyboardStandardSwap").style.display!="none"){log.write($$("a.alt").each(function(e){e.hide()}));log.write($$("a.standard").each(function(e){e.show()}));this.swappedState="standard"}application.currentView.layoutIsDirty=true;navigation.buildNavigation($("keyboard").getElements("a"));this.handlechange()},getkeyword:function(){return this._currentCategory=="Keyword"?this._currentValue:null},show:function(){this.keyclear();this.shiftReset();this.parent();if(document.getElementById("KeyboardStandardSwap")&&document.getElementById("KeyboardStandardSwap").style.display!="none"){log.write($$("a.alt").each(function(d){d.hide()}));log.write($$("a.standard").each(function(d){d.show()}));this.swappedState="standard"}document.getElementById("ScreenSeparator").className=this.id+" minimized";document.getElementById("ScreenSeparatorThumb").className="minimized";if($cn.config.EnableSearchScreenSeparator){$("ScreenSeparator").show()}$("keyboard").show()},hide:function(){this.parent();document.getElementById("ScreenSeparator").className="";document.getElementById("ScreenSeparatorThumb").className="";document.getElementById("HorizontalFade").className="";document.getElementById("HorizontalFadeTop").className="";$("HorizontalFade").hide();$("HorizontalFadeTop").hide();$("ScreenSeparator").hide();$("keyboard").hide()},handleBack:function(d){d.preventDefault();this.unsubEvents();this.hide()},navigate:function(f){if(this.isActive&&f.args[0].direction=="right"){var e=$(application.element.current).get("rightaction");if(e&&e=="focusgrid"){var d=document.getElementById("titlelist").getElementsByTagName("a");if(d.length>0){f.preventDefault();application.navigator.setFocus(d[0].id,true)}}}},refineSelection:function(e){var d={preventDefault:function(){_defaultPrevented=true},args:[{}]};$("HorizontalFade").hide();$("HorizontalFadeTop").hide();BrowseView.GridControl.onSaveState(d);BrowseView.ScrollBar.onSaveState(d);this._state=d.args[0];application.state.save();application.events.publish("gridloading",{grid:"titlegrid",message:"loadinggeneric",className:"searchgrid"});BrowseView.LastGridProcess="search-refineSelection";$cn.methods.getBrowseListByCastRole(e.args[0].id,this._currentCategory,1,function(g){var f=g.data.result;application.events.publish("loadgrid",{grid:"titlegrid",data:f.items,gridProcess:"search-refineSelection",columns:2,template:"searchtitlelist",className:"searchgrid",returnFocus:"KeyboardKeyBACKTop"});if(f.items&&f.items.length>0){}else{navigation.setFocus("KeyboardKeyBACKTop",true)}if($("titlelist").getElement(".title")){navigation.setFocus($("titlelist").getElement(".title").getElement("a").id,true)}$("ScreenSeparator").removeClass("minimized");$("ScreenSeparator").addClass("searchkeyboardcontrol-arrow");$("ScreenSeparatorThumb").addClass("wheel-thumb-left").show();$("searchPanelMask").setStyle("visibility","visible");this._refined=true}.bind(this))},onSaveState:function(e){this.parent(e);var d=e.args[0];d[this.id]._currentCategory=this._currentCategory;d[this.id]._refined=this._refined},});var GiftCardKeyboardControl=new Class({Extends:KeyboardControl,id:"giftcardkeyboardcontrol",_currentCategory:"",_refined:false,_hault:0,value:"",initialize:function(){this.parent()},keyboardFocus:function(d){if(document.getElementById(d.args[0].focusedelem)){if($("skinnykeyboard").isParentOf($(d.args[0].focusedelem))){log.write("skinnykeyboardfocus");if(this._refined){this.handlechange()}}}},unsubEvents:function(){application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"keydown")},handleKeyPress:function(d){switch(d.args[0].event.keyCode){case application.keys.KEY_1:application.navigator.setFocus("Skinny1",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"1"});break;case application.keys.KEY_2:application.navigator.setFocus("Skinny2",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"2"});break;case application.keys.KEY_3:application.navigator.setFocus("Skinny3",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"3"});break;case application.keys.KEY_4:application.navigator.setFocus("Skinny4",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"4"});break;case application.keys.KEY_5:application.navigator.setFocus("Skinny5",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"5"});break;case application.keys.KEY_6:application.navigator.setFocus("Skinny6",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"6"});break;case application.keys.KEY_7:application.navigator.setFocus("Skinny7",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"7"});break;case application.keys.KEY_8:application.navigator.setFocus("Skinny8",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"8"});break;case application.keys.KEY_9:application.navigator.setFocus("Skinny9",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"9"});break;case application.keys.KEY_0:application.navigator.setFocus("Skinny0",true);application.events.publish("keyboardselect",{caller:"giftcardkeyboardcontrol",value:"0"});break;default:break}},valuechange:function(d){if(d&&d.args[0].caller==this.id){if(this._currentValue==""){this.shiftReset()}$("SkinnySearchText").set("html",this._currentValue+"_");this.shiftLeft();this.handlechange()}},shiftLeft:function(){var g=parseInt($("SkinnySearchText").clientWidth);var e=parseInt($("SkinnySearchTextWrap").clientWidth)-15;var f=$("SkinnySearchText").getStyle("margin-left");if(g>e){if(f==""){f=0}var d=new Fx.Morph($("SkinnySearchText"),{duration:300,transition:Fx.Transitions.Sine.easeOut});d.start({"margin-left":e-g+"px"})}else{this.shiftReset()}},shiftReset:function(){$("SkinnySearchText").setStyle("margin-left","0")},keyselect:function(d){if(!BrowseView.GiftCardPanel.isProcessing){log.write("keyboard select:"+d.args[0].value);log.write(d);this._currentValue+=d.args[0].value;this.valuechange(d)}},clear:function(){$("SkinnySearchText").set("html","_");this.value="";this.shiftReset();this._currentValue=""},handlechange:function(){this.value=this._currentValue},setcategory:function(d){this._currentCategory=d.args[0].selectedvalue;this.keyclear();this.handlechange()},show:function(){this._currentValue="";$("SkinnySearchText").set("html","_");document.getElementById("skinnykeyboard").className=this.id;log.write($$("a.standard").each(function(d){d.show()}));$("skinnykeyboard").show();navigation.buildNavigation($("skinnykeyboard").getElements("a"));application.events.subscribe(this,"back",this.handleBack.bind(this));application.events.subscribe(this,"keydown",this.handleKeyPress.bind(this))},handleBack:function(d){d.preventDefault();this.unsubEvents();this.hide()},hide:function(){document.getElementById("keyboard").className="";this.unsubEvents();$("skinnykeyboard").hide()}});var SettingsWheelControl=new Class({Extends:WheelControl,Implements:WheelControl,id:"SettingsWheelControl",initialize:function(d){this.parent()},loadSettingsMenu:function(f){var e=[];e.push({name:application.resource.SettingsWheelOptionStrings.General,iD:"General",parentID:0});if(application.resource.SettingsWheelOptionStrings.ClosedCaptions!=undefined){e.push({name:application.resource.SettingsWheelOptionStrings.ClosedCaptions,iD:"ClosedCaptions",parentID:0})}if($cn.data.AllowedAudioProfiles&&$cn.data.AllowedAudioProfiles.length>0){e.push({name:application.resource.SettingsWheelOptionStrings.Audio,iD:"Audio",parentID:0})}e.push({name:application.resource.SettingsWheelOptionStrings.Family,iD:"Family",parentID:0});if(application.debugMode){e.push({name:application.resource.SettingsWheelOptionStrings.Debug,iD:"Debug",parentID:0})}var g=[];g.push({name:application.resource.SettingsWheelOptionStrings.Activate,iD:"Activate",parentID:"General"});if($cn.config.EnableGiftCertificates){g.push({name:application.resource.SettingsWheelOptionStrings.GiftCards,iD:"GiftCards",parentID:"General"})}if($cn.config.EnableUV){g.push({name:application.resource.SettingsWheelOptionStrings.UV,iD:"UV",parentID:"General"})}g.push({name:application.resource.SettingsWheelOptionStrings.About,iD:"About",parentID:"General"});if($cn.config.EnableSystemStatus){g.push({name:application.resource.SettingsWheelOptionStrings.SystemStatus,iD:"SystemStatus",parentID:"General"})}var d={General:g,Audio:[{name:application.resource.SettingsWheelOptionStrings.Format,iD:"Format",parentID:"Audio"}],Family:[{name:application.resource.SettingsWheelOptionStrings.Parental,iD:"Parental",parentID:"Family"},{name:application.resource.SettingsWheelOptionStrings.RequirePIN,iD:"RequirePIN",parentID:"Family"}],Library:[{name:application.resource.SettingsWheelOptionStrings.RoxioNow,iD:"RoxioNow",parentID:"Library"}]};if(application.resource.SettingsWheelOptionStrings.ClosedCaptions!=undefined){d.ClosedCaptions=[];d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCTextColor,iD:"CCTextColor",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCTextFont,iD:"CCTextFont",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCTextSize,iD:"CCTextSize",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCTextOpacity,iD:"CCTextOpacity",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCTextEdging,iD:"CCTextEdging",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCBackgroundColor,iD:"CCBackgroundColor",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCBackgroundOpacity,iD:"CCBackgroundOpacity",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCWindowColor,iD:"CCWindowColor",parentID:"ClosedCaptions"});d.ClosedCaptions.push({name:application.resource.SettingsWheelOptionStrings.CCWindowOpacity,iD:"CCWindowOpacity",parentID:"ClosedCaptions"})}if(application.debugMode){d.Debug=[];d.Debug.push({name:application.resource.SettingsWheelOptionStrings.DeviceInfo,iD:"DeviceInfo",parentID:"Debug"});d.Debug.push({name:application.resource.SettingsWheelOptionStrings.ChangeEnvironment,iD:"ChangeEnvironment",parentID:"Debug"});d.Debug.push({name:application.resource.SettingsWheelOptionStrings.ConfigurationValues,iD:"ConfigurationValues",parentID:"Debug"});d.Debug.push({name:application.resource.SettingsWheelOptionStrings.AudioSupport,iD:"AudioSupport",parentID:"Debug"})}this.loadData(e,d,f)},loadData:function(f,d,e){this.cleanUI();this._masterSource=f;this._slaveSource=d;this.wheelChangedTimeout=200;if(f.length>0){this._renderWheel($(this.masterSourceElement),this._masterSource,(e)?e:0)}},navigate:function(g){this.parent(g);if(BrowseView.DockControl.selection=="dock-settings"){if((application.element.current&&application.element.current!="")&&document.getElementById(application.element.current)&&application.element.current=="selectedmaster"){if(g.args[0].direction=="left"){g.preventDefault();application.navigator.setFocus("dock-settings",true)}else{if(g.args[0].direction=="right"){g.preventDefault();application.navigator.setFocus("selectedslave",true)}}}else{if((application.element.current&&application.element.current!="")&&document.getElementById(application.element.current)&&application.element.current=="selectedslave"){if(g.args[0].direction=="right"){if(BrowseView.SettingsPanel.activePanelId){g.preventDefault();if(!this.isNavigating&&!BrowseView.SettingsPanel.isProcessing){var f=document.getElementById(BrowseView.SettingsPanel.activePanelId).getElementsByTagName("a");if(f.length>0){var e=false;var d=0;while(!e){if(f[d]){if(document.getElementById(f[d].id).offsetWidth!=0&&document.getElementById(f[d].id).offsetHeight!=0){application.navigator.setFocus(f[d].id,true);e=true}d++}else{e=true}}}}}}else{if(g.args[0].direction=="down"){if(BrowseView.SettingsPanel.activePanelId){if(BrowseView.SettingsPanel.isProcessing){g.preventDefault()}}}}}}}}});var SettingsPanelControlProperties={id:"settingspanel",persist:{},controls:{},layoutIsDirty:true,contentId:"SettingsPanel",tpl:null,secretKey:"",secretSequence:"",secretDebugKey:"492836",secretDirectionSequence:"udruudruuudr",currentWheelItem:"",isInitialized:false,initialize:function(){$("settingspanel").hide();this.loadView("Activate");log.write("settingspanel.init()");application.events.subscribe(this,"wheelvaluechanged",this.handleSettingWheelChange.bind(this));application.events.subscribe(this,"navigate",this.onNavigate.bind(this));this.tpl=new ui.template(this.contentId,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile()},loadView:function(d){},loadActivatePanel:function(e){var d=this;if(application.authSupported){this.isProcessing=true;this.verificationInProcess=true;$cn.methods.verifyAuthToken(function(f){if(this.currentWheelItem=="Activate"){if(!f){application.clearAuthToken();d.updateAuthStatus()}d.handleSettingWheelChange(e,true);this.isProcessing=false}}.bind(this))}else{d.handleSettingWheelChange(e,true)}},loadAboutPanel:function(e){var d=this;if(application.authSupported){this.isProcessing=true;log.write("Current Panel ID: "+this.activePanelId);$cn.methods.verifyAuthToken(function(f){if(this.currentWheelItem=="About"){if(f){$cn.methods.loadToken(function(g){if(this.currentWheelItem=="About"){$("settingsdeviceid").innerHTML=($cn.data.DeviceName!="")?$cn.utilities.forceWrap($cn.data.DeviceName,30,50):"Not Activated";d.handleSettingWheelChange(e,true);this.isProcessing=false;if(!("WebSocketManager" in window)){$$("#settingspanel .settingssdkversion").hide()}}}.bind(this))}else{application.clearAuthToken();d.updateAuthStatus();d.handleSettingWheelChange(e,true);this.isProcessing=false}}}.bind(this))}else{d.handleSettingWheelChange(e,true)}},loadUVPanel:function(e){var d=this;d.UV=new $cn.utilities.UserUVManager("settingsPanel");log.write("GETTING UV INFO");d.UV.checkUVAccount(function(){if("UV"===d.currentWheelItem){d.UVInfoLoaded=true;d.handleSettingWheelChange(e)}})},handleSettingWheelChange:function(g,f){var e=g.args[0],d=this;log.write("changing wheel...");if(e.wheelinstance=="SettingsWheelControl"){this.currentWheelItem=e.slavevalue;log.write("Current Wheel Value: "+this.currentWheelItem);if("UV"!==e.slavevalue){if(this.UV&&this.UV.timer){$cn.utilities.clearLoadingSpinner(this.UV.timer)}}$$("#settingspanel .panel").each(function(h){h.hide()});this.activePanelId=null;if((e.slavevalue=="General"||e.slavevalue=="Activate")&&$cn.data.AuthToken!=""&&!f){this.loadActivatePanel(g)}else{if(e.slavevalue=="About"&&$cn.data.AuthToken!=""&&!f){this.loadAboutPanel(g)}else{if(e.slavevalue=="UV"&&!this.UVInfoLoaded){this.loadUVPanel(g)}else{log.write("handling wheel change, last branch");this.isProcessing=true;if(!this.isInitialized){this.tpl.empty();this.tpl.append({version:configuration.readValue("version"),build:configuration.readValue("build"),Major:configuration.readValue("SDKVersion_Major"),Minor:configuration.readValue("SDKVersion_Minor"),Revision:configuration.readValue("SDKVersion_Revision"),Branch:configuration.readValue("SDKVersion_Branch"),Build:configuration.readValue("SDKVersion_Build"),deviceid:webservices.uniqueId,devicename:($cn.data.DeviceName!="")?$cn.utilities.forceWrap($cn.data.DeviceName,30,50):"Not Activated",accountlinkurl:$cn.data.AccountLinkUrl,firmwareversion:$cn.data.FirmwareVersion,affid:$cn.data.AffId,devicetype:webservices.destType,debugmode:($cn.config.SyncLogsExternally)?"Yes":"No",onscreendebug:($cn.config.OnScreenDebugLog)?"Yes":"No",env:application.CurrentEnvironment,modelnumber:device.realmodelid,countryid:$cn.data.CountryID,useragent:webservices.userAgent,logging:($cn.config.Debug)?"Yes":"No",baseline:($cn.data.baselineEnable)?"Yes":"No",jinni:($cn.data.jinniEnable)?"Yes":"No",flixster:($cn.data.flixsterEnable)?"Yes":"No",email:($cn.data.UserEmailAddress!="")?$cn.data.UserEmailAddress:"Not Activated"});if(this.UVInfoLoaded){this.tpl.empty();this.tpl.append({uvName:(d.UV.linkingAccount.user)?d.UV.linkingAccount.user.userName:"",uvEmail:(d.UV.linkingAccount.user)?d.UV.linkingAccount.user.email:"",uvStatus:d.getUVStatusMessage(),uvMessage:d.getUVMessage()});if(d.UV.linkingAccount.user){$("uvInfoUsername").removeClass("hidden");$("uvInfoEmail").removeClass("hidden")}if(d.UV.currentStatus){$("uvInfoStatus").removeClass("hidden")}this.UVInfoLoaded=false}}this.tpl.apply();if(!$(e.slavevalue)){if(BrowseView.SettingsWheelControl._slaveSource[e.slavevalue][0]){$(BrowseView.SettingsWheelControl._slaveSource[e.slavevalue][0].iD).show()}}else{log.write("Settings Panel (wheel changed): "+e.slavevalue);this.activePanelId=e.slavevalue;$(e.slavevalue).show();if(e.slavevalue=="Format"){this.selectAudioText($cn.data.PreferredAudioType)}log.write("$(data.slavevalue).show();")}if(!("WebSocketManager" in window)){$$("#settingspanel .settingssdkversion").hide()}application.currentView.layoutIsDirty=true;setTimeout(function(){this.isProcessing=false}.bind(this),400)}}}}},getUVStatusMessage:function(){var e="",d="";if("UVDeviceInactive"===this.UV.currentState){return""}if(this.UV.linkingAccount.linkingExpires){d=$cn.utilities.formatDate(this.UV.linkingAccount.linkingExpires,$cn.config.DateFormat)}if(this.UV.currentStatus){log.write("--- current status: status message: "+this.UV.currentStatus+" : ----");e=application.resource.uv_messages.settingsPanel.Status[this.UV.currentStatus].replace("##expiration##",d)}else{if(this.UV.currentState){e=application.resource.uv_messages.settingsPanel.Status[this.UV.currentState].replace("##expiration##",d)}}return e},getUVMessage:function(){var f="",e=application.resource.uv_messages.settingsPanel,d=(this.UV.currentStatus)?this.UV.currentStatus:this.UV.currentState;log.write("--- current status: uv message: "+d+" : ----");if(d=="AcctNotAvailable"){f=e.UVNotSupported.replace("##UvLink##",$cn.config.UVAccountLinkUrl)}else{if("UVDeviceInactive"===d){f=application.resource.uv_messages.settingsPanel.UVDeviceInactive.replace("##Activate##",$cn.data.ActivationURL)}else{if(d){f=e[d]}}}return f},requiresPurchasePin:function(){return($cn.data.PurchasePinEnabled)},requiresParentalControls:function(){return($cn.data.ParentPinEnabled)},requiresParentalControlsOnStartUp:function(){return($cn.data.ParentPinEnabledOnStartup)},selectedAudioFormat:function(d){var e=false;switch(d){case"Stereo":if($cn.data.PreferredAudioType=="Stereo_Standard"){e=true}break;case"DTS":if($cn.data.PreferredAudioType=="DTS_Express_51"||$cn.data.PreferredAudioType=="DTS_Express_Stereo"){e=true}break;case"Dolby":if($cn.data.PreferredAudioType=="Dolby_Digital_Plus_51"||$cn.data.PreferredAudioType=="Dolby_Digital_Plus_Stereo"){e=true}break;default:break}return e},showAudioType:function(d){var e="hidden";switch(d){case"DTS_Express_Stereo":if($cn.data.DTSStereoEnable){e=""}break;case"DTS_Express_51":if($cn.data.DTS51Enable){e=""}break;case"Dolby_Digital_Plus_51":if($cn.data.Dolby51Enable){e=""}break;case"Dolby_Digital_Plus_Stereo":if($cn.data.DolbyStereoEnable){e=""}break;default:break}return e},showAudioFormat:function(d){var e="hidden";switch(d){case"Stereo":if($cn.data.Dolby51Enable||$cn.data.DolbyStereoEnable||$cn.data.DTS51Enable||$cn.data.DTSStereoEnable){e=""}break;case"DTS":if($cn.data.DTS51Enable||$cn.data.DTSStereoEnable){e=""}break;case"Dolby":if($cn.data.Dolby51Enable||$cn.data.DolbyStereoEnable){e=""}break;default:break}return e},toggleBaseline:function(){$cn.data.baselineEnable=!$cn.data.baselineEnable;$("cbaseline").innerHTML=($cn.data.baselineEnable)?"Yes":"No"},toggleJinni:function(){$cn.data.jinniEnable=!$cn.data.jinniEnable;$("cjinni").innerHTML=($cn.data.jinniEnable)?"Yes":"No"},toggleFlixster:function(){$cn.data.flixsterEnable=!$cn.data.flixsterEnable;$("cflixster").innerHTML=($cn.data.flixsterEnable)?"Yes":"No"},toggleOnScreenDebug:function(){$cn.config.OnScreenDebugLog=!$cn.config.OnScreenDebugLog;$("osdebug").innerHTML=($cn.config.OnScreenDebugLog)?"Yes":"No";if($cn.config.OnScreenDebugLog){$("debugger").show()}else{$("debugger").hide()}},toggleParentalControlsOnStartUp:function(){if($cn.data.AuthToken==""){BrowseView.showActivate()}else{log.write("Current ParentPinEnabledOnStartup status: "+$cn.data.ParentPinEnabledOnStartup);var e=this,d=!$cn.data.ParentPinEnabledOnStartup;$cn.methods.loadToken(function(f){if($cn.data.ParentalControlsConfigured){application.events.publish("authparent",{callback:function(){e._toggleParentalControlsOnStartup(d)}})}else{BrowseView.showMessage("message_parentalcontrols",{Message:application.resource.switch_user_notsetup})}})}},toggleParentalControls:function(){if($cn.data.AuthToken==""){BrowseView.showActivate()}else{log.write("Current parental control status: "+$cn.data.ParentPinEnabled);var e=this,d=!$cn.data.ParentPinEnabled;$cn.methods.loadToken(function(f){if($cn.data.ParentalControlsConfigured){application.events.publish("authparent",{callback:function(){e._toggleParentalControls(d)}})}else{BrowseView.showMessage("message_parentalcontrols",{Message:application.resource.switch_user_notsetup})}})}},_toggleParentalControlsOnStartup:function(d){$cn.data.ParentPinEnabledOnStartup=d;log.write("New ParentPinEnabledOnStartup status: "+$cn.data.ParentPinEnabledOnStartup);document.getElementById("parentcheckonstartup").className="checkbox_"+$cn.data.ParentPinEnabledOnStartup;application.saveAuthToken()},_toggleParentalControls:function(d){$cn.data.ParentPinEnabled=d;$cn.data.IsParent=!$cn.data.ParentPinEnabled;log.write("New parental control status: "+$cn.data.ParentPinEnabled);log.write("Parental status: "+$cn.data.IsParent);webservices.clearContentCache(function(){document.getElementById("parentcheck").className="checkbox_"+$cn.data.ParentPinEnabled;BrowseView.reset();$("btnAccount").removeClass("locked");$("dock-back").addClass("disableBack");application.saveAuthToken();if($cn.data.ParentPinEnabled){$("btnAccount").addClass("locked")}})},togglePurchasePin:function(){if($cn.data.AuthToken==""){BrowseView.showActivate()}else{log.write("Current PurchasePinEnabled status: "+$cn.data.PurchasePinEnabled);var e=this,d=!$cn.data.PurchasePinEnabled;$cn.methods.loadToken(function(f){if($cn.data.ParentalControlsConfigured){application.events.publish("authparent",{callback:function(){e._togglePurchasePin(d)}})}else{BrowseView.showMessage("message_parentalcontrols",{Message:application.resource.switch_user_notsetup})}})}},_togglePurchasePin:function(d){$cn.data.PurchasePinEnabled=d;log.write("New PurchasePinEnabled control status: "+$cn.data.PurchasePinEnabled);document.getElementById("purchasepincheck").className="checkbox_"+$cn.data.PurchasePinEnabled;application.saveAuthToken()},show:function(){$("settingspanel").show();this.secretKey="";this.secretSequence="";this.isProcessing=false;if(!this.isInitialized){this.tpl.append({version:configuration.readValue("version"),build:configuration.readValue("build"),Major:configuration.readValue("SDKVersion_Major"),Minor:configuration.readValue("SDKVersion_Minor"),Revision:configuration.readValue("SDKVersion_Revision"),Branch:configuration.readValue("SDKVersion_Branch"),Build:configuration.readValue("SDKVersion_Build"),deviceid:webservices.uniqueId,devicename:($cn.data.DeviceName!="")?$cn.data.DeviceName:"Not Activated",accountlinkurl:$cn.data.AccountLinkUrl,firmwareversion:$cn.data.FirmwareVersion,affid:$cn.data.AffId,devicetype:webservices.destType,debugmode:($cn.config.SyncLogsExternally)?"Yes":"No",env:application.CurrentEnvironment,modelnumber:device.realmodelid,countryid:$cn.data.CountryID,logging:($cn.config.Debug)?"Yes":"No",baseline:($cn.data.baselineEnable)?"Yes":"No",jinni:($cn.data.jinniEnable)?"Yes":"No",flixster:($cn.data.flixsterEnable)?"Yes":"No",email:($cn.data.UserEmailAddress!="")?$cn.data.UserEmailAddress:"Not Activated"})}var d=this.tpl.apply();application.events.subscribe(this,"activated",this.updateActivationStatus.bind(this));application.events.subscribe(this,"badauthtoken",this.updateAuthStatus.bind(this));application.events.subscribe(this,"keydown",this.handleKeyDown.bind(this));application.events.subscribe(this,"activatecancelled",this.onActivateCancelled.bind(this))},hide:function(){application.events.unsubscribe(this,"activated");application.events.unsubscribe(this,"keydown");application.events.unsubscribe(this,"badauthtoken");application.events.unsubscribe(this,"activatecancelled");$("settingspanel").hide()},showAudioText:function(d){$("settingsaacselected").addClass("hidden");$("settingsdtsselected").addClass("hidden");$("settingsdolbyselected").addClass("hidden");switch(d){case"btnsettingsaudiostereo":case"audio_stereo":$("settingsaacselected").removeClass("hidden");break;case"btnsettingsaudiodts":case"audio_dts":$("settingsdtsselected").removeClass("hidden");break;case"btnsettingsaudiodolby":case"audio_digital":$("settingsdolbyselected").removeClass("hidden");break;default:break}},onBlur:function(d){log.write("onBlur called.");if(document.getElementById("Activate")){}},onNavigate:function(k){log.write("Navigate getting called.");if(document.getElementById("Activate")&&document.getElementById("Format").style.display=="block"){var j=k.args[0].current;if($(j).rel=="audioanchor"){if(k.args[0].direction=="up"||k.args[0].direction=="down"){k.preventDefault();var g=$$("a[rel=audioanchor]"),f=[],e=0,h=0,d;for(d=0;d<g.length;d++){if(j==g[d].id){h=e}if(document.getElementById(g[d].id).offsetWidth>0){f[f.length]=g[d];e++}}if(k.args[0].direction=="up"){if(h>0){navigation.setFocus(f[h-1].id,true)}else{navigation.setFocus(f[f.length-1].id,true)}}else{if(k.args[0].direction=="down"){if(h<f.length-1){navigation.setFocus(f[h+1].id,true)}else{navigation.setFocus(f[0].id,true)}}}}}}},onActivateCancelled:function(d){if(document.getElementById("Activate")){if(document.getElementById("GiftCards").style.display=="block"){navigation.setFocus("btnsettingsgc",true)}}},updateActivationStatus:function(d){log.write("SettingsPanel::updateActivationStatus called");$cn.methods.loadToken(function(e){if(document.getElementById("Activate")){document.getElementById("activate_devicenotactive").className="notactive_false";document.getElementById("activate_deviceactive").className="active_true";document.getElementById("settingsdeviceid").innerHTML=$cn.data.DeviceName;$("activate_devicenotactive").hide();$("activate_deviceactive").show();if($cn.data.ParentPinEnabled){document.getElementById("parentcheck").className="checkbox_true";if($cn.data.PurchasePinEnabled){document.getElementById("purchasepincheck").className="checkbox_true"}else{document.getElementById("purchasepincheck").className="checkbox_false"}}else{document.getElementById("parentcheck").className="checkbox_false"}application.currentView.layoutIsDirty=true;application.navigator.setFocus("selectedslave",true)}})},updateAuthStatus:function(d){log.write("updateAuthStatus callded: badauthtoken");if(document.getElementById("Activate")){document.getElementById("activate_devicenotactive").className="notactive_true";document.getElementById("activate_deviceactive").className="active_false";document.getElementById("settingsdeviceid").innerHTML="Not Activated";document.getElementById("purchasepincheck").className="checkbox_false";document.getElementById("parentcheck").className="checkbox_false";document.getElementById("parentcheckonstartup").className="checkbox_false";$("btnAccount").removeClass("locked");$("activate_devicenotactive").show();$("activate_deviceactive").hide()}},selectAudioFormat:function(f,d,e){switch(d){case"Stereo":$cn.data.PreferredAudioType="Stereo_Standard";break;case"DTS":if($cn.data.DTS51Enable){$cn.data.PreferredAudioType="DTS_Express_51"}else{$cn.data.PreferredAudioType="DTS_Express_Stereo"}break;case"Dolby":if($cn.data.Dolby51Enable){$cn.data.PreferredAudioType="Dolby_Digital_Plus_51"}else{$cn.data.PreferredAudioType="Dolby_Digital_Plus_Stereo"}break;default:break}configuration.writeValue("DefaultAudioFormat",$cn.data.PreferredAudioType);this.selectAudioText($cn.data.PreferredAudioType);$$("div.chk").removeClass("checkbox_true");$$("div.chk").addClass("checkbox_false");$(f).addClass("checkbox_true")},selectAudioText:function(d){switch(d){case"Stereo_Standard":this.showAudioText("btnsettingsaudiostereo");break;case"DTS_Express_51":case"DTS_Express_Stereo":this.showAudioText("btnsettingsaudiodts");break;case"Dolby_Digital_Plus_51":case"Dolby_Digital_Plus_Stereo":this.showAudioText("btnsettingsaudiodolby");break;default:break}},toggleDebug:function(){$cn.config.Debug=!$cn.config.Debug;$("cdebug").innerHTML=($cn.config.Debug)?"Yes":"No"},toggleRemoteLogging:function(){$cn.config.SyncLogsExternally=!$cn.config.SyncLogsExternally;$("cremote").innerHTML=($cn.config.SyncLogsExternally)?"Yes":"No"},handleKeyDown:function(d){switch(d.args[0].event.keyCode){case application.keys.KEY_UP:this.secretSequence+="u";break;case application.keys.KEY_DOWN:this.secretSequence+="d";break;case application.keys.KEY_RIGHT:this.secretSequence+="r";break;case application.keys.KEY_RED:this.secretKey+="a";break;case application.keys.KEY_1:this.secretKey+="1";break;case application.keys.KEY_2:this.secretKey+="2";break;case application.keys.KEY_3:this.secretKey+="3";break;case application.keys.KEY_4:this.secretKey+="4";break;case application.keys.KEY_5:this.secretKey+="5";break;case application.keys.KEY_6:this.secretKey+="6";break;case application.keys.KEY_7:this.secretKey+="7";break;case application.keys.KEY_8:this.secretKey+="8";break;case application.keys.KEY_9:this.secretKey+="9";break;case application.keys.KEY_0:this.secretKey+="0";break;default:break}log.write("Secret Key: "+this.secretKey+", Secret Sequence: "+this.secretSequence);if(this.secretKey=="a0852"){BrowseView.showChangeEnv()}else{if(this.secretKey==this.secretDebugKey||this.secretSequence==this.secretDirectionSequence){application.debugMode=true;BrowseView.goSettings(0)}else{if(this.secretKey.length>=this.secretDebugKey.length){this.secretKey=""}if(this.secretSequence.length>=this.secretDirectionSequence.length){this.secretSequence=""}}}},isActivated:function(){return($cn.data.AuthToken!="")?"true":"false"},getClosedCaptionPreview:function(){return ccrender.getClosedCaptionPreview()},updateClosedCaptionPreview:function(){if($$(".ClosedCaptionPreview")){$$(".ClosedCaptionPreview").set("html",this.getClosedCaptionPreview())}},setCCTextOpacity:function(d){$$("#SettingsCCTextOpacityContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");switch(d){case"Default":$("CCTextOpacityDefault").className="checkbox_true";$cn.data.CCTextOpacity="auto";break;case"Opaque":$("CCTextOpacityOpaque").className="checkbox_true";$cn.data.CCTextOpacity="100";break;case"SemiTransparent":$("CCTextOpacitySemiTransparent").className="checkbox_true";$cn.data.CCTextOpacity="50";break}this.updateClosedCaptionPreview();configuration.writeValue("CCTextOpacity",$cn.data.CCTextOpacity)},setCCTextFont:function(d){$$("#SettingsCCTextFontContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCTextFont"+d.capitalize()).className="checkbox_true";$cn.data.CCFont=d;this.updateClosedCaptionPreview();configuration.writeValue("CCFont",$cn.data.CCFont)},setCCTextEdge:function(d){$$("#SettingsCCTextEdgingContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCTextEdging"+d.capitalize()).className="checkbox_true";$cn.data.CCTextEdge=d;this.updateClosedCaptionPreview();configuration.writeValue("CCTextEdge",$cn.data.CCTextEdge)},setCCTextColor:function(d){$$("#SettingsCCTextColorContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCTextColor"+d.capitalize()).className="checkbox_true";$cn.data.CCTextColor=d;this.updateClosedCaptionPreview();configuration.writeValue("CCTextColor",$cn.data.CCTextColor)},setCCTextSize:function(e){$$("#SettingsCCTextSizeContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCTextSize"+e.capitalize()).className="checkbox_true";var d={auto:"auto",small:75,medium:100,large:125,extralarge:150};$cn.data.CCTextSize=d[e];this.updateClosedCaptionPreview();configuration.writeValue("CCTextSize",$cn.data.CCTextSize)},setCCBackgroundColor:function(d){$$("#SettingsCCBackgroundColorContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCBackgroundColor"+d.capitalize()).className="checkbox_true";$cn.data.CCBackgroundColor=d;this.updateClosedCaptionPreview();configuration.writeValue("CCBackgroundColor",$cn.data.CCBackgroundColor)},setCCBackgroundOpacity:function(e){$$("#SettingsCCBackgroundOpacityContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCBackgroundOpacity"+e.capitalize()).className="checkbox_true";var d={auto:"auto",opaque:100,semiTransparent:50,transparent:0};$cn.data.CCBackgroundOpacity=d[e];this.updateClosedCaptionPreview();configuration.writeValue("CCBackgroundOpacity",$cn.data.CCBackgroundOpacity)},setCCWindowColor:function(d){$$("#SettingsCCWindowColorContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCWindowColor"+d.capitalize()).className="checkbox_true";$cn.data.CCWindowColor=d;this.updateClosedCaptionPreview();configuration.writeValue("CCWindowColor",$cn.data.CCWindowColor)},setCCWindowOpacity:function(e){$$("#SettingsCCWindowOpacityContainer div.checkbox_true").removeClass("checkbox_true").addClass("checkbox_false");$("CCWindowOpacity"+e.capitalize()).className="checkbox_true";var d={auto:"auto",opaque:100,semiTransparent:50,transparent:0};$cn.data.CCWindowOpacity=d[e];this.updateClosedCaptionPreview();configuration.writeValue("CCWindowOpacity",$cn.data.CCWindowOpacity)}},SettingsPanelControl=new Class(SettingsPanelControlProperties);var TvSeasonsWheelControl=new Class({Extends:WheelControl,Implements:WheelControl,id:"TvSeasonsWheelControl",container:"searchwheel",singleWheel:true,MetaData:[],masterSourceElement:"singlemasterdatasource",masterSelectedElement:"singleselectedmaster",cleanUI:function(){if($("singleselectedmaster")){$("singleselectedmaster").label=""}if($("singlemasterdatasource")){if($("singlemasterdatasource").getChildren().length>0){$("singlemasterdatasource").getChildren().destroy()}}},handleWheelItemChange:function(f){log.write(f);if(f.context===ActiveWheel){var e=f.args[0];var d=this._masterSource[e.selectedidx];application.events.publish("gridloading",{grid:"titlegrid",message:"tvloading",className:"episodegrid",cssClass:"tv"});if(this.isLibrary){$cn.methods.getBundleListingPurchased(e.selectedvalue,function(j){log.write(j.bundleItems.length);var g=j.bundleItems;if(this.isSeasonal){g=g.slice();g.unshift({titleID:d.iD,name:application.resource.all_episodes,itemNumber:d.season})}if(d.watchFilter){var h=[];g.each(function(k){if(!k.hasWatched){h.push(k)}});g=h}BrowseView.LastGridProcess="tvseasons";application.events.publish("loadgrid",{grid:"titlegrid",data:g,columns:1,template:"listgrid",gridProcess:"tvseasons",className:"episodegrid",returnFocus:"singleselectedmaster"})}.bind(this))}else{$cn.methods.getBundleListing(e.selectedvalue,function(h){log.write(h.bundleItems.length);var g=h.bundleItems;if(this.isSeasonal){g=g.slice();g.unshift({titleID:d.iD,name:application.resource.all_episodes,itemNumber:d.name})}BrowseView.LastGridProcess="tvepisodes";application.events.publish("loadgrid",{grid:"titlegrid",data:g,columns:1,template:"listgrid",gridProcess:"tvepisodes",className:"episodegrid",returnFocus:"singleselectedmaster"})}.bind(this))}}},loadData:function(g,h){var f=0;var e="";this.layoutIsDirty=true;this.saveHistory();this.cleanUI();this._masterSource=[];if(this.isLibrary){if(this.isSeasonal){for(var d=0;d<g.length;d++){if(h==g[d].titleID){f=this._masterSource.length}this._masterSource.push({name:g[d].name,season:g[d].name,iD:g[d].titleID});if(!g[d].hasWatched){this._masterSource.push({name:g[d].name+"<br/>"+application.resource.unwatched_episodes,season:g[d].name,iD:g[d].titleID,watchFilter:true})}}}else{this._masterSource=[{name:application.resource.all_episodes,iD:g[0].titleID},{name:application.resource.unwatched_episodes,iD:g[0].titleID,watchFilter:true}]}}else{for(var d=0;d<g.length;d++){this._masterSource.push({name:g[d].name,iD:g[d].titleID});if(h==g[d].titleID){f=d}}}if(this._masterSource.length>0){$("titlegrid").show();$("singlewheel").show();this._renderWheel($("singlemasterdatasource"),this._masterSource,f);navigation.setFocus("singleselectedmaster",true)}},navigate:function(d){if(d.context===ActiveWheel&&d.args[0].current=="singleselectedmaster"){if(d.args[0].direction=="left"){navigation.setFocus("tdbuttonEpisodes");d.preventDefault()}else{this.parent(d)}}},onSaveState:function(e){this.parent(e);var d=e.args[0][this.id];d.isLibrary=this.isLibrary;d.isSeasonal=this.isSeasonal}});var EnvironmentPopup=new Class({Extends:ModalControl,popuptype:"",initialize:function(){this.parent("envchange")},show:function(){this.parent();var e=this,d;document.getElementById("envchangebtns").innerHTML="";for(d=0;d<application.Environments.length;d++){document.getElementById("envchangebtns").innerHTML+="<p>Select ("+d+") for "+application.Environments[d].name+"</p>"}application.events.subscribe(this,"back",this.handleBack.bind(this));setTimeout(function(){application.events.subscribe(e,"keydown",e.handleKeyPress.bind(e))},500)},unsubEvents:function(){application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"keydown")},handleBack:function(d){d.preventDefault();this.unsubEvents();this.hide()},setCurrentVal:function(d){application.CurrentEnvironment=d;application.endPointServer=d+".cinemanow.com";application.apiUrl="https://"+d+".cinemanow.com";log.write("Changing config (application.CurrentEnvironment): "+application.CurrentEnvironment);log.write("Changing config (application.endPointServer): "+application.endPointServer);log.write("Changing config (application.apiUrl): "+application.apiUrl);this.unsubEvents();this.hide();BrowseView.reset();configuration.writeValue("Environment",d)},handleKeyPress:function(d){switch(d.args[0].event.keyCode){case application.keys.KEY_1:this.setCurrentVal(application.Environments[1].key);break;case application.keys.KEY_2:this.setCurrentVal(application.Environments[2].key);break;case application.keys.KEY_3:this.setCurrentVal(application.Environments[3].key);break;case application.keys.KEY_4:this.setCurrentVal(application.Environments[4].key);break;case application.keys.KEY_5:this.setCurrentVal(application.Environments[5].key);break;case application.keys.KEY_6:this.setCurrentVal(application.Environments[6].key);break;case application.keys.KEY_7:this.setCurrentVal(application.Environments[7].key);break;case application.keys.KEY_8:this.setCurrentVal(application.Environments[8].key);break;case application.keys.KEY_9:this.setCurrentVal(application.Environments[9].key);break;case application.keys.KEY_0:this.setCurrentVal(application.Environments[0].key);break;default:break}}});var ActivatePanelObject={Extends:ModalControl,Implements:ModalControl,id:"activate",persist:{},controls:{},layoutIsDirty:true,tpl:null,code:"",pollTimer:null,pollTimerStarted:false,inPolling:false,initialize:function(){log.write("activate.init()");this.parent("activate")},loadData:function(f,e){var d=this;log.write("code is: "+e);this.parent(f);if(this.pollTimer===null){this.pollTimer=new Timer();this.pollTimer.Interval=5000;this.pollTimer.Tick=function(){if(document.getElementById("ActivateContent").style.display=="none"){log.write("Activate panel is not displayed but is still polling. Stop it!");d.pollTimer.Stop();d.pollTimerStarted=false}else{if(d.inPolling){return}log.write("Polling for auth token...");d.inPolling=true;$cn.methods.pollForToken(function(g){d.inPolling=false;if(g.authToken){if(g.authToken.length>0){$cn.utilities.setParentalSettings(g);d.hide();d.pollTimerStarted=false;d.pollTimer.Stop();if(BrowseView.ActivationPcView===null){BrowseView.ActivationPcView=new ActivationPcView()}BrowseView.ActivationPcView.activeFromWelcome=false;BrowseView.ActivationPcView.payload=d.payload;BrowseView.ActivationPcView.showActivateSuccessPage()}}})}}}this.displayCode(e);navigation.setFocusElement($("ModalContent").getElement(".default"),true)},displayCode:function(e,f){var d=this;log.write("displayCode");log.write(e);if(e){d.getCodeUpdateHtml(e,d,f)}else{log.write("code doesn't exist. Go get a code");$cn.methods.getActivationString(function(g){d.getCodeUpdateHtml(g,d,f)})}},getCodeUpdateHtml:function(g,f){var d;log.write("activation string:: "+g);f.code=g;for(d=0;d<g.length;d++){try{$("Code"+d).innerHTML=g.substring(d,d+1)}catch(k){log.write(log.dumpObj(k));return}}if(application.authSupported){if(!f.pollTimerStarted){f.pollTimerStarted=true;f.pollTimer.Start()}}$("modalcontrol").addClass("show"+g.length);$("ModalWindow").setAttribute("style","");var j=(application.resource.modalConfig["activate_show"+g.length]);for(var h in j){$("ModalWindow").setStyle(h,j[h])}log.write("Modal Class: "+$("modalcontrol").className);$("modalcontrol").removeClass("activate");$$("#ActivationFooter span.url").set("html",$cn.data.ActivationURL)},show:function(d){log.write("showing modal");this.parent();this.payload=d;application.TempKeyBlock=false;application.currentView.layoutIsDirty=true},hide:function(){this.parent();$cn.data.d2dPath=false;log.write("Hiding activate");if(application.authSupported){log.write("Stopping Activation timer.");if(this.pollTimer){this.pollTimer.Stop();this.pollTimerStarted=false;this.inPolling=false}}application.currentView.layoutIsDirty=true},poll:function(){$cn.methods.pollForToken(function(d){log.write(log.dumpObj(d.data.result))})},onBack:function(d){this.parent(d);log.write("onBack getting called");if(this.payload&&this.payload.onCancel){log.write("onBack with payload getting called");this.payload.onCancel.call()}else{application.events.publish("activatecancelled",{})}}},ActivatePanel=new Class(ActivatePanelObject);var TitleCheckOutWheelControl=new Class({Extends:WheelControl,Implements:WheelControl,id:"TitleCheckOutWheelControl",container:"singlewheel",singleWheel:true,MetaData:[],persist:{},masterSourceElement:"singlemasterdatasource",masterSelectedElement:"singleselectedmaster",cleanUI:function(){if($("singleselectedmaster")){$("singleselectedmaster").label=""}if($("singlemasterdatasource")){if($("singlemasterdatasource").getChildren().length>0){$("singlemasterdatasource").getChildren().destroy()}}},handleWheelItemChange:function(e){if(e.context===ActiveWheel){var d=e.args[0];log.write("Title Wheel Item changed. Now fire custom method. "+e.args[0].wheelinstance);application.events.publish("titlecheckoutwheelchanged",{selectedvalue:d.selectedvalue,titleID:this.persist.title.titleID});BrowseView.CurrentWheelValue=d.selectedvalue+":"}},loadCheckOutData:function(f){this.layoutIsDirty=true;this.cleanUI();var k=$cn.data.TitleDetailCache[f];this.persist.title=k;this.wheelChangedTimeout=200;if(k){var j=k.availableProducts,g=[],d;for(d=0;d<j.length;d++){var h="";if(j[d].availableAssets.length>0){switch(j[d].purchaseType){case"any":h="Buy";break;case"buy":h=$cn.utilities.getBuyTextForTitle(k);if(j[d].skuType.indexOf("Upgrade")!=-1){this.disctodigital=true;h+=" Disc to Digital"}h+="<br/>"+application.resource.currency_symbol+j[d].price;break;case"rent":h="Rent "+j[d].rentalPeriod+" Hr<br />"+application.resource.currency_symbol+j[d].price;break;case"subscription":h="Subscription";break}var e=false;if(j[d].skuType.indexOf("HD")>-1){e=true}if(e){h=h+'<div id="hdbadge" ></div>'}if(j[d].skuType.indexOf("Upgrade")==-1||(j[d].skuType.indexOf("Upgrade")!=-1&&k.titleID==$cn.data.d2dTitleInfo.id)){g.push({name:h,iD:j[d].skuID,parentID:0,purchaseType:j[d],titleID:k.titleID})}}}this.loadData(g,[{}]);if(g.length>1||this.disctodigital){$("singlewheel").show();$("checkout_container").removeClass("nowheel");navigation.setFocus("singleselectedmaster",true)}else{$("singlewheel").hide();$("checkout_container").addClass("nowheel");BrowseView.CheckoutPanel.activate()}}},navigate:function(g){if(g.context===ActiveWheel){var f=g.args[0];if(f.current=="singleselectedmaster"){if(f.direction=="left"){g.preventDefault();navigation.setFocus("tdbuttonCheckout")}else{if(f.direction=="right"){g.preventDefault();if($("singlemasterdatasource")){var d=$$("#singlemasterdatasource div.hover");if(d.length>0){var e=d[0];if(e){e.removeClass("hover");e.addClass("hdHighlight")}}}if(!this.isNavigating){BrowseView.CheckoutPanel.activate()}}else{this.parent(g)}}}else{if(f.current=="checkout_order"||f.current=="checkout_redeem"||f.current=="checkout_payment"||f.current=="checkout_cancel"){if(f.direction=="left"){if($("singlemasterdatasource")){var d=$$("#singlemasterdatasource div.hdHighlight");if(d.length>0){var e=d[0];if(e){e.addClass("hover");if(f.current!="checkout_cancel"){e.removeClass("hdHighlight")}}}}}}}}}});var RecomendationWheelControl=new Class({Extends:WheelControl,Implements:WheelControl,id:"RecomendationWheelControl",returnFocus:null,titleID:null,MetaData:[],dataLoaded:false,masterIdx:0,slaveIdx:0,activate:function(){this.parent();this.returnFocus=application.element.current},handleWheelItemChange:function(f){log.write(f);if(f.context===ActiveWheel&&f.args[0]){var e=f.args[0];log.write("Title Wheel Item changed. Now fire custom method. "+f.args[0].wheelinstance);if(e.sourceid.indexOf("master")>-1){$("slavedatasource").getElements("div").destroy();f.context.loadSlaveDataSource(e.selectedvalue)}else{if(e.sourceid.indexOf("slave")>-1){log.write("The slave wheel item has changed. Update results.");var d=f.args[0].selectedvalue.split("|");this.masterIdx=d[0];this.slaveIdx=d[1];this.loadSlaveGrid(d[0],d[1])}}}},loadSlaveGrid:function(h,f){var e=(h.indexOf("s_")>-1);var g=1;var d=this;if(e){application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:2,className:"similar"});BrowseView.LastGridProcess="similar";$cn.methods.getBrowseListByGeneWithSimilarBy(f,this.titleID,g,function(j){d.dataLoaded=true;BrowseView.CurrentProcessLoaded=true;application.events.publish("loadgrid",{grid:"titlegrid",data:j.data.result.items,columns:2,altMessage:"",gridProcess:"similar",className:"similar",template:"similarlist"})})}else{if(h=="m_cast_crew"){application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:2,className:"similar"});BrowseView.LastGridProcess="similar";$cn.methods.getBrowseListByCast(f,g,function(j){d.dataLoaded=true;BrowseView.CurrentProcessLoaded=true;application.events.publish("loadgrid",{grid:"titlegrid",data:j.data.result.items,columns:2,altMessage:"",gridProcess:"similar",className:"similar",template:"similarlist"})})}}},loadSlaveDataSource:function(g){var f=this;var h=(g.indexOf("m_")==0);var e=(g.indexOf("s_")==0);if(this._slaveSource[g]){application.events.publish("recommendeddataloaded");this._renderWheel($("slavedatasource"),this._slaveSource[g]);if(e||h){var d=this._slaveSource[g][0].iD.split("|");this.masterIdx=g;this.slaveIdx=d[1];this.loadSlaveGrid(g,d[1])}}else{if(h){switch(g){case"m_cast_crew":$cn.methods.getCastAndCrew(this.titleID,function(k){f.MetaData[g]=k.castMembers;f._slaveSource[g]=[];k.castMembers.each(function(l){f._slaveSource[g].push({name:f.split(l.name),iD:g+"|"+l.castID,parentID:0})});f._renderWheel($("slavedatasource"),f._slaveSource[g]);var j=f._slaveSource[g][0].iD.split("|");application.events.publish("recommendeddataloaded");f.loadSlaveGrid(g,j[1])});break;default:break}}}},loadSlave:function(e,d){if(d){this.loadSlaveGrid(e,d)}else{this.loadSlaveGrid(e,this._slaveSource[e][0].iD.split("|")[1])}},loadData:function(e,f){var d=this;$cn.methods.getGenesByWheelOptionPlural(e,function(k){var p,m;log.write("recommendationswheel.loadData Debug: BrowseView.currentState: "+BrowseView.currentState);if((BrowseView.currentState=="titleview_wheel"||BrowseView.currentState=="titleview")&&k&&(k.responseCode==0||k.responseCode==22)&&k.wheelOptions){var g="";d.saveHistory();d.cleanUI();d.titleID=e;d._masterSource=[];d._slaveSource={};d.dataLoaded=false;BrowseView.CurrentProcessLoaded=false;application.events.publish("gridloading",{grid:"titlegrid",className:"similar"});d.activate();if($cn.data.jinniEnable){for(p=0;p<k.wheelOptions.length;p++){var q=k.wheelOptions[p];if(q.geneList.length>0){if(g==""){g=q.wheelOption}var n=$cn.data.TitleDetailCache[e],l;if(q.wheelOption=="s_all"&&n.titleType=="TV_Show"){l=application.resource.td_similar["s_all_"+n.titleType]}else{l=application.resource.td_similar[q.wheelOption]}d._masterSource[d._masterSource.length]={name:l,iD:q.wheelOption,parentID:0};d._slaveSource[q.wheelOption]=[];for(m=0;m<q.geneList.length;m++){var j=q.geneList[m];d._slaveSource[q.wheelOption].push({name:j.name,iD:q.wheelOption+"|"+j.geneId,parentID:q.wheelOption})}}}}if($cn.data.baselineEnable){if(BrowseView.currentTitle){for(var h=0;h<BrowseView.currentTitle.wheelItems.length;h++){if(BrowseView.currentTitle.wheelItems[h].indexOf("m_cast_crew")>-1){g=(g!="")?g:"m_cast_crew";d._masterSource[d._masterSource.length]={name:application.resource.td_similar.m_cast_crew,iD:"m_cast_crew",parentID:0};break}}d._renderWheel($("masterdatasource"),d._masterSource);d.loadSlaveDataSource(g)}else{$cn.methods.getTitleListing(e,true,function(r){BrowseView.currentTitle=r;for(var s=0;s<BrowseView.currentTitle.wheelItems.length;s++){if(BrowseView.currentTitle.wheelItems[s].indexOf("m_cast_crew")>-1){g=(g!="")?g:"m_cast_crew";d._masterSource[d._masterSource.length]={name:application.resource.td_similar.m_cast_crew,iD:"m_cast_crew",parentID:0};break}}d._renderWheel($("masterdatasource"),d._masterSource);d.loadSlaveDataSource(g)}.bind(this))}}}if(k.responseCode==22){f.call(d,0,"Cast and Crew added")}else{f.call(d,k.responseCode,k.responseMessage)}})},navigate:function(e){var d=e.args[0];if(e.context===ActiveWheel){if(d.current&&(d.current=="selectedmaster")){if(d.direction=="left"){if(this.dataLoaded){e.preventDefault();BrowseView.expandTitleDetails();BrowseView.TitleViewControl.enableButtons();navigation.setFocus("tdbuttonSimilar",true)}else{e.preventDefault()}}else{this.parent(e)}}else{this.parent(e)}}}});var CheckoutPanelControlProperties={id:"checkoutpanel",couponCode:0,discountAmount:0,persist:{},controls:{},layoutIsDirty:true,inLibrary:false,isActive:false,spinnerPos:1,spinnerTimer:null,spinnerSpinning:false,spinnerPosition:1,paymentInfoAvailable:false,paymentInfoListener:null,loadingTimer:null,tpl:null,tplCart:null,purchaseDetails:{},getPersist:function(){return this.persist},initialize:function(){if($("checkoutpanel")){$("checkoutpanel").hide()}this.loadView("checkout.buy");log.write("checkoutpanel.init()");this.spinnerTimer=new Timer();this.spinnerTimer.Interval=80;paymentInfoAvailable=false;paymentInfoListener=null;application.events.subscribe(this,"titlecheckoutwheelchanged",this.handleSettingWheelChange.bind(this));application.events.subscribe(this,"redeemed",this.onRedeemed.bind(this))},activate:function(){navigation.setFocusElement($("checkoutpanel").getElement(".default"),true);this.isActive=true},deactivate:function(){if(this.isActive){this.isActive=false}},cleanUI:function(){if($("checkout_container")){if($("checkout_container").getChildren().length>0){$("checkout_container").getChildren().destroy()}}},loadView:function(d){this.tpl=new ui.template("checkout_container",application.ui.loadTpl(d));this.tpl.compile()},getTitleObject:function(){return $cn.data.TitleDetailCache[this.persist.titleID]},showSummaryItem:function(d){if(document.getElementById(d)){$(d).removeClass("hidden")}$$("."+d).removeClass("hidden")},loadData:function(n){var m,k,h,e,l,d,j,f,p;this.paymentInfoAvailable=false;this.paymentInfoListener=null;this.couponCode=0;this.discountAmount=0;this.persist.titleID=n.titleID;k=this.getTitleObject();for(m=0;m<k.availableProducts.length;m++){if(k.availableProducts[m].skuID==n.selectedvalue){this.persist.sku=k.availableProducts[m]}}h=this.persist.sku;e=k.show?k.show:k.name;l=k.episode?k.episode:"";d="";if(k.titleType=="TV_Episode"){d='"'+k.name+'"';$("checkout_container").addClass("episode")}else{$("checkout_container").removeClass("episode")}var q={sku:h.skuID,name:e.ellipsToPixels(233),season:l,episode:d,titleID:k.titleID,mPAARating:k.mPAARating,loyalty_rent:$cn.utilities.getMeta("LoyaltyPointsForRent",k.metaValues),loyalty_buy:$cn.utilities.getMeta("LoyaltyPointsForBuy",k.metaValues),isHD:false,message:""};this.tpl.empty();this.tpl.append(q);this.tpl.apply();if(h.skuType.indexOf("HD")>-1){$("1080phd").removeClass("hidden");q.isHD=true}var g=false;for(m=0;m<k.metaValues.length;m++){if(k.metaValues[m].keyName=="Extras"&&k.metaValues[m].keyValue=="True"){g=true}if(k.metaValues[m].keyName=="promoText"&&k.metaValues[m].keyValue!==""){$("promoText").removeClass("hidden")}}if(k.titleType=="Movie"){if(h.purchaseType=="rent"){$("singlePlayback").removeClass("hidden");this.showSummaryItem("checkoutRental");if(!q.isHD){this.showSummaryItem("checkoutRentalSD")}j=$cn.utilities.getMeta("LoyaltyPointsForRent",k.metaValues);if(j!==""&&parseInt(j,10)>0){$("loyaltyrent").removeClass("hidden")}}else{if(h.purchaseType=="buy"&&h.skuType.indexOf("Upgrade")!=-1){$("checkout_top").getElement(".title").innerHTML=k.name.ellipsToPixels(100)+" - Disc to Digital Version";$$(".d2dCheckout").removeClass("hidden")}else{if(h.purchaseType=="buy"){this.showSummaryItem("ownIt");$("multiPlayback").removeClass("hidden");if(g){$("digitalextras").removeClass("hidden")}f=$cn.utilities.getMeta("LoyaltyPointsForBuy",k.metaValues);if(f!==""&&parseInt(f,10)>0){$("loyaltybuy").removeClass("hidden")}p=this.skuIsUv();if($cn.utilities.isTrue(p)&&$("uvPlayback")){$("uvPlayback").removeClass("hidden")}}}}}else{if(k.titleType=="TV_Episode"){$("multiPlayback").removeClass("hidden");this.showSummaryItem("ownIt");if(g){$("digitalextras").removeClass("hidden")}}}application.currentView.layoutIsDirty=true;$("checkout_container").show();$cn.methods.lookupPurchaseDetailsForTitle(k.titleID,function(r){$cn.methods.getBillingInfo(this.onBillingInfoLoaded.bind(this));if(r.responseCode==31){r.isAvailable=false;r.state="Not_Owned";r.errorHandled=true}this.inLibrary=r.isAvailable;if(r.state!="Not_Owned"){var s=this.getTitleObject();this.persist.passID=r.passID;if(s.show){application.putInnerHTML($("checkout_message"),application.resource.ownership_state.tv_title[r.state])}else{application.putInnerHTML($("checkout_message"),application.resource.ownership_state.title[r.state])}}}.bind(this))},titleInLibrary:function(){return this.inLibrary},skuIsUv:function(){var d=$cn.utilities.isTrue($cn.utilities.getMeta("HasUV",this.getTitleObject().metaValues)),e="not set";if(d){e=$cn.utilities.isTrue(this.getPersist().sku.isUV)}log.write("This "+(d?"is":"is not")+" a UV title");log.write("This "+(e?"is":"is not")+"a UV sku");return d&&e},skuIsD2D:function(){if($cn.config.EnableD2D&&$cn.config.DeviceD2DEnabled){log.write("TEST d2d");var d=this.getPersist();log.write(JSON.stringify(d));return(d.sku.skuType.indexOf("Upgrade")!=-1)}else{return false}},checkD2DValid:function(){var d=1;return $cn.data.d2dTitleInfo.validDisc!=d},goCheckOut:function(e){var d=this;if(d.titleInLibrary()&&!e){if(d.skuIsUv()){d.checkIfUserOwnsUvTitle(d.showAlreadyPurchasedModal.bind(d))}else{d.showAlreadyPurchasedModal()}}else{if($cn.config.EnableUV&&$cn.config.EnableUVPurchases&&d.skuIsUv()){if(typeof this.UV==="undefined"){this.UV=new $cn.utilities.UserUVManager("CheckoutPanel")}$cn.methods.verifyAuthToken(function(f){if(f){d.UV.checkUVAccount(function(g){if(g){d.buyItemInStore()}},true)}else{BrowseView.showActivate()}})}else{d.buyItemInStore()}}},showWarningModal:function(f){var d=this;log.write("messageObj is: "+JSON.stringify(f));log.write("real warning modal");var e={Message:f.Message,Content:f.Content,OK:f.OK,Close:f.Cancel,callback:function(g){if(g){d.goCheckOut()}}.bind(d)};BrowseView.showMessage("message_okcancel_vert",e)},buyItemInStore:function(){BrowseView.goCheckOut(this.getPersist().titleID,this.getPersist().sku.skuID,this.couponCode)},showSimilarPurchaseD2DModal:function(g){var f=application.resource.d2d_messages.already_own,d=this,e={Message:f.Message,Content:f.Content.replace(/##title##/g,this.getTitleObject().name).replace("##libTitle##",g.name).replace("##price##",this.persist.sku.price),Close:f.Cancel,OK:f.OK,Class:"similarD2DModal",callback:function(h){if(h){d.goCheckOut(true)}}};BrowseView.showMessage("message_okcancel",e)},showAlreadyPurchasedModal:function(d){var h,e=this,g=this.getPersist();if(d){h=application.resource.uv_messages.already_own}else{h=application.resource.already_purchased}var f={Message:h.Message,Content:h.Content,OK:h.OK,Close:h.Cancel,Action:h.Action,callback:function(j){switch(j){case"buy":e.goCheckOut(true);break;case"play":BrowseView.MessagePopupCached.startPlay(g.titleID,g.passID);break}}};BrowseView.showMessage("message_alreadyownuv",f)},checkIfUserOwnsUvTitle:function(d){$cn.methods.getPurchasedTitle(this.persist.passID,this.persist.titleID,function(e){var f=$cn.utilities.isTrue(e.isPassUV);d(f)})},checkUVOwnership:function(){var d=true;if(d){var e={Message:application.resource.uv_messages.already_own.Message,Content:application.resource.uv_messages.already_own.Content,OK:application.resource.uv_messages.already_own.OK,Close:application.resource.uv_messages.already_own.Cancel,Action:application.resource.uv_messages.already_own.Action,callback:function(f){}.bind(this)};BrowseView.showMessage("message_alreadyownuv",e)}else{BrowseView.goCheckOut(this.persist.titleID,this.persist.sku.skuID,this.couponCode)}},goPaymentBreakdown:function(){if(!this.paymentInfoAvailable){log.write("--- payment info not yet available, setting listener ---");this.loadingTimer=$cn.utilities.showLoadingModal(2000,"Loading Payment Info...");this.paymentInfoListener=this.goPaymentBreakdown;return}var d=this;$cn.methods.verifyAuthToken(function(e){if(e){d.showPaymentBreakdown()}else{BrowseView.showActivate()}}.bind(this))},showPaymentBreakdown:function(){var k,g;$cn.utilities.clearLoadingSpinner(this.loadingTimer);var e=0;var h="",f="";if((this.purchaseDetails.amount_tax>0&&this.purchaseDetails.amount_tax!=="")||($cn.config.EnableTaxAPI&&this.purchaseDetails.amount_tax!=0)){h="";f=""}else{if($cn.config.EnableTaxAPI){h='<span class="white"> * </span>';f='<tr><td colspan="2" align="right" style="height:50px">'+application.resource.tax_string+"</td></tr>"}}var j='<table width="90%" align="center">';j+='<tr><td align="left">Item Subtotal:</td><td align="right">'+application.resource.currency_symbol+this.purchaseDetails.amount_subtotal+"</td></tr>";if(this.purchaseDetails.amount_giftcard_remaining>0){k=(parseFloat(this.purchaseDetails.amount_giftcard)-parseFloat(this.purchaseDetails.amount_coupon)).toFixed(2);g=(parseFloat(this.purchaseDetails.amount_giftcard_remaining)-k).toFixed(2);j+='<tr><td align="left">Gift Card(s) ('+application.resource.currency_symbol+g+' remaining):</td><td align="right">-'+application.resource.currency_symbol+k+"</td></tr>"}if(this.purchaseDetails.amount_coupon>0){j+='<tr><td align="left">Coupon(s):</td><td align="right">-'+application.resource.currency_symbol+this.purchaseDetails.amount_coupon+"</td></tr>"}if(this.purchaseDetails.amount_tax!=0){j+='<tr><td align="left">Applicable Tax:</td><td align="right">'+application.resource.currency_symbol+this.purchaseDetails.amount_tax+"</td></tr>"}j+='<tr><td colspan="2">&nbsp;</td></tr>';j+='<tr><td align="left" class="white">Total to '+this.purchaseDetails.total_confirm+": "+h+'</td><td class="white" align="right">'+application.resource.currency_symbol+this.purchaseDetails.amount_total+"</td></tr>";j+='<tr><td colspan="2">&nbsp;</td></tr>';if(this.purchaseDetails.lastfour&&this.purchaseDetails.lastfour.length>0){j+='<tr><td align="left">Credit Card ending in '+this.purchaseDetails.lastfour+':</td><td align="right">'+application.resource.currency_symbol+this.purchaseDetails.amount_total+"</td></tr>"}else{j+='<tr><td align="left">Credit Card:</td><td align="right">'+application.resource.currency_symbol+this.purchaseDetails.amount_total+"</td></tr>"}j+='<tr><td colspan="2">&nbsp;</td></tr>';j+=f;j+="</table>";var d={id:"tmp"};application.events.subscribe(d,"navigate",function(l){l.preventDefault();log.write("Blocked navigation per 2011 bug.")});BrowseView.showMessage("payment_table_popup",{Message:"PAYMENT BREAKDOWN",Content:j,OK:"Close",callback:function(l){log.write("back: "+l);application.events.unsubscribe(d,"navigate")}.bind(this)})},onBillingInfoLoaded:function(l){if(l.responseCode==31){l.giftCertificateBalance=0;l.cCLast4="";l.errorHandled=true}var d=0,j=l.giftCertificateBalance,h=Math.round(this.persist.sku.price*100),g,f=this.persist.sku,k,e,m;switch(f.purchaseType){case"any":case"buy":k=application.resource.confirmation.buy[this.getTitleObject().titleType];break;case"rent":k=application.resource.confirmation.rent;k=k.replace("{Period}",f.rentalPeriod);break}if(f.skuType.indexOf("HD")>-1){k+=application.resource.confirmation.hd}m=(l.cCLast4&&l.cCLast4.length>0)?" "+l.cCLast4:"";$cn.methods.calcOrderTax(this.persist.sku.skuID,null,function(n){if(l.responseCode==31){n.subTotal=0;n.tax=0;n.errorHandled=true}var q,p;h=n.subTotal>0?Math.round(n.subTotal*100):h;g=h+Math.round(n.tax*100)-this.discountAmount;if(g>0){d=Math.min(j,g);g-=d}else{g=0}this.purchaseDetails={amount_subtotal:$cn.utilities.formatAsMoney(h),amount_tax:$cn.utilities.formatAsMoney(n.tax*100),amount_coupon:$cn.utilities.formatAsMoney(this.discountAmount),amount_giftcard:$cn.utilities.formatAsMoney(this.discountAmount+d),amount_total_discount:$cn.utilities.formatAsMoney(this.discountAmount+d),amount_giftcard_remaining:$cn.utilities.formatAsMoney(j),amount_creditcard:$cn.utilities.formatAsMoney(g),amount_total:$cn.utilities.formatAsMoney(g),tax_string:application.resource.tax_string,lastfour:m,total_confirm:k};if(this.tplCart===null){this.tplCart=new ui.template("cartdetails",application.ui.loadTpl("cartdetails.tpl"))}else{this.tplCart.empty()}this.tplCart.append(this.purchaseDetails);this.tplCart.apply();p=$("cartdetails");if(document.getElementById("cartdetails")){if(this.discountAmount>0){if(0+j>0){p.getElements(".giftcard_coupon").show()}else{p.getElements(".coupon").show()}}else{if(d>0){p.getElements(".giftcard").show()}}q=$("giftcard_remaining");if(j<=0&&q){q.hide()}p.getElements(".taxes").hide();p.getElements("#taxesString").hide();p.getElement(".total .col1 span.white").hide();if((n.tax>0&&n.tax!=="")||($cn.config.EnableTaxAPI&&n.tax!==0)){p.getElements(".taxes").show()}else{if($cn.config.EnableTaxAPI){p.getElements("#taxesString").show();p.getElement(".total .col1 span.white").show()}}}this.paymentInfoAvailable=true;if(this.paymentInfoListener){log.write("--- was waiting for payment info, now firing ---");this.paymentInfoListener();this.paymentInfoListener=null}$("checkout1").addClass("placeorder")}.bind(this))},handleSettingWheelChange:function(e){var d=e.args[0];switch(d.name){case"buy":case"rent":this.loadView("checkout.buy");break;case"freepreview":this.loadView("checkout.freepreview");break}this.loadData(d)},show:function(){$("checkoutpanel").show();application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"activated",this.updateCheckoutPanelStatus.bind(this));if($cn.data.d2dPath){if(!this.checkD2DValid()){var e=application.resource.d2d_messages.invalid,d={Message:e.Message,Content:e.Content,Close:e.OK};BrowseView.showMessage("message_d2d_content",d)}BrowseView.CurrentProcessLoaded=true;$cn.data.d2dPath=false}},hide:function(){application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"activated");$("checkoutpanel").hide();log.write("enable buttons");this.deactivate()},getWarning:function(d){if(d=="R"||d=="NC17"||d=="NR"){$("movieWarning").removeClass("hidden");$("checkoutProductList").addClass("hidden")}else{if(d=="TVMA"){$("tvWarning").removeClass("hidden");$("checkoutProductList").addClass("hidden")}else{if(d=="MA"){$("matureWarning").removeClass("hidden");$("checkoutProductList").addClass("hidden")}}}},navigate:function(payload){var p=payload.args[0];if($("checkoutpanel").isParentOf($(p.current))){if(p.direction=="left"&&$(p.current).get("left")===null){this.deactivate();var focusID=$("singlewheel").offsetWidth?"singleselectedmaster":"tdbuttonCheckout";navigation.setFocus(focusID,true);payload.preventDefault()}else{if(p.direction=="right"&&$(p.current).get("right")===null){payload.preventDefault();if(!this.isNavigating){if($(p.current).get("rightaction")=="true"){eval("("+$(application.element.current).get("rightaction")+")")}}}}}},onRedeemed:function(d){if(d.args[0].coupon){this.couponCode=d.args[0].coupon;this.discountAmount=d.args[0].amount}$cn.methods.getBillingInfo(this.onBillingInfoLoaded.bind(this))},updateCheckoutPanelStatus:function(d){$cn.methods.lookupPurchaseDetailsForTitle(this.getTitleObject().titleID,function(e){$cn.methods.getBillingInfo(this.onBillingInfoLoaded.bind(this));this.inLibrary=e.isAvailable;if(e.state!="Not_Owned"){var f=this.getTitleObject();this.persist.passID=e.passID;if(f.show){application.putInnerHTML($("checkout_message"),application.resource.ownership_state.tv_title[e.state])}else{application.putInnerHTML($("checkout_message"),application.resource.ownership_state.title[e.state])}}}.bind(this))}},CheckoutPanelControl=new Class(CheckoutPanelControlProperties);var RatePopup=new Class({Extends:ModalControl,id:"ratepopup",persist:{},controls:{},layoutIsDirty:true,tpl:null,_rating:0,_titleID:null,initialize:function(d){this.parent("ratepopup");this.contentControlId="RateStars";application.events.subscribe(this,"elementfocus",this.focus.bind(this));application.events.subscribe(this,"navigate",this.navigate.bind(this))},setRate:function(d){this._rating=d;d=d.toString().replace(/\./,"");$("RateHolder").erase("class");$("RateHolder").addClass("rate"+d)},loadData:function(d){log.write(d);this._titleID=d[0].titleID;this.parent(d)},hideIfNoFlixster:function(){var d="";if(!$cn.data.flixsterEnable){d="hide"}return d},showIfNoFlixster:function(){var d="";if($cn.data.flixsterEnable){d="hide"}return d},saveRate:function(){var d=this;log.write("Saving rate: "+this._rating);$cn.methods.rateTitle(this._titleID,this._rating,function(e){d.hide();$("YourRating").hide();if($("tdbuttonRating").getChildren("span").length){$("tdbuttonRating").getFirst("span").set("html","Change Rating")}else{$("tdbuttonRating").set("html","Change Rating")}BrowseView.TitleViewControl.setUserRating(d._rating);BrowseView.TitleViewControl.drawStarRating(parseFloat(d._rating));$("ratingstar").removeClass("display_none")})},show:function(){$("ModalWindow").setAttribute("style","");this.parent();application.events.subscribe(this,"pointerRate",this.pointerRate.bind(this));application.events.subscribe(this,"pointeractivated",this.setFocus.bind(this));application.events.subscribe(this,"pointerdeactivated",this.setFocus.bind(this));this.setFocus()},hide:function(){BrowseView.TitleViewControl.showingRating=false;this.parent();application.events.unsubscribe(this,"pointerRate");application.events.unsubscribe(this,"pointeractivated");application.events.unsubscribe(this,"pointerdeactivated")},flashArrow:function(d){$("RatingLeftArrow").removeClass("hover");$("RatingRightArrow").removeClass("hover");if(d=="left"){$("RatingLeftArrow").addClass("hover")}else{$("RatingRightArrow").addClass("hover")}setTimeout(function(){$("RatingLeftArrow").removeClass("hover");$("RatingRightArrow").removeClass("hover")},200)},navigate:function(e){if(application.element.current=="RateControl"){if(e.args[0].direction=="left"||(e.args[0].direction=="right"&&(!e.args[0].keypressed||e.args[0].keypressed!=application.keys.KEY_ENTER))){e.preventDefault();var d=0;switch(e.args[0].direction){case"left":d=e.context._rating>0.5?e.context._rating-0.5:0.5;this.flashArrow(e.args[0].direction);break;case"right":d=e.context._rating<5?e.context._rating+0.5:5;this.flashArrow(e.args[0].direction);break}e.context.setRate(d)}else{if(e.args[0].keypressed&&e.args[0].keypressed==application.keys.KEY_ENTER){this.saveRate()}else{if(e.args[0].direction=="down"){$("RateStars").removeClass("focus")}}}}},pointerRate:function(e){if(application.element.current=="RatingLeftArrow"||application.element.current=="RatingRightArrow"){pointer.lastFocusId="RateControl";if(e.args[0].direction=="left"||e.args[0].direction=="right"){e.preventDefault();var d=0;switch(e.args[0].direction){case"left":d=e.context._rating>0.5?e.context._rating-0.5:0.5;break;case"right":d=e.context._rating<5?e.context._rating+0.5:5;break}e.context.setRate(d)}}},focus:function(d){if(d.args[0].focusedelem=="RateControl"){$("RateStars").addClass("focus")}},setFocus:function(){if(pointer.isPointerModeActive()){$("RateStars").removeClass("focus");pointer.lastFocusId="RateControl"}else{if(!$("RateCancel").hasClass("hover")&&!$("RateStars").hasClass("hover")){$("RateStars").addClass("focus");application.navigator.setFocus("RateControl",true)}}},setFocusTo:function(e,d){if(d){$(e).removeClass("hover")}else{$(e).addClass("hover");application.navigator.setFocus($(e),true)}},});var PinPopup=new Class({Extends:ModalControl,id:"pinpopup",_pinValues:[-1,-1,-1,-1],_currentIndex:0,show5:false,callback:null,hideCallback:null,count:4,initialize:function(){this.parent("pinpopup");this.count=this.show5?5:4},setPointerFocus:function(d){if(application.element.current!=("Pin"+d)){if(this._pinValues[d]==-1){if(d>0){if(this._pinValues[d-1]==-1){if(application.element.current){pointer.lastFocusId=application.element.current}navigation.setFocus(null);log.write("Pinpopup.setPointerFoucs setFocus to null.");return}}$("PinFocusUpMask").show();$("PinFocusDownMask").show();pointer.lastFocusId="Pin"+d;navigation.setFocus("Pin"+d);log.write("Pinpopup.setPointerFoucs setFocus to Pin"+d)}else{if(application.element.current){pointer.lastFocusId=application.element.current}navigation.setFocus(null)}}else{log.write("Pinpopup.setPointerFoucs Else.");pointer.lastFocusId="Pin"+d}},setPinCode:function(d){if(application.element.current==null||application.element.current.indexOf("Pin")==-1){return}if(d=="up"){if(this._pinValues[this._currentIndex]<9){this._pinValues[this._currentIndex]++}else{if(this._pinValues[this._currentIndex]==9){this._pinValues[this._currentIndex]=0}}}else{if(d=="down"){if(this._pinValues[this._currentIndex]>0){this._pinValues[this._currentIndex]--}else{if(this._pinValues[this._currentIndex]<=0){this._pinValues[this._currentIndex]=9}}}}$("Pin"+this._currentIndex).innerHTML=this._pinValues[this._currentIndex]==-1?"":this._pinValues[this._currentIndex]},clickPincodeField:function(e){if(("Pin"+e)==application.element.current){pointer.lastFocusId=application.element.current;if(this._pinValues[e]>-1){navigation.setFocus(null);return}else{return}}else{if(this._pinValues[e]>-1){$("PinFocusUpMask").show();$("PinFocusDownMask").show();for(var d=e;d<this.count;d++){this._pinValues[d]=-1;$("Pin"+d).innerHTML=""}log.write("clickPincodeField:  Pin"+e);pointer.lastFocusId="Pin"+e;navigation.setFocus("Pin"+e)}}},setPinFocusArrow:function(e,d){if(application.element.current==null||application.element.current.indexOf("Pin")==-1){return}$("PinFocusUp").show();$("PinFocusDown").show();if(e=="up"){if(d){$("PinFocusUp").addClass("hover")}else{$("PinFocusUp").removeClass("hover")}}else{if(e=="down"){if(d){$("PinFocusDown").addClass("hover")}else{$("PinFocusDown").removeClass("hover")}}}},select:function(e){if(application.element.current.indexOf("Pin")==0&&application.element.current.length==4){var d=this.show5?5:4;if(e.context._currentIndex<d){e.context._currentIndex++;if(e.context._currentIndex<d){e.context.moveFocusItems(e);navigation.setFocus("Pin"+e.context._currentIndex)}}if(e.context._currentIndex==d){e.context.checkPin()}}},flashArrow:function(d){$("PinFocusUp").removeClass("hover");$("PinFocusDown").removeClass("hover");if(d=="up"){$("PinFocusUp").addClass("hover")}else{$("PinFocusDown").addClass("hover")}setTimeout(function(){$("PinFocusUp").removeClass("hover");$("PinFocusDown").removeClass("hover")},200)},navigate:function(e){if(document.getElementById(application.element.current)&&$(application.element.current).hasClass("numeric")){e.preventDefault();var g=true;var d=this.show5?5:4;switch(e.args[0].direction){case"up":if(e.context._pinValues[e.context._currentIndex]<9){e.context._pinValues[e.context._currentIndex]++}else{if(e.context._pinValues[e.context._currentIndex]==9){e.context._pinValues[e.context._currentIndex]=0}}this.flashArrow(e.args[0].direction);break;case"down":if(e.context._pinValues[e.context._currentIndex]>0){e.context._pinValues[e.context._currentIndex]--}else{if(e.context._pinValues[e.context._currentIndex]<=0){e.context._pinValues[e.context._currentIndex]=9}}this.flashArrow(e.args[0].direction);break;case"left":if((application.element.current.replace(/Pin/,"")*1)>0){e.context._pinValues[e.context._currentIndex]=-1;e.context._pinValues[e.context._currentIndex-1]=-1;application.navigator.setFocus("Pin"+(e.context._currentIndex-1))}else{g=false;application.navigator.setFocus("PinCancel")}break;case"right":if((application.element.current.replace(/Pin/,"")*1)<(d-1)){if(e.context._pinValues[e.context._currentIndex]>-1){e.context._pinValues[e.context._currentIndex+1]=-1;application.navigator.setFocus("Pin"+(e.context._currentIndex+1))}}else{if(e.context._pinValues[e.context._currentIndex]!=-1){g=false;this.checkPin()}}break}if(g){var f=e.context._pinValues[e.context._currentIndex];document.getElementById(application.element.current).innerHTML=f==-1?"":f}}else{if(application.element.current=="PinCancel"&&e.args[0].direction=="right"){e.context._pinValues=[-1,-1,-1,-1];e.context._resetPins()}}},moveFocusItems:function(f){var d=parseInt(application.resource.pinPopup.left)+(f.context._currentIndex*102);var e=d-35;$("PinFocusUp").setStyle("left",d+"px");$("PinFocusDown").setStyle("left",d+"px");$("PinFocusUpMask").setStyle("left",e+"px");$("PinFocusDownMask").setStyle("left",e+"px")},focus:function(d){if(application.element.current.indexOf("Pin")==0&&application.element.current.length==4){d.context._currentIndex=application.element.current.replace(/Pin/,"")*1;log.write("Current Index: "+d.context._currentIndex);d.context._resetPins();if(d.context._pinValues[d.context._currentIndex]<0){d.context._pinValues[d.context._currentIndex]=-1}var e=d.context._pinValues[d.context._currentIndex];document.getElementById(application.element.current).innerHTML=e==-1?"":e;$("PinFocusUp").show();$("PinFocusDown").show();$("PinIncorrect").hide();$("PinNav").show();d.context.moveFocusItems(d)}if(application.element.current=="PinCancel"){$("PinFocusUp").hide();$("PinFocusDown").hide()}},show:function(){this._pinValues=[-1,-1,-1,-1];this.parent();this._resetPins();if(!pointer.isPointerModeActive()&&application.element.current.indexOf("Pin")==0){$("PinFocusUp").show();$("PinFocusDown").show()}$("PinIncorrect").hide();if(!this.show5){$("Pin4").getParent().hide()}else{$("Pin4").getParent().show()}application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"elementfocus",this.focus.bind(this));application.events.subscribe(this,"elementblur",this.blur.bind(this));application.events.subscribe(this,"back",this.handleBack.bind(this));application.events.subscribe(this,"keydown",this.handleKeyPress.bind(this));application.events.subscribe(this,"checkpin",this.checkPin.bind(this))},unsubEvents:function(){application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"elementfocus");application.events.unsubscribe(this,"elementblur");application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"keydown");application.events.unsubscribe(this,"checkpin")},handleBack:function(d){d.preventDefault();this.unsubEvents();this.hide()},handleKeyPress:function(d){if(document.getElementById(application.element.current)&&$(application.element.current).hasClass("numeric")){switch(d.args[0].event.keyCode){case application.keys.KEY_1:this.setCurrentVal(1,d);break;case application.keys.KEY_2:this.setCurrentVal(2,d);break;case application.keys.KEY_3:this.setCurrentVal(3,d);break;case application.keys.KEY_4:this.setCurrentVal(4,d);break;case application.keys.KEY_5:this.setCurrentVal(5,d);break;case application.keys.KEY_6:this.setCurrentVal(6,d);break;case application.keys.KEY_7:this.setCurrentVal(7,d);break;case application.keys.KEY_8:this.setCurrentVal(8,d);break;case application.keys.KEY_9:this.setCurrentVal(9,d);break;case application.keys.KEY_0:this.setCurrentVal(0,d);break;case application.keys.KEY_ENTER:if(this._pinValues[this._currentIndex]!=-1){this.select(d)}break;default:break}}},setCurrentVal:function(d,e){this._pinValues[this._currentIndex]=d;document.getElementById(application.element.current).innerHTML=d==-1?"":d;this.select(e)},blur:function(f){$("PinFocusUp").hide();$("PinFocusDown").hide();$("PinFocusUpMask").hide();$("PinFocusDownMask").hide();f.context._resetPins();var e=true;if(pointer.isPointerModeActive()){for(var d=0;d<this.count;d++){if(this._pinValues[d]==-1){e=false;break}}if(e){application.events.publish("checkpin")}}},_resetPins:function(){for(var d=0;d<5;d++){if(this._pinValues[d]>-1){$("Pin"+d).innerHTML="*"}else{$("Pin"+d).innerHTML=""}}},checkPin:function(){if(this.show5){this._pinValues[4]=""}$("Pin3").innerHTML="*";var e=this._pinValues.join("");this._pinValues=[-1,-1,-1,-1];var d=this;if(application.authSupported){application.isBusy=true;navigation.setFocusElement(null);$cn.methods.checkParentPin(e,function(f){application.isBusy=false;if(f){d._currentIndex=0;d.hide();d.unsubEvents();if(d.callback){d.callback.call(d)}}else{d._pinValues=[-1,-1,-1,-1];d._resetPins();d._currentIndex=0;if(!pointer.isPointerModeActive()){application.navigator.setFocus("Pin0")}else{pointer.lastFocusId="Pin0"}$("PinIncorrect").show();$("PinNav").hide()}})}else{d._pinValues=[-1,-1,-1,-1];d._resetPins();d._currentIndex=0;$(application.element.current).innerHTML=0;if(!pointer.isPointerModeActive()){application.navigator.setFocus("Pin0",true)}else{pointer.lastFocusId="Pin0"}$("PinIncorrect").show();$("PinNav").hide()}},hide:function(){this.unsubEvents();this.parent()},cancel:function(){this.hide()}});var ConfirmPopup=new Class({Extends:ModalControl,id:"confirmpopup",purchaseType:"buy",rentalLimit:"",initialize:function(){this.parent(this.id)},goLibrary:function(d,e){navigation.setFocusElement(null);$cn.methods.getPurchasedTitle(e,d,function(f){BrowseView.loadTitle(f,"");this.hide(function(){BrowseView.TitleViewControl.setFocus()})}.bind(this));BrowseView.setView("library-view")},startPlay:function(d,e){this.hide();this.parent(d,e)},setStatus:function(j,f,e,g,d){$("ConfirmationContainer").erase("class");$("ConfirmationContainer").addClass(j);$("ConfirmationContainer").addClass(f);$("ConfirmationContainer").addClass(e);if(g){$("ConfirmationContainer").addClass("hd")}if(d){$("ConfirmationContainer").addClass("surround")}var h="ConfirmPlay";switch(e){case"episode1":h="ConfirmPlayEpisode1";break;case"resume":h="ConfirmResumePlay";break}this.rentalLimit=(f.indexOf("rent")>-1)?f.replace("rent",""):"";this.purchaseType=j;this.firstFocus=h;this.layoutIsDirty=true;this.show()},hide:function(d){this.parent();$("ModalWindow").erase("style");if(d===null){d=function(){BrowseView.TitleViewControl.setFocus()}}BrowseView.expandTitleDetails(d)},show:function(){this.parent();var d=$("ConfirmationContainer").getSize();$("ModalWindow").setStyles({top:(($("uicontainer").clientHeight-d.y)/2)+"px",height:d.y+"px",visibility:"inherit"})}});var MessagePopup=new Class({Extends:ModalControl,id:"messagepopup",callback:null,spinnerPos:1,spinnerTimer:null,initialize:function(d){this.parent(d)},draw:function(){this.parent();var f=false;var d=-413;var g=-461;if(!f){d=-1004;g=-1052}if($(this.contentId).getElement(".spinnercontainer")){var e=this;this.spinnerTimer=new Timer();this.spinnerTimer.Interval=80;this.spinnerTimer.Tick=function(){if(document.getElementById("messagespinner")){e.spinnerPosition=(e.spinnerPosition+1)%16;var h=e.spinnerPosition*80*-1;var j=d;if(e.spinnerPosition>7){h=(e.spinnerPosition-8)*80*-1;j=g}var k=document.getElementById("messagespinner");k.style.backgroundPosition=parseInt(h)+"px "+j+"px"}}}},initSpinner:function(){log.write("Loading Data");application.IsBusy=true;this.spinnerPosition=1;this.spinnerTimer.Start()},deinitSpinner:function(){this.spinnerTimer.Stop()},loadData:function(d){this.callback=d.callback;this.parent([d])},show:function(e){var d=$("ModalWindow");d.setStyle("visibility","hidden");this.parent();var f=$("messagemodalwrap").getSize();if(!e){d.setStyles({top:(($("uicontainer").clientHeight-f.y)/2)+"px",height:f.y+"px",visibility:null})}else{d.setStyles({visibility:null})}if(this.spinnerTimer){this.initSpinner()}application.isBusy=true;application.events.subscribe(this,"blockednavigate",this.blockBusy.bind(this))},hide:function(d){this.parent();application.isBusy=false;if(this.spinnerTimer){this.deinitSpinner()}BrowseView.MessagePopupCached=BrowseView.MessagePopup;BrowseView.MessagePopup=null;$("ModalWindow").setStyles({top:null,height:null});log.write("Hiding modal, and now calling callback...");if(this.callback){this.callback(d)}BrowseView.MessagePopupCached=null;application.events.unsubscribe(this,"blockednavigate")},blockBusy:function(f){var e=document.getElementById("ModalWindow").getElementsByTagName("a"),g=false,d;for(d=0;d<e.length;d++){if(e[d].id==application.element.current){var f={event:f.args[0].event,direction:f.args[0].direction,current:application.element.current};application.events.publish("navigate",f);break}}}});var SpeedInterval;var SpeedPopup=new Class({Extends:ModalControl,Implements:ModalControl,id:"speedpopup",_pinValues:[0,0,0,0,0],_currentIndex:0,initialize:function(){this.parent("speedpopup")},startSpeedCheck:function(){$("SpeedTest").show();$("SpeedResult").hide();$("SpeedUpgrade").hide();SpeedInterval=BandwidthCheck.popupBandwidthCheck(this,this.onComplete,true)},showUpgrade:function(){$("SpeedTest").hide();$("SpeedResult").hide();$("SpeedUpgrade").show();navigation.setFocus("SpeedClose2",true)},hide:function(){this.parent();clearInterval(SpeedInterval);BrowseView.showingOtherModal=false;if(this.lastFocus==="transportStop"){BrowseView.TitleViewControl.setFocus()}},onComplete:function(f){if(document.getElementById("SpeedStatusMessage")){$("SpeedStatusMessage").set("html","Testing latency...");if(f){var g=f.split("?");log.write(f);switch(g[0]){case"Complete":log.write("Speedtest: "+$cn.data.bwTest.speedBytes+" bytes per sec.");$cn.data.speedchecked=true;var e=true;var h="SpeedResult1";if($cn.data.bwTest.speedBytes>0){if($cn.data.bwTest.speedBytes<$cn.config.SDMinimumBandwidth){h="SpeedResult1"}else{if($cn.data.bwTest.speedBytes<$cn.config.HDMinimumBandwidth){h="SpeedResult2"}else{h="SpeedResult3"}}}else{e=false}log.write("showing: "+h);if(e){var d=(parseInt($cn.data.bwTest.speedBytes*8/10000)/100)+" Mbps";$("SpeedDownload").set("html",d);$("SpeedDownload2").set("html",d);$("SpeedTest").hide();$("SpeedUpgrade").hide();$("SpeedResult").show();$(h).show();if($$("#modalcontrol.speedpopup").getStyle("display")!="none"){navigation.setFocus("SpeedUpgradeButton",true)}}break;case"ProgressUpdate":application.currentView.layoutIsDirty=true;$("SpeedStatusBar").setStyle("width",g[1]+"%");break;case"SpeedUpdate":$cn.data.bwTest.speedBytes=parseInt(g[1]);break}}else{if($cn.data.bwTest.calls>=10){clearInterval(SpeedInterval);$("SpeedTest").hide();$("SpeedResult").show();$("SpeedResult1").show()}$("SpeedDownload").set("html","22 Mbps");$("SpeedDownload2").set("html","22 Mbps");navigation.setFocus("SpeedUpgradeButton",true);application.currentView.layoutIsDirty=true;$("SpeedStatusBar").setStyle("width",($cn.data.bwTest.calls*10)+"%");$cn.data.bwTest.calls++}}}});var SystemStatusPopup=new Class({Extends:ModalControl,Implements:ModalControl,startTime:null,id:"systemstatuspopup",slownessTimeout:null,slownessCheckupInterval:null,testsToPerformIndep:[{funName:"testBandwidth",defaultString:"0",htmlLocation:"#SystemStatus .bwResults .theResult",htmlLocation2:"#SystemStatus .bwSummary .theResult",completed:false,result:null},{funName:"testConnectionType",defaultString:"Not Connected",htmlLocation:"#SystemStatus .connectionResults .theResult",completed:false,result:null},{funName:"testActivationStatus",defaultString:"Not Connected",htmlLocation:"#SystemStatus .activationResults .theResult",completed:false,result:null}],testsToPerformDep:[{funName:"testIpAddress",defaultString:"Not Connected",htmlLocation:"#SystemStatus .ipResults .theResult",completed:false,result:null},{funName:"testEmailAddress",defaultString:"Not Activated",htmlLocation:"#SystemStatus .emailResults .theResult",completed:false,result:null},{funName:"testResConnection",defaultString:"Not Connected",htmlLocation:"#SystemStatus .resResults .theResult",completed:false,result:null}],_currentIndex:0,initialize:function(){this.parent("systemstatuspopup");this.storeTestsAsData(this.testsToPerformDep,this.testsToPerformIndep)},storeTestsAsData:function(){var e,d;$cn.data.SystemTests=[];for(e=0;e<arguments.length;++e){for(d=0;d<arguments[e].length;++d){$cn.data.SystemTests.push(arguments[e][d])}}},start:function(){this.testingFinished=false;this.clearPreviousResults();this.clearCompletedTests(this.testsToPerformIndep,this.testsToPerformDep);this.runTests(this.testsToPerformIndep);this.showResultsPanel();if($cn.config.SystemStatusTimeoutS){this.setSlownessTimeout($cn.config.SystemStatusTimeoutS)}else{log.write("XXXXXXXXXXX Warning XXXXXXXXXXXXXX");log.write("You are showing the System Status Popup without setting a timeout!!!");log.write("XXXXXXXXXXX Warning XXXXXXXXXXXXXX")}this.setSlownessCheckupInterval()},setSlownessTimeout:function(e){var d=this;this.slownessTimeout=setTimeout(function(){d.testingDone()},e*1000)},setSlownessCheckupInterval:function(){var d=$("SystemTestTimeRemaining");$cn.data.bwTest.intervalUpdated=true;this.slownessCheckupInterval=setInterval(function(){var e=parseInt(d.innerHTML,10)+1;if(!$cn.data.bwTest.intervalUpdated){d.innerHTML=e>$cn.config.SystemStatusTimeoutS?$cn.config.SystemStatusTimeoutS:e}$cn.data.bwTest.intervalUpdated=false},1000)},showResultsPanel:function(){$$("#settingspanel .systemstatuscotainer").hide();$$("#settingspanel .systemstatusresults").show()},clearPreviousResults:function(){$$("#SystemStatus .systemstatusresults .theResult").each(function(d){d.innerHTML=""})},clearCompletedTests:function(){var e,d;for(e=0;e<arguments.length;++e){for(d=0;d<arguments[e].length;++d){arguments[e][d].completed=false;arguments[e][d].result=null;this.setDefaultForTest(arguments[e][d])}}},runTests:function(e){var d;for(d=0;d<e.length;++d){this[e[d].funName](e[d].funName)}},testDone:function(d){var g,f,e=0,h=[this.testsToPerformIndep,this.testsToPerformDep],k=0;log.write("completed test "+d);this.getTest(d).completed=true;for(g=0;g<h.length;++g){k=k+h[g].length}for(g=0;g<h.length;++g){for(f=0;f<h[g].length;++f){if(h[g][f].completed){e=e+1}}}log.write(e+" tests done out of "+k);if(e===k){this.testingDone()}},getTest:function(d){var e;for(e=0;e<this.testsToPerformIndep.length;++e){if(d===this.testsToPerformIndep[e].funName){return this.testsToPerformIndep[e]}}for(e=0;e<this.testsToPerformDep.length;++e){if(d===this.testsToPerformDep[e].funName){return this.testsToPerformDep[e]}}return null},setString:function(d,e){log.write("###########");log.write("Setting: "+d+" to: "+e);log.write("###########");$$(d).set("html",e)},setDefaultForTest:function(d){this.setString(d.htmlLocation,d.defaultString)},setStringForTest:function(e,d){this.setString(e.htmlLocation,d)},testBandwidth:function(d){var e,f=this.getTest(d);log.write("test BW "+d+" begin");this.setString(f.htmlLocation2,"");BandwidthCheck.popupBandwidthCheck(this,this.onBwTestUpdate,false)},testConnectionType:function(d){var e=-1;var f=this.getTest(d);log.write("test Connection "+d+" begin");if($cn.utilities.Network.GetActiveType){e=$cn.utilities.Network.GetActiveType()}else{if(device.backupIPConnectionSupported){e=1}}this.testIpAddress("testIpAddress",e);switch(e){case -1:e=application.resource.testing_messages.connectionType.none;break;case 0:e=application.resource.testing_messages.connectionType.wireless;break;case 1:e=application.resource.testing_messages.connectionType.wired;break;default:e=application.resource.testing_messages.connectionType.unknown;break}log.write("your connection is: "+e);f.result=e;this.testDone(d)},testActivationStatus:function(d){var e=this,f=this.getTest(d);log.write("test Activation "+d+" begin");$cn.methods.verifyAuthToken(function(g){f.result=g?application.resource.testing_messages.activated:application.resource.testing_messages.notActivated;e.testResConnection("testResConnection");e.testEmailAddress("testEmailAddress",g);e.testDone(d)},true)},testIpAddress:function(d,f){var e="Unknown",g=this.getTest(d);log.write("test IP "+d+" begin");switch(f){case 0:case 1:log.write("about to get IP");if($cn.utilities.Network.GetIP){log.write("getting ip for connection type: "+f);e=$cn.utilities.Network.GetIP(f)}else{if(device.backupIPConnectionSupported){e="127.0.0.1"}}break}g.result=e;log.write("your ip address is: "+e);this.testDone(d)},testEmailAddress:function(e,d){var f=this,g=this.getTest(e);log.write("test Email "+e+" begin");if(d){$cn.methods.loadToken(function(){if($cn.data.UserEmailAddress){g.result=$cn.data.UserEmailAddress}f.testDone(e)},true)}else{g.result=g.defaultString;f.testDone(e)}},testResConnection:function(d){var e=this.getTest(d);log.write("test RES "+d+" begin");e.result=application.resource.testing_messages.connected;this.testDone(d)},testingDone:function(){this.testingFinished=true;log.write("$$$$ done with all tests");if(this.slownessTimeout){clearTimeout(this.slownessTimeout)}if(this.slownessCheckupInterval){clearInterval(this.slownessCheckupInterval)}if(!this.getTest("testBandwidth").completed){BrowseView.bwMessage()}this.hide()},onBwTestUpdate:function(h){var f=$("SystemStatusBar"),d=$("SystemTestTimeRemaining"),e,g,k,l;if(f){$("SystemStatusMessage").set("html",application.resource.testing_messages.testingBandwidth);if(h){var j=h.split("?");log.write(h);switch(j[0]){case"Complete":log.write("Speedtest: "+$cn.data.bwTest.speedBytes+" bytes per sec.");log.debug("Speedtest: "+$cn.data.bwTest.speedBytes+" bytes per sec.");l=$cn.data.bwTest.self.getTest("testBandwidth");l.result=parseInt($cn.data.bwTest.speedBytes*8/10000,10)/100;$cn.data.bwTest.self.testDone("testBandwidth");if(!this.testingFinished){BrowseView.bwMessage()}break;case"ProgressUpdate":$cn.data.bwTest.intervalUpdated=true;application.currentView.layoutIsDirty=true;f.setStyle("width",j[1]+"%");e=(new Date()-$cn.data.bwTest.self.startTime)/1000;if(j[1]!=0){g=100-j[1];k=e/j[1];d.innerHTML=Math.ceil(g*k)}break;case"SpeedUpdate":$cn.data.bwTest.intervalUpdated=true;$cn.data.bwTest.speedBytes=parseInt(j[1]);break}}else{$cn.data.bwTest.intervalUpdated=true;if($cn.data.bwTest.calls>=10){l=$cn.data.bwTest.self.getTest("testBandwidth");l.result=parseInt($cn.data.bwTest.speedBytes*8/10000,10)/100;$cn.data.bwTest.self.testDone("testBandwidth")}BrowseView.bwMessage();application.currentView.layoutIsDirty=true;$("SystemStatusBar").setStyle("width",($cn.data.bwTest.calls*10)+"%");$cn.data.bwTest.calls++}}},hide:function(){this.parent();this.updateHtmlWithResults();this.showWarningMarks();this.setCorrectFocus()},updateHtmlWithResults:function(){var d,e;for(d=0;d<$cn.data.SystemTests.length;++d){e=$cn.data.SystemTests[d];if(e.completed){this.setStringForTest(e,e.result)}}},showWarningMarks:function(){var f,e=false,d=application.resource.testing_messages;$cn.data.SystemTests.moreDetails={};$cn.data.SystemTests.moreDetails.data={};$cn.data.SystemTests.informativeText="";f=this.getTest("testConnectionType");if(f.result===d.connectionType.wireless||f.result===d.connectionType.none){e=true;this.makeWarningVisible(f);$cn.data.SystemTests.informativeText+=d.connectionHeading.replace("##type##",f.result)+d.connectionInfo[f.result]+"<br/><br/>"}f=this.getTest("testActivationStatus");if(f.result===application.resource.testing_messages.notActivated){e=true;this.makeWarningVisible(f);$cn.data.SystemTests.informativeText+=d.activationHeading.replace("##status##",f.result)+d.activationInfo+"<br/><br/>"}f=this.getTest("testResConnection");if(f.result===f.defaultString){e=true;this.makeWarningVisible(f);$cn.data.SystemTests.informativeText+=d.storeHeading.replace("##status##",f.result)+d.storeInfo+"<br/><br/>"}if(e){$$(".systemstatusresults #results-more-details").setStyle("display","inline-block")}},makeWarningVisible:function(d){$$(d.htmlLocation).getNext("span").setStyle("display","inline-block")},setCorrectFocus:function(){if($("results-more-details").getStyle("display")!=="none"){application.navigator.setFocus("results-more-details",true)}else{application.navigator.setFocus("results-test-again",true)}}});var WishListProperties={id:"wishlistpanel",isActive:false,currentFilter:null,currentPosition:0,tpl:null,initialize:function(){log.write(this.id+".init()");application.events.subscribe(this,"wheelitemchanged",this.handleWheelItemChange.bind(this));application.events.subscribe(this,"gridloaded",this.handleGridLoaded.bind(this));application.events.subscribe(this,"wishlistitem",this.showOptions.bind(this));application.events.subscribe(this,"savestate",this.onSaveState.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this))},handleGridLoaded:function(e){if(BrowseView.currentState=="wishlist-view"){if(this.lastSelectedItem&&this.lastSelectedItem!=""){var d=$("titlelist");var f=d.getElement("a[titleid='"+this.lastSelectedItem+"']");if(f){navigation.setFocus(f.id,true)}else{log.write("handling grid loaded by setting focuse to wheel");navigation.setFocus("singleselectedmaster",true)}this.lastSelectedItem=""}}},handleWheelItemChange:function(e){if(this.WishlistWheelControl===ActiveWheel){var d=e.args[0];log.write("Selected value: "+d.selectedvalue);this.loadList(d.selectedvalue)}},hide:function(){this.isActive=false},loadList:function(e){if(BrowseView.currentState=="wishlist-view"){var d=this;this.filter=e;if($cn.data.AuthToken!=""){if(this.data&&this.data[e]){this.currentFilter=e;BrowseView.LastGridProcess="wishlist";application.events.publish("loadgrid",{grid:"titlegrid",data:this.data[e],gridProcess:"wishlist",position:this.currentPosition,columns:4,template:"wishlist",className:"wishlistgrid"});$("messagepanel").hide();$("titlegrid").show()}else{$("titlegrid").hide();d.showMessage("wishlist_empty")}}else{$("singlewheel").hide();$("titlegrid").hide();this.showMessage("wishlist_notactivated")}this.currentPosition=0}},loadWheel:function(){var d={},e;this.lastSelectedItem="";if(this.stateRestored==true){if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastSelectedItem=$(application.element.current).get("titleid")}}e=$cn.utilities.showLoadingModal(0,application.resource.loading_enum.loadingwishlist);$cn.methods.getWishlist("Movie",function(f){log.write("getWishList callback is being executed");if(BrowseView.currentState=="wishlist-view"){if(f.items&&f.items.length){d.Movie=f.items}$cn.methods.getWishlist("TV_Show",function(g){$cn.utilities.clearLoadingSpinner(e);if(BrowseView.currentState=="wishlist-view"){if(g.items&&g.items.length){d.TV_Show=g.items}var h=[];if(d.Movie){h.push({name:"Movies",iD:"Movie",parentID:0})}if(d.TV_Show){h.push({name:"TV Shows",iD:"TV_Show",parentID:0})}if(h.length){log.write("Loading wishlist wheel!");this.data=d;$("singlewheel").show();this.WishlistWheelControl.activate();this.WishlistWheelControl.loadData(h,this.currentFilter);if(application.element.current==="singleselectedmaster"){navigation.setFocus("singleselectedmaster",true)}}else{$("singlewheel").hide();this.showMessage("wishlist_empty")}}}.bind(this))}else{$cn.utilities.clearLoadingSpinner(e)}}.bind(this))},loadWheelExt:function(){var d={},e=null;this.lastSelectedItem="";if(this.stateRestored==true){if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastSelectedItem=$(application.element.current).get("titleid")}}e=$cn.utilities.showLoadingModal(0,application.resource.loading_enum.loadingwishlist);$cn.methods.getWishlistExt("All",function(f){$cn.utilities.clearLoadingSpinner(e);if(BrowseView.currentState=="wishlist-view"){var h=[];if(f.items&&f.items.length){d.Movie=[];d.TV_Show=[];var g;for(g=0;g<f.items.length;g++){if(f.items[g].titleClassification=="Movie"){d.Movie.push(f.items[g])}else{d.TV_Show.push(f.items[g])}}if(d.Movie.length>0){h.push({name:"Movies",iD:"Movie",parentID:0})}if(d.TV_Show.length>0){h.push({name:"TV Shows",iD:"TV_Show",parentID:0})}}if(h.length){log.write("Loading wishlist wheel!");this.data=d;$("singlewheel").show();this.WishlistWheelControl.activate();this.WishlistWheelControl.loadData(h,this.currentFilter);if(application.element.current==="singleselectedmaster"){navigation.setFocus("singleselectedmaster",true)}}else{$("singlewheel").hide();this.showMessage("wishlist_empty")}}}.bind(this))},setFocus:function(){setTimeout(function(){if($("singlewheel").offsetWidth){navigation.setFocus("singleselectedmaster",true)}else{var d=$("messagepanel").getElement("a.default");if(d){navigation.setFocus(d,true)}}},100)},show:function(){this.isActive=true;this.currentFilter=null;this.currentPosition=0;this.stateRestored=false;if(!this.WishlistWheelControl){this.WishlistWheelControl=new WishlistWheelControl()}if($cn.data.AuthToken!=""){navigation.setFocus("singleselectedmaster",true);this.loadWheelExt()}else{this.showMessage("wishlist_notactivated",true)}},showMessage:function(d){if(this.tpl!=null){this.tpl.empty()}this.tpl=new ui.template("messagepanel",application.ui.loadTpl(d+".tpl"));this.tpl.compile();this.tpl.append();this.tpl.apply();var e=$("messagepanel_container");e.erase("class");e.addClass(d);log.write("showing message panel ("+d+")");$("messagepanel").show();this.setFocus()},showOptions:function(d){$cn.methods.getTitleListing(d.args[0].id,true,function(l){var f=l.name,k="",j="",h=null,g=(l.availableProducts.length)?"wishlist_options_buy":"wishlist_options",e,m=$cn.config.HighlightColor?$cn.config.HighlightColor:"#FFFFFF";if(l.titleType=="Movie"){h=$cn.utilities.purchaseText(l)}else{h=application.resource.buy_text[l.titleType];if(l.titleType=="TV_Episode"){f=$cn.utilities.getMeta("ShowName",l.metaValues);k=$cn.utilities.getMeta("SeasonName",l.metaValues);if(k.length>0){k+=", "}k+=$cn.utilities.getMeta("EpisodeNumber",l.metaValues);j='"'+l.name+'"'}else{if(l.titleType=="TV_Season"){f=$cn.utilities.getMeta("ShowName",l.metaValues);k=l.name}}}e=$cn.utilities.getMeta("PromoString",l.metaValues);if(e.length){h=h+" "+e}f=$cn.utilities.ellipsis(f,30);BrowseView.showMessage(g,{Title:'<span style="color:'+m+'">'+f+"</span>",Season:k,Episode:j,TitleID:l.titleID,mPAARating:l.mPAARating,PurchaseText:h,Index:BrowseView.GridControl.itemidx})})},showPurchase:function(d){BrowseView.MessagePopup.hide();application.TempKeyBlock=true;application.TempKeyBlockDuration=2500;application.events.publish("loadtitleview",{id:d,action:"checkout"})},showDetail:function(d){BrowseView.MessagePopup.hide();application.TempKeyBlock=true;application.TempKeyBlockDuration=2500;application.events.publish("loadtitleview",{id:d})},remove:function(f,d){BrowseView.MessagePopup.hide();var e=function(g){if(g.responseCode==0){BrowseView.GridControl.remove(d);if(BrowseView.GridControl.itemCount()==0){$("titlegrid").hide();this.show()}}};log.write("Wishlist.remove: titleId: "+f+"   index: "+d+"   count: "+BrowseView.GridControl.itemCount());$cn.methods.removeItemFromWishList(f,e.bind(this))},onActivate:function(){BrowseView.showActivate({callback:function(){this.show();this.setFocus()}.bind(this)})},onSaveState:function(f){var e=f.args[0];var d=0;if(this.isActive&&this.currentFilter){d=BrowseView.GridControl.getPosition()}e[this.id]={isActive:this.isActive,currentFilter:this.currentFilter,currentPosition:d}},onRestoreState:function(e){var d=e.args[0];if(d.store.currentState=="wishlist-view"){d=d[this.id];$extend(this,d);if(this.isActive){$("messagepanel").hide();$("scrollbar").hide();$("titlegrid").hide();$("singlewheel").hide();if($cn.data.AuthToken!=""){this.stateRestored=true;this.loadWheelExt();if(application.element.current==null){navigation.setFocus("singleselectedmaster",true)}}else{this.showMessage("wishlist_notactivated")}}}else{this.isActive=false}}},WishList=new Class(WishListProperties);var WishlistWheelControlProperties={Extends:WheelControl,Implements:WheelControl,id:"WishlistWheelControl",container:"singlewheel",singleWheel:true,MetaData:[],masterSourceElement:"singlemasterdatasource",masterSelectedElement:"singleselectedmaster",cleanUI:function(){if($("singleselectedmaster")){$("singleselectedmaster").label=""}if($("singlemasterdatasource")){if($("singlemasterdatasource").getChildren().length>0){$("singlemasterdatasource").getChildren().destroy()}}},handleWheelItemChange:function(d){log.write(d)},loadData:function(g,f){var d=0;if(f){for(var e=0;e<g.length;++e){if(g[e].iD==f){d=e;break}}}this.cleanUI();this._masterSource=g;this._renderWheel($(this.masterSourceElement),this._masterSource,d)}},WishlistWheelControl=new Class(WishlistWheelControlProperties);var LegalPopup=new Class({Extends:ModalControl,scrollview:null,initialize:function(d){this.parent(d)},setCssClass:function(e){var d=(e=="uvtermsofservice"?e:"legal");this.parent(d)},draw:function(){this.parent();var d=$(this.contentId).getElement(".scroll");if(d){this.scrollview=new ScrollView(d)}},show:function(d){if(d){this.theCallback=d}this.parent();if(this.scrollview){this.scrollview.draw()}},hide:function(){this.parent();if(this.scrollview){this.scrollview.destroy()}if(this.theCallback){this.theCallback()}},onBack:function(d){if(this.id=="eula"){d.preventDefault()}else{this.parent(d)}}});var PlayerControlProperties={id:"player",debug:false,debugAsset:"http://edge.cinemanow.com.edgesuite.net/adaptive/studio/tyson_5f09d885_wv_SD_TRAILER.vob|DEVICE_ID=dev12345|STREAM_ID=strm1234|IP_ADDR=vmes4|DRM_URL=https://fcpstage.shibboleth.tv/widevine/cypherpc/cgi-bin/GetEMMs.cgi|ACK_URL=http://vmes4/cgi-bin|I_SEEK=TIME|CUR_TIME=PTS|COMPONENT=WV",debugCCAsset:[{language:"en",closedCaptionAssetLocation:"http://us1cc.res.com.edgesuite.net/d/detour_f2b6e7d5_cc_lid_0_1.xml"}],persist:{},controls:{},buttons:[],STOPPED:0,PLAYING:1,PAUSED:2,TRICKPLAY:3,SKIPPING:4,MAX_VOL:100,MIN_VOL:0,totalTime:1,_totalbarSD:3,_totalbarHD:6,_isLoaded:false,isBuffering:false,trickPlayCnt:5,_playIndex:5,_trickPlayArr:new Array(-32,-16,-8,-4,-2,1,2,4,8,16,32),_currentStatus:0,_startPos:0,_isHd:false,_currentFileType:"STANDARD",_title:{},_bufferCount:0,_lastBuffer:0,_longBufferCount:0,_lastLongBuffer:0,_singleLongTracker:[],_errorTimeBuffer:3000,hasError:false,_readyForTrick:false,_trackBuffers:true,layoutIsDirty:true,noMoreErrors:false,tpl:null,selection:null,identifier:null,playerLoadingSpinner:null,playerLoadingSpinnerSpinning:false,doRegisterBuffers:true,registerTimeout:null,resumeTime:null,stutterTimer:null,stutterPosition:0,skipTime:0,skipStartPosition:0,skipWatchTimer:null,locateTickTimer:null,locateDirection:"",locateTimerOn:false,loadingTimer:null,loadingLimit:0,loadingInProgress:false,playPauseKey:"play",inLocateMode:false,ccData:{},elementCache:{},initialize:function(){application.events.subscribe(this,"pause",this._onPauseButton.bind(this));application.events.subscribe(this,"play",this._onPlayButton.bind(this));application.events.subscribe(this,"stop",this._onStopButton.bind(this));application.events.subscribe(this,"rewind",this._onRewindButton.bind(this));application.events.subscribe(this,"fastforward",this._onFastforwardButton.bind(this));application.events.subscribe(this,"skipback",this._onSkipbackButton.bind(this));application.events.subscribe(this,"skipforward",this._onSkipforwardButton.bind(this));application.events.subscribe(this,"play_pause",this._onPlayPauseButton.bind(this));application.events.subscribe(this,"cc_toggle",this._onClosedCaptionButton.bind(this))},_onSkipbackButton:function(){if(BrowseView.currentState=="player-view"){if(!this.hasError){BrowseView.PlayerControl._skiprw()}}},_onSkipforwardButton:function(){if(BrowseView.currentState=="player-view"){if(!this.hasError){BrowseView.PlayerControl._skipff()}}},_onPauseButton:function(){if(BrowseView.currentState=="player-view"){if(!this.hasError){BrowseView.PlayerControl._pause()}}},_onPlayButton:function(){if(BrowseView.currentState=="player-view"){if(!this.hasError){BrowseView.PlayerControl._resume()}}},_onStopButton:function(){if(BrowseView.currentState=="player-view"){this.hasError=false;BrowseView.PlayerControl._stop()}},_onPlayPauseButton:function(){if(BrowseView.currentState=="player-view"){if(!this.hasError){BrowseView.PlayerControl._playpause()}}},_onClosedCaptionButton:function(){if(BrowseView.currentState=="player-view"){if(!this.getCachedElement("CCState")||this.isBuffering||!this._isLoaded){return}if(this.hasError){return}if(this._isControlHidden()){this.showControls()}if(ccrender.isCCAvailable()){this._exitLocateMode("CCState");this.onClosedCaptionToggle()}this._regKeyTimeout("navigate")}},_mouseOverPlayerlocate:function(){if(this._currentStatus==this.STOPPED||this._currentStatus==this.PLAYING){this.getCachedElement("CurrentTime").show()}else{this.getCachedElement("CurrentTime").hide()}},_onMouseoutPlayerlocate:function(){this.getCachedElement("CurrentTime").hide()},_resetMoveDistanceAndSkipTime:function(f,d,e){if((e+f)<=0){f=-e}else{if((e+f)>d){f=d-e}else{f=f}}this.skipTime=this.totalTime*f/d;if((this.skipStartPosition+this.skipTime)<=0){this.skipTime=1-this.skipStartPosition}else{if((this.skipStartPosition+this.skipTime)>(this.totalTime-5000)){this.skipTime=this.totalTime-5000-this.skipStartPosition}else{this.skipTime=this.skipTime}}},_onMousedownPlayerlocate:function(){if(this.isBuffering||!this._isLoaded){log.write("===== Can't Mousemove on Buffering or unloaded ===== ");return}this.getCachedElement("playerlocate").addClass("hover");if(this._currentStatus==this.STOPPED||this._currentStatus==this.PLAYING){this.getCachedElement("CurrentTime").show();this.getCachedElement("Trick").removeClass("hidden")}else{this.getCachedElement("Trick").addClass("hidden")}var j,d=$("VideoProgressContainer").offsetWidth,f=arguments[0].args[0].clientX,g=parseFloat(this.getCachedElement("VideoProgress").offsetWidth),e=$("VideoProgressContainer").getStyle("left"),h=arguments[0].args[0].target.id;this._registerHideControls("playerlocate");this.showControls();this.inLocateMode=true;this.skipStartPosition=this._currentTime;if(h=="VideoProgressContainer"||h=="VideoProgressShade"){this.getCachedElement("playerlocate").addClass("hover");j=arguments[0].args[0].clientX-127;this.skipTime=this.totalTime*j/d-this.skipStartPosition;this.setProgressBar((this._currentTime/this.totalTime*100),((this.skipStartPosition+this.skipTime)/this.totalTime*100));this.onLocateToPosition();this.skipTime=0;this._regKeyTimeout("playerlocate");$(document).addEvent("mouseup",function(k){this.getCachedElement("playerlocate").addClass("hover");$(document).removeEvents("mouseup");this.getCachedElement("Trick").removeClass("hidden")}.bind(this));$("playerlocate").addEvent("mouseout",function(k){this.getCachedElement("playerlocate").removeClass("hover");$(document).removeEvents("mouseout")}.bind(this))}else{$(document).addEvent("mousemove",function(k){this.getCachedElement("playerlocate").addClass("hover");this.getCachedElement("CurrentTime").show();j=k.client.x-f;this._resetMoveDistanceAndSkipTime(j,d,g);this.setProgressBar((this._currentTime/this.totalTime*100),((this.skipStartPosition+this.skipTime)/this.totalTime*100));this.getCachedElement("CurrentTime").set("html",$cn.utilities.convertMStoTime(this.skipStartPosition+this.skipTime))}.bind(this));$(document).addEvent("mouseup",function(k){j=k.client.x-f;this._resetMoveDistanceAndSkipTime(j,d,g);this.onLocateToPosition();this.skipTime=0;this._regKeyTimeout("playerlocate");$(document).removeEvents("mousemove");$(document).removeEvents("mouseup");this.getCachedElement("Trick").removeClass("hidden")}.bind(this))}},_onNavigate:function(f){if(BrowseView.currentState=="player-view"){var d=f.args[0].current,e=f.args[0].direction;if(application.isBusy){return}else{if(!this._isLoaded||(this._isLoaded&&this.isBuffering)||(this._currentStatus===this.SKIPPING&&(e=="up"||e=="down"))){log.write("===== Can't navigate on loading, buffering or skipping =====");f.preventDefault();return}}if(this._isControlHidden()){this.showControls();f.preventDefault()}else{if((d=="playerlocate"&&(e=="left"||e=="right"))||(this._isFocusOnTransport(d)&&(e=="up"||e=="down"))||(d=="CCState"&&(e=="up"||e=="down"))){this.getCachedElement("CurrentTime").show();this.getCachedElement("Trick").addClass("hidden")}else{this.getCachedElement("CurrentTime").hide();this.getCachedElement("Trick").removeClass("hidden")}if(d==="playerlocate"&&(e==="right"||e==="left")){if(!this.locateTickTimer){this.locateTickTimer=new Timer();this.locateTickTimer.Interval=100;this.locateTickTimer.Tick=function(){if(this.locateTimerOn){if(!this._locatePlaybackTime(this.locateDirection==="right")){this.locateTimerOn=false;this.locateDirection=""}}else{this.locateTickTimer.Stop()}}.bind(this)}if(!this.locateDirection){if(this._locatePlaybackTime(e==="right")){this.locateDirection=e}}else{if(e===this.locateDirection&&!this.locateTimerOn){this.locateTimerOn=true;this.locateTickTimer.Start()}}}if(this.inLocateMode&&(this._currentStatus===this.PLAYING||this._currentStatus===this.TRICKPLAY)&&(d=="playerlocate"&&(e=="up"||e=="down"))){this._exitLocateMode()}}this._regKeyTimeout("navigate")}},_onKeyUp:function(f){if(BrowseView.currentState=="player-view"){if(this.isBuffering||!this._isLoaded){log.write("===== Can't navigate on Buffering or unloaded ===== ");return}var d=f.args[0].current,e=f.args[0].direction;if(d==="playerlocate"&&(e==="right"||e==="left")){this.locateDirection="";this.locateTimerOn=false}}},_locatePlaybackTime:function(d){var h=0,g=false,j=10000,f=Math.max(Math.floor(this.totalTime/100),10000),e=0;if(!this.inLocateMode){h=(d)?j:0-j;if(this._isPositionInBound(this._currentTime+h)){this.skipTime=h;this.skipStartPosition=this._currentTime;g=true;log.write("_locatePlaybackTime: first positioning offset: "+this.skipTime/1000)}}else{e=(this.locateTimerOn)?f:j;h=d?this.skipTime+e:this.skipTime-e;if(!h){h=d?e:0-e}if(this._isPositionInBound(this.skipStartPosition+h)){this.skipTime=h;g=true;log.write("_locatePlaybackTime: cumulative positioning offset: "+this.skipTime/1000)}}if(g){if(!this.inLocateMode){this.inLocateMode=true}this.setProgressBar((this._currentTime/this.totalTime*100),((this.skipStartPosition+this.skipTime)/this.totalTime*100));this.getCachedElement("CurrentTime").set("html",$cn.utilities.convertMStoTime(this.skipStartPosition+this.skipTime))}return g},_isControlHidden:function(){return parseInt(this.getCachedElement("PlayerLocateBottom").getStyle("bottom"))===-140},_isFocusOnTransport:function(d){var e=this.getCachedElement(d);if(e&&e.getParent().id==="PlayerTransportBar"){return true}else{return false}},_isPositionInBound:function(d){return 1000<=d&&d<=this.totalTime-5000},_exitLocateMode:function(d){this.inLocateMode=false;this.locateTimerOn=false;if(d){application.navigator.setFocus(d);this.getCachedElement("CurrentTime").hide();this.getCachedElement("Trick").removeClass("hidden")}},_onRewindButton:function(f){if(!this._isLoaded){log.write("===== Can't RW file not loaded ===== ");return}if((this._currentTime<=2000)&&(this._trickPlayArr[this.trickPlayCnt]<1)){return}if(this.hasError){return}var d=f.context;if(d._trickTest){var e=new Date();var g=$cn.utilities.DateDiff(e,d._trickTest);log.write("newDate: "+e.toString()+", self._rwTest: "+d._trickTest.toString()+", seconds: "+g);if(!d._readyForTrick&&g<2000){log.write("ignore rw");return}else{d._readyForTrick=true}d._trickTest=e}d._trickTest=new Date();d._registerHideControls("rw");d._rewind()},_onFastforwardButton:function(f){if(!this._isLoaded){log.write("===== Can't FF file is not loaded ===== ");return}if((this._currentTime<=2000)&&(this._trickPlayArr[this.trickPlayCnt]<1)){return}if(this.hasError){return}var d=f.context;if(d._trickTest){var e=new Date(),g=$cn.utilities.DateDiff(e,d._trickTest);log.write("newDate: "+e.toString()+", self._ffTest: "+d._trickTest.toString()+", seconds: "+g);if(!d._readyForTrick&&g<2000){log.write("ignore ff");return}else{d._readyForTrick=true}d._trickTest=e}d._trickTest=new Date();d._registerHideControls("ff");d._fastForward()},_onError:function(d){this._clearAllBufferTimeouts();if(this.noMoreErrors||(BrowseView.MessagePopup&&BrowseView.MessagePopup.isNowVisible)){log.write("-- Errors occuring too close together. Ignoring this one. --");return}this.noMoreErrors=true;setTimeout(function(){this.noMoreErrors=false}.bind(this),this._errorTimeBuffer);log.write("Error Occurred: "+d);this.trickPlayCnt=this._playIndex;this.hideLoading();this.isBuffering=false;this.hasError=true;if(d=="askabouthdswap_error"||d=="connectiontooslow_error_player"){this._currentStatus=this.PAUSED}else{this.stopPlayer();this._currentStatus=this.STOPPED}application.events.publish("error",this._makeErrorObject(d))},_makeErrorObject:function(d){return{type:d,titleID:this.persist.titleID,streamID:this.persist.streamid,url:this.persist.url,startTimeSeconds:parseInt(this._currentTime/1000,10),isHd:this._isHd,passID:this.persist.passID}},listenForLoad:function(){this._isLoaded=true},showStreamSwitch:function(){var d="PlayerLoading";$("PlayerLoadingDescription").show();BrowseView.PlayerControl.spinnerid="PlayerSpinner";BrowseView.PlayerControl.playeridx=0;if(BrowseView.PlayerControl.playerLoadingSpinner==null){BrowseView.PlayerControl.playerLoadingSpinner=new Timer();BrowseView.PlayerControl.playerLoadingSpinner.Interval=80;BrowseView.PlayerControl.playerLoadingSpinner.Tick=function(){if(!BrowseView.PlayerControl.playerLoadingSpinnerSpinning){BrowseView.PlayerControl.playerLoadingSpinner.Stop();BrowseView.PlayerControl.playerLoadingSpinnerSpinning=false;return}var h=false;var e=-413;var k=-461;if(!h){e=-1004;k=-1052}if(document.getElementById(BrowseView.PlayerControl.spinnerid)){var j=document.getElementById(BrowseView.PlayerControl.spinnerid);BrowseView.PlayerControl.playeridx=(BrowseView.PlayerControl.playeridx+1)%16;var f=BrowseView.PlayerControl.playeridx*80*-1;var g=e;if(BrowseView.PlayerControl.playeridx>7){f=(BrowseView.PlayerControl.playeridx-8)*80*-1;g=k}j.style.backgroundPosition=parseInt(f)+"px "+g+"px"}}}if(!BrowseView.PlayerControl.playerLoadingSpinnerSpinning){log.write("starting spinner");BrowseView.PlayerControl.playerLoadingSpinnerSpinning=true;BrowseView.PlayerControl.playerLoadingSpinner.Start();if(!BrowseView.PlayerControl.isBuffering){BrowseView.PlayerControl.isBuffering=true;this.registerBuffer()}}$(d).show()},setLoadingProgress:function(d){this.loadingLimit=d},showLoadingProgress:function(){var e=0,d=0;if(!this.loadingTimer){this.loadingTimer=new Timer();this.loadingTimer.Interval=100;this.loadingTimer.Tick=function(){if(this.loadingInProgress){if(d<this.loadingLimit){if(0<e&&e<d){e=d}d=this.loadingLimit}if(e<d&&e<100){e+=2}}else{e=0;d=0;this.loadingTimer.Stop()}$("PlayerLoadingProgress").style.width=e+"%"}.bind(this)}if(!this.loadingInProgress){this.setLoadingProgress(20);this.loadingInProgress=true;this.loadingTimer.Interval=100;this.loadingTimer.Start();$("PlayerLoadingDescription").hide();$("PlayerLoading").show();$("PlayerLoadingProgressContainer").show();$("PlayerSpinner").hide()}},showLoading:function(e){var f=e?"PlayerLoadingResume":"PlayerLoading",d;$("PlayerLoadingDescription").hide();BrowseView.PlayerControl.spinnerid=e?"PlayerSpinnerResume":"PlayerSpinner";BrowseView.PlayerControl.playeridx=0;if(BrowseView.PlayerControl.playerLoadingSpinner==null){BrowseView.PlayerControl.playerLoadingSpinner=new Timer();BrowseView.PlayerControl.playerLoadingSpinner.Interval=80;BrowseView.PlayerControl.playerLoadingSpinner.Tick=function(){var k,g,m,l,h,j;if(!BrowseView.PlayerControl.playerLoadingSpinnerSpinning){BrowseView.PlayerControl.playerLoadingSpinner.Stop();BrowseView.PlayerControl.playerLoadingSpinnerSpinning=false;return}k=false;g=-413;m=-461;if(!k){g=-1004;m=-1052}if(document.getElementById(BrowseView.PlayerControl.spinnerid)){l=document.getElementById(BrowseView.PlayerControl.spinnerid);BrowseView.PlayerControl.playeridx=(BrowseView.PlayerControl.playeridx+1)%16;h=BrowseView.PlayerControl.playeridx*80*-1;j=g;if(BrowseView.PlayerControl.playeridx>7){h=(BrowseView.PlayerControl.playeridx-8)*80*-1;j=m}l.style.backgroundPosition=parseInt(h)+"px "+j+"px"}}}if(!BrowseView.PlayerControl.playerLoadingSpinnerSpinning){log.write("starting spinner");BrowseView.PlayerControl.playerLoadingSpinnerSpinning=true;BrowseView.PlayerControl.playerLoadingSpinner.Start();if(!BrowseView.PlayerControl.isBuffering){BrowseView.PlayerControl.isBuffering=true;this.registerBuffer()}}$(f).show();$("PlayerSpinner").show();$("PlayerLoadingProgressContainer").hide()},hideLoading:function(){if(this.loadingTimer){this.loadingInProgress=false}if(this.playerLoadingSpinner){this.playerLoadingSpinner.Stop();this.playerLoadingSpinnerSpinning=false}$("PlayerLoading").hide();$("PlayerLoadingResume").hide()},show:function(){this.lastFocus=application.element.current;BrowseView.PlayerControl._currentTime=0;this._swappedToSD=false;this._isLoaded=false;this._readyForTrick=false;application.events.subscribe(this,"back",this.handleBack.bind(this));application.events.subscribe(this,"goback",this.handleBack.bind(this));application.events.subscribe(this,"select",this.handleSelect.bind(this));application.events.subscribe(this,"navigate",this._onNavigate.bind(this));application.events.subscribe(this,"keyup",this._onKeyUp.bind(this));application.events.subscribe(this,"pointerclick",this._onPlayerClick.bind(this));application.events.subscribe(this,"pointeractivated",this._onPlayerClick.bind(this));application.events.subscribe(this,"pointerdeactivated",this._onPlayerClick.bind(this));application.events.subscribe(this,"pointermousedown",this._onMousedownPlayerlocate.bind(this));application.events.subscribe(this,"pointermouseout",this._onMouseoutPlayerlocate.bind(this));$("playerlocate").addEvent("mouseover",this._mouseOverPlayerlocate.bind(this));BrowseView.hideLogo();$("dock").hide();$("uicontainer").addClass("initPlayerBackground");$("store").set("class","");$("mainstage").hide();$("imagepopup").hide();if(!pointer.isPointerModeActive()){$("PlayerLoadingCancel").hide()}application.navigator.setFocus("transportPlayPause",true);$("PlayerLogo").removeClass("redbuttons");$("PlayerContainer").show();this.mouseMoveWakeupCtl();Player.SetVisibility(true)},hide:function(){application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"goback");application.events.unsubscribe(this,"select");application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"keyup");application.events.unsubscribe(this,"pointerclick");application.events.unsubscribe(this,"pointeractivated");application.events.unsubscribe(this,"pointerdeactivated");application.events.unsubscribe(this,"pointermousedown");application.events.unsubscribe(this,"pointermouseout");navigation.setFocus(this.lastFocus,true);$("PlayerContainer").hide();Player.SetVisibility(false);$("uicontainer").addClass("containerBackground");this.unbindeMouseMoveWakeupCtl();BrowseView.showLogo();$("dock").show();$("mainstage").show()},_clearAllBufferTimeouts:function(){var d;log.write("++++++ clearing all timeouts");if(BrowseView.PlayerControl.playerTimeout){clearTimeout(BrowseView.PlayerControl.playerTimeout);BrowseView.PlayerControl.playerTimeout=false}if(BrowseView.PlayerControl.bufferCheckTimeout){clearTimeout(BrowseView.PlayerControl.bufferCheckTimeout);BrowseView.PlayerControl.bufferCheckTimeout=false}for(d=0;d<this._singleLongTracker.length;++d){if(this._singleLongTracker[d]){clearTimeout(this._singleLongTracker[d]);this._singleLongTracker[d]=false}}this._lastBuffer=0;this._bufferCount=0;this._lastLongBuffer=0;this._longBufferCount=0},load:function(l,n,e,g,k,d,m,h){this._clearAllBufferTimeouts();this.identifier=$cn.utilities.uniqueIdentifier();log.write("uid is: "+this.identifier);log.write("================ Player.load() ===================");application.bandwidthCheck.callbackType="player";var p=this,j=(d==""),f=$cn.utilities.currentlyPlayingAudioProfile(d);$("PlayerLoadingTitle").set("html","");if(this.playerLoadingSpinnerSpinning&&this.playerLoadingSpinner){this.playerLoadingSpinner.Stop();this.playerLoadingSpinnerSpinning=false}(j)?this.showLoading():this.showLoadingProgress();this.persist.titleID=l;this.persist.passID=d;this.persist.streamid=n;this.persist.url=e;this._isHd=k;this.hasError=false;this.trickPlayCnt=this._playIndex;this._isLoaded=false;this.bandwidthError=false;this.resumeTime=g;this._currentStatus=this.STOPPED;this.stutterPosition=0;this.playPauseKey="play";this._trackBuffers=true;this.clearElementCache();this._currentTime=0;this.totalTime=0;this.setProgressBar(0,-1);this.getCachedElement("TimeSpent").set("html","");this.getCachedElement("TimeRemain").set("html","");log.write("this._isHd: "+this._isHd+", audioProfileType: "+f);this.getCachedElement("audiotype").className="";this.getCachedElement("surround").removeClass("visible");$("audiobadges_player").hide();if(!j){if(f!="Stereo_Standard"&&this._isHd){this.getCachedElement("audiotype").className=f;this.getCachedElement("surround").addClass("visible");if(BrowseView.TitleViewControl.getAudioIconCssClass("Dolby_Digital_Plus_Stereo")){$("dolbyplus_player").hide()}else{$("dolbyplus_player").show();if(BrowseView.TitleViewControl.showAudioMetaField("HDOnly")){$("dolbyplus_player").addClass("hd")}else{$("dolbyplus_player").removeClass("hd")}}if(BrowseView.TitleViewControl.getAudioIconCssClass("Dolby_Digital_Plus_51")){$("dolby51_player").hide()}else{$("dolby51_player").show();if(BrowseView.TitleViewControl.showAudioMetaField("HDOnly")){$("dolby51_player").addClass("hd")}else{$("dolby51_player").removeClass("hd")}}if(BrowseView.TitleViewControl.getAudioIconCssClass("DTS_Express_51")){$("dtsexpress51_player").hide()}else{$("dtsexpress51_player").show();if(BrowseView.TitleViewControl.showAudioMetaField("HDOnly")){$("dtsexpress51_player").addClass("hd")}else{$("dtsexpress51_player").removeClass("hd")}}if(BrowseView.TitleViewControl.getAudioIconCssClass("DTS_Express_Stereo")){$("dtsexpress20_player").hide()}else{$("dtsexpress20_player").show();if(BrowseView.TitleViewControl.showAudioMetaField("HDOnly")){$("dtsexpress20_player").addClass("hd")}else{$("dtsexpress20_player").removeClass("hd")}}$("audiobadges_player").show()}}this.isTrailer=(j);$cn.methods.getTitleListing(l,false,function(w){p._title=w;var v=p._title.titleType.substring(3,0)=="TV_",r=p._title.titleType=="TV_Episode",E=p._title.name,D="",u="",A,s;if(p.resumeTime>$cn.config.EarliestResumeS){s=(p.resumeTime-$cn.config.RewindUponResumeS)}else{s=p.resumeTime}if(r){var C=$cn.utilities.getMeta("ShowName",p._title.metaValues);var G=$cn.utilities.getMeta("SeasonName",p._title.metaValues);var q=$cn.utilities.getMeta("EpisodeNumber",p._title.metaValues);var F=$cn.utilities.getMeta("EpisodeName",p._title.metaValues);if(C){E=C}if(G){D+=G+", "}if(q){D+=q+": ";u=q+": "}D+='"'+p._title.name+'"'}u+='"'+p._title.name+'" ';var B="Loading "+u;B+=k?'<div class="HDContainer"><span class="HD"></span></div> ':"";B+=($("audiotype").className.length>0)?'<div class="AudioContainer"><span class="surround"></span></div> ':"";if(!j){B+=$cn.utilities.getMeta("HasClosedCaption",p._title.metaValues)=="True"?'<div class="CCBadgeContainer"><span class="ccBadge"></span></div> ':""}B+="...";$("PlayerLoadingTitle").set("html",B);p.setTitleDisplay(E,D);p.ccData=m;var H=(p.ccData!=undefined)&&(p.ccData.length>0);ccrender.init("TimedTexts");p.updateCCState(H);log.write("Preparing to play content. url: "+e+"at position "+s);if(h){log.write("we are hdsd switching - set bw test passed to true");A=true}else{A=$cn.utilities.bandwidthCheckValid(p._isHd);log.write("we are not hdsd switching - bw test is: "+A)}if(!j&&!A){p.setLoadingProgress(65);p.loadingTimer.Stop();p.loadingTimer.Interval=250;p.loadingTimer.Start()}log.write("bandwidthCheckValid is: "+A);if(A){if(application.playbackSupported&&(p.debug||e==null)){p._play(p.debugAsset,0)}else{p._play(e,(g<$cn.config.EarliestResumeS-$cn.config.RewindUponResumeS)?0:s)}}else{BandwidthCheck.playerBandwidthCheck(e,p._isHd,g,s,PlaybackBandwidthTest)}})},handleBack:function(d){if(BrowseView.currentState=="player-view"&&$$("div.message_exit").length==0){d.preventDefault();if(this.isBuffering){this.isBuffering=false;this._clearAllBufferTimeouts()}this.hasError=false;this._stop(true)}},handleSelect:function(d){if(BrowseView.currentState=="player-view"){if(!application.isBusy&&this._currentStatus===this.PLAYING&&this._isControlHidden()){this.showControls();this._regKeyTimeout("navigate");d.preventDefault()}}},setPlayStateDisplay:function(e,d){$("PlayerContainer").erase("class");$("PlayerContainer").addClass(e);$("PlayerContainer").addClass(e+"_"+d);if(d&&d!=""){$("PlayerContainer").addClass("skiptext");this.getCachedElement("TransportRW").set("html","<div>"+d+"</div>");this.getCachedElement("TransportFF").set("html","<div>"+d+"</div>");this.getCachedElement("TransportSkipRW").set("html","<div>"+d+"</div>");this.getCachedElement("TransportSkipFF").set("html","<div>"+d+"</div>");this.getCachedElement("TrickText").set("html",d)}if(e==="play"){this.getCachedElement("VideoQuality").show()}else{this.getCachedElement("VideoQuality").hide()}this.getCachedElement("TransportCenter").show()},setProgressBar:function(f,d){var e=0;if(d>-1){if(f<d){this.getCachedElement("VideoProgress").style.width=f+"%";this.getCachedElement("VideoProgressShade").style.width=d+"%";e=this.getCachedElement("VideoProgressShade").offsetWidth+115}else{this.getCachedElement("VideoProgressShade").style.width=f+"%";this.getCachedElement("VideoProgress").style.width=d+"%";e=this.getCachedElement("VideoProgress").offsetWidth+115}}else{this.getCachedElement("VideoProgress").style.width=f+"%";this.getCachedElement("VideoProgressShade").style.width=f+"%";e=this.getCachedElement("VideoProgress").offsetWidth+115}this.getCachedElement("TrickRW").style.left=e+"px";this.getCachedElement("TrickFF").style.left=e+"px";this.getCachedElement("TrickSkipFF").style.left=e+"px";this.getCachedElement("TrickSkipRW").style.left=e+"px";this.getCachedElement("TrickText").style.left=(e+25)+"px";this.getCachedElement("CurrentTime").style.left=(e-15)+"px";this.getCachedElement("playerlocate").style.left=(e-137)+"px"},setQuality:function(f){var e=this.getCachedElement("VideoQuality");e.erase("class");e.addClass("q"+f);if(this._isHd&&f>2){e.addClass("hd")}var d="";switch(f){case 1:d=this._isHd?"":"0.7 Mbps";break;case 2:d=this._isHd?"2.0 Mbps":"1.0 Mbps";break;case 3:d=this._isHd?"4.0 Mbps":"1.5 Mbps";break;case 4:d=this._isHd?"8.0 Mbps":"2.0 Mbps";break}this.getCachedElement("BitrateText").set("html",d)},setTimeDisplay:function(e){this._currentTime=e;this.getCachedElement("TimeSpent").set("html",$cn.utilities.convertMStoTime(e));this.getCachedElement("TimeRemain").set("html","-"+$cn.utilities.convertMStoTime(parseInt(parseInt(this.totalTime)-parseInt(e))));var f=(e/this.totalTime*100),d;if(this._currentStatus===this.SKIPPING||this.inLocateMode){d=((this.skipStartPosition+this.skipTime)/this.totalTime*100)}else{d=-1;this.getCachedElement("CurrentTime").set("html",$cn.utilities.convertMStoTime(e))}this.setProgressBar(f,d);device.displayTime(e)},setTitleDisplay:function(e,d){$("VideoTitle").set("html",e);$("VideoSummary").set("html",d)},updateCCState:function(f){var e=this.getCachedElement("CCState"),d=ccrender.isCCEnabled();ccrender.setCCAvailable(f);if(e){e.removeClass("CCOn");e.removeClass("CCOff");e.removeClass("CCUnavailableOn");e.removeClass("CCUnavailableOff");if(f){this.getCachedElement("transportSkipRW").setAttribute("left","CCState");this.getCachedElement("transportSkipFW").setAttribute("right","CCState");if(d){e.addClass("CCOn")}else{e.addClass("CCOff")}}else{this.getCachedElement("transportSkipRW").setAttribute("left","transportSkipFW");this.getCachedElement("transportSkipFW").setAttribute("right","transportSkipRW");if(d){e.addClass("CCUnavailableOn")}else{e.addClass("CCUnavailableOff")}}}},hideControls:function(d,f){log.write("caller == "+d+", BrowseView.PlayerControl._hideCtrlId: "+BrowseView.PlayerControl._hideCtrlId);if(d==BrowseView.PlayerControl._hideCtrlId||f){var g=new Fx.Morph($("PlayerTop"),{duration:300,transition:Fx.Transitions.Sine.easeOut});var e=new Fx.Morph($("PlayerLocateBottom"),{duration:300,transition:Fx.Transitions.Sine.easeOut});g.start({top:"-90px"});e.start({bottom:"-140px"});$("TransportCenter").hide();this._exitLocateMode()}},showControls:function(){if(BrowseView.PlayerControl._currentStatus==BrowseView.PlayerControl.PLAYING){BrowseView.PlayerControl._StreamBitRates()}else{}var e=new Fx.Morph($("PlayerTop"),{duration:300,transition:Fx.Transitions.Sine.easeOut});var d=new Fx.Morph($("PlayerLocateBottom"),{duration:300,transition:Fx.Transitions.Sine.easeOut});e.start({top:"0px"});d.start({bottom:"0px"})},registerBuffer:function(){var j,h,e=this,k,f,d=this.identifier,g;log.write("+++ doRegisterBuffers: "+this.doRegisterBuffers);log.write("+++ currentStatus: "+this._currentStatus);log.write("********* playerTimeout is: "+this.playerTimeout);if(!this.playerTimeout){log.write("+++ creating a new playerTimeout");this.playerTimeout=setTimeout(function(){log.write("Buffering Timeout called back. Current Player Identity: "+e.identifier+", this timer created by: "+d+". Now check if anything should be done.");if(!e._isLoaded&&e.identifier===d){log.write("Something should be done. Buffering Timeout: Player is not loaded show error. Assuming we are unplugged.");e._onError("OnNetworkDisconnected")}},application.appSetting("PlayerBufferTimeout"))}log.write("+++ Creating this.playerTimeout: "+this.playerTimeout+" with identity "+this.identifier);if(!this.doRegisterBuffers||!this._trackBuffers||this._currentStatus!=this.PLAYING){log.write("doRegisterBuffers is: "+this.doRegisterBuffers);log.write("_trackBuffers is: "+this._trackBuffers);log.write("_currentStatus is "+this._currentStatus);log.write("--- bail from registerBuffer ---");return}this._bufferCount++;this._longBufferCount++;this._singleLongTracker[this._singleLongTracker.length]=setTimeout(function(){log.write("+++++++++++++++++++++ reduce called");e._longBufferCount=e._longBufferCount-1;log.write("+++++++++++++++++++++ reduce long buffer count by one to: "+e._longBufferCount)},application.appSetting("LongWindowMinutes")*60*1000);if(this._lastBuffer===0||this._lastLongBuffer===0){this._lastBuffer=new Date();this._lastLongBuffer=new Date()}else{f=new Date();j=$cn.utilities.DateDiff(f,this._lastBuffer);k=this.msToSeconds(j);if(k>application.appSetting("HDChokeTimeSpan")){this._bufferCount=1}this._lastBuffer=f;j=$cn.utilities.DateDiff(f,this._lastLongBuffer);k=this.msToSeconds(j);this._lastLongBuffer=f;if(this._bufferCount>=application.appSetting("HDChokeLimit")||this._longBufferCount>=application.appSetting("HDLongChokeLimit")){if(e._isHd){BrowseView.PlayerControl._onError("askabouthdswap_error")}else{log.write("+++++++++++++++++++++ Too many SD buffers shown. Connetion too slow.");BrowseView.PlayerControl._onError("connectiontooslow_error_player")}}}log.write("+++++++++++++++++++++ short buffer count: "+this._bufferCount);log.write("+++++++++++++++++++++ long buffer count: "+this._longBufferCount);log.write("+++++++++++++++++++++ time: "+(new Date()))},focusClosedCaptionToggle:function(){var d=this.getCachedElement("CCState");if(d.hasClass("CCUnavailableOff")||d.hasClass("CCUnavailableOn")){return}else{pointer.lastFocusId="CCState";navigation.setFocus(d)}},_handleHdSwap:function(){if(this._swappedToSD){return}this._swappedToSD=true;this._isHd=false;this._clearAllBufferTimeouts();this.stopPlayer();this._currentStatus=this.STOPPED},_OnTimeChanged:function(d){if(d>2000&&!this.isBuffering){this._readyForTrick=true}this.setTimeDisplay(d)},_play:function(f,e){log.write("+++ PLAY +++");var g=2000;var d=0;var h=0;if(Player){if(f){h=f.length}if(h&&h>g){log.write("PlayerControl._play, url is too long!")}else{if(h>0&&h<=g){this.setLoadingProgress(90);this._currentStatus=this.PLAYING;device.play(this,f,e,this.ccData);this.setPlayStateDisplay("play")}}}},_pause:function(){if(this.isBuffering||!this._isLoaded||this._currentStatus==this.SKIPPING){log.write("===== Can't Pause on Buffering, unloaded or skipping ===== ");return}this._exitLocateMode("transportPlayPause");if(this._currentStatus!=this.PAUSED){log.write("===== Start movie pausing ===== ");var e=this.trickPlayCnt;var d=this._currentStatus;this._currentStatus=this.PAUSED;this.playPauseKey="pause";Player.Pause();if(this.trickPlayCnt!=this._playIndex){this.trickPlayCnt=this._playIndex}this.showControls();this.setPlayStateDisplay("pause");device.setOnScreenSaver();this._registerHideControls("pause");log.write("Screen Saver Turned on while playback is stopped.");device.displayPause()}else{if(configuration.readValue("PauseResumeEnable")==true){this._resume()}else{log.write("===== Can't Pause, movie is already paused ===== ")}}},_resume:function(){if(this.isBuffering||!this._isLoaded){log.write("===== Can't Resume on Buffering or unloaded ===== ");return}this._exitLocateMode("transportPlayPause");if(this._currentStatus==this.SKIPPING){if(this.skipWatchTimer){clearTimeout(this.skipWatchTimer);this.skipWatchTimer=null}log.write("_resume: skip chapter, skipTime("+this.skipTime/1000+"), new position("+(this.skipStartPosition+this.skipTime)/1000+")");Player.LocateToPosition(parseInt((this.skipStartPosition+this.skipTime)/1000));this.isBuffering=true;this.showLoading(true);return}if(this.hasError&&this._currentStatus==this.PAUSED){this.hasError=false;this._clearAllBufferTimeouts()}log.write("_resume() called and we are not buffering");if(this._currentStatus!=this.PLAYING){log.write("+++=== Movie resuming ===+++");var f=this.trickPlayCnt;var d=this._currentStatus;device.setOffScreenSaver();log.write("Screen Saver Turned off during playback.");if(d==this.PAUSED){var e=Player.Resume();log.write("Resume Response:"+e);if(e!=1){log.write("Player.Resume FAILED. Reset values and ignore the request.");this.trickPlayCnt=f;this._currentStatus=d;return}}if(this.trickPlayCnt!=this._playIndex){log.write("Reset Playback speed.");this.trickPlayCnt=this._playIndex;if(Player.SetPlaybackSpeed(this._trickPlayArr[this.trickPlayCnt])==1){this._handleTrickplay(this._trickPlayArr[this.trickPlayCnt])}else{log.write("Player.SetPlaybackSpeed FAILED. Reset values and ignore the request.");this.trickPlayCnt=f;this._currentStatus=d;return}}this.setPlayStateDisplay("play");this._currentStatus=this.PLAYING;this._regKeyTimeout("resume");this.playPauseKey="play";device.displayPlay()}else{log.write("===== Can't Resume movie already playing ===== ");this.showControls();this.setPlayStateDisplay("play");this._regKeyTimeout("resume")}},_playpause:function(){if(this._currentStatus==this.PLAYING||(this._currentStatus==this.TRICKPLAY&&this.playPauseKey=="pause")){this._pause()}else{if(this._currentStatus==this.PAUSED||(this._currentStatus==this.TRICKPLAY&&this.playPauseKey=="play")){this._resume()}}},stopPlayer:function(){setTimeout(function(){Player.Stop()},0);ccrender.clean()},_stop:function(d){$(document).removeEvents("mousemove");log.write("Attempting to stop.");var e=this;if(this.isBuffering){log.write("===== Can't Stop on Buffering ===== ");return}this.stopPlayer();this._exitLocateMode("transportStop");if(this._currentStatus!=this.STOPPED){this._currentStatus=this.STOPPED;this._saveStatus("stopped",function(){log.write("Manage Stream Instance - Stop response received.");e.isBuffering=false;e.trickPlayCnt=e._playIndex;log.write("Current stopping status: "+e._currentTime);device.setOnScreenSaver();log.write("Screen Saver Turned on while playback is stopped.");device.displayStop();e._handleReturnKey(d)})}else{this._handleReturnKey(d)}},_fastForward:function(){if(this.isBuffering||this._currentStatus==this.SKIPPING){log.write("===== Can't TrickPlay on Buffering or skipping ===== ");return}else{this._exitLocateMode("transportFW");if(this._readyForTrick){var g=this.trickPlayCnt;var d=this._currentStatus;if(this._currentStatus==this.PAUSED){Player.Resume();this.trickPlayCnt=this._playIndex+1}else{if(this.trickPlayCnt<this._playIndex){this.trickPlayCnt=this._playIndex}this.trickPlayCnt++;if(this.trickPlayCnt>=this._trickPlayArr.length){this.trickPlayCnt=this._playIndex+1}}this._readyForTrick=false;log.write("_trickPlayArr["+this.trickPlayCnt+"] :: "+this._trickPlayArr[this.trickPlayCnt]);var e=Player.SetPlaybackSpeed(this._trickPlayArr[this.trickPlayCnt]);log.write("setspeed:"+e);if(e==1){log.write("Handle Trickplay UI");this._handleTrickplay(this._trickPlayArr[this.trickPlayCnt]);if(this._trickPlayArr[this.trickPlayCnt]==1){this._currentStatus=this.PLAYING;this._regKeyTimeout("tp")}else{this.setToTrickPlay()}}else{log.write("Player.SetPlaybackSpeed FAILED. Reset values and ignore the request.");this.trickPlayCnt=g;this._currentStatus=d;if(this._currentStatus==this.PAUSED){var f=Player.Pause()}}}}},setToTrickPlay:function(){this._currentStatus=this.TRICKPLAY},_rewind:function(){if(this.isBuffering||this._currentStatus==this.SKIPPING){log.write("===== Can't TrickPlay on Buffering or skipping ===== ");return}this._exitLocateMode("transportRW");if(this._readyForTrick){var g=this.trickPlayCnt;var d=this._currentStatus;if(this._currentStatus==this.PAUSED){Player.Resume();this.trickPlayCnt=this._playIndex-1}else{if(this.trickPlayCnt>this._playIndex){this.trickPlayCnt=this._playIndex}this.trickPlayCnt--;if(this.trickPlayCnt<0){this.trickPlayCnt=this._playIndex-1}}this._readyForTrick=false;var e=Player.SetPlaybackSpeed(this._trickPlayArr[this.trickPlayCnt]);log.write("setspeed:"+e);log.write("setspeed:"+e);if(e==1){log.write("_trickPlayArr["+this.trickPlayCnt+"] :: "+this._trickPlayArr[this.trickPlayCnt]);this._handleTrickplay(this._trickPlayArr[this.trickPlayCnt]);if(this._trickPlayArr[this.trickPlayCnt]==1){this._currentStatus=this.PLAYING;this._regKeyTimeout("tp")}else{this.setToTrickPlay()}}else{log.write("Player.SetPlaybackSpeed FAILED. Reset values and ignore the request.");this.trickPlayCnt=g;this._currentStatus=d;if(this._currentStatus==this.PAUSED){var f=Player.Pause()}}}},_skipff:function(){this._skipChapter(true)},_skiprw:function(){this._skipChapter(false)},_skipChapter:function(d){if(this.isBuffering||!this._isLoaded){log.write("===== Can't TrickPlay on Buffering or unloaded ===== ");return}this._exitLocateMode(d?"transportSkipFW":"transportSkipRW");var f=300000,g=0,e=false;if(this._currentStatus!=this.SKIPPING){g=(d)?f:0-f;if(this._isPositionInBound(this._currentTime+g)){this.skipTime=g;this.skipStartPosition=this._currentTime;e=true;log.write("_skipChapter: set first skip time: "+this.skipTime/1000)}}else{g=(d)?this.skipTime+f:this.skipTime-f;if(!g){g=(d)?f:0-f}if(this._isPositionInBound(this.skipStartPosition+g)){this.skipTime=g;e=true;log.write("_skipChapter: set cumulative skip time: "+this.skipTime/1000)}}if(e){if(this._currentStatus!=this.SKIPPING){this._currentStatus=this.SKIPPING;this._registerHideControls("skip");this.showControls();if(this.trickPlayCnt!=this._playIndex){this.trickPlayCnt=this._playIndex}}if(this.skipTime>0){this.setPlayStateDisplay("skipff","+"+this.skipTime/60000+"m")}else{if(this.skipTime<0){this.setPlayStateDisplay("skiprw",this.skipTime/60000+"m")}}this.setProgressBar((this._currentTime/this.totalTime*100),((this.skipStartPosition+this.skipTime)/this.totalTime*100));if(this.skipWatchTimer){clearTimeout(this.skipWatchTimer)}this.skipWatchTimer=setTimeout(function(){this.skipWatchTimer=null;if(this._currentStatus==this.SKIPPING){log.write("_skipChapter: skip chapter, skipTime("+this.skipTime/1000+"), new position("+(this.skipStartPosition+this.skipTime)/1000+")");Player.LocateToPosition(parseInt((this.skipStartPosition+this.skipTime)/1000));this.isBuffering=true;this.showLoading(true)}}.bind(this),1500)}},_handleTrickplay:function(d){this.showControls();if(d>1){this.setPlayStateDisplay("ff",d+"X")}else{if(d<0){this.setPlayStateDisplay("rw",Math.abs(d)+"X")}else{this.setPlayStateDisplay("play")}}},_StreamBitRates:function(){this._handleBitrateIndicatorNew(Player.GetQualityInfo())},_handleBitrateIndicatorNew:function(d){var g=d.PlaybackQualityLevels==4?this._totalbarSD:this._totalbarHD;var e=Math.floor(1+(g/d.PlaybackQualityLevels)*(d.PlaybackQualityLevel-1));log.write("_handleBitrateIndicatorNew: barNumber"+e);this.getCachedElement("VideoQuality").erase("class");if(d.PlaybackQualityLevels==4){this.getCachedElement("VideoQuality").addClass("qs"+e)}else{this.getCachedElement("VideoQuality").addClass("qh"+e)}if(this._isHd){this.getCachedElement("VideoQuality").addClass("hd")}var f=this._genMbpsStr(d.PlaybackQualityRate);this.getCachedElement("BitrateText").set("html",f)},_genMbpsStr:function(d){var e=(new Number(d/1000000)).toFixed(1);log.write("_genMbpsStr: Origin"+d+". after genMbps: "+e);return(e+" Mbps")},_handleBitrateIndicator:function(f){var g=parseInt(f)/(1000*1024);var d=4;var e="";if(this._currentStatus==this.PLAYING){if(!this._isHd){if(g<=0.8){d=1}else{if(g<1.1){d=2}else{if(g<=1.6){d=3}else{if(g<=2.1){d=4}else{d=4}}}}}else{if(g<4){d=2}else{if(g<4.2){d=2;if(g>=4){d=3}}else{if(g>=4.2){e="_hd";if(g<8){d=3}else{d=4}}}}}this.setQuality(d);log.write("Quality: "+f+"(bps), Quality key: "+g+", Quality IDX: "+d)}},_saveStatus:function(g,d){var f=this,k,h,l;if(!this.isTrailer){k=Math.floor(parseInt(this._currentTime,10)/1000);h=Math.floor(parseInt(this.totalTime,10)/1000);log.write("--- status seconds: "+k);if(k>30||this.resumeTime!=null){log.write("Saving Stream Status: "+g+", "+this._currentTime);if(k<$cn.config.EarliestResumeS||k>(h-30)){k=999001}try{l=$cn.utilities.showLoadingModal(0);$cn.methods.sendStopMessageForStream(f.persist.streamid,k,function(e){$cn.utilities.clearLoadingSpinner(l);log.write("Play Status Saved");if(d&&typeof d=="function"){d.call(this)}})}catch(j){d.call(this)}}else{d.call(this)}}else{d.call(this)}},_handleReturnKey:function(d){var f,e=this;this.hideLoading();if(!this.hasError){log.write("this.persist.passID: "+this.persist.passID);f={passID:this.persist.passID,stopPositionMins:(!this.hasError)?Math.floor((parseInt(this._currentTime)/1000)/60):0,stopPositionPercent:(!this.hasError)?parseInt(parseFloat(this._currentTime/this.totalTime)*100):0,bandwidthError:this.bandwidthError};if(d&&e._title.titleType=="TV_Episode"){log.write("$$$$$$$ NEXT EPISODE EXISTS $$$$$$$");f.setFocus="tdbuttonNextEpisode"}else{if(BrowseView.showingOtherModal){f.leaveFocusAlone=true;BrowseView.showingOtherModal=false}else{application.navigator.setFocus(this.lastFocus,true)}}BrowseView.TitleViewControl.update(f);device.setOnScreenSaver();log.write("Screen Saver Turned on while playback is stopped.");log.write("hiding player");log.write("LastFocus: "+this.lastFocus);BrowseView.currentState=(this.persist.passID)?"library-view":"titleview";$("TransportCenter").hide();application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"goback");application.events.unsubscribe(this,"select");application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"keyup");application.events.unsubscribe(this,"pointerclick");application.events.unsubscribe(this,"pointeractivated");application.events.unsubscribe(this,"pointerdeactivated");if(!this.persist.passID||this.persist.passID==""){log.write("SHOULD NOT FIRE");navigation.setFocus(this.lastFocus,true)}application.TempKeyBlock=true;application.TempKeyBlockDuration=2000;$("store").set("class","titleview");$("PlayerContainer").hide();Player.SetVisibility(false);$("uicontainer").removeClass("initPlayerBackground");BrowseView.showLogo();$("dock").show();$("mainstage").show()}else{log.write("handle return key error")}},getDisplayRatio:function(){var e=0,d=Player.GetVideoHeight(),f=Player.GetVideoWidth();if(d==0){e=0}else{e=Math.floor(f/d*100)/100}log.write("====== Video Size ========"+f+" X "+d);log.write("====== Video Ratio ========"+e);g_dRatio=e;return e},setVideoposAuto:function(){log.write("setVideoposAuto()");var k=0,j=0,l=960,g=540;var d=(Player.GetVideoWidth()==720)?640:Player.GetVideoWidth();var n=Player.GetVideoHeight();var r=1.78;var f=1.33;var e=this.getDisplayRatio();log.write("g_dRatio = "+e);if(e>f){var h=Math.floor((l*n)/d);var m=Math.floor((g-h)/2);log.write("x = "+k+" y = "+m+" width = "+l+" height = "+h);if(m<0){m=0}if(h>540){h=540}Player.SetDisplayArea(k,m,l,h)}else{var q=Math.floor((j*d)/n);var p=Math.floor((k-q)/2);log.write("x = "+p+" y = "+j+" width = "+q+" height = "+j);if(!isNaN(p)){Player.SetDisplayArea(p,j,q,j)}else{Player.SetDisplayArea(0,0,960,540)}}},_regKeyTimeout:function(d){if(this._currentStatus===this.PLAYING){setTimeout('BrowseView.PlayerControl.hideControls("'+BrowseView.PlayerControl._registerHideControls(d)+'")',3000)}},_registerHideControls:function(e){if(e==BrowseView.PlayerControl._hideCtrlId){BrowseView.PlayerControl.hideControls()}else{var d=Math.floor(Math.random()*new Date().getMilliseconds());BrowseView.PlayerControl._hideCtrlId=e+d}return BrowseView.PlayerControl._hideCtrlId},_OnStreamInfoReady:function(){if(BrowseView.currentState=="player-view"){log.write("Player.OnStreamInfoReady");var h=Player.GetDuration();var e=Player.GetVideoWidth();var d=Player.GetVideoHeight();if(Math.floor(h/1000)==this._startPos){log.write("EOF Detected at start this will not play a movie. Starting from beginning.");this._play(this.persist.url,0)}var f=parseInt(h,10);var g=Math.floor(f/1000);log.write("nTotTime: "+f);log.write("nTotSec: "+g);this.totalTime=h;this.setVideoposAuto();this._StreamBitRates();if(!this.isTrailer&&!this._isLoaded){this.setLoadingProgress(100);this.loadingTimer.Stop();this.loadingTimer.Interval=100;this.loadingTimer.Start()}if(!pointer.isPointerModeActive()&&!this.hasError){application.navigator.setFocus("transportPlayPause",true)}this._qualityCheck=setTimeout("BrowseView.PlayerControl._StreamBitRates()",10000)}else{this.stopPlayer();BrowseView.PlayerControl.hide()}},setRegisterBufferTimeout:function(){},msToSeconds:function(d){return d/1000},getCachedElement:function(e){var d=this.elementCache[e];if(!d){d=$(e);if(d){this.elementCache[e]=d}}return d},clearElementCache:function(){this.elementCache={}},onStutterStart:function(){if(!this.stutterTimer&&(this.stutterPosition!=this._currentTime)){var d=this;this.stutterTimer=setTimeout(function(){d.stutterTimer=null;if(d._currentStatus==d.PLAYING){log.write("PlayerControl.onStutterStart, pause player and rebuffer");d.stutterPosition=d._currentTime;Player.Pause();OnBufferingStart()}if(!d.hasError){setTimeout(function(){if(d._currentStatus==d.PLAYING){log.write("PlayerControl.onStutterStart, end rebuffer and continue play");Player.Resume()}},6000)}},2000)}},onStutterStop:function(){if(this.stutterTimer){log.write("PlayerControl.onStutterStop, clear stuter timer");clearTimeout(this.stutterTimer);this.stutterTimer=null}else{log.write("PlayerControl.onStutterStop, end rebuffer and clear loading");OnBufferingComplete()}},onSkipChapterEnd:function(){if(this._currentStatus==this.SKIPPING){log.write("onSkipChapterEnd, back to play state.");this._currentStatus=this.PLAYING;this._exitLocateMode();log.write("onSkipChapterEnd, clear buffering flag ("+this.isBuffering+")");this.isBuffering=false;this.hideLoading();this.setPlayStateDisplay("play");this._regKeyTimeout("resume")}},onScanToPlay:function(){if(this._currentStatus==this.TRICKPLAY){this._exitLocateMode("transportPlayPause");this.trickPlayCnt=this._playIndex;this.setPlayStateDisplay("play");this._currentStatus=this.PLAYING;this._regKeyTimeout("resume");this.playPauseKey="play";device.displayPlay()}},onLocateToPosition:function(){if(this.isBuffering||!this._isLoaded){log.write("===== Can't locate on Buffering or unloaded ===== ");return}var d=0;if(this.inLocateMode){d=parseFloat((this.skipStartPosition+this.skipTime)/1000);if(this._currentStatus===this.PLAYING){this._registerHideControls("skip")}}else{if(this._currentStatus==this.TRICKPLAY||this._currentStatus==this.PAUSED){d=this._currentTime/1000}}if(d){log.write("onLocateToPosition, play from: ("+d+")");this._currentStatus=this.SKIPPING;Player.LocateToPosition(d);this.isBuffering=true;this.showLoading(true)}},onStopped:function(){if(!this._swappedToSD){return}this._swappedToSD=false;var d=this,e;log.write("Current Bandwidth is too low or too many buffers. Switching to SD at: "+this._currentTime+" short buffer count: "+this._bufferCount+" long buffer count: "+this._longBufferCount);e=Math.floor(parseInt(this._currentTime)/1000);log.write("trying to restart sd at: "+e+" seconds.");$cn.methods.getStreamingAssetLocation(d.persist.passID,"STANDARD",function(g){var f=$cn.utilities.buildPlaybackURL(g.streamingAssetLocation,g.streamID,g.dRMServerURL,g.dRMACKServerURL,g.heartbeatURL,g.heartbeatPollInSeconds,false,g.customData);f=f+"HD_STREAM_ID="+d.persist.streamid+"|";d.load(d.persist.titleID,g.streamID,f,e,false,d.persist.passID,g.availableClosedCaptions,true)})},onTransportSkipRW:function(){if(BrowseView.currentState=="player-view"){var d={};application.events.publish("skipback",d)}},onTransportRW:function(){if(BrowseView.currentState=="player-view"){var d={};application.events.publish("rewind",d)}},onTransportPlayPause:function(){if(BrowseView.currentState=="player-view"){var d={};if(this._currentStatus===this.PLAYING){application.events.publish("pause",d)}else{application.events.publish("play",d)}}},onTransportStop:function(){if(BrowseView.currentState=="player-view"){var d={};application.events.publish("stop",d)}},onTransportFF:function(){if(BrowseView.currentState=="player-view"){var d={};application.events.publish("fastforward",d)}},onTransportSkipFF:function(){if(BrowseView.currentState=="player-view"){var d={};application.events.publish("skipforward",d)}},onClosedCaptionToggle:function(){if(BrowseView.currentState!="player-view"){return}var e=this.getCachedElement("CCState"),d=ccrender.isCCEnabled(),f=ccrender.isCCAvailable();if(f&&d){log.write("onClosedCaptionToggle  SetCCEnabled(false)");e.removeClass("CCOn");e.addClass("CCOff");Player.SetCCEnabled(false);ccrender.setCCEnabled(false)}if(f&&!d){log.write("onClosedCaptionToggle  SetCCEnabled(true)");e.removeClass("CCOff");e.addClass("CCOn");Player.SetCCEnabled(true);ccrender.setCCEnabled(true)}this._regKeyTimeout("navigate")},mouseMoveWakeupCtl:function(){var d;$("PlayerContainer").addEvent("mousemove",function(){if(this._isControlHidden()){this.showControls()}if(d){clearTimeout(d)}d=setTimeout(function(){this._regKeyTimeout("navigate")}.bind(this),2000)}.bind(this))},unbindeMouseMoveWakeupCtl:function(){$("PlayerContainer").removeEvents("mousemove")},_onPlayerClick:function(){if(BrowseView.currentState!="player-view"){return}if(this._currentStatus==this.PLAYING){if(application.isBusy||!this._isLoaded||this.isBuffering){log.write("===== No need to show PlayerControl bar when loading, buffering or application is busy =====");return}if(this._isControlHidden()){this.showControls()}this._regKeyTimeout("navigate")}}},PlayerControl=new Class(PlayerControlProperties);function OnRenderingComplete(){log.write("Player.OnRenderingComplete");$("PlayerTop","PlayerLocateBottom").style.display="none";setTimeout(function(){$("PlayerTop","PlayerLocateBottom").style.display=""},3000);log.write("Video Stopped while: "+BrowseView.PlayerControl._currentStatus);log.write("Playback Speed: "+BrowseView.PlayerControl._trickPlayArr[BrowseView.PlayerControl.trickPlayCnt]);if(BrowseView.PlayerControl._currentStatus==3&&BrowseView.PlayerControl._trickPlayArr[BrowseView.PlayerControl.trickPlayCnt]<0){BrowseView.PlayerControl.stopPlayer();setTimeout(function(){BrowseView.PlayerControl._isLoaded=false;BrowseView.PlayerControl._readyForTrick=false;BrowseView.PlayerControl.hideControls("",true);BrowseView.PlayerControl.trickPlayCnt=BrowseView.PlayerControl._playIndex;BrowseView.PlayerControl._play(BrowseView.PlayerControl.persist.url,0)},500)}else{BrowseView.PlayerControl._stop(true)}}function OnStreamInfoReady(){BrowseView.PlayerControl._OnStreamInfoReady()}function OnCurrentPlayTime(d){BrowseView.PlayerControl._OnTimeChanged(d)}function OnBufferingStart(){log.write("Player.OnBufferingStart =====================");var d=BrowseView.PlayerControl.isBuffering;BrowseView.PlayerControl.isBuffering=true;if(BrowseView.PlayerControl._isLoaded){BrowseView.PlayerControl.showLoading(true)}if(!d){log.write("$$$$$$$$$ about to call register buffer ================================");BrowseView.PlayerControl.registerBuffer()}else{log.write("%%%%%%%%% did not call register buffer, there is already another ongoing buffer event +++++++++++++++++++++++++++++++++")}log.write("_currentStatus from bottom of OnBufferingStart(): "+BrowseView.PlayerControl._currentStatus)}function OnBufferingProgress(d){log.write("Player.OnBufferingProgress: prog("+d+")")}function OnBufferingComplete(){log.write("Player.OnBufferingComplete");if(BrowseView.currentState!="player-view"){return}if(!BrowseView.PlayerControl._isLoaded){BrowseView.PlayerControl.hideLoading();BrowseView.PlayerControl.isBuffering=false;BrowseView.PlayerControl.listenForLoad();if(BrowseView.PlayerControl._currentTime>2000){BrowseView.PlayerControl._readyForTrick=true}BrowseView.PlayerControl._regKeyTimeout("play");if(BrowseView.PlayerControl.playerTimeout){clearTimeout(BrowseView.PlayerControl.playerTimeout);BrowseView.PlayerControl.playerTimeout=null}if(BrowseView.PlayerControl.bufferCheckTimeout){clearTimeout(BrowseView.PlayerControl.bufferCheckTimeout);BrowseView.PlayerControl.bufferCheckTimeout=null}BrowseView.PlayerControl.showControls()}else{BrowseView.PlayerControl.hideLoading();BrowseView.PlayerControl.isBuffering=false}}function OnNetworkDisconnected(){if(BrowseView.currentState!="player-view"){return}log.write("Player.OnNetworkDisconnected");BrowseView.PlayerControl._onError("OnNetworkDisconnected")}function OnAuthenticationFailed(){if(BrowseView.currentState!="player-view"){return}log.write("Player.OnAuthenticationFailed");BrowseView.PlayerControl._onError("OnAuthenticationFailed")}function OnConnectionFailed(){if(BrowseView.currentState!="player-view"){return}log.write("Player.OnConnectionFailed");BrowseView.PlayerControl._onError("OnConnectionFailed")}function OnRenderError(){if(BrowseView.currentState!="player-view"){return}log.write("Player.OnRenderError");BrowseView.PlayerControl._onError("OnRenderError")}function OnStreamNotFound(){if(BrowseView.currentState!="player-view"){return}log.write("Player.OnStreamNotFound");if(BrowseView.PlayerControl.isTrailer){BrowseView.PlayerControl._onError("OnStreamNotFound_trailer")}else{BrowseView.PlayerControl._onError("OnStreamNotFound")}}function OnCustomEvent(e){if(BrowseView.currentState!="player-view"){return}var d=String(e);log.write("Player.OnCustomEvent: "+e);BrowseView.PlayerControl._onError("OnWideVineError_"+d)}function OnPlaybackStutterStart(){if(BrowseView.currentState!="player-view"){return}log.write("OnPlaybackStutterStart");BrowseView.PlayerControl.onStutterStart()}function OnPlaybackStutterStop(){if(BrowseView.currentState!="player-view"){return}log.write("OnPlaybackStutterStop");BrowseView.PlayerControl.onStutterStop()}function OnPlaybackSkipChapterEnd(){if(BrowseView.currentState!="player-view"){return}log.write("OnPlaybackSkipChapterEnd");BrowseView.PlayerControl.onSkipChapterEnd()}function OnPlaybackStopped(){if(BrowseView.currentState!="player-view"){return}log.write("OnPlaybackStopped");BrowseView.PlayerControl.onStopped()}function OnPlaybackCCData(d){if(BrowseView.currentState!="player-view"){return}log.write("OnPlaybackCCData");if(BrowseView.PlayerControl._currentStatus==BrowseView.PlayerControl.STOPPED){ccrender.clean()}else{ccrender.renderCCXMLNodes(d)}}function OnUpdateCCState(d){if(BrowseView.currentState!="player-view"){return}log.write("OnUpdateCCState");BrowseView.PlayerControl.updateCCState(d)}function OnScanToPlay(){if(BrowseView.currentState!="player-view"){return}log.write("OnScanToPlay");BrowseView.PlayerControl.onScanToPlay()}var LibraryClass={id:"librarypanel",isInvalid:false,tplKey:null,tpl:null,_data:[],scroll:false,_timer:600,_periodical:"",_timerStarted:false,initialize:function(d){application.events.subscribe(this,"navigate",this.handleNavigate.bind(this));application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));this.id=d;this.tplKey=this.id;this.tpl=new ui.template(this.id,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile();log.write(this.id+".init()")},cleanUI:function(){if($(this.id).getChildren().length>0){$(this.id).getChildren().destroy()}},setFocus:function(){if($("librarypanel").getStyle("display")=="block"){if($("btnLibraryActivate").getStyle("display")=="block"){navigation.setFocus("btnLibraryActivate",true)}else{navigation.setFocus("btnLibraryBrowseStore",true)}}else{navigation.setFocus("selectedmaster",true)}},show:function(){var d=this;log.write("triggered show");$("mainstage").show();if($cn.data.AuthToken.length==0){BrowseView.hideExtras();$("librarypanel").show();$("librarytop").show();$("librarytop").getElement(".buttons").addClass("double");$$(".libraryActivate").show();this.setFocus();if(BrowseView.MessagePopup){BrowseView.MessagePopup.resetFocus()}}else{BrowseView.CurrentProcessLoaded=false;$cn.utilities.showSharedLoadingModal(0,application.resource.loading_enum.library);$cn.methods.getUserLibraryExt(function(e){$cn.utilities.clearSharedLoadingSpinner();if(e.items.length>0){$("librarypanel").hide();$("librarytop").hide();$("wheel").show();$("singlewheel").hide();if(!BrowseView.LibraryWheelControl){BrowseView.LibraryWheelControl=new LibraryWheelControl()}BrowseView.GridControl.cleanUI();BrowseView.LibraryWheelControl.activate();BrowseView.LibraryWheelControl.lastSlaveValue=false;BrowseView.LibraryWheelControl.loadLibraryMenu(e);navigation.setFocus("selectedmaster",true);if(BrowseView.MessagePopup){BrowseView.MessagePopup.resetFocus()}}else{BrowseView.hideExtras();$("librarytop").getElement(".buttons").removeClass("double");$("librarypanel").show();$("wheel").hide();$("singlewheel").hide();$("librarytop").show();$$(".libraryActivate").hide();navigation.setFocus("btnLibraryBrowseStore",true);application.currentView.layoutIsDirty=true;BrowseView.CurrentProcessLoaded=true}})}$("uicontainer").addClass("redbuttons")},handleNavigate:function(d){if(BrowseView.currentState=="library-view"){if(d.args[0].direction=="left"&&application.element.current=="btnLibraryBrowseStore"){d.preventDefault();if(document.getElementById("btnLibraryActivate")&&document.getElementById("btnLibraryActivate").style.display=="block"){navigation.setFocus("btnLibraryActivate",true)}else{navigation.setFocus("dock-library",true)}if(BrowseView.MessagePopup){BrowseView.MessagePopup.resetFocus()}}}},hide:function(){this.stopRefresh();$("librarypanel").hide()},startRefresh:function(){if(!this._timerStarted){log.write("**********start refresh: "+this._timerStarted);$clear(this._periodical);this._timerStarted=true;this._periodical=this.refresh.periodical(this._timer*1000)}},refresh:function(){if(BrowseView.currentState=="library-view"){log.write("**********refreshing library.....");BrowseView.Library.show()}else{BrowseView.Library.stopRefresh()}},stopRefresh:function(){log.write("**********stop refresh");$clear(BrowseView.Library._periodical);BrowseView.Library._timerStarted=false},loadData:function(f,d,e){this._data=[];this._data=f;this.draw()},onScroll:function(d,e){},draw:function(){var d=this;this.cleanUI();this.tpl.empty();this._data.each(function(e){log.write(e);d.tpl.append(e)});this.tpl.apply()},checkUVTermsOfService:function(){var d=this;if($cn.config.UVTOSEnabled){if($cn.data.UVTermsAcceptance=="accepted"){return true}else{$cn.methods.getUVTermsOfServiceAcceptance(function(e){$cn.data.UVTermsAcceptance=e;if(e!="accepted"){$cn.methods.getUVTermsOfService(d.showUVTermsOfService.bind(d))}else{if(e=="accepted"){return true}}})}}},showUVTermsOfService:function(d){this.Legal=new LegalPopup("uvtermsofservice");var e=application.resource.uv_messages.uvTermsOfService;this.Legal.loadData([{title:($cn.data.UVTermsAcceptance=="changed"?e.ChangedMessage:e.UnacceptedMessage),content:e.Content,text:d,OK:e.OK,Close:e.Close,AcceptAction:"BrowseView.Library.acceptUVTermsOfService(true)",CloseAction:"BrowseView.Library.Legal.hide()"}]);this.layoutIsDirty=true;this.Legal.firstFocus="LegalOK";this.Legal.show();$("SplashScreen").hide()},acceptUVTermsOfService:function(e){var d=this;$cn.methods.acceptUVTermsOfService(function(f){d.Legal.hide();d.Legal.hide();$("Overlay").setStyle("background-color","transparent");$cn.data.UVTermsAcceptance=f})},onActivate:function(){BrowseView.showActivate({callback:function(){this.show();navigation.setFocus("dock-library",true);if(BrowseView.MessagePopup){BrowseView.MessagePopup.resetFocus()}}.bind(this)})},onRestoreState:function(e){var d=e.args[0];if(d.store.currentState=="library-view"&&application.element.current=="selectedmaster"){d=d[this.id];$extend(this,d);if($cn.data.AuthToken!=""){this.show()}}}},Library=new Class(LibraryClass);var LibraryWheelControl=new Class({DEBUG:false,Extends:WheelControl,Implements:WheelControl,id:"LibraryWheelControl",currentMasterValue:"Movies",currentSlaveValue:"",masterWheelOptionList:[],libraryItems:{},MOVIE_GENRES:["Action","Adventure","Animation","Comedy","Drama","Family","Horror","Romance","Sci-Fi","Thriller","Westerns"],TV_GENRES:["Action","Adventure","Animation and Cartoons","Comedy","Drama","Family","Food and Leisure","Home and Garden","Horror","Music","Other","Reality and Game Shows","Romance","Sci-Fi","Sports","Thriller","Westerns"],MasterWheel_ORDER:["Movies","Movie_Rentals","HD_Movies","HD_TV_Shows","TV_Shows"],MOVIES_ORDER:["All","UltraViolet","Never_Watched","Unavailable","Action","Adventure","Animation","Comedy","Drama","Family","Horror","Romance","Sci-Fi","Thriller"],MOVIES_RENTALS_ORDER:["All","Never_Watched","Unavailable","Action","Adventure","Animation","Comedy","Drama","Family","Horror","Romance","Sci-Fi","Thriller","Expired","Expiring_Soon"],TV_ORDER:["All","Never_Watched","Unavailable","Action","Adventure","Animation and Cartoons","Comedy","Drama","Family","Food and Leisure","Home and Garden","Horror","Music","Other","Reality and Game Shows","Romance","Sci-Fi","Sports","Talk and Interview","Thriller","Westerns"],processRawData:function(d,f){var e;this.libraryItems={};this.UV=new $cn.utilities.UserUVManager();this.UV.checkUVAccount(function(p){for(var k=0;k<d.items.length;k++){var h=[];var g=[];e=d.items[k];if(!p&&$cn.utilities.isTrue(e.isPassUV)){continue}switch(e.titleClassification){case"Movie":if(h.indexOf("Movies")<0){h.push("Movies")}break;case"TV_Show":case"TV_Season":case"TV_Episode":if(h.indexOf("TV_Shows")<0){h.push("TV_Shows")}break;default:break}if(e.isHD==true&&h.indexOf("HD_Movies")<0&&e.titleClassification=="Movie"){h.push("HD_Movies")}if(e.isHD==true&&h.indexOf("HD_TV_Shows")<0&&e.titleClassification!="Movie"){h.push("HD_TV_Shows")}if(e.purchaseType=="rent"){if(h.indexOf("Movie_Rentals")<0){h.push("Movie_Rentals")}if(e.minutesToExpire>0&&e.minutesToExpire<7*24*60&&g.indexOf("Expiring_Soon")<0){g.push("Expiring_Soon")}}if(p&&$cn.utilities.isTrue(e.isPassUV)&&(-1===$cn.utilities.inArray("UltraViolet",g))){if(g.indexOf("UltraViolet")<0){g.push("UltraViolet")}}var q=false;switch(e.watchStatus){case"WatchNow":if(g.indexOf("All")<0){g.push("All")}break;case"ExpiredRental":if(g.indexOf("All")<0){g.push("All")}if(g.indexOf("Expired")<0){g.push("Expired")}break;default:if(g.indexOf("All")<0){g.push("All")}if(g.indexOf("Unavailable")<0){g.push("Unavailable")}this.configObject(h,g,e);q=true;break}if(q){continue}if($cn.utilities.getMeta("LicensesDelivered",e.metaValues)=="0"&&g.indexOf("Never_Watched")<0){g.push("Never_Watched")}if(e.genres){var n;var j=(e.titleClassification=="Movie")?this.MOVIE_GENRES:this.TV_GENRES;for(var l=0;l<e.genres.length;l++){n=e.genres[l];for(var m=0;m<j.length;m++){if(j[m]==n.name&&g.indexOf(n.name)<0){g.push(n.name);break}}}}this.configObject(h,g,e)}f(this)}.bind(this),true)},configObject:function(e,d,h){if(this.DEBUG){log.write("librarywheel.configObject Debug: Enter with "+e+", "+d+", "+h)}for(var g=0;g<e.length;g++){if(!this.libraryItems[e[g]]){this.libraryItems[e[g]]={}}for(var f=0;f<d.length;f++){if(e[g]=="Movie_Rentals"||(d[f]!="Expired"&&d[f]!="Expiring_Soon")){if(!this.libraryItems[e[g]][d[f]]){this.libraryItems[e[g]][d[f]]=[]}if(this.DEBUG){log.write("librarywheel.configObject Debug: About to push targetItem "+h+" into "+e[g]+", "+d[f])}this.libraryItems[e[g]][d[f]].push(h)}}}},getMasterWheelOptions:function(){var d=[];for(var f=0;f<this.MasterWheel_ORDER.length;f++){for(var e in this.libraryItems){if(e==this.MasterWheel_ORDER[f]){d.push(e);break}}}return d},getSlaveWheelOptionsbyMasterWheel:function(d){var l=[];switch(d){case"Movies":case"HD_Movies":l=this.MOVIES_ORDER;break;case"Movie_Rentals":l=this.MOVIES_RENTALS_ORDER;break;case"TV_Shows":case"HD_TV_Shows":l=this.TV_ORDER;break}var e=[];var h=[];for(var g in this.libraryItems[d]){for(var k=0;k<l.length;k++){if(g==l[k]){h[k]=true;break}}}for(var f=0;f<h.length;f++){if(h[f]){var j=application.resource.LibSlaveWheelOptions[l[f]];if(!j){j=l[f].replace("_","<br/>")}e.push({name:j,iD:l[f]})}}return e},getContentbyWheelOptions:function(d,e){return this.libraryItems[d][e]},loadLibraryMenu:function(d,e){this.processRawData(d,function(){var f=this.getMasterWheelOptions();var k=[],h=0;if($cn.config.EnableD2D&&$cn.config.DeviceD2DEnabled){f.push("D2D_Movies")}for(var g=0;g<f.length;++g){var j=f[g];log.write(f[g]);if(j==e){h=g}k.push({iD:j,name:application.resource.LibMasterWheelOptions[j]})}this.currentMasterValue=f[h];this.loadData(k,{},h);this.loadSlaveDataSource(this.currentMasterValue);navigation.setFocus("selectedmaster",true)}.bind(this))},handleWheelItemChange:function(j){if(j.context===ActiveWheel){var g=this,h=j.args[0],e=h.source[h.selectedidx].parentID,d=h.selectedvalue;if(h.sourceid.indexOf("master")>-1){e=h.selectedvalue;this.currentMasterValue=h.selectedvalue;$("slavedatasource").getElements("div").destroy();j.context.loadSlaveDataSource(this.currentMasterValue)}this.lastValue=d;BrowseView.CurrentWheelValue=e+":"+d;if(h.sourceid.indexOf("slave")>-1){e=j.context.currentMasterValue;this.lastSlaveValue=d;log.write("The slave wheel item has changed. Update results.");if(e=="D2D_Movies"&&d=="Info"){var f=[{title:application.resource.lib_d2d_info.title,step1:application.resource.lib_d2d_info.step1,step2:application.resource.lib_d2d_info.step2,step3:application.resource.lib_d2d_info.step3}];BrowseView.LastGridProcess="d2dinfo";application.events.publish("loadgrid",{grid:"disctodigitalgrid",gridProcess:"d2dinfo",data:f,columns:1,template:"disctodigitalgrid"})}else{if(g.lastValue&&(g.lastValue==e||g.lastValue==d)){application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:3});BrowseView.CurrentLibraryGenreID=this.lastValue;setTimeout(function(){if(g.lastValue&&(g.lastValue==e||g.lastValue==d)){g.loadSlaveGrid(h.source[h.selectedidx])}},1000)}}}}},loadSlaveDataCallback:function(e){this._slaveSource[e]=this.getSlaveWheelOptionsbyMasterWheel(e);var f=this._slaveSource[e].length;var d=0;if(this.lastSlaveValue){while(f--){if(this._slaveSource[e][f].iD==this.lastSlaveValue){d=f;log.write("FOuND IT at index"+f)}}}if(d===0){this.lastSlaveValue=false}this._renderWheel($("slavedatasource"),this._slaveSource[e],d);application.events.publish("gridloading",{grid:"titlegrid",message:"loading",columns:3});this.loadSlaveGrid(this._slaveSource[e][d])},loadSlaveDataSource:function(g){var f=this,d=0;BrowseView.CurrentProcessLoaded=false;log.write("masterKey: "+g);this._slaveSource[g]=[];if(g=="D2D_Movies"){this._slaveSource[g].push({name:application.resource.LibSlaveWheelOptions.Info,iD:"Info"});var e=[{title:application.resource.lib_d2d_info.title,step1:application.resource.lib_d2d_info.step1,step2:application.resource.lib_d2d_info.step2,step3:application.resource.lib_d2d_info.step3}];this._renderWheel($("slavedatasource"),this._slaveSource[g],d);BrowseView.LastGridProcess="d2dinfo";application.events.publish("loadgrid",{grid:"disctodigitalgrid",gridProcess:"d2dinfo",data:e,columns:1,template:"disctodigitalgrid"})}else{f.loadSlaveDataCallback(g)}},loadSlaveGrid:function(d){BrowseView.LastGridProcess="librarylist";var e=this.getContentbyWheelOptions(this.currentMasterValue,d.iD);if(e.length>0){application.events.publish("loadgrid",{grid:"titlegrid",data:e,columns:3,gridProcess:"librarylist",template:"librarylist",cssClass:"library"})}else{application.events.publish("loadgrid",{grid:"titlegrid",data:null,template:"librarylist",gridProcess:"librarylist",cssClass:"library"})}BrowseView.CurrentProcessLoaded=true}});var ImagePopup=new Class({Extends:ModalControl,id:"imagepopup",currentIdx:0,initialize:function(){application.events.subscribe(this,"navigate",this.navigate.bind(this));this.parent(this.id,"ImageContent")},navigate:function(d){if(document.getElementById(application.element.current)!=null&&application.element.current=="closeImagePopup"){if(d.args[0].direction=="left"||d.args[0].direction=="right"){$("ImageContent").getChildren("div.imageholder")[this.currentIdx].hide();switch(d.args[0].direction){case"left":if(this.currentIdx>0){this.currentIdx=this.currentIdx-1}break;case"right":if(this.currentIdx+1<this._data.length){this.currentIdx=this.currentIdx+1}break}$("ImageContent").getChildren("div.imageholder")[this.currentIdx].show();this.setArrows()}}},setArrows:function(){$("rightArrow").hide();$("leftArrow").hide();if(this.currentIdx>0){$("leftArrow").show()}if(this._data.length>1&&this._data.length-1!=this.currentIdx){$("rightArrow").show()}},show:function(d){if(d){this.currentIdx=d}else{this.currentIdx=0}this.lastFocus=application.element.current;navigation.setFocus("closeImagePopup",true);BrowseView.hideLogo();$("dock").hide();$("uicontainer").setStyle("background","none");$("mainstage").hide();$("imagepopup").show();$("closeImagePopup").show();$("ImageContent").getChildren("div.imageholder")[this.currentIdx].show();this.setArrows()},hide:function(){navigation.setFocus(this.lastFocus,true);$("closeImagePopup").hide();$("imagepopup").hide();$("uicontainer").setStyle("background","#181818");BrowseView.showLogo();$("dock").show();$("ImageContent").getChildren("div.imageholder").hide();$("mainstage").show()},});var HelpPanelControl=new Class({id:"helppanel",persist:{},controls:{},layoutIsDirty:true,contentId:"helppanel",tpl:null,initialize:function(){$("helppanel").hide();log.write("helppanel.init()");application.events.subscribe(this,"wheelitemchanged",this.handleSettingWheelChange.bind(this));this.tpl=new ui.template(this.contentId,application.ui.loadTpl(this.id+".tpl"));this.tpl.compile()},handleSettingWheelChange:function(e){var d=e.args[0];if(d.wheelinstance=="HelpWheelControl"){log.write("Help Panel (wheel changed)");log.write(d);$$("#helppanel .panel").each(function(f){f.hide()});log.write("selected: "+d.selectedvalue);if($(d.selectedvalue)){$(d.selectedvalue).show()}}},hideIfNoBaseline:function(d){var e="";if(!$cn.data.baselineEnable){e="hide"}return e},showIfNoBaseline:function(d){var e="";if($cn.data.baselineEnable){e="hide"}return e},hideIfNoJinni:function(d){var e="";if(!$cn.data.jinniEnable){e="hide"}return e},showIfNoJinni:function(d){var e="";if($cn.data.jinniEnable){e="hide"}return e},show:function(){$("helppanel").show();this.tpl.append({custom:""});this.tpl.apply()},hide:function(){$("helppanel").hide()},getAccountLinkUrl:function(){return $cn.data.AccountLinkUrl},tm:function(){return"&#0153;"}});var HelpWheelControl=new Class({Extends:WheelControl,id:"HelpWheelControl",container:"singlewheel",singleWheel:true,MetaData:[],masterSourceElement:"singlemasterdatasource",masterSelectedElement:"singleselectedmaster",handleWheelItemChange:function(e){log.write(e);if(e.context===ActiveWheel){var d=e.args[0];log.write("Search Wheel Item changed. Now fire custom method. "+e.args[0].wheelinstance);application.events.publish("wheelvaluechanged",{selectedvalue:d.selectedvalue,wheelinstance:this.id})}},loadHelpMenu:function(){application.currentView.layoutIsDirty=true;this.cleanUI();if($cn.config.EnableUV){this.loadData([{name:application.resource.HelpWheelOptionStrings.GettingStarted,iD:"GettingStarted",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.BrowsingStore,iD:"BrowsingStore",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.Searching,iD:"Searching",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.WishList,iD:"WishList",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.Library,iD:"Library",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.ParentalControls,iD:"ParentalControls",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.OnscreenControls,iD:"OnscreenControls",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.CustomerSupport,iD:"CustomerSupport",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.RentingBuying,iD:"RentingBuying",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.Ultraviolet,iD:"Ultraviolet",parentID:0,list:1}],[{}])}else{this.loadData([{name:application.resource.HelpWheelOptionStrings.GettingStarted,iD:"GettingStarted",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.BrowsingStore,iD:"BrowsingStore",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.Searching,iD:"Searching",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.WishList,iD:"WishList",parentID:0,list:0},{name:application.resource.HelpWheelOptionStrings.Library,iD:"Library",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.ParentalControls,iD:"ParentalControls",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.OnscreenControls,iD:"OnscreenControls",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.CustomerSupport,iD:"CustomerSupport",parentID:0,list:1},{name:application.resource.HelpWheelOptionStrings.RentingBuying,iD:"RentingBuying",parentID:0,list:1}],[{}])}application.events.publish("wheelvaluechanged",{selectedvalue:"GettingStarted",wheelinstance:this.id})}});var EpisodePanelControl=new Class({id:"episodepanel",title:null,initialize:function(){},show:function(){$("titlelist").innerHTML="";this.title=BrowseView.TitleViewControl.persist.title;this.title.show=$cn.utilities.ellipsis(this.title.show,30);BrowseView.GridControl.loadHeader("episode_header.tpl",this.title);if(!this.TvSeasonsWheelControl){this.TvSeasonsWheelControl=new TvSeasonsWheelControl()}this.TvSeasonsWheelControl.isLibrary=this.title.passID!=null;this.TvSeasonsWheelControl.isSeasonal=this.title.seasonal;if(this.title.passID!=null){if(this.title.seasonal){$cn.methods.getBundleListingPurchased(this.title.showTitleID,function(e){log.write(e.bundleItems.length);this.TvSeasonsWheelControl.activate();this.TvSeasonsWheelControl.loadData(e.bundleItems,this.title.seasonTitleID);BrowseView.shrinkTitleDetails("episode-panel",null)}.bind(this))}else{this.TvSeasonsWheelControl.activate();this.TvSeasonsWheelControl.loadData([{titleID:this.title.showTitleID}]);BrowseView.shrinkTitleDetails("episode-panel",null)}}else{var d=this.title.seasonal?"episodegrid":"episodegrid-wide";application.events.publish("gridloading",{grid:"titlegrid",message:"tvloading",className:d,cssClass:"tv"});$cn.methods.getBundleListing(this.title.showTitleID,function(e){log.write(e.bundleItems.length);application.currentView.layoutIsDirty=true;if(e.bundleItems.length==0){log.write("##### ERROR - Empty bundle listing ######");application.events.publish("error",{type:"system_error",method:"getBundleListing"});return}BrowseView.shrinkTitleDetails("episode-panel",null);if(!this.title.seasonal){$("titlegrid").show();BrowseView.LastGridProcess="episodelist";application.events.publish("loadgrid",{grid:"titlegrid",data:[],columns:1,template:"listgrid",gridProcess:"episodelist",className:"episodegrid-wide",returnFocus:application.element.current});navigation.setFocusElement($("titlelist").getElements("a")[0],true)}else{this.TvSeasonsWheelControl.activate();this.TvSeasonsWheelControl.loadData(e.bundleItems,this.title.seasonTitleID)}}.bind(this))}},hide:function(){},onItemSelected:function(d){if(this.TvSeasonsWheelControl.isLibrary){$cn.methods.lookupPurchaseDetailsForTitle(d,function(e){application.events.publish("loadtitleview",{id:d,passID:parseInt(e.passID),type:"library"})})}else{application.events.publish("loadtitleview",{id:d,checklibrary:true})}}});var WelcomeControlProperties={id:"welcomecontrol",persist:{},controls:{},buttons:[],layoutIsDirty:true,_data:[],lastFocus:null,firstFocus:null,contentControlId:"",contentId:"welcomecontrol",initialize:function(e,d){this.id=e},getStarted:function(){$("welcomeintro").hide();$("welcomebutton").hide();if($("welcomebuttonmask")){$("welcomebuttonmask").hide()}application.events.unsubscribe(this,"pointeractivated");$("welcomemessage").show();if($cn.config.EnableUV&&$("uvwelcomebenefit")){$("uvwelcomebenefit").removeClass("hidden")}application.navigator.setFocus("leftbutton",true)},startActivation:function(){BrowseView.ActivationPcView.activeFromWelcome=true;BrowseView.ActivationPcView.show()},explore:function(){this.hide()},init:function(f,e){log.write("merchcontrol.init()");var d=this;if(f){this.persist=f}},cleanUI:function(){},loadData:function(d){this._data=[];this._data=d},show:function(){log.write("Showing Welcome Page.");application.events.subscribe(this,"pointeractivated",this.onPointerActivated.bind(this));$("welcome").show()},onBack:function(d){log.write(d)},hide:function(d){if($cn.data.d2dPath){log.write("D2D LOAD TITLE");log.write("D2D LOAD TITLE");log.write("D2D LOAD TITLE");log.write("D2D LOAD TITLE");log.write("D2D LOAD TITLE");log.write("D2D LOAD TITLE");$("store").set("class","browse-view");application.events.publish("loadtitleview",{id:$cn.data.d2dTitleInfo.id,action:"checkout"});setTimeout(function(){if($("welcome")){$("welcome").destroy()}if(d){d()}}.bind(this),200)}else{if($cn.data.EnableMerchPage){setTimeout(function(){$("welcome").destroy();if(d){d()}BrowseView.showMerch();application.navigator.setFocus("f_button",true)}.bind(this),200)}else{$("store").set("class","browse-view");BrowseView.showMessage("message_loading",{Message:application.resource.loading_enum.loadinggeneric});BrowseView.goHome(true);setTimeout(function(){if($("welcome")){$("welcome").destroy()}if(BrowseView&&BrowseView.MessagePopup){BrowseView.MessagePopup.hide()}if(d){d()}application.navigator.setFocus("selectedmaster",true)}.bind(this),2000)}}},onPointerActivated:function(){pointer.lastFocusId="welcomebutton"}},WelcomeControl=new Class(WelcomeControlProperties);var AudioPopup=new Class({Extends:ModalControl,id:"audiopopup",titleID:0,passID:0,resume:0,callback:null,initialize:function(){log.write("audiopopup.init()");this.parent(this.id)},navigate:function(k){if($$("div.audiopopup").length>0&&$$("div.audiopopup")[0].style.display=="block"){var j=k.args[0].current;if($(j).rel=="audioanchor"){if(k.args[0].direction=="up"||k.args[0].direction=="down"){k.preventDefault();var g=$$("a[rel=audioanchor]"),f=[],e=0,h=0,d;for(d=0;d<g.length;d++){if(j==g[d].id){h=e}if(document.getElementById(g[d].id).offsetWidth>0){f[f.length]=g[d];e++}}if(k.args[0].direction=="up"){if(h>0){navigation.setFocus(f[h-1].id,true)}else{navigation.setFocus(f[f.length-1].id,true)}}else{if(k.args[0].direction=="down"){if(h<f.length-1){navigation.setFocus(f[h+1].id,true)}else{navigation.setFocus(f[0].id,true)}}}}}}},show:function(h,j,g,k){var d;this.lastFocus=application.element.current;this.parent();this.titleID=h;this.passID=j;this.resume=g;this.callback=k;application.events.subscribe(this,"elementfocus",this.onFocus.bind(this));application.events.subscribe(this,"navigate",this.navigate.bind(this));var f=$cn.utilities.getAudioProfileTypesForPurchase(j);for(var e=0;e<f.length;e++){if(f[e]=="Dolby"){$("audio_dolby").removeClass("hidden");application.navigator.setFocus("audio_dolby",true)}if(f[e]=="DTS"){$("audio_dts").removeClass("hidden");application.navigator.setFocus("audio_dts",true)}}},hide:function(){application.events.unsubscribe(this,"elementfocus");application.events.unsubscribe(this,"navigate");this.parent()},onFocus:function(){if($$("div.audiopopup").length>0){switch(application.element.current){case"audio_stereo":$$("p.audiopromo").addClass("hidden");$("aacselected").removeClass("hidden");break;case"audio_dts":$$("p.audiopromo").addClass("hidden");$("dtsselected").removeClass("hidden");break;case"audio_dolby":$$("p.audiopromo").addClass("hidden");$("dolbyselected").removeClass("hidden");break;default:break}}},selectAudioFormat:function(d){$cn.data.PreferredAudioType=d;$cn.data.PreferredAudioTypeSet=true;configuration.writeValue("DefaultAudioFormat",$cn.data.PreferredAudioType);configuration.writeValue("AudioSetupDisplayed",$cn.data.PreferredAudioTypeSet);$cn.methods.setAudioDefaultProperty(d,function(){this.hide();if(this.callback){this.callback.call()}else{BrowseView.showPlay(this.titleID,this.passID,this.resume,true)}}.bind(this))}});var CCPopup=new Class({Extends:ModalControl,id:"ccsettingpopup",_ccValues:{},_ccSeleted:{},_currentIndex:0,callback:null,hideCallback:null,initialize:function(){this.parent("ccsettingpopup");this._ccValues={CCTextColor:["auto","white","black","red","green","blue","yellow","magenta","cyan"],CCTextOpacity:["auto",100,75,50,25],CCTextSize:["auto",200,150,100,75,50],CCFont:["auto","monospaceSerif","proportionalSerif","monospaceSansSerif","proportionalSansSerif","casual","cursive","smallCaps"],CCBackgroundColor:["auto","white","black","red","green","blue","yellow","magenta","cyan"],CCBackgroundOpacity:["auto",100,75,50,25,0],CCTextEdge:["auto","none","raised","depressed","uniform","drop_shadowed"],CCWindowColor:["auto","white","black","red","green","blue","yellow","magenta","cyan"],CCWindowOpacity:["auto",100,75,0],CCLanguage:["auto","normal","simplified"]};this._ccSeleted={CCTextColor:{index:0,value:"auto"},CCTextOpacity:{index:0,value:"auto"},CCTextSize:{index:0,value:"auto"},CCFont:{index:0,value:"auto"},CCBackgroundColor:{index:0,value:"auto"},CCBackgroundOpacity:{index:0,value:"auto"},CCTextEdge:{index:0,value:"auto"},CCWindowColor:{index:0,value:"auto"},CCWindowOpacity:{index:0,value:"auto"},CCLanguage:{index:0,value:"auto"}};this._ccSeleted.CCTextColor.value=$cn.data.CCTextColor?$cn.data.CCTextColor:"auto";this._ccSeleted.CCTextOpacity.value=$cn.data.CCTextOpacity||$cn.data.CCTextOpacity==0?$cn.data.CCTextOpacity:"auto";this._ccSeleted.CCTextSize.value=$cn.data.CCTextSize?$cn.data.CCTextSize:"auto";this._ccSeleted.CCFont.value=$cn.data.CCFont?$cn.data.CCFont:"auto";this._ccSeleted.CCBackgroundColor.value=$cn.data.CCBackgroundColor?$cn.data.CCBackgroundColor:"auto";this._ccSeleted.CCBackgroundOpacity.value=$cn.data.CCBackgroundOpacity||$cn.data.CCBackgroundOpacity==0?$cn.data.CCBackgroundOpacity:"auto";this._ccSeleted.CCTextEdge.value=$cn.data.CCTextEdge?$cn.data.CCTextEdge:"auto";this._ccSeleted.CCWindowColor.value=$cn.data.CCWindowColor?$cn.data.CCWindowColor:"auto";this._ccSeleted.CCWindowOpacity.value=$cn.data.CCWindowOpacity||$cn.data.CCWindowOpacity==0?$cn.data.CCWindowOpacity:"auto";this._ccSeleted.CCLanguage.value=$cn.data.CCLanguage?$cn.data.CCLanguage:"auto"},navigate:function(g){if(document.getElementById(application.element.current)&&$(application.element.current).hasClass("ccOption")){switch(g.args[0].direction){case"up":break;case"down":break;case"left":g.preventDefault();var e=g.context._ccValues[application.element.current];var f=g.context._ccSeleted[application.element.current];var h=f.index;var d=f.value;h=h-1<0?e.length-1:h-1;f.value=e[h];f.index=h;g.context._ccSeleted[application.element.current]=f;$(application.element.current).set("html",f.value);break;case"right":g.preventDefault();var e=g.context._ccValues[application.element.current];var f=g.context._ccSeleted[application.element.current];var h=f.index;var d=f.value;h=h+1>e.length-1?0:h+1;f.value=e[h];f.index=h;g.context._ccSeleted[application.element.current]=f;$(application.element.current).set("html",f.value);break}}},show:function(){$("CCTextColor").set("html",$cn.data.CCTextColor?$cn.data.CCTextColor:"auto");$("CCTextOpacity").set("html",$cn.data.CCTextOpacity||$cn.data.CCTextOpacity==0?$cn.data.CCTextOpacity:"auto");$("CCTextSize").set("html",$cn.data.CCTextSize?$cn.data.CCTextSize:"auto");$("CCFont").set("html",$cn.data.CCFont?$cn.data.CCFont:"auto");$("CCBackgroundColor").set("html",$cn.data.CCBackgroundColor?$cn.data.CCBackgroundColor:"auto");$("CCBackgroundOpacity").set("html",$cn.data.CCBackgroundOpacity||$cn.data.CCBackgroundOpacity==0?$cn.data.CCBackgroundOpacity:"auto");$("CCTextEdge").set("html",$cn.data.CCTextEdge?$cn.data.CCTextEdge:"auto");$("CCWindowColor").set("html",$cn.data.CCWindowColor?$cn.data.CCWindowColor:"auto");$("CCWindowOpacity").set("html",$cn.data.CCWindowOpacity||$cn.data.CCWindowOpacity==0?$cn.data.CCWindowOpacity:"auto");$("CCLanguage").set("html",$cn.data.CCLanguage?$cn.data.CCLanguage:"auto");this.parent();application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"back",this.handleBack.bind(this));application.events.subscribe(this,"keydown",this.handleKeyPress.bind(this))},unsubEvents:function(){application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"back");application.events.unsubscribe(this,"keydown")},handleBack:function(d){d.preventDefault();this.unsubEvents();this.hide()},handleKeyPress:function(d){},saveSettings:function(){$cn.data.CCTextColor=this._ccSeleted.CCTextColor.value;$cn.data.CCTextOpacity=this._ccSeleted.CCTextOpacity.value;$cn.data.CCTextSize=this._ccSeleted.CCTextSize.value;$cn.data.CCFont=this._ccSeleted.CCFont.value;$cn.data.CCBackgroundColor=this._ccSeleted.CCBackgroundColor.value;$cn.data.CCBackgroundOpacity=this._ccSeleted.CCBackgroundOpacity.value;$cn.data.CCTextEdge=this._ccSeleted.CCTextEdge.value;$cn.data.CCWindowColor=this._ccSeleted.CCWindowColor.value;$cn.data.CCWindowOpacity=this._ccSeleted.CCWindowOpacity.value;$cn.data.CCLanguage=this._ccSeleted.CCLanguage.value;application.saveAuthToken();this.hide()},hide:function(){this.unsubEvents();this.parent()},cancel:function(){this.hide()}});var MerchControlProperties={id:"merchcontrol",persist:{},controls:{},buttons:[],layoutIsDirty:true,_data:[],tpl:null,tplTvShows:null,tplNewMovies:null,tplFeature:null,tplCollection:null,tplActions:null,scroll:false,lastFocus:null,firstFocus:null,contentControlId:"",contentId:"merchcontrol",initialize:function(e,d){application.events.subscribe(this,"restorestate",this.onRestoreState.bind(this));this.id=e;this.tplTvShows=new ui.template("newtvshows",application.ui.loadTpl("merch_newtvshows.tpl"));this.tplTvShows.compile();this.tplNewMovies=new ui.template("newmovies",application.ui.loadTpl("merch_newmovies.tpl"));this.tplNewMovies.compile();this.tplFeature=new ui.template("featuredpromotion",application.ui.loadTpl("merch_feature.tpl"));this.tplFeature.compile();this.tplCollection=new ui.template("newcollections",application.ui.loadTpl("merch_collection.tpl"));this.tplCollection.compile();this.tplActions=new ui.template("actionbuttoncontainer",application.ui.loadTpl("merchactionbuttons.tpl"));this.tplActions.compile()},init:function(e,d){log.write("merchcontrol.init()");if(e){this.persist=e}},cleanUI:function(){},loadData:function(d){this._data=[];this._data=d},show:function(){var e=this,d,f=$cn.config.MaxMerchThumbs||5;log.write("Showing Merch Page.");application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"displaytitledetails",this.loadtitleview.bind(this));application.events.subscribe(this,"loadgenreview",this.loadgenreview.bind(this));if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastFocus=application.element.current}$("newcollectionheader").set("text",$cn.data.Merch.newCollectionHeader);$("newmovieheader").set("text",$cn.data.Merch.newMovieHeader);$("newtvshowheader").set("text",$cn.data.Merch.newTVShowHeader);$("merchpage").show();this.tplNewMovies.empty();this.tplTvShows.empty();this.tplFeature.empty();this.tplCollection.empty();this.tplActions.empty();this.tplFeature.append($cn.data.Merch.featuredPromotion);if($("featuredtitleheader")){$("featuredtitleheader").set("text",$cn.data.Merch.featuredPromotion.name)}d=0;$cn.data.Merch.newMovies.each(function(g){if(d<f){g.titleidx=d++;if(typeof $cn.config.CustomDefaultGridImage=="function"){g.defaultImageClass=$cn.config.CustomDefaultGridImage()}e.tplNewMovies.append(g)}});d=0;$cn.data.Merch.newTVShows.each(function(g){if(d<f){g.titleidx=d++;if(typeof $cn.config.CustomDefaultGridImage=="function"){g.defaultImageClass=$cn.config.CustomDefaultGridImage()}e.tplTvShows.append(g)}});d=0;if($cn.data.Merch.newCollections.length){log.write("we have new collections length");for(d=0;d<$cn.data.Merch.newCollections.length;d+=1){if($cn.config.MaxMerchCollections&&$cn.data.Merch.newCollections.length>$cn.config.MaxMerchCollections){$cn.data.Merch.newCollections.length=$cn.config.MaxMerchCollections}$cn.data.Merch.newCollections[d].titleidx=d;e.tplCollection.append($cn.data.Merch.newCollections[d])}}else{log.write("we do NOT have new collections length");e.tplCollection.append($cn.data.Merch.newCollections)}d=0;$cn.data.Merch.actionButtons.each(function(g){g.titleidx=d++;e.tplActions.append(g)});this.tplNewMovies.apply();this.tplTvShows.apply();this.tplFeature.apply();this.tplCollection.apply();this.tplActions.apply();navigation.setFocus("f_button",true)},keydown:function(d){switch(d){case"Store":this.hide();BrowseView.goHome();break;case"MyLibrary":this.hide();navigation.setFocus("dock-library",true);BrowseView.goLibrary(function(){$("mainstage").hide()},function(){$("mainstage").show()});break;default:break}},navigate:function(j){var d,h=$(application.element.current).get("class").replace("hover","").replace("default","").trim(),f=$cn.config.MaxMerchThumbs<$cn.data.Merch.newMovies.length?$cn.config.MaxMerchThumbs:$cn.data.Merch.newMovies.length,e=$cn.config.MaxMerchThumbs<$cn.data.Merch.newTVShows.length?$cn.config.MaxMerchThumbs:$cn.data.Merch.newTVShows.length,g=$cn.data.Merch.newCollections.length;direction=j.args[0].direction;if(h.indexOf("activate")==-1&&document.getElementById("modalcontrol").style.display!="block"){if(BrowseView.currentState=="merch-view"){log.write("Merch page listening.");j.preventDefault();switch(h){case"featuredpromotion":if(direction==="up"){navigation.setFocusElement($("newcollections").getElement("a[titleidx='"+(g-1)+"']"),true)}if(direction==="down"){navigation.setFocusElement($("newcollections").getElement("a[titleidx='0']"),true)}else{if(direction==="right"){navigation.setFocusElement($("newmovies").getElement("a[titleidx='0']"),true)}else{if(direction==="left"){navigation.setFocusElement($("newmovies").getElement("a[titleidx='"+(f-1)+"']"),true)}}}break;case"newmovie":d=parseInt($(application.element.current).get("titleidx"));if(direction==="down"){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='"+d+"']"),true)}if(direction==="up"){if(d<2){navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='0']"),true)}else{navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='1']"),true)}}else{if(direction==="right"){if(f>d+1){navigation.setFocusElement($("newmovies").getElement("a[titleidx='"+(d+1)+"']"),true)}else{navigation.setFocusElement($("featuredpromotion").getElement("a"),true)}}else{if(direction==="left"){if(d>0){navigation.setFocusElement($("newmovies").getElement("a[titleidx='"+(d-1)+"']"),true)}else{navigation.setFocusElement($("featuredpromotion").getElement("a"),true)}}}}break;case"newtvshows":d=parseInt($(application.element.current).get("titleidx"));if(direction==="up"){navigation.setFocusElement($("newmovies").getElement("a[titleidx='"+d+"']"),true)}else{if(direction==="down"){if(d<2){navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='0']"),true)}else{navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='1']"),true)}}else{if(direction==="right"){if(e>d+1){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='"+(d+1)+"']"),true)}else{navigation.setFocusElement($("newcollections").getElement("a"),true)}}else{if(direction==="left"){if(d>0){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='"+(d-1)+"']"),true)}else{navigation.setFocusElement($("newcollections").getElement("a"),true)}}}}}break;case"button":d=parseInt($(application.element.current).get("titleidx"));if(direction==="up"){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='"+(d===0?0:2)+"']"),true)}if(direction==="down"){navigation.setFocusElement($("newmovies").getElement("a[titleidx='"+(d===0?0:2)+"']"),true)}else{if(direction==="right"){if($cn.data.Merch.actionButtons.length>(d+1)){navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='"+(d+1)+"']"),true)}else{navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='0']"),true)}}else{if(direction==="left"){navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='"+(d?0:1)+"']"),true)}}}break;case"collection":d=parseInt($(application.element.current).get("titleidx"));if(direction==="right"){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='0']"),true)}else{if(direction==="left"){navigation.setFocusElement($("newtvshows").getElement("a[titleidx='"+(e-1)+"']"),true)}else{if(d===0&&direction==="up"){navigation.setFocusElement($("featuredpromotion").getElement("a"),true)}else{if(d+1===g&&direction==="down"){navigation.setFocusElement($("actionbuttoncontainer").getElement("a[titleidx='0']"),true)}else{if(direction==="up"){navigation.setFocusElement($("newcollections").getElement("a[titleidx='"+(d-1)+"']"),true)}else{if(direction==="down"){navigation.setFocusElement($("newcollections").getElement("a[titleidx='"+(d+1)+"']"),true)}}}}}}break;default:break}}}},loadgenreview:function(l){var e=l.args[0],m=null,g=null,j=null,n=0,k=0,f=0,h=0;if(!$cn.utilities.haveGenreId(e.id)){$("merchpage").hide();BrowseView.goHome();return}$("merchpage").hide();for(var q in $cn.data.slaveWheel){$cn.data.slaveWheel[q].each(function(p){if(p.iD==e.id){h=p.parentId;j=$cn.data.slaveWheel[q];g=p;j.each(function(r){if(g.iD==r.iD){f=n}n++})}})}n=0;$cn.data.masterWheel.each(function(p){if(h==p.iD){k=n;m=p}n++});BrowseView.goHome();BrowseView.WheelControl.loadData($cn.data.masterWheel,$cn.data.slaveWheel,k);BrowseView.WheelControl._slaveWheel.render(j,f);application.events.publish("wheelrendered",{sourceid:"WheelControl",source:"slavedatasource",selectedidx:f,selectedvalue:g.iD});application.events.publish("wheelitemchanged",{wheelinstance:"WheelControl",sourceid:"WheelControl",source:"slavedatasource",selectedidx:f,selectedvalue:g.iD});var d=$("titlegrid").getElementsByTagName("a");if(d.length>0){navigation.setFocusElement($("titlegrid").getElement(d[0].id),true)}else{navigation.setFocus("selectedslave",true)}},loadtitleview:function(d){$("merchpage").hide()},hide:function(){BrowseView.hideExtras();$("titlegrid").show();$("wheel").show();$("dock").show();navigation.setFocus("selectedmaster",true);$("merchpage").hide();application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"displaytitledetails");application.events.unsubscribe(this,"loadgenreview")},onBack:function(d){if(d){d.preventDefault()}},onRestoreState:function(){if(BrowseView.currentState==="merch-view"){application.events.unsubscribe(this,"navigate");application.events.unsubscribe(this,"displaytitledetails");application.events.unsubscribe(this,"loadgenreview");application.events.subscribe(this,"navigate",this.navigate.bind(this));application.events.subscribe(this,"displaytitledetails",this.loadtitleview.bind(this));application.events.subscribe(this,"loadgenreview",this.loadgenreview.bind(this));$("merchpage").show()}}},MerchControl=new Class(MerchControlProperties);var SignInControl=new Class({id:"signincontrol",persist:{},controls:{},buttons:[],layoutIsDirty:true,_data:[],tpl:null,lastFocus:null,firstFocus:null,contentControlId:"",contentId:"merchcontrol",initialize:function(f,d){this.id=f;var e=f;if(f=="accountfeature"||f=="checkout"){e="activate"}this.tpl=new ui.template(d,application.ui.loadTpl("signin_"+e+".tpl"));this.tpl.compile()},init:function(f,e){log.write("signincontrol.init()");var d=this;if(f){this.persist=f}},cleanUI:function(){},loadData:function(d){this._data=[];this._data=d},show:function(){$("dock").hide();$("wheel").hide();$("gridview").hide();$("signin").show();application.events.subscribe(this,"loadforgotpassword",this.forgotpassword.bind(this));if(application.element.current!=null&&application.element.current!=""&&document.getElementById(application.element.current)){this.lastFocus=application.element.current}var d="",e="";if(this.id=="accountfeature"){d="You need to activate this device to use this feature."}else{if(this.id=="checkout"){d="You need to activate this device to make purchases."}else{e="hide"}}this.tpl.empty();this.tpl.append({message:d,className:e});this.tpl.apply();navigation.setFocus("SignInUserName")},signin:function(){alert("signin")},forgotpassword:function(d){alert("forgotpassword")},createaccount:function(d){alert("create account")},activate:function(d){alert("activate")},hide:function(){},onBack:function(d){if(d){d.preventDefault()}}});var ActivationPcView=new Class({id:"activateview",persist:{},controls:{},layoutIsDirty:true,tpl:null,code:"",pollTimer:null,pollTimerStarted:false,inPolling:false,activeFromWelcome:true,payload:null,focusElement:"",initialize:function(){log.write("activate.init()")},cancel:function(){$("activatefullscreen").hide();application.navigator.setFocus("leftbutton",true);this.pollTimer.Stop();this.pollTimerStarted=false;this.inPolling=false},startBase:function(){this.loadData();if(document.getElementById("activationintro")){$("activationintro").hide()}$("activationbody").show()},start:function(){this.startBase();application.navigator.setFocus("generatenewcodebutton",true)},startFirstTime:function(){this.startBase();application.navigator.setFocus("activationbodycancelbutton",true)},loadData:function(){var d=this;this.displayCode();if(this.pollTimer===null){this.pollTimer=new Timer();this.pollTimer.Interval=5000;this.pollTimer.Tick=function(){if(document.getElementById("ActivateContent").style.display=="none"){log.write("Activate panel is not displayed but is still polling. Stop it!");d.pollTimer.Stop();d.pollTimerStarted=false}else{if(d.inPolling){return}log.write("Polling for auth token...");d.inPolling=true;$cn.methods.pollForToken(function(e){d.inPolling=false;if(e.authToken){if(e.authToken.length>0){$cn.utilities.setParentalSettings(e);d.pollTimerStarted=false;d.pollTimer.Stop();d.showActivateSuccessPage()}}})}}}},showActivateSuccessPage:function(){var d=this;if(!this.activeFromWelcome){$("activatefullscreen").show();$("activationintro").hide()}$("activationdevicename").innerHTML='"'+$cn.data.DeviceName+'"';$("acctCredit").innerHTML="";$("accountCredit").hide();$("accountCreditNoBilling").hide();$("noBilling").hide();$cn.methods.getBillingInfo(function(e){if(e.giftCertificateBalance>0){$("acctCredit").innerHTML=application.resource.currency_symbol+$cn.utilities.formatAsMoney(e.giftCertificateBalance);$("accountCredit").show();if(e.cCLast4===""){$("accountCreditNoBilling").show()}}else{if(e.cCLast4===""){$("noBilling").show()}}if($cn.config.EnableUV){$("activationsuccesscontent").addClass("successuvbg")}else{$("uvNotifyMessage").hide()}$("activationbody").hide();$("activationsuccess").show();d.focusElement=application.element.current;application.navigator.setFocus("activationcontinuebutton",true)})},displayCode:function(){var e=this,d,f;f=$cn.utilities.showLoadingModal(2000,"Loading Activation String...");application.TempKeyBlock=true;$cn.methods.getActivationString(function(g){application.TempKeyBlock=false;$cn.utilities.clearLoadingSpinner(f);log.write("activation string: "+g);e.code=g;for(d=0;d<g.length;d++){try{$("Code"+d).innerHTML=g.substring(d,d+1)}catch(h){log.write(log.dumpObj(h));return}}if(application.authSupported){if(!e.pollTimerStarted){e.pollTimerStarted=true;e.pollTimer.Start()}}})},show:function(){var d=$("activationintro"),e=$("activationbody");$("activatefullscreen").show();$("Code0").innerHTML="";$("Code1").innerHTML="";$("Code2").innerHTML="";$("Code3").innerHTML="";$("Code4").innerHTML="";$("Code5").innerHTML="";$("Code6").innerHTML="";application.currentView.layoutIsDirty=true;$$("#activationintro .content .url").set("html",$cn.data.ActivationURL);$$("#activationbody span.url").set("html",$cn.data.ActivationURL);if(d){e.hide();d.show();application.navigator.setFocus("okaybuttonactivation",true)}else{e.show();this.startFirstTime()}},hide:function(){log.write("Hiding activate");if(this.activeFromWelcome){if(application.authSupported){log.write("Stopping Activation timer.");if(this.pollTimer){this.pollTimer.Stop();this.pollTimerStarted=false;this.inPolling=false}}BrowseView.WelcomeControl.hide(function(){$("activatefullscreen").hide()})}else{application.element.current=this.focusElement;$("activatefullscreen").hide();application.events.publish("activated",(this.payload)?this.payload:{});if(!this.payload){application.navigator.setFocus(this.focusElement,true)}}application.currentView.layoutIsDirty=true},poll:function(){$cn.methods.pollForToken(function(d){log.write(log.dumpObj(d.data.result))})},onBack:function(d){this.parent(d);log.write("onBack getting called");if(this.payload&&this.payload.onCancel){log.write("onBack with payload getting called");this.payload.onCancel.call()}else{application.events.publish("activatecancelled",{})}}});